import{a as c}from"./chunk-VIUQYQMJ.js";import{Da as r,Ia as a,Jb as o,S as i,za as s}from"./chunk-OKFD3A6M.js";var d=class t{templateRef=i(s);viewContainer=i(r);rbacService=i(c);cdr=i(o);subscription;embeddedView=null;hasAccess=!1;featureKey;mode="hide";ngOnInit(){if(!this.featureKey){console.warn("CanAccessDirective: featureKey is required");return}this.checkAccess(),this.subscription=this.rbacService.getPermissionContext$().subscribe(()=>{this.checkAccess()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this.clearView()}checkAccess(){let e=this.rbacService.canAccessFeature(this.featureKey);e!==this.hasAccess&&(this.hasAccess=e,this.updateView())}updateView(){if(this.mode==="hide")this.hasAccess?this.embeddedView||(this.embeddedView=this.viewContainer.createEmbeddedView(this.templateRef)):this.clearView();else if(this.embeddedView||(this.embeddedView=this.viewContainer.createEmbeddedView(this.templateRef)),this.embeddedView.rootNodes&&this.embeddedView.rootNodes.length>0){let e=this.embeddedView.rootNodes[0];this.mode==="disable"?this.hasAccess?(e.removeAttribute("disabled"),e.removeAttribute("aria-disabled"),e.classList.remove("opacity-50","pointer-events-none")):(e.setAttribute("disabled","true"),e.setAttribute("aria-disabled","true"),e.classList.add("opacity-50","pointer-events-none")):this.mode==="readonly"&&(this.hasAccess?(e.removeAttribute("readonly"),e.removeAttribute("aria-readonly")):(e.setAttribute("readonly","true"),e.setAttribute("aria-readonly","true"),e.addEventListener&&(e.addEventListener("click",this.blockClick,!0),e.addEventListener("submit",this.blockSubmit,!0))))}this.cdr.markForCheck()}blockClick=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()};blockSubmit=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()};clearView(){this.embeddedView&&(this.mode==="readonly"&&this.embeddedView.rootNodes&&this.embeddedView.rootNodes.forEach(e=>{e.removeEventListener&&(e.removeEventListener("click",this.blockClick,!0),e.removeEventListener("submit",this.blockSubmit,!0))}),this.viewContainer.clear(),this.embeddedView=null)}static \u0275fac=function(n){return new(n||t)};static \u0275dir=a({type:t,selectors:[["","appCanAccess",""]],inputs:{featureKey:[0,"appCanAccess","featureKey"],mode:"mode"}})};export{d as a};
