import{a as $}from"./chunk-QSZBM4NB.js";import{a as H}from"./chunk-P5TE6FOK.js";import{a as F}from"./chunk-M3W4QUEG.js";import"./chunk-BYXBJQAS.js";import{d as V}from"./chunk-QHH3SHC3.js";import{a as L,b as G}from"./chunk-7DC7YEPQ.js";import{$ as m,$a as e,$b as z,Bb as d,Cb as s,Ga as T,La as b,Ra as S,S as v,Va as B,Wa as _,Y as P,Z as M,Za as C,_ as p,_a as w,ab as n,bb as g,db as k,eb as E,fb as h,nb as o,ob as c,pb as O,qb as A,xa as r}from"./chunk-OKFD3A6M.js";import{a as I,b as D}from"./chunk-KAT7YFEL.js";var q=(a,i)=>i.pharmacy.id,W=(a,i)=>i.id;function U(a,i){if(a&1){let t=k();e(0,"div",36),E("click",function(){let l=P(t).$implicit,u=h(3);return M(u.viewDrug(l.id))}),e(1,"div",37)(2,"h4",38),o(3),n(),e(4,"button",39),d(5,"translate"),p(),e(6,"svg",40),g(7,"path",41)(8,"circle",42),n()()(),m(),e(9,"div",43),p(),e(10,"svg",44),g(11,"rect",45)(12,"rect",46)(13,"rect",47)(14,"rect",48),n(),m(),e(15,"span"),o(16),n()(),e(17,"div",49)(18,"div",50)(19,"span",51),o(20),d(21,"translate"),n(),e(22,"span",52),o(23),n()(),e(24,"div",50)(25,"span",51),o(26),d(27,"translate"),n(),e(28,"span",53),o(29),n()(),e(30,"div",50)(31,"span",51),o(32),d(33,"translate"),n(),e(34,"span",53),o(35),n()()()()}if(a&2){let t=i.$implicit;r(3),c((t.generalDrug==null?null:t.generalDrug.name)||"N/A"),r(),S("title",s(5,9,"common.view")),r(12),c(t.internalBarcode),r(4),c(s(21,11,"inventory.currentStock")),r(3),c(t.stockQuantity),r(3),c(s(27,13,"inventory.minimumStock")),r(3),c(t.minimumStock),r(3),c(s(33,15,"drug.price")),r(3),c(t.price)}}function J(a,i){if(a&1&&(e(0,"div",30),C(1,U,36,17,"div",35,W),n()),a&2){let t=h().$implicit;r(),w(t.lowStockDrugs)}}function K(a,i){a&1&&(e(0,"div",31),p(),e(1,"svg",54),g(2,"path",55),n(),m(),e(3,"p"),o(4),d(5,"translate"),n()()),a&2&&(r(4),c(s(5,1,"inventory.adequateStock")))}function X(a,i){if(a&1&&(e(0,"div"),o(1),n()),a&2){let t=h().$implicit,f=h(3);B("days-badge "+f.getExpiryBadgeClass(t.daysToExpiry)),r(),O(" ",f.formatDaysToExpiry(t.daysToExpiry)," ")}}function Z(a,i){if(a&1){let t=k();e(0,"div",36),E("click",function(){let l=P(t).$implicit,u=h(3);return M(u.viewDrug(l.id))}),e(1,"div",37)(2,"h4",38),o(3),n(),e(4,"button",39),d(5,"translate"),p(),e(6,"svg",40),g(7,"path",41)(8,"circle",42),n()()(),m(),e(9,"div",43),p(),e(10,"svg",44),g(11,"rect",45)(12,"rect",46)(13,"rect",47)(14,"rect",48),n(),m(),e(15,"span"),o(16),n()(),e(17,"div",56)(18,"div",57),p(),e(19,"svg",14),g(20,"rect",58)(21,"line",59)(22,"line",60)(23,"line",61),n(),m(),e(24,"span"),o(25),d(26,"dateFormat"),n()(),b(27,X,2,3,"div",62),n(),e(28,"div",63)(29,"span",64),o(30),d(31,"translate"),n(),e(32,"span",65),o(33),d(34,"translate"),n()()()}if(a&2){let t=i.$implicit;r(3),c((t.generalDrug==null?null:t.generalDrug.name)||"N/A"),r(),S("title",s(5,8,"common.view")),r(12),c(t.internalBarcode),r(9),c(s(26,10,t.expiryDate)),r(2),_(t.daysToExpiry!==void 0?27:-1),r(3),O("",s(31,12,"drug.stock"),":"),r(3),A("",t.stockQuantity," ",s(34,14,"inventory.items"),"")}}function ee(a,i){if(a&1&&(e(0,"div",30),C(1,Z,35,16,"div",35,W),n()),a&2){let t=h().$implicit;r(),w(t.nearExpiryDrugs)}}function te(a,i){a&1&&(e(0,"div",31),p(),e(1,"svg",54),g(2,"path",55),n(),m(),e(3,"p"),o(4),d(5,"translate"),n()()),a&2&&(r(4),c(s(5,1,"inventory.noExpiring")))}function ne(a,i){if(a&1&&(e(0,"div",1)(1,"div",3)(2,"div",4)(3,"div",5),p(),e(4,"svg",6),g(5,"path",7)(6,"circle",8),n()(),m(),e(7,"div",9)(8,"h2",10),o(9),n(),e(10,"p",11),o(11),n()()(),e(12,"div",12)(13,"div",13),p(),e(14,"svg",14),g(15,"path",15)(16,"line",16)(17,"line",17),n(),m(),e(18,"span"),o(19),n()(),e(20,"div",18),p(),e(21,"svg",14),g(22,"circle",19)(23,"polyline",20),n(),m(),e(24,"span"),o(25),n()()()(),e(26,"div",21)(27,"div",22)(28,"div",23)(29,"div",24)(30,"div",25),p(),e(31,"svg",26),g(32,"path",15)(33,"line",16)(34,"line",17),n()(),m(),e(35,"div")(36,"h3",27),o(37),d(38,"translate"),n(),e(39,"p",28),o(40),d(41,"translate"),n()()(),e(42,"div",29),o(43),n()(),b(44,J,3,0,"div",30)(45,K,6,3,"div",31),n(),e(46,"div",32)(47,"div",23)(48,"div",24)(49,"div",33),p(),e(50,"svg",26),g(51,"circle",19)(52,"polyline",20),n()(),m(),e(53,"div")(54,"h3",27),o(55),d(56,"translate"),n(),e(57,"p",28),o(58),d(59,"translate"),n()()(),e(60,"div",34),o(61),n()(),b(62,ee,3,0,"div",30)(63,te,6,3,"div",31),n()()()),a&2){let t=i.$implicit;r(9),c(t.pharmacy.name),r(2),c(t.pharmacy.address||t.pharmacy.email||""),r(8),c(t.lowStockDrugs.length),r(6),c(t.nearExpiryDrugs.length),r(12),c(s(38,12,"inventory.lowStock")),r(3),c(s(41,14,"inventory.belowMinimum")),r(3),c(t.lowStockDrugs.length),r(),_(t.lowStockDrugs.length>0?44:45),r(11),c(s(56,16,"inventory.nearExpiry")),r(3),c(s(59,18,"inventory.expiringWithin30Days")),r(3),c(t.nearExpiryDrugs.length),r(),_(t.nearExpiryDrugs.length>0?62:63)}}function ie(a,i){a&1&&(e(0,"div",2),p(),e(1,"svg",66),g(2,"path",7)(3,"circle",8),n(),m(),e(4,"p"),o(5),d(6,"translate"),n()()),a&2&&(r(5),c(s(6,1,"inventory.noPharmacies")))}var j=class a{drugsService=v($);router=v(V);translationService=v(L);authService=v(F);pharmacyAlerts=[];loading=!0;ngOnInit(){this.loadAlerts()}loadAlerts(){this.loading=!0;let i=this.authService.getCurrentUser();if(!i){this.loading=!1;return}let t=[];if(i.pharmacies&&i.pharmacies.length>0)t.push(...i.pharmacies);else if(i.pharmacyId){let l={id:i.pharmacyId,name:"Pharmacy",primaryColor:"#166534",secondaryColor:"#22c55e",sidebarColor:"#14532d"};t.push(l)}if(t.length===0){this.loading=!1;return}let f=t.map(l=>l.id);this.drugsService.getLowStockDrugs().subscribe({next:l=>{let u=l.filter(y=>f.includes(y.pharmacyId)),N=this.groupDrugsByPharmacy(u,t);this.drugsService.getExpiringDrugs(30).subscribe({next:y=>{let R=y.filter(x=>f.includes(x.pharmacyId)).map(x=>D(I({},x),{daysToExpiry:this.calculateDaysToExpiry(x.expiryDate)})).sort((x,Q)=>(x.daysToExpiry||999)-(Q.daysToExpiry||999)),Y=this.groupDrugsByPharmacy(R,t);this.pharmacyAlerts=t.map(x=>({pharmacy:x,lowStockDrugs:N[x.id]||[],nearExpiryDrugs:Y[x.id]||[]})),this.loading=!1},error:y=>{console.error("Error loading expiring drugs:",y),this.loading=!1}})},error:l=>{console.error("Error loading low stock drugs:",l),this.loading=!1}})}groupDrugsByPharmacy(i,t){let f={};return t.forEach(l=>{f[l.id]=i.filter(u=>u.pharmacyId===l.id)}),f}calculateDaysToExpiry(i){if(!i)return 999;let t=new Date,l=new Date(i).getTime()-t.getTime();return Math.ceil(l/(1e3*60*60*24))}formatDaysToExpiry(i){return i<0?this.translationService.translate("inventory.expired"):i===0?this.translationService.translate("inventory.expiresToday"):`${i} ${this.translationService.translate("common.days")}`}getExpiryBadgeClass(i){return i<0||i<=7?"critical":i<=14?"urgent":"warning"}getDaysToExpiryClass(i){return i<0?"text-red-600 font-semibold":i<=7?"text-red-600 font-medium":i<=14?"text-orange-600 font-medium":"text-yellow-600"}viewDrug(i){this.router.navigate(["/drugs",i])}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=T({type:a,selectors:[["app-pharmacies-inventory-alerts"]],decls:4,vars:1,consts:[[1,"alerts-container"],[1,"pharmacy-card"],[1,"no-pharmacies"],[1,"pharmacy-header"],[1,"header-content"],[1,"pharmacy-icon"],["width","32","height","32","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M3 21h18M5 21V7l8-4v18M19 21V10l-6-3"],["cx","9","cy","14","r","1","fill","currentColor"],[1,"pharmacy-info"],[1,"pharmacy-name"],[1,"pharmacy-address"],[1,"stats-overview"],[1,"stat-pill","stat-warning"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"],["x1","12","y1","9","x2","12","y2","13"],["x1","12","y1","17","x2","12.01","y2","17"],[1,"stat-pill","stat-danger"],["cx","12","cy","12","r","10"],["points","12 6 12 12 16 14"],[1,"alerts-grid"],[1,"alert-section","low-stock-section"],[1,"section-header"],[1,"section-title-wrapper"],[1,"alert-icon","warning-icon"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2.5"],[1,"section-title"],[1,"section-subtitle"],[1,"count-badge","warning-badge"],[1,"drug-cards"],[1,"empty-state"],[1,"alert-section","expiry-section"],[1,"alert-icon","danger-icon"],[1,"count-badge","danger-badge"],[1,"drug-card"],[1,"drug-card",3,"click"],[1,"drug-card-header"],[1,"drug-name"],[1,"view-btn",3,"title"],["width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"],["cx","12","cy","12","r","3"],[1,"drug-barcode"],["width","14","height","14","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["x","1","y","4","width","4","height","16"],["x","7","y","4","width","2","height","16"],["x","11","y","4","width","4","height","16"],["x","17","y","4","width","6","height","16"],[1,"drug-metrics"],[1,"metric"],[1,"metric-label"],[1,"metric-value","critical"],[1,"metric-value"],["width","48","height","48","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","1.5"],["d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"expiry-info"],[1,"expiry-date"],["x","3","y","4","width","18","height","18","rx","2","ry","2"],["x1","16","y1","2","x2","16","y2","6"],["x1","8","y1","2","x2","8","y2","6"],["x1","3","y1","10","x2","21","y2","10"],[3,"class"],[1,"drug-stock"],[1,"stock-label"],[1,"stock-value"],["width","64","height","64","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","1.5"]],template:function(t,f){t&1&&(e(0,"div",0),C(1,ne,64,20,"div",1,q,!1,ie,7,3,"div",2),n()),t&2&&(r(),w(f.pharmacyAlerts))},dependencies:[z,H,G],styles:['.alerts-container[_ngcontent-%COMP%]{padding:1.5rem;max-width:1600px;margin:0 auto;display:flex;flex-direction:column;gap:2rem}.pharmacy-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fff,#f8fafc);border-radius:20px;overflow:hidden;box-shadow:0 4px 20px #0000000f;border:1px solid rgba(226,232,240,.8);animation:_ngcontent-%COMP%_slideIn .4s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.pharmacy-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--sidebar-bg) 0%,var(--sidebar-bg) 100%);padding:2rem;position:relative;overflow:hidden}.pharmacy-header[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-50%;right:-10%;width:400px;height:400px;background:radial-gradient(circle,var(--sidebar-bg) 0%,transparent 70%);border-radius:50%}.header-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.25rem;position:relative;z-index:1;margin-bottom:1.5rem}.pharmacy-icon[_ngcontent-%COMP%]{width:56px;height:56px;background:linear-gradient(135deg,var(--sidebar-active-bg) 0%,var(--sidebar-active-bg) 100%);border-radius:14px;display:flex;align-items:center;justify-content:center;color:#000;box-shadow:0 4px 12px #3b82f64d}.pharmacy-info[_ngcontent-%COMP%]{flex:1}.pharmacy-name[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:#fff;margin:0 0 .25rem;letter-spacing:-.02em}.pharmacy-address[_ngcontent-%COMP%]{font-size:.9rem;color:#cbd5e1;margin:0}.stats-overview[_ngcontent-%COMP%]{display:flex;gap:1rem;position:relative;z-index:1}.stat-pill[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.625rem 1.125rem;border-radius:12px;font-weight:600;font-size:.95rem;backdrop-filter:blur(10px)}.stat-warning[_ngcontent-%COMP%]{background:#eab30826;color:#fbbf24;border:1px solid rgba(234,179,8,.3)}.stat-danger[_ngcontent-%COMP%]{background:#ef444426;color:#f87171;border:1px solid rgba(239,68,68,.3)}.alerts-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(500px,1fr));gap:1.5rem;padding:2rem}.alert-section[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.75rem;border:2px solid transparent;transition:all .3s ease}.low-stock-section[_ngcontent-%COMP%]{border-color:#eab30833;background:linear-gradient(135deg,#fffbeb,#fff)}.expiry-section[_ngcontent-%COMP%]{border-color:#ef444433;background:linear-gradient(135deg,#fef2f2,#fff)}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.5rem;padding-bottom:1.25rem;border-bottom:2px solid rgba(0,0,0,.05)}.section-title-wrapper[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-start}.alert-icon[_ngcontent-%COMP%]{width:42px;height:42px;border-radius:11px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.warning-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#fff;box-shadow:0 4px 12px #fbbf244d}.danger-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f87171,#ef4444);color:#fff;box-shadow:0 4px 12px #f871714d}.section-title[_ngcontent-%COMP%]{font-size:1.35rem;font-weight:700;color:#0f172a;margin:0 0 .25rem;letter-spacing:-.01em}.section-subtitle[_ngcontent-%COMP%]{font-size:.85rem;color:#64748b;margin:0}.count-badge[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:700;padding:.5rem 1rem;border-radius:10px;min-width:50px;text-align:center}.warning-badge[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#fff;box-shadow:0 3px 10px #fbbf2440}.danger-badge[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f87171,#ef4444);color:#fff;box-shadow:0 3px 10px #f8717140}.drug-cards[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.drug-card[_ngcontent-%COMP%]{background:#fff;border:1.5px solid rgba(226,232,240,.8);border-radius:14px;padding:1.25rem;transition:all .3s ease;cursor:pointer;position:relative}.drug-card[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;border-radius:14px;padding:1.5px;background:linear-gradient(135deg,transparent,transparent);-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude;opacity:0;transition:opacity .3s ease}.drug-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 8px 24px #00000014;border-color:#3b82f6}.drug-card[_ngcontent-%COMP%]:hover:before{opacity:1;background:linear-gradient(135deg,#3b82f6,#8b5cf6)}.drug-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem}.drug-name[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:#0f172a;margin:0;flex:1;line-height:1.4}.view-btn[_ngcontent-%COMP%]{background:#f1f5f9;border:none;width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;color:#64748b;cursor:pointer;transition:all .2s ease;flex-shrink:0}.view-btn[_ngcontent-%COMP%]:hover{background:#3b82f6;color:#fff;transform:scale(1.05)}.drug-barcode[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-family:Courier New,monospace;font-size:.85rem;color:#475569;background:#f8fafc;padding:.5rem .75rem;border-radius:8px;width:fit-content;margin-bottom:1rem}.drug-barcode[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#94a3b8}.drug-metrics[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;padding-top:1rem;border-top:1px solid #f1f5f9}.metric[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.metric-label[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b;text-transform:uppercase;letter-spacing:.05em;font-weight:500}.metric-value[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:700;color:#0f172a}.metric-value.critical[_ngcontent-%COMP%]{color:#ef4444;font-size:1.25rem}.expiry-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding:.875rem;background:#f8fafc;border-radius:10px}.expiry-date[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.9rem;color:#475569}.expiry-date[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#94a3b8}.days-badge[_ngcontent-%COMP%]{font-size:.85rem;font-weight:700;padding:.4rem .875rem;border-radius:8px;text-transform:uppercase;letter-spacing:.03em}.days-badge.critical[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;box-shadow:0 2px 8px #ef44444d}.days-badge.urgent[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f97316,#ea580c);color:#fff;box-shadow:0 2px 8px #f973164d}.days-badge.warning[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#fff;box-shadow:0 2px 8px #fbbf244d}.drug-stock[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background:#f1f5f9;border-radius:8px}.stock-label[_ngcontent-%COMP%]{font-size:.85rem;color:#64748b;font-weight:500}.stock-value[_ngcontent-%COMP%]{font-size:.95rem;font-weight:600;color:#0f172a}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 1rem;color:#94a3b8}.empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin-bottom:1rem;opacity:.5}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.95rem;margin:0}.no-pharmacies[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;background:#fff;border-radius:20px;color:#94a3b8;box-shadow:0 4px 20px #0000000f}.no-pharmacies[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin-bottom:1.5rem;opacity:.5}.no-pharmacies[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;margin:0}@media (max-width: 1200px){.alerts-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media (max-width: 768px){.alerts-container[_ngcontent-%COMP%]{padding:1rem}.pharmacy-header[_ngcontent-%COMP%]{padding:1.5rem}.pharmacy-name[_ngcontent-%COMP%]{font-size:1.5rem}.stats-overview[_ngcontent-%COMP%]{flex-wrap:wrap}.alerts-grid[_ngcontent-%COMP%]{padding:1.5rem;gap:1.25rem}.drug-metrics[_ngcontent-%COMP%]{grid-template-columns:1fr}.expiry-info[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.75rem}}']})};export{j as PharmaciesInventoryAlertsComponent};
