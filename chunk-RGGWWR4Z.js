import{a as $}from"./chunk-DLU7ZGG4.js";import{a as Z}from"./chunk-THCZEFPZ.js";import"./chunk-P5TE6FOK.js";import"./chunk-N3GUYB4W.js";import{c as V,e as H,g as J,o as q,p as K,q as Q,w as U}from"./chunk-VW37JDOU.js";import{a as X}from"./chunk-YJWIIGXE.js";import{a as Y}from"./chunk-JEDHGX64.js";import"./chunk-ACQN7LQS.js";import{a as W,b as j}from"./chunk-7DC7YEPQ.js";import{$ as O,$a as n,$b as L,A as u,Bb as o,Cb as c,Ga as z,La as _,M as k,Ra as g,S as y,Wa as w,Y as G,Z as T,_ as N,ab as r,bb as P,db as F,eb as h,fb as D,j as v,n as M,nb as l,ob as p,pb as A,rb as R,ub as I,vb as B,wb as E,xa as i}from"./chunk-OKFD3A6M.js";import{a as b,b as C}from"./chunk-KAT7YFEL.js";var x=class m{globalDrugs=[{id:"GD001",name:"Paracetamol 500mg",genericName:"Acetaminophen",barcode:"1234567890123",atcCode:"N02BE01",therapeuticClass:"Analgesics",manufacturer:"ABC Pharmaceuticals",priceReference:5.5,alternatives:["GD002"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-11-27"),createdBy:"admin001",affectedPharmacies:150},{id:"GD002",name:"Ibuprofen 200mg",genericName:"Ibuprofen",barcode:"1234567890124",atcCode:"M01AE01",therapeuticClass:"NSAIDs",manufacturer:"MedTech Industries",priceReference:8,alternatives:["GD001"],isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-11-27"),createdBy:"admin001",affectedPharmacies:120},{id:"GD003",name:"Amoxicillin 250mg",genericName:"Amoxicillin",barcode:"1234567890125",atcCode:"J01CA04",therapeuticClass:"Antibiotics",manufacturer:"ABC Pharmaceuticals",priceReference:12,isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-11-27"),createdBy:"admin001",affectedPharmacies:95}];getAll(t){let e=[...this.globalDrugs];if(t?.search){let f=t.search.toLowerCase();e=e.filter(S=>S.name.toLowerCase().includes(f)||S.genericName.toLowerCase().includes(f)||S.barcode?.toLowerCase().includes(f))}t?.isActive!==void 0&&(e=e.filter(f=>f.isActive===t.isActive));let a=t?.page||1,s=t?.pageSize||10,d=(a-1)*s,te=d+s,ae=e.slice(d,te);return v({data:ae,total:e.length,page:a,pageSize:s,totalPages:Math.ceil(e.length/s)}).pipe(u(500))}getById(t){let e=this.globalDrugs.find(a=>a.id===t);return v(e||null).pipe(u(300))}create(t){let e=C(b({},t),{id:`GD${String(this.globalDrugs.length+1).padStart(3,"0")}`,affectedPharmacies:0,createdAt:new Date,updatedAt:new Date});return this.globalDrugs.push(e),v(e).pipe(u(500))}update(t,e){let a=this.globalDrugs.find(s=>s.id===t);if(!a)throw new Error("Drug not found");return Object.assign(a,e,{updatedAt:new Date}),v(a).pipe(u(500))}deactivate(t){return this.update(t,{isActive:!1}).pipe(u(500),M(()=>!0))}static \u0275fac=function(e){return new(e||m)};static \u0275prov=k({token:m,factory:m.\u0275fac,providedIn:"root"})};function ne(m,t){if(m&1&&(n(0,"div",24)(1,"p",25),l(2),o(3,"translate"),o(4,"translate"),r()()),m&2){let e=D(2);i(2),R(" ",c(3,3,"platform.catalog.impactWarning"),": ",e.selectedDrug.affectedPharmacies," ",c(4,5,"platform.catalog.pharmacies")," ")}}function re(m,t){if(m&1){let e=F();n(0,"app-modal",21,0),o(2,"translate"),h("confirmed",function(){G(e);let s=D();return T(s.selectedDrug=null)}),n(3,"div",1)(4,"div",22)(5,"div")(6,"label",12),l(7),o(8,"translate"),r(),n(9,"p",23),l(10),r()(),n(11,"div")(12,"label",12),l(13),o(14,"translate"),r(),n(15,"p",23),l(16),r()(),n(17,"div")(18,"label",12),l(19),o(20,"translate"),r(),n(21,"p",23),l(22),r()(),n(23,"div")(24,"label",12),l(25),o(26,"translate"),r(),n(27,"p",23),l(28),r()(),n(29,"div")(30,"label",12),l(31),o(32,"translate"),r(),n(33,"p",23),l(34),r()(),n(35,"div")(36,"label",12),l(37),o(38,"translate"),r(),n(39,"p",23),l(40),r()()(),_(41,ne,5,7,"div",24),r()()}if(m&2){let e=D();g("title",e.selectedDrug.name)("showFooter",!0)("confirmText",c(2,16,"common.close")),i(7),p(c(8,18,"platform.catalog.genericName")),i(3),p(e.selectedDrug.genericName),i(3),p(c(14,20,"platform.catalog.barcode")),i(3),p(e.selectedDrug.barcode||"-"),i(3),p(c(20,22,"platform.catalog.atcCode")),i(3),p(e.selectedDrug.atcCode||"-"),i(3),p(c(26,24,"platform.catalog.therapeuticClass")),i(3),p(e.selectedDrug.therapeuticClass||"-"),i(3),p(c(32,26,"platform.catalog.manufacturer")),i(3),p(e.selectedDrug.manufacturer||"-"),i(3),p(c(38,28,"platform.catalog.affectedPharmacies")),i(3),p(e.selectedDrug.affectedPharmacies||0),i(),w(e.selectedDrug.affectedPharmacies&&e.selectedDrug.affectedPharmacies>0?41:-1)}}var ee=class m{catalogService=y(x);translationService=y(W);loading=!1;drugs=[];selectedDrug=null;filters={search:"",isActive:void 0};totalDrugs=0;activeDrugs=0;inactiveDrugs=0;avgPharmaciesPerDrug=0;pagination={page:1,pageSize:10,total:0,totalPages:0};columns=[{key:"name",label:"platform.catalog.name",sortable:!0},{key:"genericName",label:"platform.catalog.genericName",sortable:!0},{key:"barcode",label:"platform.catalog.barcode",sortable:!0},{key:"therapeuticClass",label:"platform.catalog.therapeuticClass",sortable:!0},{key:"affectedPharmacies",label:"platform.catalog.affectedPharmacies",sortable:!0},{key:"isActive",label:"platform.catalog.status",sortable:!0}];showCreateModal=!1;ngOnInit(){this.loadDrugs()}loadDrugs(){this.loading=!0,this.catalogService.getAll({page:this.pagination.page,pageSize:this.pagination.pageSize,search:this.filters.search||void 0,isActive:this.filters.isActive}).subscribe({next:t=>{this.drugs=t.data.map(e=>C(b({},e),{isActive:e.isActive?this.translationService.translate("platform.catalog.active"):this.translationService.translate("platform.catalog.inactive"),affectedPharmacies:e.affectedPharmacies||0})),this.pagination={page:t.page,pageSize:t.pageSize,total:t.total,totalPages:t.totalPages},this.calculateStats(t.data),this.loading=!1},error:()=>{this.loading=!1}})}calculateStats(t){this.totalDrugs=t.length,this.activeDrugs=t.filter(a=>a.isActive).length,this.inactiveDrugs=t.filter(a=>!a.isActive).length;let e=t.reduce((a,s)=>a+(s.affectedPharmacies||0),0);this.avgPharmaciesPerDrug=this.totalDrugs>0?Math.round(e/this.totalDrugs):0}applyFilters(){this.pagination.page=1,this.loadDrugs()}onPageChange(t){this.pagination.page=t,this.loadDrugs()}viewDrug(t){this.catalogService.getById(t.id).subscribe({next:e=>{this.selectedDrug=e}})}static \u0275fac=function(e){return new(e||m)};static \u0275cmp=z({type:m,selectors:[["app-catalog"]],decls:49,vars:55,consts:[["drugModal",""],[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-[var(--text-primary)]"],[1,"text-sm","text-[var(--card-text)]","mt-1"],["variant","primary",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[3,"label","value","icon"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"block","text-sm","font-medium","text-[var(--card-text)]","mb-1"],["type","text",1,"w-full","px-4","py-2","border","border-[var(--border-color)]","rounded-[var(--radius-md)]","text-sm","bg-[var(--card-bg)]","text-[var(--text-primary)]",3,"ngModelChange","ngModel","placeholder"],[1,"w-full","px-4","py-2","border","border-[var(--border-color)]","rounded-[var(--radius-md)]","text-sm","bg-[var(--card-bg)]","text-[var(--text-primary)]",3,"ngModelChange","ngModel"],[3,"value"],[1,"flex","items-end"],["variant","primary","size","sm",3,"onClick"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-6"],[3,"onPageChange","onRowClick","columns","data","pagination","loading","emptyMessage"],[3,"title","showFooter","confirmText"],[3,"confirmed","title","showFooter","confirmText"],[1,"grid","grid-cols-2","gap-4"],[1,"text-[var(--text-primary)]"],[1,"bg-yellow-50","border","border-yellow-200","rounded-lg","p-4"],[1,"text-sm","text-yellow-800"]],template:function(e,a){e&1&&(n(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),l(4),o(5,"translate"),r(),n(6,"p",4),l(7),o(8,"translate"),r()(),n(9,"app-button",5),h("onClick",function(){return a.showCreateModal=!0}),N(),n(10,"svg",6),P(11,"path",7),r(),l(12),o(13,"translate"),r()(),O(),n(14,"div",8),P(15,"app-stat-card",9)(16,"app-stat-card",9)(17,"app-stat-card",9)(18,"app-stat-card",9),r(),n(19,"div",10)(20,"div",11)(21,"div")(22,"label",12),l(23),o(24,"translate"),r(),n(25,"input",13),o(26,"translate"),E("ngModelChange",function(d){return B(a.filters.search,d)||(a.filters.search=d),d}),r()(),n(27,"div")(28,"label",12),l(29),o(30,"translate"),r(),n(31,"select",14),E("ngModelChange",function(d){return B(a.filters.isActive,d)||(a.filters.isActive=d),d}),n(32,"option",15),l(33),o(34,"translate"),r(),n(35,"option",15),l(36),o(37,"translate"),r(),n(38,"option",15),l(39),o(40,"translate"),r()()(),n(41,"div",16)(42,"app-button",17),h("onClick",function(){return a.applyFilters()}),l(43),o(44,"translate"),r()()()(),n(45,"div",18)(46,"app-table",19),o(47,"translate"),h("onPageChange",function(d){return a.onPageChange(d)})("onRowClick",function(d){return a.viewDrug(d)}),r()()(),_(48,re,42,30,"app-modal",20)),e&2&&(i(4),p(c(5,33,"platform.catalog.title")),i(3),p(c(8,35,"platform.catalog.subtitle")),i(5),A(" ",c(13,37,"platform.catalog.addDrug")," "),i(3),g("label","platform.catalog.totalDrugs")("value",a.totalDrugs)("icon","pill-bottle"),i(),g("label","platform.catalog.activeDrugs")("value",a.activeDrugs)("icon","check-circle"),i(),g("label","platform.catalog.inactiveDrugs")("value",a.inactiveDrugs)("icon","x-circle"),i(),g("label","platform.catalog.avgPharmaciesPerDrug")("value",a.avgPharmaciesPerDrug)("icon","users"),i(5),p(c(24,39,"common.search")),i(2),I("ngModel",a.filters.search),g("placeholder",c(26,41,"platform.catalog.searchPlaceholder")),i(4),p(c(30,43,"platform.catalog.status")),i(2),I("ngModel",a.filters.isActive),i(),g("value",void 0),i(),p(c(34,45,"common.all")),i(2),g("value",!0),i(),p(c(37,47,"platform.catalog.active")),i(2),g("value",!1),i(),p(c(40,49,"platform.catalog.inactive")),i(4),A(" ",c(44,51,"common.search")," "),i(3),g("columns",a.columns)("data",a.drugs)("pagination",a.pagination)("loading",a.loading)("emptyMessage",c(47,53,"platform.catalog.noDrugs")),i(2),w(a.selectedDrug?48:-1))},dependencies:[L,U,K,Q,V,q,H,J,Z,X,j,$,Y],encapsulation:2})};export{ee as CatalogComponent};
