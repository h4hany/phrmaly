import{a as P}from"./chunk-YUSM72LK.js";import{a as H}from"./chunk-O3HD32UM.js";import{a as j}from"./chunk-QDLVDHOW.js";import{a as F}from"./chunk-JYPY3KCN.js";import{a as z}from"./chunk-XG6FMBJJ.js";import{a as Q}from"./chunk-6CFKC637.js";import"./chunk-WWNH5MHG.js";import"./chunk-5PFWNSG3.js";import"./chunk-URFUYTQU.js";import"./chunk-BYXBJQAS.js";import{b as D}from"./chunk-3UJCRMW3.js";import{d as E}from"./chunk-C3O3TVFX.js";import{$a as l,Ab as s,Bb as p,Eb as A,Fa as M,Ka as b,Q as S,Qa as c,Va as T,W as v,X as u,Y as _,Z as I,_a as n,_b as B,ab as g,cb as C,db as h,eb as d,ib as V,jb as L,kb as N,mb as f,nb as y,ob as k,wa as a}from"./chunk-E4S7NVXB.js";import{a as x,b as w}from"./chunk-C6Q5SG76.js";var O=["deleteModal"];function R(r,t){if(r&1&&g(0,"app-alert",3),r&2){let e=d();c("title",e.errorMessage)}}function q(r,t){if(r&1){let e=C();n(0,"app-button",15),h("onClick",function(){v(e);let o=d();return u(o.navigateToNew())}),_(),n(1,"svg",16),g(2,"path",17),l(),f(3),s(4,"translate"),l()}r&2&&(a(3),k(" ",p(4,1,"button.createNewInvoice")," "))}function K(r,t){if(r&1){let e=C();n(0,"div",19)(1,"button",20),s(2,"translate"),h("click",function(){v(e);let o=d().$implicit,m=d();return u(m.viewInvoice(o.id))}),_(),n(3,"svg",21),g(4,"path",22)(5,"path",23),l()(),I(),n(6,"button",20),s(7,"translate"),h("click",function(){v(e);let o=d().$implicit,m=d();return u(m.editInvoice(o.id))}),_(),n(8,"svg",21),g(9,"path",24),l()(),I(),n(10,"button",25),s(11,"translate"),h("click",function(){v(e);let o=d().$implicit,m=d();return u(m.confirmDelete(o))}),_(),n(12,"svg",21),g(13,"path",26),l()()()}r&2&&(a(),c("title",p(2,3,"common.view")),a(5),c("title",p(7,5,"common.edit")),a(4),c("title",p(11,7,"common.delete")))}function U(r,t){r&1&&b(0,K,14,9,"div",18),r&2&&c("appCanAccess","invoice.actions")}var $=class r{router=S(E);invoicesService=S(H);invoices=[];searchQuery="";errorMessage="";loading=!1;deleting=!1;selectedInvoiceId=null;selectedInvoiceNumber="";deleteModal;columns=[{key:"invoiceNumber",label:"table.invoiceNumber",sortable:!0},{key:"patientName",label:"table.patient",sortable:!0},{key:"createdAt",label:"table.date",sortable:!0},{key:"itemsCount",label:"table.items",sortable:!0},{key:"total",label:"table.total",sortable:!0},{key:"paymentStatus",label:"table.paymentStatus",sortable:!0},{key:"paymentMethod",label:"table.paymentMethod",sortable:!0},{key:"actions",label:"table.action"}];pagination={page:1,pageSize:10,total:0,totalPages:0};ngOnInit(){this.loadInvoices()}loadInvoices(){this.loading=!0,this.invoicesService.getAll({page:this.pagination.page,pageSize:this.pagination.pageSize}).subscribe({next:t=>{this.invoices=t.data.map(e=>w(x({},e),{patientName:"Patient "+e.patientId,createdAt:this.formatDate(e.createdAt),itemsCount:e.items.length,total:e.total.toFixed(2),paymentMethod:e.paymentMethod||"N/A"})),this.pagination={page:t.page,pageSize:t.pageSize,total:t.total,totalPages:t.totalPages},this.loading=!1},error:()=>{this.errorMessage="Failed to load invoices",this.loading=!1}})}onSearch(){this.searchQuery.trim()?(this.loading=!0,this.invoicesService.search(this.searchQuery).subscribe({next:t=>{this.invoices=t.map(e=>w(x({},e),{patientName:"Patient "+e.patientId,createdAt:this.formatDate(e.createdAt),itemsCount:e.items.length,total:e.total.toFixed(2),paymentMethod:e.paymentMethod||"N/A"})),this.pagination={page:1,pageSize:10,total:t.length,totalPages:Math.ceil(t.length/10)},this.loading=!1},error:()=>{this.errorMessage="Search failed",this.loading=!1}})):this.loadInvoices()}navigateToNew(){this.router.navigate(["/invoices/new"])}viewInvoice(t){this.router.navigate(["/invoices",t])}editInvoice(t){this.router.navigate(["/invoices",t,"edit"])}confirmDelete(t){this.selectedInvoiceId=t.id,this.selectedInvoiceNumber=t.invoiceNumber,this.deleteModal.open()}deleteInvoice(){this.selectedInvoiceId&&(this.deleting=!0,this.invoicesService.delete(this.selectedInvoiceId).subscribe({next:t=>{t&&(this.loadInvoices(),this.deleteModal.close(),this.selectedInvoiceId=null,this.selectedInvoiceNumber=""),this.deleting=!1},error:()=>{this.errorMessage="Failed to delete invoice",this.deleting=!1}}))}formatDate(t){let e=new Date(t),i=String(e.getDate()).padStart(2,"0"),o=String(e.getMonth()+1).padStart(2,"0"),m=e.getFullYear();return`${i}-${o}-${m}`}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=M({type:r,selectors:[["app-invoices-list"]],viewQuery:function(e,i){if(e&1&&V(O,5),e&2){let o;L(o=N())&&(i.deleteModal=o.first)}},decls:31,vars:32,consts:[["actionTemplate",""],["deleteModal",""],[1,"space-y-6"],["type","error",3,"title"],[1,"flex","items-center","justify-between","gap-4"],[1,"flex-1","max-w-lg"],[1,"relative"],["type","text",1,"w-full","pl-10","pr-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]","focus:border-[var(--primary-color)]",3,"input","placeholder","value"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","absolute","left-3","top-2.5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"flex","gap-3"],["variant","outline"],["variant","primary",3,"onClick",4,"appCanAccess"],["rowIdKey","id",3,"columns","data","pagination","emptyMessage","loading"],[3,"confirmed","title","showFooter","confirmText","confirmLoading"],["variant","primary",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["class","flex items-center gap-2",4,"appCanAccess"],[1,"flex","items-center","gap-2"],[1,"p-1","text-gray-600","hover:text-gray-900",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"p-1","text-gray-600","hover:text-red-600",3,"click","title"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"]],template:function(e,i){if(e&1){let o=C();n(0,"div",2),b(1,R,1,1,"app-alert",3),n(2,"div",4)(3,"div",5)(4,"div",6)(5,"input",7),s(6,"translate"),h("input",function(G){return v(o),i.searchQuery=G.target.value,u(i.onSearch())}),l(),_(),n(7,"svg",8),g(8,"path",9),l()()(),I(),n(9,"div",10)(10,"app-button",11),f(11),s(12,"translate"),l(),n(13,"app-button",11),f(14),s(15,"translate"),l(),b(16,q,5,3,"app-button",12),l()(),n(17,"app-table",13),b(18,U,1,1,"ng-template",null,0,A),l(),n(20,"app-modal",14,1),s(22,"translate"),s(23,"translate"),h("confirmed",function(){return v(o),u(i.deleteInvoice())}),n(24,"p"),f(25),s(26,"translate"),n(27,"strong"),f(28),l(),f(29),s(30,"translate"),l()()()}e&2&&(a(),T(i.errorMessage?1:-1),a(4),c("placeholder",p(6,18,"common.search"))("value",i.searchQuery),a(6),y(p(12,20,"common.filters")),a(3),y(p(15,22,"common.export")),a(2),c("appCanAccess","invoice.create"),a(),c("columns",i.columns)("data",i.invoices)("pagination",i.pagination)("emptyMessage","empty.noInvoices")("loading",i.loading),a(3),c("title",p(22,24,"button.deleteInvoice"))("showFooter",!0)("confirmText",p(23,26,"common.delete"))("confirmLoading",i.deleting),a(5),k("",p(26,28,"modal.deleteInvoiceConfirm")," "),a(3),y(i.selectedInvoiceNumber),a(),y(p(30,30,"modal.cannotUndo")))},dependencies:[B,Q,j,F,z,D,P],encapsulation:2})};export{$ as InvoicesListComponent};
