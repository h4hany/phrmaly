import{a as L}from"./chunk-6GA3C6U4.js";import{a as z}from"./chunk-THCZEFPZ.js";import"./chunk-P5TE6FOK.js";import{a as A}from"./chunk-N3GUYB4W.js";import{a as P}from"./chunk-YJWIIGXE.js";import{a as q}from"./chunk-YUKQXM5O.js";import"./chunk-M3W4QUEG.js";import"./chunk-BYXBJQAS.js";import{d as N}from"./chunk-QHH3SHC3.js";import{b as O}from"./chunk-7DC7YEPQ.js";import{$ as J,$a as r,$b as V,A as f,Bb as l,Cb as m,Ga as F,La as v,M as k,Ra as u,S as C,Wa as x,Xa as B,Y as h,Z as w,Za as D,_ as T,_a as R,ab as n,bb as S,db as y,eb as g,fb as d,j as _,mb as j,nb as o,ob as s,pb as b,qb as E,xa as i}from"./chunk-OKFD3A6M.js";import"./chunk-KAT7YFEL.js";var M=class t{pharmacyContextService=C(q);uploadFile(a){let e=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!e)throw new Error("No pharmacy context");let p={id:`MIG${Date.now()}`,pharmacyId:e,fileName:a.name,status:"uploading",totalRows:0,processedRows:0,errors:[],createdAt:new Date};return _(p).pipe(f(1e3))}mapColumns(a,e){return _({id:a,pharmacyId:"ph1",fileName:"data.csv",status:"mapping",totalRows:100,processedRows:0,errors:[],createdAt:new Date}).pipe(f(500))}previewImport(a){return _({valid:95,invalid:5,preview:[]}).pipe(f(500))}executeImport(a){return _({id:a,pharmacyId:"ph1",fileName:"data.csv",status:"completed",totalRows:100,processedRows:95,errors:["Row 5: Invalid date format","Row 12: Missing required field"],createdAt:new Date,completedAt:new Date}).pipe(f(2e3))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"})};function H(t,a){if(t&1&&(r(0,"div",19)(1,"p",20),o(2),l(3,"translate"),n()()),t&2){let e=d(2);i(2),E("",m(3,2,"migration.fileSelected"),": ",e.selectedFile.name,"")}}function $(t,a){if(t&1){let e=y();r(0,"div",7)(1,"h3",11),o(2),l(3,"translate"),n(),r(4,"div",12)(5,"input",13,0),g("change",function(c){h(e);let I=d();return w(I.handleFileSelect(c))}),n(),T(),r(7,"svg",14),S(8,"path",15),n(),J(),r(9,"p",16),o(10),l(11,"translate"),n(),r(12,"p",17),o(13),l(14,"translate"),n(),r(15,"app-button",18),g("onClick",function(){h(e);let c=j(6);return w(c.click())}),o(16),l(17,"translate"),n(),v(18,H,4,4,"div",19),n()()}if(t&2){let e=d();i(2),s(m(3,5,"migration.upload")),i(8),s(m(11,7,"migration.selectFile")),i(3),s(m(14,9,"migration.supportedFormats")),i(3),s(m(17,11,"migration.browse")),i(2),x(e.selectedFile?18:-1)}}function K(t,a){if(t&1&&(r(0,"div",7)(1,"h3",11),o(2),l(3,"translate"),n(),S(4,"app-table",21),n()),t&2){let e=d();i(2),s(m(3,4,"migration.map")),i(2),u("columns",e.mappingColumns)("data",e.columnMappings)("emptyMessage","migration.noMappings")}}function Q(t,a){if(t&1&&(r(0,"div",7)(1,"h3",11),o(2),l(3,"translate"),n(),r(4,"div",22)(5,"div",23)(6,"div",24),o(7),l(8,"translate"),n(),r(9,"div",25),o(10),n()(),r(11,"div",26)(12,"div",24),o(13),l(14,"translate"),n(),r(15,"div",27),o(16),n()()(),S(17,"app-table",21),n()),t&2){let e=d();i(2),s(m(3,8,"migration.preview")),i(5),s(m(8,10,"migration.validRows")),i(3),s(e.previewData.valid),i(3),s(m(14,12,"migration.invalidRows")),i(3),s(e.previewData.invalid),i(),u("columns",e.previewColumns)("data",e.previewData.preview)("emptyMessage","migration.noPreview")}}function U(t,a){if(t&1&&(r(0,"p",36),o(1),n()),t&2){let e=a.$implicit;i(),s(e)}}function X(t,a){if(t&1&&(r(0,"div",33)(1,"h4",34),o(2),l(3,"translate"),n(),r(4,"div",35),D(5,U,2,1,"p",36,B),n()()),t&2){let e=d(3);i(2),s(m(3,1,"migration.errors")),i(3),R(e.importJob.errors)}}function Y(t,a){if(t&1&&(r(0,"div",28)(1,"div",29)(2,"span",30),o(3),l(4,"translate"),n(),r(5,"app-badge",31),o(6),n()(),r(7,"div",29)(8,"span",30),o(9),l(10,"translate"),n(),r(11,"span",32),o(12),n()(),v(13,X,7,3,"div",33),n()),t&2){let e=d(2);i(3),s(m(4,7,"migration.status")),i(2),u("variant",e.getStatusVariant(e.importJob.status)),i(),b(" ",e.importJob.status," "),i(3),s(m(10,9,"migration.processed")),i(3),E("",e.importJob.processedRows," / ",e.importJob.totalRows,""),i(),x(e.importJob.errors.length>0?13:-1)}}function Z(t,a){if(t&1&&(r(0,"div",7)(1,"h3",11),o(2),l(3,"translate"),n(),v(4,Y,14,11,"div",28),n()),t&2){let e=d();i(2),s(m(3,2,"migration.importLog")),i(2),x(e.importJob?4:-1)}}function ee(t,a){if(t&1){let e=y();r(0,"app-button",37),g("onClick",function(){h(e);let c=d();return w(c.nextStep())}),o(1),l(2,"translate"),n()}if(t&2){let e=d();u("disabled",!e.canProceed()),i(),b(" ",m(2,2,"common.next")," ")}}function te(t,a){if(t&1){let e=y();r(0,"app-button",37),g("onClick",function(){h(e);let c=d();return w(c.executeImport())}),o(1),l(2,"translate"),n()}if(t&2){let e=d();u("disabled",!e.canSubmit()),i(),b(" ",m(2,2,"migration.import")," ")}}var W=class t{migrationEngine=C(M);router=C(N);currentStep=0;selectedFile=null;importJob=null;columnMappings=[];previewData={valid:0,invalid:0,preview:[]};steps=[{id:"upload",label:"migration.upload",description:"migration.uploadDesc"},{id:"map",label:"migration.map",description:"migration.mapDesc"},{id:"preview",label:"migration.preview",description:"migration.previewDesc"},{id:"import",label:"migration.import",description:"migration.importDesc"}];mappingColumns=[{key:"sourceColumn",label:"migration.sourceColumn"},{key:"targetField",label:"migration.targetField"},{key:"required",label:"migration.required"}];previewColumns=[{key:"row",label:"migration.row"},{key:"data",label:"migration.data"},{key:"status",label:"migration.status"}];ngOnInit(){this.columnMappings=[{sourceColumn:"Name",targetField:"name",required:!0},{sourceColumn:"Email",targetField:"email",required:!1},{sourceColumn:"Phone",targetField:"phone",required:!0}]}handleFileSelect(a){let e=a.target;e.files&&e.files.length>0&&(this.selectedFile=e.files[0],this.migrationEngine.uploadFile(this.selectedFile).subscribe({next:p=>{this.importJob=p}}))}canProceed(){return this.currentStep===0?!!this.selectedFile:this.currentStep===1?this.columnMappings.length>0:this.currentStep===2}canSubmit(){return this.previewData.valid>0}nextStep(){this.currentStep===1?this.migrationEngine.mapColumns(this.importJob?.id||"",this.columnMappings).subscribe({next:a=>{this.importJob=a,this.currentStep++}}):this.currentStep===2?this.migrationEngine.previewImport(this.importJob?.id||"").subscribe({next:a=>{this.previewData=a,this.currentStep++}}):this.currentStep++}executeImport(){this.importJob&&this.migrationEngine.executeImport(this.importJob.id).subscribe({next:a=>{this.importJob=a}})}getStatusVariant(a){return{completed:"success",importing:"info",failed:"danger",uploading:"info",mapping:"info",preview:"info"}[a]||"default"}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=F({type:t,selectors:[["app-migration"]],decls:20,vars:14,consts:[["fileInput",""],[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold"],[1,"text-sm","text-gray-600","hover:text-gray-900",3,"click"],[3,"stepChange","steps","currentStep"],[1,"p-6","rounded-lg",2,"background-color","var(--card-bg)"],[1,"space-y-4"],[1,"flex","justify-between","mt-6","pt-6","border-t"],["variant","outline",3,"onClick","disabled"],["variant","primary",3,"disabled"],[1,"text-lg","font-semibold","mb-4"],[1,"border-2","border-dashed","rounded-lg","p-8","text-center"],["type","file","accept",".csv,.xlsx,.xls",1,"hidden",3,"change"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-4","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"],[1,"text-gray-600","mb-2"],[1,"text-sm","text-gray-500","mb-4"],[3,"onClick"],[1,"mt-4","p-3","bg-green-50","rounded-lg"],[1,"text-sm","text-green-800"],[3,"columns","data","emptyMessage"],[1,"grid","grid-cols-2","gap-4","mb-4"],[1,"p-4","bg-green-50","rounded-lg"],[1,"text-sm","text-gray-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"p-4","bg-red-50","rounded-lg"],[1,"text-2xl","font-bold","text-red-600"],[1,"space-y-3"],[1,"flex","justify-between"],[1,"text-gray-600"],[3,"variant"],[1,"font-medium"],[1,"mt-4"],[1,"font-semibold","mb-2"],[1,"space-y-1"],[1,"text-sm","text-red-600"],["variant","primary",3,"onClick","disabled"]],template:function(e,p){e&1&&(r(0,"div",1)(1,"div",2)(2,"h2",3),o(3),l(4,"translate"),n(),r(5,"button",4),g("click",function(){return p.router.navigate(["/dashboard"])}),o(6),l(7,"translate"),n()(),r(8,"app-wizard-stepper",5),g("stepChange",function(I){return p.currentStep=I}),n(),r(9,"div",6),v(10,$,19,13,"div",7)(11,K,5,6,"div",7)(12,Q,18,14,"div",7)(13,Z,5,4,"div",7),r(14,"div",8)(15,"app-button",9),g("onClick",function(){return p.currentStep=p.currentStep-1}),o(16),l(17,"translate"),n(),v(18,ee,3,4,"app-button",10)(19,te,3,4,"app-button",10),n()()()),e&2&&(i(3),s(m(4,8,"migration.title")),i(3),b(" \u2190 ",m(7,10,"common.back")," "),i(2),u("steps",p.steps)("currentStep",p.currentStep),i(2),x(p.currentStep===0?10:p.currentStep===1?11:p.currentStep===2?12:p.currentStep===3?13:-1),i(5),u("disabled",p.currentStep===0),i(),b(" ",m(17,12,"common.previous")," "),i(2),x(p.currentStep<p.steps.length-1?18:19))},dependencies:[V,L,z,P,A,O],encapsulation:2})};export{W as MigrationComponent};
