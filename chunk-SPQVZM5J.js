import{a as j}from"./chunk-EKSGP2SL.js";import{a as L}from"./chunk-QSZBM4NB.js";import{a as P,b as $}from"./chunk-4PK2EB7K.js";import{a as Q}from"./chunk-CPH2TRFL.js";import{a as R}from"./chunk-PUVF5ECJ.js";import"./chunk-Y5QUESDN.js";import{d,e as M,f as O,h as q,k as A,n as B,t as N,u as w,v as G,w as V,x as T}from"./chunk-VW37JDOU.js";import{b as x,d as E}from"./chunk-QHH3SHC3.js";import"./chunk-KPWAPXFF.js";import"./chunk-ACQN7LQS.js";import{b as _}from"./chunk-7DC7YEPQ.js";import{$a as o,$b as k,Bb as y,Cb as D,Ga as S,La as I,Ra as i,S as u,Sa as C,Wa as F,_ as f,ab as a,bb as l,eb as v,nb as h,pb as b,xa as t}from"./chunk-OKFD3A6M.js";import"./chunk-KAT7YFEL.js";function H(p,e){p&1&&(f(),o(0,"svg",17),l(1,"circle",19)(2,"path",20),a())}function W(p,e){p&1&&(f(),o(0,"svg",18),l(1,"path",21),a())}var z=class p{fb=u(G);router=u(E);route=u(x);drugsService=u(L);drugForm;loading=!1;errorMessage="";isEdit=!1;drugId=null;generalDrugs=[];generalDrugOptions=[];statusOptions=[{value:"active",label:"common.active"},{value:"inactive",label:"common.inactive"},{value:"out_of_stock",label:"form.drug.outOfStock"}];classificationOptions=[{value:"medicinal",label:"drug.classification.medicinal"},{value:"cosmetic",label:"drug.classification.cosmetic"}];originOptions=[{value:"local",label:"drug.origin.local"},{value:"imported",label:"drug.origin.imported"}];ngOnInit(){this.drugId=this.route.snapshot.paramMap.get("id"),this.isEdit=!!this.drugId,this.drugForm=this.fb.group({generalDrugId:["",[d.required]],internalBarcode:["",[d.required,d.minLength(6),d.maxLength(8)]],price:[0,[d.required,d.min(0)]],priceAfterDiscount:[0,[d.min(0)]],stockQuantity:[0,[d.required,d.min(0)]],minimumStock:[0,[d.required,d.min(0)]],expiryDate:[""],status:["active"],classification:["medicinal"],origin:["local"]}),this.loadGeneralDrugs(),this.isEdit&&this.drugId&&this.loadDrug()}loadGeneralDrugs(){this.drugsService.getAllGeneralDrugs().subscribe({next:e=>{this.generalDrugs=e,this.generalDrugOptions=e.map(n=>({value:n.id,label:`${n.name} - ${n.manufacturer}`}))}})}loadDrug(){this.drugsService.getPharmacyDrugById(this.drugId).subscribe({next:e=>{e&&this.drugForm.patchValue({generalDrugId:e.generalDrugId,internalBarcode:e.internalBarcode,price:e.price,priceAfterDiscount:e.priceAfterDiscount,stockQuantity:e.stockQuantity,minimumStock:e.minimumStock,expiryDate:e.expiryDate?this.formatDateForInput(e.expiryDate):"",status:e.status,classification:e.classification||"medicinal",origin:e.origin||"local"})},error:()=>{this.errorMessage="error.loadDrug"}})}onSubmit(){if(this.drugForm.valid){this.loading=!0,this.errorMessage="";let e=this.drugForm.value,n={generalDrugId:e.generalDrugId,pharmacyId:"ph1",internalBarcode:e.internalBarcode,price:e.price,priceAfterDiscount:e.priceAfterDiscount||e.price,stockQuantity:e.stockQuantity,minimumStock:e.minimumStock,expiryDate:e.expiryDate?new Date(e.expiryDate):void 0,status:e.status,classification:e.classification,origin:e.origin};(this.isEdit?this.drugsService.updatePharmacyDrug(this.drugId,n):this.drugsService.createPharmacyDrug(n)).subscribe({next:()=>{this.router.navigate(["/drugs"])},error:m=>{this.errorMessage=m.message||"error.saveDrug",this.loading=!1}})}else Object.keys(this.drugForm.controls).forEach(e=>{this.drugForm.get(e)?.markAsTouched()})}onCancel(){this.router.navigate(["/drugs"])}formatDateForInput(e){let n=new Date(e),r=n.getFullYear(),m=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");return`${r}-${m}-${s}`}static \u0275fac=function(n){return new(n||p)};static \u0275cmp=S({type:p,selectors:[["app-drug-form"]],decls:37,vars:51,consts:[[3,"title","description","errorMessage"],[1,"p-8",3,"ngSubmit","formGroup"],[3,"title"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["formControlName","generalDrugId","label","form.drug.generalDrug","prefixIcon","medicine",3,"required","options","placeholder","hasError","errorMessage"],["type","text","formControlName","internalBarcode","prefixIcon","barcode",3,"label","placeholder","maxlength","required","hasError","errorMessage"],["type","number","formControlName","price","prefixIcon","currency-dollar",3,"label","step","min","required"],["type","number","formControlName","priceAfterDiscount","prefixIcon","currency-dollar",3,"label","step","min"],["type","date","formControlName","expiryDate","prefixIcon","calendar",3,"label"],["formControlName","status","prefixIcon","check-circle",3,"label","options","placeholder"],["type","number","formControlName","stockQuantity","prefixIcon","package",3,"label","min","required"],["type","number","formControlName","minimumStock","prefixIcon","package",3,"label","min","required"],["formControlName","classification",3,"label","radioOptions"],["formControlName","origin",3,"label","radioOptions"],[1,"flex","items-center","justify-end","gap-4","pt-8","border-t-2","border-gray-100"],["type","button",1,"px-6","py-3","border-2","border-gray-300","text-gray-700","rounded-xl","font-semibold","hover:bg-gray-50","hover:border-gray-400","transition-all","duration-200",3,"click"],["type","submit",1,"px-6","py-3","rounded-xl","font-semibold","hover:shadow-xl","hover:scale-105","active:scale-95","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","disabled:hover:shadow-none","transition-all","duration-200","flex","items-center","gap-2",3,"disabled"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"]],template:function(n,r){if(n&1&&(o(0,"app-modern-form-wrapper",0)(1,"form",1),v("ngSubmit",function(){return r.onSubmit()}),o(2,"app-form-section",2)(3,"div",3)(4,"div"),l(5,"app-autocomplete-input",4),a(),o(6,"div"),l(7,"app-text-input",5),a(),o(8,"div"),l(9,"app-text-input",6),a(),o(10,"div"),l(11,"app-text-input",7),a(),o(12,"div"),l(13,"app-text-input",8),a(),o(14,"div"),l(15,"app-autocomplete-input",9),a()()(),o(16,"app-form-section",2)(17,"div",3)(18,"div"),l(19,"app-text-input",10),a(),o(20,"div"),l(21,"app-text-input",11),a()()(),o(22,"app-form-section",2)(23,"div",3)(24,"div"),l(25,"app-radio-input",12),a(),o(26,"div"),l(27,"app-radio-input",13),a()()(),o(28,"div",14)(29,"button",15),v("click",function(){return r.onCancel()}),h(30),y(31,"translate"),a(),o(32,"button",16),I(33,H,3,0,":svg:svg",17)(34,W,2,0,":svg:svg",18),h(35),y(36,"translate"),a()()()()),n&2){let m,s,c,g;i("title",r.isEdit?"form.editDrug":"form.addDrug")("description",r.isEdit?"form.editDrugDescription":"form.addDrugDescription")("errorMessage",r.errorMessage),t(),i("formGroup",r.drugForm),t(),i("title","drug.generalInfo"),t(3),i("required",!0)("options",r.generalDrugOptions)("placeholder","form.selectGeneralDrug")("hasError",!!((m=r.drugForm.get("generalDrugId"))!=null&&m.invalid&&((m=r.drugForm.get("generalDrugId"))!=null&&m.touched)))("errorMessage",(s=r.drugForm.get("generalDrugId"))!=null&&s.invalid&&((s=r.drugForm.get("generalDrugId"))!=null&&s.touched)?"validation.generalDrugRequired":void 0),t(2),i("label","form.drug.internalBarcode")("placeholder","placeholder.barcode")("maxlength",8)("required",!0)("hasError",!!((c=r.drugForm.get("internalBarcode"))!=null&&c.invalid&&((c=r.drugForm.get("internalBarcode"))!=null&&c.touched)))("errorMessage",(g=r.drugForm.get("internalBarcode"))!=null&&g.invalid&&((g=r.drugForm.get("internalBarcode"))!=null&&g.touched)?"validation.barcodeRequired":void 0),t(2),i("label","drug.price")("step",.01)("min",0)("required",!0),t(2),i("label","form.drug.priceAfterDiscount")("step",.01)("min",0),t(2),i("label","drug.expiryDate"),t(2),i("label","form.drug.status")("options",r.statusOptions)("placeholder","form.selectStatus"),t(),i("title","drug.stockInfo"),t(3),i("label","form.drug.stockQuantity")("min",0)("required",!0),t(2),i("label","form.drug.minimumStock")("min",0)("required",!0),t(),i("title","drug.classificationAndOrigin"),t(3),i("label","drug.classification")("radioOptions",r.classificationOptions),t(2),i("label","drug.origin")("radioOptions",r.originOptions),t(3),b(" ",D(31,47,"common.cancel")," "),t(2),C("background","var(--primary-bg)")("color","var(--primary-text)"),i("disabled",r.drugForm.invalid||r.loading),t(),F(r.loading?33:34),t(2),b(" ",D(36,49,r.isEdit?"form.updateDrug":"form.createDrug")," ")}},dependencies:[k,T,q,M,O,N,w,A,B,V,P,$,j,R,Q,_],encapsulation:2})};export{z as DrugFormComponent};
