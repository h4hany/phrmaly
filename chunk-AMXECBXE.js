import{a as qe,b as Le}from"./chunk-3AOUMDXJ.js";import{a as Ge}from"./chunk-O3HD32UM.js";import{a as Fe}from"./chunk-ZOZDUEMX.js";import{a as Ae}from"./chunk-ET74JURU.js";import{a as Ne}from"./chunk-TCUYX7IT.js";import{a as Me}from"./chunk-XG6FMBJJ.js";import{b as ie,c as z,d as L,e as O,f as ne,g as R,h as oe,i as W,k as re,l as ae,m as le,n as de,o as ce,p as se,q as pe,r as me,s as q,v as Te,w as $,x as ue}from"./chunk-TK76J465.js";import{a as Be}from"./chunk-T542ZMY7.js";import"./chunk-URFUYTQU.js";import"./chunk-BYXBJQAS.js";import{b as j}from"./chunk-3UJCRMW3.js";import{b as Ee,d as Pe}from"./chunk-C3O3TVFX.js";import{$a as n,Ab as c,Ba as xe,Bb as p,Cb as F,Fa as A,Ha as Ie,K as ye,Ka as S,Q as N,Qa as w,Ra as b,Sa as G,Va as y,W as g,Wa as Z,X as _,Y as h,Ya as V,Yb as te,Z as C,Za as E,_a as t,_b as H,ab as u,cb as D,da as I,db as f,e as Ce,eb as m,ia as we,ib as De,jb as ke,kb as Ve,mb as d,nb as v,ob as x,pb as ee,tb as P,ub as T,va as Se,vb as M,wa as i,xb as B}from"./chunk-E4S7NVXB.js";import{e as We}from"./chunk-C6Q5SG76.js";var ve=class l{barcodeSubject=new Ce;barcode$=this.barcodeSubject.asObservable();barcodeBuffer="";bufferTimeout;constructor(){this.initializeBarcodeReader()}initializeBarcodeReader(){document.addEventListener("keypress",o=>{o.key&&o.key.length===1&&this.handleBarcodeInput(o.key)})}handleBarcodeInput(o){this.bufferTimeout&&clearTimeout(this.bufferTimeout),this.barcodeBuffer+=o,o===`
`||o==="\r"?(this.processBarcode(this.barcodeBuffer.trim()),this.barcodeBuffer=""):this.bufferTimeout=setTimeout(()=>{this.barcodeBuffer.length>=6&&this.processBarcode(this.barcodeBuffer.trim()),this.barcodeBuffer=""},100)}processBarcode(o){o.length>=6&&this.barcodeSubject.next(o)}scanBarcode(o){o&&o.length>=6&&this.barcodeSubject.next(o)}static \u0275fac=function(e){return new(e||l)};static \u0275prov=ye({token:l,factory:l.\u0275fac,providedIn:"root"})};var U=class l{constructor(o,e){this.el=o;this.barcodeService=e;this.barcodeService.barcode$.subscribe(r=>{this.isElementFocused()&&this.barcodeScanned.emit(r)})}barcodeScanned=new I;barcodeBuffer="";bufferTimeout;onKeyDown(o){o.key&&o.key.length===1&&!o.ctrlKey&&!o.metaKey&&(this.bufferTimeout&&clearTimeout(this.bufferTimeout),this.barcodeBuffer+=o.key,this.bufferTimeout=setTimeout(()=>{this.barcodeBuffer=""},200))}onPaste(o){let e=o.clipboardData?.getData("text")||"";e.length>=6&&/^\d+$/.test(e)&&(o.preventDefault(),this.barcodeScanned.emit(e.trim()))}isElementFocused(){return document.activeElement===this.el.nativeElement||this.el.nativeElement.contains(document.activeElement)}static \u0275fac=function(e){return new(e||l)(xe(we),xe(ve))};static \u0275dir=Ie({type:l,selectors:[["","appBarcodeScanner",""]],hostBindings:function(e,r){e&1&&f("keydown",function(s){return r.onKeyDown(s)})("paste",function(s){return r.onPaste(s)})},outputs:{barcodeScanned:"barcodeScanned"}})};var Oe=We(qe());var ge=()=>({standalone:!0}),J=(l,o)=>o.id,Ue=(l,o)=>o.id||o.name;function Ke(l,o){if(l&1){let e=D();t(0,"button",55),f("click",function(){let a=g(e).$implicit,s=m(3);return _(s.onPatientSelect.emit(a))}),t(1,"div",18),h(),t(2,"svg",56),u(3,"path",13),n(),d(4),n()()}if(l&2){let e=o.$implicit;i(4),x(" ",e.fullName," ")}}function Ye(l,o){if(l&1&&V(0,Ke,5,1,"button",54,J),l&2){let e=m(2);E(e.filteredPatients)}}function Qe(l,o){l&1&&(t(0,"div",53),d(1),c(2,"translate"),n()),l&2&&(i(),x(" ",p(2,1,"common.noData")," "))}function Je(l,o){if(l&1){let e=D();t(0,"button",55),f("click",function(){let a=g(e).$implicit,s=m(3);return _(s.onPatientSelect.emit(a))}),t(1,"div",18),h(),t(2,"svg",56),u(3,"path",13),n(),d(4),n()()}if(l&2){let e=o.$implicit;i(4),x(" ",e.fullName," ")}}function Xe(l,o){if(l&1&&V(0,Je,5,1,"button",54,J),l&2){let e=m(2);E(e.patients)}}function Ze(l,o){if(l&1&&(t(0,"div",14)(1,"div",52),S(2,Ye,2,0)(3,Qe,3,3,"div",53)(4,Xe,2,0),n()()),l&2){let e=m();i(2),y(e.patientInput.trim()&&e.filteredPatients.length>0?2:-1),i(),y(e.patientInput.trim()&&e.filteredPatients.length===0?3:-1),i(),y(e.patientInput.trim()?-1:4)}}function et(l,o){if(l&1){let e=D();t(0,"button",59),f("click",function(){let a=g(e).$implicit,s=m(3);return _(s.onDoctorSelect.emit(a))}),t(1,"div",18),h(),t(2,"svg",56),u(3,"path",13),n(),d(4),n()()}if(l&2){let e=o.$implicit;i(4),x(" ",e.name," ")}}function tt(l,o){if(l&1&&V(0,et,5,1,"button",58,Ue),l&2){let e=m(2);E(e.filteredDoctors)}}function it(l,o){if(l&1){let e=D();t(0,"button",60),f("click",function(){g(e);let a=m(2);return _(a.onAddNewDoctor.emit())}),t(1,"div",18),h(),t(2,"svg",61),u(3,"path",25),n(),d(4),c(5,"translate"),n()()}if(l&2){let e=m(2);i(4),ee(" ",p(5,2,"invoice.addNewDoctor"),": ",e.doctorInput," ")}}function nt(l,o){if(l&1){let e=D();t(0,"button",59),f("click",function(){let a=g(e).$implicit,s=m(3);return _(s.onDoctorSelect.emit(a))}),t(1,"div",18),h(),t(2,"svg",56),u(3,"path",13),n(),d(4),n()()}if(l&2){let e=o.$implicit;i(4),x(" ",e.name," ")}}function ot(l,o){if(l&1&&V(0,nt,5,1,"button",58,J),l&2){let e=m(2);E(e.doctors)}}function rt(l,o){if(l&1&&(t(0,"div",14)(1,"div",52),S(2,tt,2,0)(3,it,6,4,"button",57)(4,ot,2,0),n()()),l&2){let e=m();i(2),y(e.doctorInput.trim()&&e.filteredDoctors.length>0?2:-1),i(),y(e.doctorInput.trim()&&e.filteredDoctors.length===0?3:-1),i(),y(e.doctorInput.trim()?-1:4)}}function at(l,o){if(l&1){let e=D();t(0,"button",67),f("click",function(){let a=g(e).$implicit,s=m(4);return _(s.onDrugSelect.emit(a))}),t(1,"div",68)(2,"div",18),h(),t(3,"svg",56),u(4,"path",64),n(),C(),t(5,"span"),d(6),n()(),t(7,"span",69),d(8),n()()()}if(l&2){let e=o.$implicit;i(6),v((e.generalDrug==null?null:e.generalDrug.name)||"Drug "+e.id),i(2),x("",e.price," EGP")}}function lt(l,o){if(l&1&&V(0,at,9,2,"button",66,J),l&2){let e=m(3);E(e.filteredDrugs)}}function dt(l,o){l&1&&(t(0,"div",53),d(1),c(2,"translate"),n()),l&2&&(i(),x(" ",p(2,1,"common.noData")," "))}function ct(l,o){if(l&1){let e=D();t(0,"button",67),f("click",function(){let a=g(e).$implicit,s=m(4);return _(s.onDrugSelect.emit(a))}),t(1,"div",68)(2,"div",18),h(),t(3,"svg",56),u(4,"path",64),n(),C(),t(5,"span"),d(6),n()(),t(7,"span",69),d(8),n()()()}if(l&2){let e=o.$implicit;i(6),v((e.generalDrug==null?null:e.generalDrug.name)||"Drug "+e.id),i(2),x("",e.price," EGP")}}function st(l,o){if(l&1&&V(0,ct,9,2,"button",66,J),l&2){let e=m(3);E(e.pharmacyDrugs)}}function pt(l,o){if(l&1&&(t(0,"div",14)(1,"div",52),S(2,lt,2,0)(3,dt,3,3,"div",53)(4,st,2,0),n()()),l&2){let e=m(2);i(2),y(e.drugInput.trim()&&e.filteredDrugs.length>0?2:-1),i(),y(e.drugInput.trim()&&e.filteredDrugs.length===0?3:-1),i(),y(e.drugInput.trim()?-1:4)}}function mt(l,o){if(l&1){let e=D();t(0,"div",26)(1,"div",19)(2,"div",62)(3,"input",63),c(4,"translate"),M("ngModelChange",function(a){g(e);let s=m();return T(s.drugInput,a)||(s.drugInput=a),_(a)}),f("input",function(a){g(e);let s=m();return _(s.onDrugInput.emit(a))})("focus",function(){g(e);let a=m();return _(a.onDrugFocus.emit())}),n(),t(5,"div",11),h(),t(6,"svg",12),u(7,"path",64),n()(),S(8,pt,5,3,"div",14),n(),C(),t(9,"button",65),f("click",function(){g(e);let a=m();return _(a.onAddSelectedDrug.emit())}),d(10),c(11,"translate"),n()()()}if(l&2){let e=m();i(3),P("ngModel",e.drugInput),w("ngModelOptions",B(13,ge))("placeholder",p(4,9,"form.selectDrug")),i(5),y(e.showDrugDropdown?8:-1),i(),b("background","var(--sidebar-active-bg)")("color","var(--sidebar-active-text)"),i(),x(" ",p(11,11,"common.add")," ")}}function ut(l,o){l&1&&(t(0,"div",28)(1,"div",70),h(),t(2,"svg",71),u(3,"path",72),n()(),C(),t(4,"h4",73),d(5),c(6,"translate"),n(),t(7,"p",74),d(8),c(9,"translate"),n()()),l&2&&(i(5),v(p(6,2,"invoice.wizard.noItemsYet")),i(3),v(p(9,4,"invoice.wizard.addDrugsHint")))}function vt(l,o){if(l&1){let e=D();t(0,"div",75)(1,"div",76)(2,"label",77),d(3),c(4,"translate"),n(),t(5,"div",18)(6,"div",78),h(),t(7,"svg",12),u(8,"path",64),n()(),C(),u(9,"input",79),n()(),t(10,"div")(11,"label",77),d(12),c(13,"translate"),n(),u(14,"input",80),n(),t(15,"div")(16,"label",77),d(17),c(18,"translate"),n(),t(19,"div",32),u(20,"input",81),t(21,"span",82),d(22,"EGP"),n()()(),t(23,"div",83)(24,"button",84),f("click",function(){let a=g(e).$index,s=m();return _(s.onRemoveItem.emit(a))}),h(),t(25,"svg",12),u(26,"path",85),n()()(),C(),u(27,"div",86),n()}if(l&2){let e,r=o.$implicit,a=o.$index,s=m();b("animation-delay",a*.05+"s"),w("formGroupName",a),i(3),v(p(4,13,"drug.name")),i(3),b("background","rgba(0, 48, 50, 0.2)"),i(),b("color","var(--sidebar-active-text)"),i(2),w("value",s.getDrugName((e=r.get("drugId"))==null?null:e.value)),i(3),v(p(13,15,"invoice.quantity")),i(5),v(p(18,17,"form.invoice.unitPrice")),i(10),b("background","var(--sidebar-bg)")}}function gt(l,o){if(l&1&&(t(0,"div",30)(1,"div",87)(2,"div",88)(3,"span",89),d(4),c(5,"translate"),n(),t(6,"span",90),d(7),t(8,"span",91),d(9,"EGP"),n()()(),t(10,"div",92)(11,"span",90),d(12),c(13,"translate"),n(),t(14,"span",93),d(15),t(16,"span",94),d(17,"EGP"),n()()()()()),l&2){let e=m();i(4),v(p(5,6,"invoice.subtotal")),i(3),x("",e.formattedSubtotal," "),i(5),v(p(13,8,"invoice.total")),i(2),b("color","var(--sidebar-active-text)"),i(),x(" ",e.formattedTotal," ")}}function _t(l,o){l&1&&(h(),t(0,"svg",51),u(1,"circle",95)(2,"path",96),n())}function bt(l,o){l&1&&(h(),t(0,"svg",12),u(1,"path",97),n())}var _e=class l{invoiceForm;itemsArray;patients=[];pharmacyDrugs=[];doctors=[];filteredDoctors=[];filteredPatients=[];filteredDrugs=[];patientInput="";doctorInput="";drugInput="";barcodeInput="";showPatientDropdown=!1;showDoctorDropdown=!1;showDrugDropdown=!1;showDrugSelector=!1;loading=!1;formattedSubtotal="0.00";formattedTotal="0.00";getDrugName;onPatientInput=new I;onPatientFocus=new I;onPatientSelect=new I;onDoctorInput=new I;onDoctorFocus=new I;onDoctorSelect=new I;onAddNewDoctor=new I;onDrugInput=new I;onDrugFocus=new I;onDrugSelect=new I;onToggleDrugSelector=new I;onAddSelectedDrug=new I;onBarcodeEnter=new I;onBarcodeScanned=new I;onRemoveItem=new I;onCreateVoucher=new I;onCreateInvoice=new I;onCancel=new I;static \u0275fac=function(e){return new(e||l)};static \u0275cmp=A({type:l,selectors:[["app-invoice-step"]],inputs:{invoiceForm:"invoiceForm",itemsArray:"itemsArray",patients:"patients",pharmacyDrugs:"pharmacyDrugs",doctors:"doctors",filteredDoctors:"filteredDoctors",filteredPatients:"filteredPatients",filteredDrugs:"filteredDrugs",patientInput:"patientInput",doctorInput:"doctorInput",drugInput:"drugInput",barcodeInput:"barcodeInput",showPatientDropdown:"showPatientDropdown",showDoctorDropdown:"showDoctorDropdown",showDrugDropdown:"showDrugDropdown",showDrugSelector:"showDrugSelector",loading:"loading",formattedSubtotal:"formattedSubtotal",formattedTotal:"formattedTotal",getDrugName:"getDrugName"},outputs:{onPatientInput:"onPatientInput",onPatientFocus:"onPatientFocus",onPatientSelect:"onPatientSelect",onDoctorInput:"onDoctorInput",onDoctorFocus:"onDoctorFocus",onDoctorSelect:"onDoctorSelect",onAddNewDoctor:"onAddNewDoctor",onDrugInput:"onDrugInput",onDrugFocus:"onDrugFocus",onDrugSelect:"onDrugSelect",onToggleDrugSelector:"onToggleDrugSelector",onAddSelectedDrug:"onAddSelectedDrug",onBarcodeEnter:"onBarcodeEnter",onBarcodeScanned:"onBarcodeScanned",onRemoveItem:"onRemoveItem",onCreateVoucher:"onCreateVoucher",onCreateInvoice:"onCreateInvoice",onCancel:"onCancel"},decls:123,vars:99,consts:[[1,"p-8",3,"formGroup"],[1,"mb-10"],[1,"flex","items-center","mb-6"],[1,"w-1","h-8","rounded-full","mr-3"],[1,"text-xl","font-bold","text-gray-900"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"group"],[1,"block","text-sm","font-semibold","text-gray-700","mb-2"],[1,"text-red-500","ml-1"],[1,"relative","patient-dropdown-container"],["type","text","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-full","px-4","py-3.5","pl-12","border-2","border-gray-200","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all","duration-200","hover:border-gray-300",3,"ngModelChange","input","focus","ngModel","ngModelOptions","placeholder"],[1,"absolute","left-4","top-1/2","-translate-y-1/2","text-gray-400","pointer-events-none"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"absolute","z-20","mt-2","w-full","bg-white","shadow-2xl","max-h-64","rounded-xl","border","border-gray-100","overflow-hidden","animate-slide-down"],[1,"relative","doctor-dropdown-container"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center"],[1,"flex","gap-3"],[1,"relative","group"],["type","text","appBarcodeScanner","","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-64","pl-11","pr-4","py-2.5","border-2","border-gray-200","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all","duration-200","hover:border-gray-300",3,"ngModelChange","keyup.enter","barcodeScanned","placeholder","ngModel","ngModelOptions"],[1,"absolute","left-3.5","top-1/2","-translate-y-1/2","text-gray-400","pointer-events-none"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"],["type","button",1,"px-5","py-2.5","rounded-xl","font-semibold","text-sm","hover:shadow-lg","hover:scale-105","active:scale-95","transition-all","duration-200","flex","items-center","gap-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"mb-6","p-6","rounded-xl","border-2","animate-slide-down",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],["formArrayName","items",1,"space-y-4"],[1,"text-center","py-16","px-4"],["onmouseenter","this.style.borderColor='rgba(0, 48, 50, 0.5)';","onmouseleave","this.style.borderColor='#f3f4f6';",1,"group","relative","grid","grid-cols-1","md:grid-cols-5","gap-4","p-5","bg-gradient-to-br","from-gray-50","to-white","rounded-xl","border-2","border-gray-100","hover:shadow-md","transition-all","duration-200","animate-slide-in-left",3,"formGroupName","animation-delay"],[1,"mt-6","p-6","rounded-xl","border-2",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],[1,"mb-8"],[1,"relative"],["formControlName","paymentStatus","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-full","px-4","py-3.5","pl-12","border-2","border-gray-200","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all","appearance-none","cursor-pointer","hover:border-gray-300"],["value","pending"],["value","partial"],["value","paid"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"absolute","right-4","top-1/2","-translate-y-1/2","text-gray-400","pointer-events-none"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],["formControlName","paymentMethod","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-full","px-4","py-3.5","pl-12","border-2","border-gray-200","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all","appearance-none","cursor-pointer","hover:border-gray-300"],["value",""],["value","cash"],["value","card"],["value","bank_transfer"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"],[1,"flex","items-center","justify-end","gap-4","pt-8","border-t-2","border-gray-100"],["type","button",1,"px-6","py-3","border-2","border-gray-300","text-gray-700","rounded-xl","font-semibold","hover:bg-gray-50","hover:border-gray-400","transition-all","duration-200",3,"click"],["type","button","onmouseenter","if (!this.disabled) this.style.backgroundColor='rgba(217, 242, 117, 0.1)';","onmouseleave","if (!this.disabled) this.style.backgroundColor='';",1,"px-6","py-3","border-2","rounded-xl","font-semibold","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:bg-transparent","transition-all","duration-200","flex","items-center","gap-2",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"],["type","button",1,"px-6","py-3","rounded-xl","font-semibold","hover:shadow-xl","hover:scale-105","active:scale-95","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","disabled:hover:shadow-none","transition-all","duration-200","flex","items-center","gap-2",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],[1,"py-2","max-h-64","overflow-auto"],[1,"px-4","py-3","text-sm","text-gray-500"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","border-l-4","border-transparent",2,"color","rgb(55 65 81)"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","border-l-4","border-transparent",2,"color","rgb(55 65 81)",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2","text-gray-400"],["type","button",1,"block","w-full","text-left","px-4","py-3","text-sm","hover:bg-green-50","transition-colors","cursor-pointer","text-green-600","font-semibold","border-l-4","border-transparent","hover:border-green-500"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)'; this.style.color='rgb(55 65 81)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent'; this.style.color='rgb(55 65 81)';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","text-gray-900","border-l-4","border-transparent",2,"color","rgb(55 65 81)"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)'; this.style.color='rgb(55 65 81)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent'; this.style.color='rgb(55 65 81)';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","text-gray-900","border-l-4","border-transparent",2,"color","rgb(55 65 81)",3,"click"],["type","button",1,"block","w-full","text-left","px-4","py-3","text-sm","hover:bg-green-50","transition-colors","cursor-pointer","text-green-600","font-semibold","border-l-4","border-transparent","hover:border-green-500",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],[1,"relative","flex-1","drug-dropdown-container"],["type","text","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='rgba(0, 48, 50, 0.4)'; this.style.boxShadow='none';",1,"w-full","px-4","py-3","pl-12","border-2","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all",2,"border-color","rgba(0, 48, 50, 0.4)",3,"ngModelChange","input","focus","ngModel","ngModelOptions","placeholder"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"],["type","button",1,"px-6","py-3","rounded-xl","font-semibold","text-sm","hover:shadow-lg","hover:scale-105","active:scale-95","transition-all","duration-200",3,"click"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)'; this.style.color='rgb(55 65 81)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent'; this.style.color='rgb(55 65 81)';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","border-l-4","border-transparent",2,"color","rgb(55 65 81)"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)'; this.style.color='rgb(55 65 81)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent'; this.style.color='rgb(55 65 81)';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","border-l-4","border-transparent",2,"color","rgb(55 65 81)",3,"click"],[1,"flex","items-center","justify-between"],[1,"text-xs","text-gray-500","ml-2"],[1,"w-20","h-20","mx-auto","mb-4","bg-gray-100","rounded-full","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-10","h-10","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600","mb-6"],["onmouseenter","this.style.borderColor='rgba(0, 48, 50, 0.5)';","onmouseleave","this.style.borderColor='#f3f4f6';",1,"group","relative","grid","grid-cols-1","md:grid-cols-5","gap-4","p-5","bg-gradient-to-br","from-gray-50","to-white","rounded-xl","border-2","border-gray-100","hover:shadow-md","transition-all","duration-200","animate-slide-in-left",3,"formGroupName"],[1,"md:col-span-2"],[1,"block","text-xs","font-semibold","text-gray-600","mb-2","uppercase","tracking-wide"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center","mr-3"],["type","text","readonly","",1,"flex-1","px-4","py-3","border","border-gray-200","rounded-lg","text-sm","bg-gray-50","text-gray-700","font-medium",3,"value"],["type","number","formControlName","quantity","min","1","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-full","px-4","py-3","border-2","border-gray-200","rounded-lg","text-sm","bg-white","focus:outline-none","transition-all","text-center","font-semibold","text-gray-900"],["type","number","formControlName","unitPrice","step","0.01","readonly","",1,"w-full","px-4","py-3","pr-8","border","border-gray-200","rounded-lg","text-sm","bg-gray-50","text-gray-700","font-semibold"],[1,"absolute","right-3","top-1/2","-translate-y-1/2","text-xs","text-gray-500","font-medium"],[1,"flex","items-end","justify-end","md:justify-start"],["type","button","title","Remove item",1,"group/btn","p-3","text-red-500","hover:text-white","hover:bg-red-500","rounded-lg","transition-all","duration-200","hover:scale-110","active:scale-95",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"absolute","-left-1","top-1/2","-translate-y-1/2","w-1","h-0","rounded-full","group-hover:h-3/4","transition-all","duration-300"],[1,"space-y-3"],[1,"flex","justify-between","items-center","pb-3",2,"border-bottom","1px solid rgba(0, 48, 50, 0.3)"],[1,"text-sm","font-semibold","text-gray-700"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-sm","font-normal","text-gray-600"],[1,"flex","justify-between","items-center","pt-2"],[1,"text-2xl","font-bold"],[1,"text-base","font-semibold","text-gray-600"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"]],template:function(e,r){e&1&&(t(0,"form",0)(1,"div",1)(2,"div",2),u(3,"div",3),t(4,"h3",4),d(5),c(6,"translate"),n()(),t(7,"div",5)(8,"div",6)(9,"label",7),d(10),c(11,"translate"),t(12,"span",8),d(13,"*"),n()(),t(14,"div",9)(15,"input",10),c(16,"translate"),M("ngModelChange",function(s){return T(r.patientInput,s)||(r.patientInput=s),s}),f("input",function(s){return r.onPatientInput.emit(s)})("focus",function(){return r.onPatientFocus.emit()}),n(),t(17,"div",11),h(),t(18,"svg",12),u(19,"path",13),n()(),S(20,Ze,5,3,"div",14),n()(),C(),t(21,"div",6)(22,"label",7),d(23),c(24,"translate"),n(),t(25,"div",15)(26,"input",10),c(27,"translate"),M("ngModelChange",function(s){return T(r.doctorInput,s)||(r.doctorInput=s),s}),f("input",function(s){return r.onDoctorInput.emit(s)})("focus",function(){return r.onDoctorFocus.emit()}),n(),t(28,"div",11),h(),t(29,"svg",12),u(30,"path",16),n()(),S(31,rt,5,3,"div",14),n()()()(),C(),t(32,"div",1)(33,"div",17)(34,"div",18),u(35,"div",3),t(36,"h3",4),d(37),c(38,"translate"),n()(),t(39,"div",19)(40,"div",20)(41,"input",21),c(42,"translate"),M("ngModelChange",function(s){return T(r.barcodeInput,s)||(r.barcodeInput=s),s}),f("keyup.enter",function(){return r.onBarcodeEnter.emit()})("barcodeScanned",function(s){return r.onBarcodeScanned.emit(s)}),n(),t(43,"div",22),h(),t(44,"svg",12),u(45,"path",23),n()()(),C(),t(46,"button",24),f("click",function(){return r.onToggleDrugSelector.emit()}),h(),t(47,"svg",12),u(48,"path",25),n(),d(49),c(50,"translate"),n()()(),S(51,mt,12,14,"div",26),C(),t(52,"div",27),S(53,ut,10,6,"div",28),V(54,vt,28,19,"div",29,Z),n(),S(56,gt,18,10,"div",30),n(),t(57,"div",31)(58,"div",2),u(59,"div",3),t(60,"h3",4),d(61),c(62,"translate"),n()(),t(63,"div",5)(64,"div",6)(65,"label",7),d(66),c(67,"translate"),n(),t(68,"div",32)(69,"select",33)(70,"option",34),d(71),c(72,"translate"),n(),t(73,"option",35),d(74),c(75,"translate"),n(),t(76,"option",36),d(77),c(78,"translate"),n()(),t(79,"div",11),h(),t(80,"svg",12),u(81,"path",37),n()(),C(),t(82,"div",38),h(),t(83,"svg",12),u(84,"path",39),n()()()(),C(),t(85,"div",6)(86,"label",7),d(87),c(88,"translate"),n(),t(89,"div",32)(90,"select",40)(91,"option",41),d(92),c(93,"translate"),n(),t(94,"option",42),d(95),c(96,"translate"),n(),t(97,"option",43),d(98),c(99,"translate"),n(),t(100,"option",44),d(101),c(102,"translate"),n()(),t(103,"div",11),h(),t(104,"svg",12),u(105,"path",45),n()(),C(),t(106,"div",38),h(),t(107,"svg",12),u(108,"path",39),n()()()()()(),C(),t(109,"div",46)(110,"button",47),f("click",function(){return r.onCancel.emit()}),d(111),c(112,"translate"),n(),t(113,"button",48),f("click",function(){return r.onCreateVoucher.emit()}),h(),t(114,"svg",12),u(115,"path",49),n(),d(116),c(117,"translate"),n(),C(),t(118,"button",50),f("click",function(){return r.onCreateInvoice.emit()}),S(119,_t,3,0,":svg:svg",51)(120,bt,2,0,":svg:svg",12),d(121),c(122,"translate"),n()()()),e&2&&(w("formGroup",r.invoiceForm),i(3),b("background","var(--sidebar-bg)"),i(2),v(p(6,54,"invoice.wizard.patientDoctorInfo")),i(5),x(" ",p(11,56,"invoice.patient")," "),i(5),P("ngModel",r.patientInput),w("ngModelOptions",B(96,ge))("placeholder",p(16,58,"form.selectPatient")),i(5),y(r.showPatientDropdown?20:-1),i(3),v(p(24,60,"invoice.doctor")),i(3),P("ngModel",r.doctorInput),w("ngModelOptions",B(97,ge))("placeholder",p(27,62,"form.selectOrType")),i(5),y(r.showDoctorDropdown?31:-1),i(4),b("background","var(--sidebar-bg)"),i(2),v(p(38,64,"invoice.items")),i(4),w("placeholder",p(42,66,"placeholder.scanBarcode")),P("ngModel",r.barcodeInput),w("ngModelOptions",B(98,ge)),i(5),b("background","var(--sidebar-active-bg)")("color","var(--sidebar-active-text)"),i(3),x(" ",p(50,68,"form.invoice.addDrug")," "),i(2),y(r.showDrugSelector?51:-1),i(2),y(r.itemsArray.length===0?53:-1),i(),E(r.itemsArray.controls),i(2),y(r.itemsArray.length>0?56:-1),i(3),b("background","var(--sidebar-bg)"),i(2),v(p(62,70,"form.invoice.paymentInfo")),i(5),v(p(67,72,"invoice.paymentStatus")),i(5),v(p(72,74,"invoice.status.pending")),i(3),v(p(75,76,"invoice.status.partial")),i(3),v(p(78,78,"invoice.status.paid")),i(10),v(p(88,80,"invoice.paymentMethod")),i(5),v(p(93,82,"form.selectMethod")),i(3),v(p(96,84,"form.invoice.cash")),i(3),v(p(99,86,"form.invoice.card")),i(3),v(p(102,88,"form.invoice.bankTransfer")),i(10),x(" ",p(112,90,"common.cancel")," "),i(2),b("border-color","var(--primary-bg)")("color","var(--primary-text)"),w("disabled",r.invoiceForm.invalid||r.itemsArray.length===0),i(3),x(" ",p(117,92,"invoice.wizard.createVoucher")," "),i(2),b("background","var(--primary-bg)")("color","var(--primary-text)"),w("disabled",r.invoiceForm.invalid||r.itemsArray.length===0||r.loading),i(),y(r.loading?119:120),i(2),x(" ",p(122,94,"invoice.wizard.createInvoice")," "))},dependencies:[H,ue,oe,se,pe,z,W,ce,O,ne,q,re,de,ae,le,$,R,j,U],encapsulation:2})};var je=()=>({standalone:!0}),xt=(l,o)=>o.origin,ft=(l,o)=>o.drugId;function Ct(l,o){if(l&1){let e=D();t(0,"div",46)(1,"div",47)(2,"div",48)(3,"input",49),M("ngModelChange",function(a){let s=g(e).$implicit;return T(s.applyDiscount,a)||(s.applyDiscount=a),_(a)}),f("change",function(){g(e);let a=m(2);return _(a.onCalculateDiscount.emit())}),n(),t(4,"div",50)(5,"span",51),d(6),n(),t(7,"div",52),d(8),c(9,"translate"),t(10,"span",53),d(11),n(),d(12," \xD7 "),t(13,"span",53),d(14),c(15,"number"),n(),d(16," = "),t(17,"span",54),d(18),c(19,"number"),n()()()()(),t(20,"div",47)(21,"label",18),d(22),c(23,"translate"),n(),t(24,"div",55)(25,"input",56),M("ngModelChange",function(a){let s=g(e).$implicit;return T(s.discountPercentage,a)||(s.discountPercentage=a),_(a)}),f("input",function(){g(e);let a=m(2);return _(a.onCalculateDiscount.emit())}),n(),t(26,"span",57),d(27,"%"),n()()(),t(28,"div",58)(29,"div",59)(30,"div",60),d(31),c(32,"translate"),n(),t(33,"div",61),d(34),c(35,"number"),n(),t(36,"div",62),d(37,"EGP"),n()()()()}if(l&2){let e=o.$implicit,r=m(2);i(3),b("accent-color","var(--sidebar-bg)"),P("ngModel",e.applyDiscount),w("ngModelOptions",B(38,je)),i(3),v(e.drugName),i(2),x(" ",p(9,23,"invoice.quantity"),": "),i(3),v(e.quantity),i(3),v(F(15,25,e.price,"1.2-2")),i(3),b("color","var(--sidebar-active-text)"),i(),x("",F(19,28,e.quantity*e.price,"1.2-2")," EGP"),i(4),x(" ",p(23,31,"invoice.voucher.discountPercentage")," "),i(3),b("border-color",e.applyDiscount?"rgba(0, 48, 50, 0.4)":"#e5e7eb")("background-color",e.applyDiscount?"rgba(0, 48, 50, 0.1)":"#f9fafb")("color",e.applyDiscount?"rgb(55 65 81)":""),P("ngModel",e.discountPercentage),w("ngModelOptions",B(39,je))("disabled",!e.applyDiscount),i(6),v(p(32,33,"invoice.totalPrice")),i(3),v(F(35,35,r.getDiscountedPrice(e),"1.2-2"))}}function yt(l,o){if(l&1&&(t(0,"div",9)(1,"div",41)(2,"h4",42),h(),t(3,"svg",43),u(4,"path",44),n(),d(5),c(6,"translate"),c(7,"translate"),c(8,"translate"),n()(),C(),t(9,"div",45),V(10,Ct,38,40,"div",46,ft),n()()),l&2){let e=o.$implicit;i(),b("background","var(--sidebar-bg)")("color","var(--sidebar-active-text)"),i(4),x(" ",e.origin==="local"?p(6,5,"drug.origin.local"):e.origin==="imported"?p(7,7,"drug.origin.imported"):p(8,9,"invoice.voucher.unknownOrigin")," "),i(5),E(e.products)}}function wt(l,o){l&1&&(h(),t(0,"svg",40),u(1,"circle",63)(2,"path",64),n())}function St(l,o){l&1&&(h(),t(0,"svg",37),u(1,"path",65),n())}var be=class l{voucher;voucherProductGroups=[];subtotal=0;averageDiscountPercentage=0;voucherDiscountAmount=0;loading=!1;getDiscountedPrice;onCalculateDiscount=new I;onBack=new I;onCreateVoucherInvoice=new I;static \u0275fac=function(e){return new(e||l)};static \u0275cmp=A({type:l,selectors:[["app-voucher-step"]],inputs:{voucher:"voucher",voucherProductGroups:"voucherProductGroups",subtotal:"subtotal",averageDiscountPercentage:"averageDiscountPercentage",voucherDiscountAmount:"voucherDiscountAmount",loading:"loading",getDiscountedPrice:"getDiscountedPrice"},outputs:{onCalculateDiscount:"onCalculateDiscount",onBack:"onBack",onCreateVoucherInvoice:"onCreateVoucherInvoice"},decls:77,vars:73,consts:[[1,"p-8","space-y-8"],[1,"rounded-xl","p-6","border-2",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],[1,"block","text-sm","font-semibold","text-gray-700","mb-2"],[1,"flex","items-center"],[1,"w-12","h-12","rounded-lg","flex","items-center","justify-center","mr-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"],["type","text","readonly","",1,"flex-1","px-4","py-3","border","rounded-lg","text-sm","bg-white/50","font-mono","text-gray-900","font-semibold",2,"border-color","rgba(0, 48, 50, 0.4)",3,"value"],[1,"space-y-6"],["onmouseenter","this.style.borderColor='rgba(0, 48, 50, 0.5)';","onmouseleave","this.style.borderColor='#e5e7eb';",1,"border-2","border-gray-200","rounded-xl","overflow-hidden","transition-all","duration-300"],[1,"border-t-2","border-gray-200","pt-8"],[1,"border-2","rounded-xl","p-5","mb-6","flex","items-start",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","mr-3","flex-shrink-0","mt-0.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-sm","font-semibold","mb-1"],[1,"text-sm"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"bg-gradient-to-br","from-gray-50","to-white","p-5","rounded-xl","border-2","border-gray-200"],[1,"block","text-xs","font-semibold","text-gray-600","mb-2","uppercase","tracking-wide"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"p-5","rounded-xl","border-2",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],[1,"block","text-xs","font-semibold","mb-2","uppercase","tracking-wide"],[1,"text-2xl","font-bold"],[1,"bg-gradient-to-br","from-green-50","to-emerald-50/30","p-5","rounded-xl","border-2","border-green-200"],[1,"block","text-xs","font-semibold","text-green-700","mb-2","uppercase","tracking-wide"],[1,"text-2xl","font-bold","text-green-600"],[1,"text-sm","text-green-600"],[1,"rounded-xl","p-6"],[1,"flex","justify-between","items-center"],[1,"text-sm","font-semibold","opacity-90","mb-1"],[1,"text-4xl","font-bold"],[1,"text-xl"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","opacity-20"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"flex","items-center","justify-end","gap-4","pt-8","border-t-2","border-gray-100"],["type","button",1,"px-6","py-3","border-2","border-gray-300","text-gray-700","rounded-xl","font-semibold","hover:bg-gray-50","hover:border-gray-400","transition-all","duration-200","flex","items-center","gap-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],["type","button",1,"px-6","py-3","rounded-xl","font-semibold","hover:shadow-xl","hover:scale-105","active:scale-95","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","disabled:hover:shadow-none","transition-all","duration-200","flex","items-center","gap-2",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],[1,"px-6","py-4"],[1,"text-lg","font-bold","text-white","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"],[1,"p-6","space-y-4","bg-gradient-to-br","from-gray-50","to-white"],["onmouseenter","this.style.borderColor='rgba(0, 48, 50, 0.5)';","onmouseleave","this.style.borderColor='#f3f4f6';",1,"grid","grid-cols-1","md:grid-cols-5","gap-4","p-5","bg-white","rounded-xl","border-2","border-gray-100","hover:shadow-md","transition-all","duration-200"],[1,"md:col-span-2"],[1,"flex","items-start","space-x-3"],["type","checkbox",1,"w-5","h-5","mt-1","border-gray-300","rounded","cursor-pointer","transition-all",3,"ngModelChange","change","ngModel","ngModelOptions"],[1,"flex-1"],[1,"text-sm","font-bold","text-gray-900","block","mb-1"],[1,"text-xs","text-gray-600","bg-gray-100","rounded-lg","px-3","py-1.5","inline-block"],[1,"font-semibold"],[1,"font-bold"],[1,"relative"],["type","number","min","0","max","100","step","0.01","onfocus","if (!this.disabled) { this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)'; }","onblur","if (!this.disabled) { this.style.borderColor='rgba(0, 48, 50, 0.4)'; this.style.boxShadow='none'; }",1,"w-full","px-4","py-3","pr-8","border-2","rounded-lg","text-sm","transition-all","disabled:bg-gray-100","disabled:cursor-not-allowed","disabled:border-gray-200","focus:outline-none",3,"ngModelChange","input","ngModel","ngModelOptions","disabled"],[1,"absolute","right-3","top-1/2","-translate-y-1/2","text-sm","font-bold","text-gray-600"],[1,"flex","items-center","justify-end"],[1,"text-right"],[1,"text-xs","font-semibold","text-gray-600","mb-1"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-xs","text-gray-500"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"div",1)(2,"label",2),d(3),c(4,"translate"),n(),t(5,"div",3)(6,"div",4),h(),t(7,"svg",5),u(8,"path",6),n()(),C(),u(9,"input",7),n()(),t(10,"div",8),V(11,yt,12,11,"div",9,xt),n(),t(13,"div",10)(14,"div",11),h(),t(15,"svg",12),u(16,"path",13),n(),C(),t(17,"div")(18,"p",14),d(19),c(20,"translate"),n(),t(21,"p",15),d(22),c(23,"translate"),n()()(),t(24,"div",16)(25,"div",17)(26,"label",18),d(27),c(28,"translate"),n(),t(29,"div",19),d(30),c(31,"number"),n(),t(32,"div",20),d(33,"EGP"),n()(),t(34,"div",21)(35,"label",22),d(36),c(37,"translate"),n(),t(38,"div",23),d(39),n(),t(40,"div",15),d(41),c(42,"translate"),n()(),t(43,"div",24)(44,"label",25),d(45),c(46,"translate"),n(),t(47,"div",26),d(48),c(49,"number"),n(),t(50,"div",27),d(51),c(52,"translate"),n()()(),t(53,"div",28)(54,"div",29)(55,"div")(56,"div",30),d(57),c(58,"translate"),n(),t(59,"div",31),d(60),c(61,"number"),t(62,"span",32),d(63,"EGP"),n()()(),h(),t(64,"svg",33),u(65,"path",34),n()()()(),C(),t(66,"div",35)(67,"button",36),f("click",function(){return r.onBack.emit()}),h(),t(68,"svg",37),u(69,"path",38),n(),d(70),c(71,"translate"),n(),C(),t(72,"button",39),f("click",function(){return r.onCreateVoucherInvoice.emit()}),S(73,wt,3,0,":svg:svg",40)(74,St,2,0,":svg:svg",37),d(75),c(76,"translate"),n()()()),e&2&&(i(3),v(p(4,42,"invoice.voucher.voucherName")),i(3),b("background","rgba(0, 48, 50, 0.2)"),i(),b("color","var(--sidebar-active-text)"),i(2),w("value",r.voucher.voucherName),i(2),E(r.voucherProductGroups),i(4),b("color","var(--sidebar-active-text)"),i(3),b("color","var(--sidebar-active-text)"),i(),x(" ",p(20,44,"invoice.voucher.note")," "),i(2),b("color","var(--card-text)"),i(),x(" ",p(23,46,"invoice.voucher.averageDiscountNote")," "),i(5),v(p(28,48,"invoice.subtotal")),i(3),v(F(31,50,r.subtotal,"1.2-2")),i(5),b("color","var(--sidebar-active-text)"),i(),v(p(37,53,"invoice.voucher.averageDiscount")),i(2),b("color","var(--sidebar-active-text)"),i(),x("",r.averageDiscountPercentage.toFixed(2),"%"),i(),b("color","var(--sidebar-active-text)"),i(),v(p(42,55,"invoice.voucher.averageDiscountLabel")),i(4),v(p(46,57,"invoice.voucher.discountAmount")),i(3),v(F(49,59,r.voucherDiscountAmount,"1.2-2")),i(3),v(p(52,62,"invoice.voucher.egpSaved")),i(2),b("background","var(--sidebar-bg)")("color","var(--sidebar-text)"),i(4),v(p(58,64,"invoice.total")),i(3),x("",F(61,66,r.subtotal-r.voucherDiscountAmount,"1.2-2")," "),i(10),x(" ",p(71,69,"common.back")," "),i(2),b("background","var(--primary-bg)")("color","var(--primary-text)"),w("disabled",r.loading),i(),y(r.loading?73:74),i(2),x(" ",p(76,71,"invoice.wizard.createInvoice")," "))},dependencies:[H,te,$,z,W,ie,O,q,me,R,j],encapsulation:2})};var It=["voucherCard"];function Dt(l,o){l&1&&(h(),t(0,"svg",25),u(1,"circle",26)(2,"path",27),n(),d(3),c(4,"translate")),l&2&&(i(3),x(" ",p(4,1,"invoice.voucher.sending")," "))}function kt(l,o){l&1&&(h(),t(0,"svg",28),u(1,"path",29),n(),d(2),c(3,"translate")),l&2&&(i(2),x(" ",p(3,1,"invoice.voucher.sendToPatient")," "))}var he=class l{voucherCard;voucher;averageDiscountPercentage=0;sendingVoucher=!1;onSendVoucher=new I;onBack=new I;onClose=new I;onCardReady=new I;onCardCopied=new I;ngAfterViewInit(){}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=A({type:l,selectors:[["app-share-voucher-step"]],viewQuery:function(e,r){if(e&1&&De(It,5),e&2){let a;ke(a=Ve())&&(r.voucherCard=a.first)}},inputs:{voucher:"voucher",averageDiscountPercentage:"averageDiscountPercentage",sendingVoucher:"sendingVoucher"},outputs:{onSendVoucher:"onSendVoucher",onBack:"onBack",onClose:"onClose",onCardReady:"onCardReady",onCardCopied:"onCardCopied"},decls:45,vars:32,consts:[["voucherCard",""],[1,"p-8","space-y-8"],[1,"rounded-xl","p-6","border-2",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],[1,"flex","items-center","mb-4"],[1,"w-12","h-12","rounded-full","flex","items-center","justify-center","mr-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"text-lg","font-bold","text-gray-900"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"bg-white","rounded-lg","p-4"],[1,"block","text-xs","font-semibold","text-gray-600","mb-1","uppercase","tracking-wide"],[1,"flex","justify-center"],[3,"onCardReady","onCardCopied","voucher","averageDiscountPercentage"],[1,"text-center","space-y-4"],[1,"bg-gradient-to-br","from-green-50","to-emerald-50/30","rounded-xl","p-6","border-2","border-green-200"],[1,"flex","items-start","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-green-600","mr-3","flex-shrink-0","mt-0.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-sm","text-green-900","text-left"],["type","button",1,"px-8","py-4","rounded-xl","font-bold","text-lg","hover:shadow-2xl","hover:scale-105","active:scale-95","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","disabled:hover:shadow-none","transition-all","duration-200","flex","items-center","gap-3","mx-auto",3,"click","disabled"],[1,"flex","items-center","justify-end","gap-4","pt-8","border-t-2","border-gray-100"],["type","button",1,"px-6","py-3","border-2","border-gray-300","text-gray-700","rounded-xl","font-semibold","hover:bg-gray-50","hover:border-gray-400","transition-all","duration-200","flex","items-center","gap-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],["type","button",1,"px-6","py-3","bg-gray-700","text-white","rounded-xl","font-semibold","hover:bg-gray-800","hover:shadow-lg","transition-all","duration-200",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-6","w-6"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["fill","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["d","M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"]],template:function(e,r){if(e&1){let a=D();t(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),h(),t(4,"svg",5),u(5,"path",6),n()(),C(),t(6,"h3",7),d(7),c(8,"translate"),n()(),t(9,"div",8)(10,"div",9)(11,"label",10),d(12),c(13,"translate"),n(),t(14,"div",7),d(15),n()(),t(16,"div",9)(17,"label",10),d(18),c(19,"translate"),n(),t(20,"div",7),d(21),n()()()(),t(22,"div",11)(23,"app-voucher-card",12,0),f("onCardReady",function(k){return g(a),_(r.onCardReady.emit(k))})("onCardCopied",function(k){return g(a),_(r.onCardCopied.emit(k))}),n()(),t(25,"div",13)(26,"div",14)(27,"div",15),h(),t(28,"svg",16),u(29,"path",17),n(),C(),t(30,"p",18),d(31),c(32,"translate"),n()()(),t(33,"button",19),f("click",function(){return g(a),_(r.onSendVoucher.emit())}),S(34,Dt,5,3)(35,kt,4,3),n()(),t(36,"div",20)(37,"button",21),f("click",function(){return g(a),_(r.onBack.emit())}),h(),t(38,"svg",22),u(39,"path",23),n(),d(40),c(41,"translate"),n(),C(),t(42,"button",24),f("click",function(){return g(a),_(r.onClose.emit())}),d(43),c(44,"translate"),n()()()}e&2&&(i(3),b("background","rgba(0, 48, 50, 0.2)"),i(),b("color","var(--sidebar-active-text)"),i(3),v(p(8,20,"invoice.voucher.patientInfo")),i(5),v(p(13,22,"patient.fullName")),i(3),v(r.voucher.patient.fullName),i(3),v(p(19,24,"patient.phone")),i(3),v(r.voucher.patient.phone),i(2),w("voucher",r.voucher)("averageDiscountPercentage",r.averageDiscountPercentage),i(8),x(" ",p(32,26,"invoice.voucher.qrCodeDescription")," "),i(2),b("background","var(--primary-bg)")("color","var(--primary-text)"),w("disabled",r.sendingVoucher),i(),y(r.sendingVoucher?34:35),i(6),x(" ",p(41,28,"common.back")," "),i(3),x(" ",p(44,30,"common.close")," "))},dependencies:[H,j,Le],encapsulation:2})};var K=()=>({standalone:!0}),X=(l,o)=>o.id,Vt=(l,o)=>o.id||o.name,Et=(l,o)=>o.origin,Pt=(l,o)=>o.drugId;function Tt(l,o){if(l&1&&(t(0,"div",6),u(1,"app-alert",27),n()),l&2){let e=m();i(),w("title",e.errorMessage)}}function Mt(l,o){l&1&&(h(),t(0,"svg",14),u(1,"path",28),n())}function Bt(l,o){if(l&1&&(t(0,"span",20),d(1,"1"),n()),l&2){let e=m();G("text-white",e.currentStep>=1)("text-gray-500",e.currentStep<1)}}function Ft(l,o){l&1&&(h(),t(0,"svg",14),u(1,"path",28),n())}function Gt(l,o){if(l&1&&(t(0,"span",20),d(1,"2"),n()),l&2){let e=m();G("text-white",e.currentStep>=2)("text-gray-500",e.currentStep<2)}}function Lt(l,o){if(l&1){let e=D();t(0,"app-invoice-step",29),f("onPatientInput",function(a){g(e);let s=m();return _(s.onPatientInput(a))})("onPatientFocus",function(){g(e);let a=m();return _(a.showPatientDropdown=!0)})("onPatientSelect",function(a){g(e);let s=m();return _(s.selectPatient(a))})("onDoctorInput",function(a){g(e);let s=m();return _(s.onDoctorInput(a))})("onDoctorFocus",function(){g(e);let a=m();return _(a.showDoctorDropdown=!0)})("onDoctorSelect",function(a){g(e);let s=m();return _(s.selectDoctor(a))})("onAddNewDoctor",function(){g(e);let a=m();return _(a.addNewDoctor())})("onDrugInput",function(a){g(e);let s=m();return _(s.onDrugInput(a))})("onDrugFocus",function(){g(e);let a=m();return _(a.showDrugDropdown=!0)})("onDrugSelect",function(a){g(e);let s=m();return _(s.selectDrug(a))})("onToggleDrugSelector",function(){g(e);let a=m();return _(a.showDrugSelector=!a.showDrugSelector)})("onAddSelectedDrug",function(){g(e);let a=m();return _(a.addSelectedDrug())})("onBarcodeEnter",function(){g(e);let a=m();return _(a.addItemByBarcode())})("onBarcodeScanned",function(a){g(e);let s=m();return _(s.onBarcodeScanned(a))})("onRemoveItem",function(a){g(e);let s=m();return _(s.removeItem(a))})("onCreateVoucher",function(){g(e);let a=m();return _(a.onCreateVoucher())})("onCreateInvoice",function(){g(e);let a=m();return _(a.onCreateInvoice())})("onCancel",function(){g(e);let a=m();return _(a.onCancel())}),n()}if(l&2){let e=m();w("invoiceForm",e.invoiceForm)("itemsArray",e.itemsArray)("patients",e.patients)("pharmacyDrugs",e.pharmacyDrugs)("doctors",e.doctors)("filteredDoctors",e.filteredDoctors)("filteredPatients",e.filteredPatients)("filteredDrugs",e.filteredDrugs)("patientInput",e.patientInput)("doctorInput",e.doctorInput)("drugInput",e.drugInput)("barcodeInput",e.barcodeInput)("showPatientDropdown",e.showPatientDropdown)("showDoctorDropdown",e.showDoctorDropdown)("showDrugDropdown",e.showDrugDropdown)("showDrugSelector",e.showDrugSelector)("loading",e.loading)("formattedSubtotal",e.formattedSubtotal)("formattedTotal",e.formattedTotal)("getDrugName",e.getDrugName.bind(e))}}function Nt(l,o){if(l&1){let e=D();t(0,"button",83),f("click",function(){let a=g(e).$implicit,s=m(4);return _(s.selectPatient(a))}),t(1,"div",47),h(),t(2,"svg",84),u(3,"path",42),n(),d(4),n()()}if(l&2){let e=o.$implicit;i(4),x(" ",e.fullName," ")}}function At(l,o){if(l&1&&V(0,Nt,5,1,"button",82,X),l&2){let e=m(3);E(e.filteredPatients)}}function Ht(l,o){l&1&&(t(0,"div",81),d(1),c(2,"translate"),n()),l&2&&(i(),x(" ",p(2,1,"common.noData")," "))}function jt(l,o){if(l&1){let e=D();t(0,"button",83),f("click",function(){let a=g(e).$implicit,s=m(4);return _(s.selectPatient(a))}),t(1,"div",47),h(),t(2,"svg",84),u(3,"path",42),n(),d(4),n()()}if(l&2){let e=o.$implicit;i(4),x(" ",e.fullName," ")}}function zt(l,o){if(l&1&&V(0,jt,5,1,"button",82,X),l&2){let e=m(3);E(e.patients)}}function Ot(l,o){if(l&1&&(t(0,"div",43)(1,"div",80),S(2,At,2,0)(3,Ht,3,3,"div",81)(4,zt,2,0),n()()),l&2){let e=m(2);i(2),y(e.patientInput.trim()&&e.filteredPatients.length>0?2:-1),i(),y(e.patientInput.trim()&&e.filteredPatients.length===0?3:-1),i(),y(e.patientInput.trim()?-1:4)}}function Rt(l,o){if(l&1){let e=D();t(0,"button",87),f("click",function(){let a=g(e).$implicit,s=m(4);return _(s.selectDoctor(a))}),t(1,"div",47),h(),t(2,"svg",84),u(3,"path",42),n(),d(4),n()()}if(l&2){let e=o.$implicit;i(4),x(" ",e.name," ")}}function Wt(l,o){if(l&1&&V(0,Rt,5,1,"button",86,Vt),l&2){let e=m(3);E(e.filteredDoctors)}}function qt(l,o){if(l&1){let e=D();t(0,"button",88),f("click",function(){g(e);let a=m(3);return _(a.addNewDoctor())}),t(1,"div",47),h(),t(2,"svg",89),u(3,"path",54),n(),d(4),c(5,"translate"),n()()}if(l&2){let e=m(3);i(4),ee(" ",p(5,2,"invoice.addNewDoctor"),": ",e.doctorInput," ")}}function $t(l,o){if(l&1){let e=D();t(0,"button",87),f("click",function(){let a=g(e).$implicit,s=m(4);return _(s.selectDoctor(a))}),t(1,"div",47),h(),t(2,"svg",84),u(3,"path",42),n(),d(4),n()()}if(l&2){let e=o.$implicit;i(4),x(" ",e.name," ")}}function Ut(l,o){if(l&1&&V(0,$t,5,1,"button",86,X),l&2){let e=m(3);E(e.doctors)}}function Kt(l,o){if(l&1&&(t(0,"div",43)(1,"div",80),S(2,Wt,2,0)(3,qt,6,4,"button",85)(4,Ut,2,0),n()()),l&2){let e=m(2);i(2),y(e.doctorInput.trim()&&e.filteredDoctors.length>0?2:-1),i(),y(e.doctorInput.trim()&&e.filteredDoctors.length===0?3:-1),i(),y(e.doctorInput.trim()?-1:4)}}function Yt(l,o){if(l&1){let e=D();t(0,"button",95),f("click",function(){let a=g(e).$implicit,s=m(5);return _(s.selectDrug(a))}),t(1,"div",96)(2,"div",47),h(),t(3,"svg",84),u(4,"path",92),n(),C(),t(5,"span"),d(6),n()(),t(7,"span",97),d(8),n()()()}if(l&2){let e=o.$implicit;i(6),v((e.generalDrug==null?null:e.generalDrug.name)||"Drug "+e.id),i(2),x("",e.price," EGP")}}function Qt(l,o){if(l&1&&V(0,Yt,9,2,"button",94,X),l&2){let e=m(4);E(e.filteredDrugs)}}function Jt(l,o){l&1&&(t(0,"div",81),d(1),c(2,"translate"),n()),l&2&&(i(),x(" ",p(2,1,"common.noData")," "))}function Xt(l,o){if(l&1){let e=D();t(0,"button",95),f("click",function(){let a=g(e).$implicit,s=m(5);return _(s.selectDrug(a))}),t(1,"div",96)(2,"div",47),h(),t(3,"svg",84),u(4,"path",92),n(),C(),t(5,"span"),d(6),n()(),t(7,"span",97),d(8),n()()()}if(l&2){let e=o.$implicit;i(6),v((e.generalDrug==null?null:e.generalDrug.name)||"Drug "+e.id),i(2),x("",e.price," EGP")}}function Zt(l,o){if(l&1&&V(0,Xt,9,2,"button",94,X),l&2){let e=m(4);E(e.pharmacyDrugs)}}function ei(l,o){if(l&1&&(t(0,"div",43)(1,"div",80),S(2,Qt,2,0)(3,Jt,3,3,"div",81)(4,Zt,2,0),n()()),l&2){let e=m(3);i(2),y(e.drugInput.trim()&&e.filteredDrugs.length>0?2:-1),i(),y(e.drugInput.trim()&&e.filteredDrugs.length===0?3:-1),i(),y(e.drugInput.trim()?-1:4)}}function ti(l,o){if(l&1){let e=D();t(0,"div",55)(1,"div",48)(2,"div",90)(3,"input",91),c(4,"translate"),M("ngModelChange",function(a){g(e);let s=m(2);return T(s.drugInput,a)||(s.drugInput=a),_(a)}),f("input",function(a){g(e);let s=m(2);return _(s.onDrugInput(a))})("focus",function(){g(e);let a=m(2);return _(a.showDrugDropdown=!0)}),n(),t(5,"div",40),h(),t(6,"svg",41),u(7,"path",92),n()(),S(8,ei,5,3,"div",43),n(),C(),t(9,"button",93),f("click",function(){g(e);let a=m(2);return _(a.addSelectedDrug())}),d(10),c(11,"translate"),n()()()}if(l&2){let e=m(2);i(3),P("ngModel",e.drugInput),w("ngModelOptions",B(13,K))("placeholder",p(4,9,"form.selectDrug")),i(5),y(e.showDrugDropdown?8:-1),i(),b("background","var(--sidebar-active-bg)")("color","var(--sidebar-active-text)"),i(),x(" ",p(11,11,"common.add")," ")}}function ii(l,o){l&1&&(t(0,"div",57)(1,"div",98),h(),t(2,"svg",99),u(3,"path",100),n()(),C(),t(4,"h4",101),d(5),c(6,"translate"),n(),t(7,"p",102),d(8),c(9,"translate"),n()()),l&2&&(i(5),v(p(6,2,"invoice.wizard.noItemsYet")),i(3),v(p(9,4,"invoice.wizard.addDrugsHint")))}function ni(l,o){if(l&1){let e=D();t(0,"div",103)(1,"div",104)(2,"label",105),d(3),c(4,"translate"),n(),t(5,"div",47)(6,"div",106),h(),t(7,"svg",41),u(8,"path",92),n()(),C(),u(9,"input",107),n()(),t(10,"div")(11,"label",105),d(12),c(13,"translate"),n(),u(14,"input",108),n(),t(15,"div")(16,"label",105),d(17),c(18,"translate"),n(),t(19,"div",8),u(20,"input",109),t(21,"span",110),d(22,"EGP"),n()()(),t(23,"div",111)(24,"button",112),f("click",function(){let a=g(e).$index,s=m(2);return _(s.removeItem(a))}),h(),t(25,"svg",41),u(26,"path",113),n()()(),C(),u(27,"div",114),n()}if(l&2){let e,r=o.$implicit,a=o.$index,s=m(2);b("animation-delay",a*.05+"s"),w("formGroupName",a),i(3),v(p(4,13,"drug.name")),i(3),b("background","rgba(0, 48, 50, 0.2)"),i(),b("color","var(--sidebar-active-text)"),i(2),w("value",s.getDrugName((e=r.get("drugId"))==null?null:e.value)),i(3),v(p(13,15,"invoice.quantity")),i(5),v(p(18,17,"form.invoice.unitPrice")),i(10),b("background","var(--sidebar-bg)")}}function oi(l,o){if(l&1&&(t(0,"div",59)(1,"div",115)(2,"div",116)(3,"span",117),d(4),c(5,"translate"),n(),t(6,"span",118),d(7),t(8,"span",119),d(9,"EGP"),n()()(),t(10,"div",120)(11,"span",118),d(12),c(13,"translate"),n(),t(14,"span",121),d(15),t(16,"span",122),d(17,"EGP"),n()()()()()),l&2){let e=m(2);i(4),v(p(5,6,"invoice.subtotal")),i(3),x("",e.formattedSubtotal," "),i(5),v(p(13,8,"invoice.total")),i(2),b("color","var(--sidebar-active-text)"),i(),x(" ",e.formattedTotal," ")}}function ri(l,o){l&1&&(h(),t(0,"svg",79),u(1,"circle",123)(2,"path",124),n())}function ai(l,o){l&1&&(h(),t(0,"svg",41),u(1,"path",125),n())}function li(l,o){if(l&1){let e=D();t(0,"form",23)(1,"div",30)(2,"div",31),u(3,"div",32),t(4,"h3",33),d(5),c(6,"translate"),n()(),t(7,"div",34)(8,"div",35)(9,"label",36),d(10),c(11,"translate"),t(12,"span",37),d(13,"*"),n()(),t(14,"div",38)(15,"input",39),c(16,"translate"),M("ngModelChange",function(a){g(e);let s=m();return T(s.patientInput,a)||(s.patientInput=a),_(a)}),f("input",function(a){g(e);let s=m();return _(s.onPatientInput(a))})("focus",function(){g(e);let a=m();return _(a.showPatientDropdown=!0)}),n(),t(17,"div",40),h(),t(18,"svg",41),u(19,"path",42),n()(),S(20,Ot,5,3,"div",43),n()(),C(),t(21,"div",35)(22,"label",36),d(23),c(24,"translate"),n(),t(25,"div",44)(26,"input",39),c(27,"translate"),M("ngModelChange",function(a){g(e);let s=m();return T(s.doctorInput,a)||(s.doctorInput=a),_(a)}),f("input",function(a){g(e);let s=m();return _(s.onDoctorInput(a))})("focus",function(){g(e);let a=m();return _(a.showDoctorDropdown=!0)}),n(),t(28,"div",40),h(),t(29,"svg",41),u(30,"path",45),n()(),S(31,Kt,5,3,"div",43),n()()()(),C(),t(32,"div",30)(33,"div",46)(34,"div",47),u(35,"div",32),t(36,"h3",33),d(37),c(38,"translate"),n()(),t(39,"div",48)(40,"div",49)(41,"input",50),c(42,"translate"),M("ngModelChange",function(a){g(e);let s=m();return T(s.barcodeInput,a)||(s.barcodeInput=a),_(a)}),f("keyup.enter",function(){g(e);let a=m();return _(a.addItemByBarcode())})("barcodeScanned",function(a){g(e);let s=m();return _(s.onBarcodeScanned(a))}),n(),t(43,"div",51),h(),t(44,"svg",41),u(45,"path",52),n()()(),C(),t(46,"button",53),f("click",function(){g(e);let a=m();return _(a.showDrugSelector=!a.showDrugSelector)}),h(),t(47,"svg",41),u(48,"path",54),n(),d(49),c(50,"translate"),n()()(),S(51,ti,12,14,"div",55),C(),t(52,"div",56),S(53,ii,10,6,"div",57),V(54,ni,28,19,"div",58,Z),n(),S(56,oi,18,10,"div",59),n(),t(57,"div",60)(58,"div",31),u(59,"div",32),t(60,"h3",33),d(61),c(62,"translate"),n()(),t(63,"div",34)(64,"div",35)(65,"label",36),d(66),c(67,"translate"),n(),t(68,"div",8)(69,"select",61)(70,"option",62),d(71),c(72,"translate"),n(),t(73,"option",63),d(74),c(75,"translate"),n(),t(76,"option",64),d(77),c(78,"translate"),n()(),t(79,"div",40),h(),t(80,"svg",41),u(81,"path",65),n()(),C(),t(82,"div",66),h(),t(83,"svg",41),u(84,"path",67),n()()()(),C(),t(85,"div",35)(86,"label",36),d(87),c(88,"translate"),n(),t(89,"div",8)(90,"select",68)(91,"option",69),d(92),c(93,"translate"),n(),t(94,"option",70),d(95),c(96,"translate"),n(),t(97,"option",71),d(98),c(99,"translate"),n(),t(100,"option",72),d(101),c(102,"translate"),n()(),t(103,"div",40),h(),t(104,"svg",41),u(105,"path",73),n()(),C(),t(106,"div",66),h(),t(107,"svg",41),u(108,"path",67),n()()()()()(),C(),t(109,"div",74)(110,"button",75),f("click",function(){g(e);let a=m();return _(a.onCancel())}),d(111),c(112,"translate"),n(),t(113,"button",76),f("click",function(){g(e);let a=m();return _(a.onCreateVoucher())}),h(),t(114,"svg",41),u(115,"path",77),n(),d(116),c(117,"translate"),n(),C(),t(118,"button",78),f("click",function(){g(e);let a=m();return _(a.onCreateInvoice())}),S(119,ri,3,0,":svg:svg",79)(120,ai,2,0,":svg:svg",41),d(121),c(122,"translate"),n()()()}if(l&2){let e=m();w("formGroup",e.invoiceForm),i(3),b("background","var(--sidebar-bg)"),i(2),v(p(6,54,"invoice.wizard.patientDoctorInfo")),i(5),x(" ",p(11,56,"invoice.patient")," "),i(5),P("ngModel",e.patientInput),w("ngModelOptions",B(96,K))("placeholder",p(16,58,"form.selectPatient")),i(5),y(e.showPatientDropdown?20:-1),i(3),v(p(24,60,"invoice.doctor")),i(3),P("ngModel",e.doctorInput),w("ngModelOptions",B(97,K))("placeholder",p(27,62,"form.selectOrType")),i(5),y(e.showDoctorDropdown?31:-1),i(4),b("background","var(--sidebar-bg)"),i(2),v(p(38,64,"invoice.items")),i(4),w("placeholder",p(42,66,"placeholder.scanBarcode")),P("ngModel",e.barcodeInput),w("ngModelOptions",B(98,K)),i(5),b("background","var(--sidebar-active-bg)")("color","var(--sidebar-active-text)"),i(3),x(" ",p(50,68,"form.invoice.addDrug")," "),i(2),y(e.showDrugSelector?51:-1),i(2),y(e.itemsArray.length===0?53:-1),i(),E(e.itemsArray.controls),i(2),y(e.itemsArray.length>0?56:-1),i(3),b("background","var(--sidebar-bg)"),i(2),v(p(62,70,"form.invoice.paymentInfo")),i(5),v(p(67,72,"invoice.paymentStatus")),i(5),v(p(72,74,"invoice.status.pending")),i(3),v(p(75,76,"invoice.status.partial")),i(3),v(p(78,78,"invoice.status.paid")),i(10),v(p(88,80,"invoice.paymentMethod")),i(5),v(p(93,82,"form.selectMethod")),i(3),v(p(96,84,"form.invoice.cash")),i(3),v(p(99,86,"form.invoice.card")),i(3),v(p(102,88,"form.invoice.bankTransfer")),i(10),x(" ",p(112,90,"common.cancel")," "),i(2),b("border-color","var(--primary-bg)")("color","var(--primary-text)"),w("disabled",e.invoiceForm.invalid||e.itemsArray.length===0),i(3),x(" ",p(117,92,"invoice.wizard.createVoucher")," "),i(2),b("background","var(--primary-bg)")("color","var(--primary-text)"),w("disabled",e.invoiceForm.invalid||e.itemsArray.length===0||e.loading),i(),y(e.loading?119:120),i(2),x(" ",p(122,94,"invoice.wizard.createInvoice")," ")}}function di(l,o){if(l&1){let e=D();t(0,"app-voucher-step",126),f("onCalculateDiscount",function(){g(e);let a=m();return _(a.calculateVoucherDiscount())})("onBack",function(){g(e);let a=m();return _(a.goToStep(1))})("onCreateVoucherInvoice",function(){g(e);let a=m();return _(a.onCreateVoucherInvoice())}),n()}if(l&2){let e=m();w("voucher",e.voucher)("voucherProductGroups",e.voucherProductGroups)("subtotal",e.subtotal)("averageDiscountPercentage",e.averageDiscountPercentage)("voucherDiscountAmount",e.voucherDiscountAmount)("loading",e.loading)("getDiscountedPrice",e.getDiscountedPrice.bind(e))}}function ci(l,o){if(l&1){let e=D();t(0,"div",162)(1,"div",104)(2,"div",163)(3,"input",164),M("ngModelChange",function(a){let s=g(e).$implicit;return T(s.applyDiscount,a)||(s.applyDiscount=a),_(a)}),f("change",function(){g(e);let a=m(3);return _(a.calculateVoucherDiscount())}),n(),t(4,"div",165)(5,"span",166),d(6),n(),t(7,"div",167),d(8),c(9,"translate"),t(10,"span",168),d(11),n(),d(12," \xD7 "),t(13,"span",168),d(14),c(15,"number"),n(),d(16," = "),t(17,"span",169),d(18),c(19,"number"),n()()()()(),t(20,"div",104)(21,"label",105),d(22),c(23,"translate"),n(),t(24,"div",8)(25,"input",170),M("ngModelChange",function(a){let s=g(e).$implicit;return T(s.discountPercentage,a)||(s.discountPercentage=a),_(a)}),f("input",function(){g(e);let a=m(3);return _(a.calculateVoucherDiscount())}),n(),t(26,"span",171),d(27,"%"),n()()(),t(28,"div",172)(29,"div",173)(30,"div",174),d(31),c(32,"translate"),n(),t(33,"div",118),d(34),c(35,"number"),n(),t(36,"div",175),d(37,"EGP"),n()()()()}if(l&2){let e=o.$implicit,r=m(3);i(3),b("accent-color","var(--sidebar-bg)"),P("ngModel",e.applyDiscount),w("ngModelOptions",B(38,K)),i(3),v(e.drugName),i(2),x(" ",p(9,23,"invoice.quantity"),": "),i(3),v(e.quantity),i(3),v(F(15,25,e.price,"1.2-2")),i(3),b("color","var(--sidebar-active-text)"),i(),x("",F(19,28,e.quantity*e.price,"1.2-2")," EGP"),i(4),x(" ",p(23,31,"invoice.voucher.discountPercentage")," "),i(3),b("border-color",e.applyDiscount?"rgba(0, 48, 50, 0.4)":"#e5e7eb")("background-color",e.applyDiscount?"rgba(0, 48, 50, 0.1)":"#f9fafb")("color",e.applyDiscount?"rgb(55 65 81)":""),P("ngModel",e.discountPercentage),w("ngModelOptions",B(39,K))("disabled",!e.applyDiscount),i(6),v(p(32,33,"invoice.totalPrice")),i(3),v(F(35,35,r.getDiscountedPrice(e),"1.2-2"))}}function si(l,o){if(l&1&&(t(0,"div",132)(1,"div",157)(2,"h4",158),h(),t(3,"svg",159),u(4,"path",160),n(),d(5),c(6,"translate"),c(7,"translate"),c(8,"translate"),n()(),C(),t(9,"div",161),V(10,ci,38,40,"div",162,Pt),n()()),l&2){let e=o.$implicit;i(),b("background","var(--sidebar-bg)")("color","var(--sidebar-active-text)"),i(4),x(" ",e.origin==="local"?p(6,5,"drug.origin.local"):e.origin==="imported"?p(7,7,"drug.origin.imported"):p(8,9,"invoice.voucher.unknownOrigin")," "),i(5),E(e.products)}}function pi(l,o){l&1&&(h(),t(0,"svg",79),u(1,"circle",123)(2,"path",124),n())}function mi(l,o){l&1&&(h(),t(0,"svg",41),u(1,"path",125),n())}function ui(l,o){if(l&1){let e=D();t(0,"div",25)(1,"div",127)(2,"label",36),d(3),c(4,"translate"),n(),t(5,"div",47)(6,"div",128),h(),t(7,"svg",129),u(8,"path",77),n()(),C(),u(9,"input",130),n()(),t(10,"div",131),V(11,si,12,11,"div",132,Et),n(),t(13,"div",133)(14,"div",134),h(),t(15,"svg",135),u(16,"path",136),n(),C(),t(17,"div")(18,"p",137),d(19),c(20,"translate"),n(),t(21,"p",138),d(22),c(23,"translate"),n()()(),t(24,"div",139)(25,"div",140)(26,"label",105),d(27),c(28,"translate"),n(),t(29,"div",141),d(30),c(31,"number"),n(),t(32,"div",142),d(33,"EGP"),n()(),t(34,"div",143)(35,"label",144),d(36),c(37,"translate"),n(),t(38,"div",121),d(39),n(),t(40,"div",138),d(41),c(42,"translate"),n()(),t(43,"div",145)(44,"label",146),d(45),c(46,"translate"),n(),t(47,"div",147),d(48),c(49,"number"),n(),t(50,"div",148),d(51),c(52,"translate"),n()()(),t(53,"div",149)(54,"div",150)(55,"div")(56,"div",151),d(57),c(58,"translate"),n(),t(59,"div",152),d(60),c(61,"number"),t(62,"span",153),d(63,"EGP"),n()()(),h(),t(64,"svg",154),u(65,"path",65),n()()()(),C(),t(66,"div",74)(67,"button",155),f("click",function(){g(e);let a=m();return _(a.goToStep(1))}),h(),t(68,"svg",41),u(69,"path",156),n(),d(70),c(71,"translate"),n(),C(),t(72,"button",78),f("click",function(){g(e);let a=m();return _(a.onCreateVoucherInvoice())}),S(73,pi,3,0,":svg:svg",79)(74,mi,2,0,":svg:svg",41),d(75),c(76,"translate"),n()()()}if(l&2){let e=m();i(3),v(p(4,42,"invoice.voucher.voucherName")),i(3),b("background","rgba(0, 48, 50, 0.2)"),i(),b("color","var(--sidebar-active-text)"),i(2),w("value",e.voucher==null?null:e.voucher.voucherName),i(2),E(e.voucherProductGroups),i(4),b("color","var(--sidebar-active-text)"),i(3),b("color","var(--sidebar-active-text)"),i(),x(" ",p(20,44,"invoice.voucher.note")," "),i(2),b("color","var(--card-text)"),i(),x(" ",p(23,46,"invoice.voucher.averageDiscountNote")," "),i(5),v(p(28,48,"invoice.subtotal")),i(3),v(F(31,50,e.subtotal,"1.2-2")),i(5),b("color","var(--sidebar-active-text)"),i(),v(p(37,53,"invoice.voucher.averageDiscount")),i(2),b("color","var(--sidebar-active-text)"),i(),x("",e.averageDiscountPercentage.toFixed(2),"%"),i(),b("color","var(--sidebar-active-text)"),i(),v(p(42,55,"invoice.voucher.averageDiscountLabel")),i(4),v(p(46,57,"invoice.voucher.discountAmount")),i(3),v(F(49,59,e.voucherDiscountAmount,"1.2-2")),i(3),v(p(52,62,"invoice.voucher.egpSaved")),i(2),b("background","var(--sidebar-bg)")("color","var(--sidebar-text)"),i(4),v(p(58,64,"invoice.total")),i(3),x("",F(61,66,e.subtotal-e.voucherDiscountAmount,"1.2-2")," "),i(10),x(" ",p(71,69,"common.back")," "),i(2),b("background","var(--primary-bg)")("color","var(--primary-text)"),w("disabled",e.loading),i(),y(e.loading?73:74),i(2),x(" ",p(76,71,"invoice.wizard.createInvoice")," ")}}function vi(l,o){if(l&1){let e=D();t(0,"app-share-voucher-step",176),f("onSendVoucher",function(){g(e);let a=m();return _(a.sendVoucherToPatient())})("onBack",function(){g(e);let a=m();return _(a.goToStep(2))})("onClose",function(){g(e);let a=m();return _(a.onCancel())})("onCardReady",function(a){g(e);let s=m();return _(s.onCardReadyHandler(a))})("onCardCopied",function(a){g(e);let s=m();return _(s.onCardCopied(a))}),n()}if(l&2){let e=m();w("voucher",e.voucher)("averageDiscountPercentage",e.averageDiscountPercentage)("sendingVoucher",e.sendingVoucher)}}function gi(l,o){l&1&&(h(),t(0,"svg",199),u(1,"circle",123)(2,"path",124),n(),d(3),c(4,"translate")),l&2&&(i(3),x(" ",p(4,1,"invoice.voucher.sending")," "))}function _i(l,o){l&1&&(h(),t(0,"svg",200),u(1,"path",201),n(),d(2),c(3,"translate")),l&2&&(i(2),x(" ",p(3,1,"invoice.voucher.sendToPatient")," "))}function bi(l,o){if(l&1){let e=D();t(0,"div",25)(1,"div",127)(2,"div",177)(3,"div",178),h(),t(4,"svg",129),u(5,"path",42),n()(),C(),t(6,"h3",118),d(7),c(8,"translate"),n()(),t(9,"div",179)(10,"div",180)(11,"label",181),d(12),c(13,"translate"),n(),t(14,"div",118),d(15),n()(),t(16,"div",180)(17,"label",181),d(18),c(19,"translate"),n(),t(20,"div",118),d(21),n()()()(),t(22,"div",182)(23,"div",183),u(24,"div",184)(25,"div",185)(26,"div",186)(27,"div",187)(28,"canvas",188,0),t(30,"div",189)(31,"p",190),d(32),c(33,"translate"),n(),t(34,"p",191),d(35),n()()()(),t(36,"div",192)(37,"div",193)(38,"div",194),h(),t(39,"svg",195),u(40,"path",65),n(),C(),t(41,"p",196),d(42),c(43,"translate"),n()()(),t(44,"button",197),f("click",function(){g(e);let a=m();return _(a.sendVoucherToPatient())}),S(45,gi,5,3)(46,_i,4,3),n()(),t(47,"div",74)(48,"button",155),f("click",function(){g(e);let a=m();return _(a.goToStep(2))}),h(),t(49,"svg",41),u(50,"path",156),n(),d(51),c(52,"translate"),n(),C(),t(53,"button",198),f("click",function(){g(e);let a=m();return _(a.onCancel())}),d(54),c(55,"translate"),n()()()}if(l&2){let e=m();i(3),b("background","rgba(0, 48, 50, 0.2)"),i(),b("color","var(--sidebar-active-text)"),i(3),v(p(8,30,"invoice.voucher.patientInfo")),i(5),v(p(13,32,"patient.fullName")),i(3),v(e.selectedPatient==null?null:e.selectedPatient.fullName),i(3),v(p(19,34,"patient.phone")),i(3),v(e.selectedPatient==null?null:e.selectedPatient.phone),i(3),b("border-color","var(--sidebar-bg)"),i(),b("border-color","var(--sidebar-bg)"),i(),b("border-color","var(--sidebar-bg)"),i(),b("border-color","var(--sidebar-bg)"),i(5),v(p(33,36,"invoice.voucher.voucherCode")),i(2),b("color","var(--sidebar-active-text)"),i(),v(e.voucher==null?null:e.voucher.voucherCode),i(7),x(" ",p(43,38,"invoice.voucher.qrCodeDescription")," "),i(2),b("background","var(--primary-bg)")("color","var(--primary-text)"),w("disabled",e.sendingVoucher),i(),y(e.sendingVoucher?45:46),i(6),x(" ",p(52,40,"common.back")," "),i(3),x(" ",p(55,42,"common.close")," ")}}var ze=class l{fb=N(Te);router=N(Pe);route=N(Ee);invoicesService=N(Ge);patientsService=N(Fe);drugsService=N(Ne);invoiceCartService=N(Ae);pharmacyContextService=N(Be);cardElementRef;invoiceForm;loading=!1;sendingVoucher=!1;errorMessage="";isEdit=!1;invoiceId=null;currentStep=1;patients=[];pharmacyDrugs=[];selectedPatient=null;barcodeInput="";showDrugSelector=!1;selectedDrugId="";drugInput="";showDrugDropdown=!1;filteredDrugs=[];patientInput="";showPatientDropdown=!1;filteredPatients=[];doctorInput="";showDoctorDropdown=!1;doctors=[{id:"DOC001",name:"Dr. John Smith"},{id:"DOC002",name:"Dr. Jane Doe"},{id:"DOC003",name:"Dr. Michael Johnson"},{id:"DOC004",name:"Dr. Sarah Williams"}];filteredDoctors=[];selectedDoctor=null;voucher=null;voucherProductGroups=[];averageDiscountPercentage=0;voucherDiscountAmount=0;get itemsArray(){return this.invoiceForm.get("items")}get subtotal(){return this.itemsArray.value.reduce((e,r)=>e+(r.quantity*r.unitPrice||0),0)}get total(){return this.subtotal}get formattedSubtotal(){return this.subtotal.toFixed(2)}get formattedTotal(){return this.total.toFixed(2)}ngOnInit(){this.invoiceId=this.route.snapshot.paramMap.get("id"),this.isEdit=!!this.invoiceId,this.invoiceForm=this.fb.group({patientId:["",[L.required]],items:this.fb.array([]),paymentStatus:["pending"],paymentMethod:[""],doctor:[null]}),this.loadPatients(),this.loadDrugs(),this.isEdit&&this.invoiceId&&this.loadInvoice()}getWizardTitle(){return""}loadPatients(){this.patientsService.getAll({page:1,pageSize:100}).subscribe({next:o=>{this.patients=o.data}})}loadDrugs(){this.drugsService.getPharmacyDrugs({page:1,pageSize:100}).subscribe({next:o=>{this.pharmacyDrugs=o.data,!this.isEdit&&this.itemsArray.length===0&&this.loadDrugsFromCart()}})}loadInvoice(){this.invoicesService.getById(this.invoiceId).subscribe({next:o=>{if(o){if(this.invoiceForm.patchValue({patientId:o.patientId,paymentStatus:o.paymentStatus,paymentMethod:o.paymentMethod||""}),o.patientId){let e=this.patients.find(r=>r.id===o.patientId);e&&(this.patientInput=e.fullName,this.selectedPatient=e)}o.items.forEach(e=>{this.addItemWithData(e)})}},error:()=>{this.errorMessage="Failed to load invoice"}})}onBarcodeScanned(o){this.addItemByBarcode(o)}addItemByBarcode(o){let e=o||this.barcodeInput.trim();e&&this.drugsService.getPharmacyDrugByBarcode(e).subscribe({next:r=>{r?(this.addItemWithDrug(r),this.barcodeInput=""):this.errorMessage="Drug not found for barcode: "+e},error:()=>{this.errorMessage="Failed to search drug"}})}onDrugInput(o){let e=o.target;if(this.drugInput=e.value,this.showDrugDropdown=!0,this.drugInput.trim()){let r=this.drugInput.toLowerCase();this.filteredDrugs=this.pharmacyDrugs.filter(a=>(a.generalDrug?.name||"Drug "+a.id).toLowerCase().includes(r))}else this.filteredDrugs=[...this.pharmacyDrugs]}selectDrug(o){this.drugInput=o.generalDrug?.name||"Drug "+o.id,this.selectedDrugId=o.id,this.showDrugDropdown=!1}addSelectedDrug(){if(!this.selectedDrugId)if(this.drugInput.trim()){let e=this.pharmacyDrugs.find(r=>(r.generalDrug?.name||"Drug "+r.id).toLowerCase()===this.drugInput.toLowerCase());if(e)this.selectedDrugId=e.id;else return}else return;let o=this.pharmacyDrugs.find(e=>e.id===this.selectedDrugId);o&&(this.addItemWithDrug(o),this.selectedDrugId="",this.drugInput="",this.showDrugSelector=!1)}addItemWithDrug(o){let e=this.itemsArray.controls.findIndex(a=>a.get("drugId")?.value===o.id);if(e>=0){let a=this.itemsArray.at(e),s=a.get("quantity")?.value||1;a.patchValue({quantity:s+1});return}let r=this.fb.group({drugId:[o.id,[L.required]],quantity:[1,[L.required,L.min(1)]],unitPrice:[o.priceAfterDiscount||o.price,[L.required]]});this.itemsArray.push(r)}loadDrugsFromCart(){if(this.isEdit)return;let o=this.invoiceCartService.getDrugs();o.length>0&&o.forEach(e=>{let r=this.pharmacyDrugs.find(a=>a.id===e.id)||e;this.addItemWithDrug(r)})}addItemWithData(o){let e=this.fb.group({drugId:[o.drugId,[L.required]],quantity:[o.quantity,[L.required,L.min(1)]],unitPrice:[o.unitPrice,[L.required]]});this.itemsArray.push(e)}removeItem(o){this.itemsArray.removeAt(o)}getDrugName(o){return this.pharmacyDrugs.find(r=>r.id===o)?.generalDrug?.name||"Unknown Drug"}onCreateInvoice(){if(this.invoiceForm.valid&&this.itemsArray.length>0){this.loading=!0,this.errorMessage="";let o=this.invoiceForm.value,e=o.items.map(s=>({drugId:s.drugId,quantity:s.quantity,unitPrice:s.unitPrice,totalPrice:s.quantity*s.unitPrice})),r={patientId:o.patientId,items:e,subtotal:this.subtotal,discount:0,total:this.total,paymentStatus:o.paymentStatus,paymentMethod:o.paymentMethod||void 0,pharmacyId:this.pharmacyContextService.getCurrentPharmacy()?.id||"ph1"};(this.isEdit?this.invoicesService.update(this.invoiceId,r):this.invoicesService.create(r)).subscribe({next:()=>{this.invoiceCartService.clear(),this.router.navigate(["/invoices"])},error:s=>{this.errorMessage=s.message||"An error occurred while saving",this.loading=!1}})}else Object.keys(this.invoiceForm.controls).forEach(o=>{this.invoiceForm.get(o)?.markAsTouched()})}onCreateVoucher(){if(this.invoiceForm.valid&&this.itemsArray.length>0){let o=this.invoiceForm.get("patientId")?.value;if(!o){this.errorMessage="Please select a patient first";return}if(this.selectedPatient=this.patients.find(Y=>Y.id===o)||null,!this.selectedPatient){this.errorMessage="Patient not found";return}let e=this.pharmacyContextService.getCurrentPharmacy();if(!e){this.errorMessage="Pharmacy not found";return}let r=Date.now().toString(36).toUpperCase(),a=`${o}-${e.name}-${r}`,s=new Date,k=new Date;k.setMonth(k.getMonth()+3),this.voucher={voucherName:a,voucherCode:r,createdAt:s,validUntil:k,amount:this.subtotal,patient:this.selectedPatient,pharmacy:e},this.groupProductsByOrigin(),this.currentStep=2}}groupProductsByOrigin(){let o=this.itemsArray.value,e={};o.forEach(r=>{let s=this.pharmacyDrugs.find(k=>k.id===r.drugId)?.origin||"unknown";e[s]||(e[s]={origin:s,products:[]}),e[s].products.push({drugId:r.drugId,drugName:this.getDrugName(r.drugId),price:r.unitPrice,quantity:r.quantity,applyDiscount:!1,discountPercentage:0})}),this.voucherProductGroups=Object.values(e),this.calculateVoucherDiscount()}getDiscountedPrice(o){return o.quantity*o.price}calculateVoucherDiscount(){let o=0,e=0,r=this.subtotal;this.voucherProductGroups.forEach(a=>{a.products.forEach(s=>{s.applyDiscount&&s.discountPercentage>0&&(o+=s.discountPercentage,e++)})}),e>0?this.averageDiscountPercentage=o/e:this.averageDiscountPercentage=0,this.voucherDiscountAmount=r*this.averageDiscountPercentage/100,this.voucher&&(this.voucher.amount=this.subtotal-this.voucherDiscountAmount)}onCreateVoucherInvoice(){this.loading=!0,this.errorMessage="";let o=this.invoiceForm.value,e=o.items.map(k=>({drugId:k.drugId,quantity:k.quantity,unitPrice:k.unitPrice,totalPrice:k.quantity*k.unitPrice})),r=this.voucherDiscountAmount,a=this.subtotal-r,s={patientId:o.patientId,items:e,subtotal:this.subtotal,discount:r,total:a,paymentStatus:o.paymentStatus,paymentMethod:o.paymentMethod||void 0,pharmacyId:this.pharmacyContextService.getCurrentPharmacy()?.id||"ph1",voucherCode:this.voucher?.voucherCode||"",voucherName:this.voucher?.voucherName||""};this.invoicesService.create(s).subscribe({next:()=>{this.loading=!1,this.currentStep=3},error:k=>{this.errorMessage=k.message||"An error occurred while saving",this.loading=!1}})}sendVoucherToPatient(){if(!this.voucher||!this.cardElementRef){this.errorMessage="Voucher or card not available";return}this.sendingVoucher=!0;let o=this.cardElementRef.nativeElement;(0,Oe.default)(o,{backgroundColor:"#ffffff",scale:2,logging:!1,useCORS:!0,allowTaint:!1}).then(e=>{e.toBlob(r=>{if(this.sendingVoucher=!1,!r){this.errorMessage="Failed to generate card image";return}let a=new ClipboardItem({"image/png":r});navigator.clipboard.write([a]).then(()=>{let k=`https://wa.me/${this.voucher.patient.phone.replace(/[^0-9]/g,"")}`;window.open(k,"_blank"),setTimeout(()=>{this.router.navigate(["/invoices"])},2e3)}).catch(s=>{console.error("Failed to copy to clipboard:",s);let k=URL.createObjectURL(r),Y=document.createElement("a");Y.href=k,Y.download=`voucher-${this.voucher.voucherCode}.png`,Y.click(),URL.revokeObjectURL(k);let Re=`https://wa.me/${this.voucher.patient.phone.replace(/[^0-9]/g,"")}`;window.open(Re,"_blank")})},"image/png")}).catch(e=>{console.error("Failed to capture card:",e),this.errorMessage="Failed to capture card image",this.sendingVoucher=!1})}onCardReadyHandler(o){this.cardElementRef=o}onCardCopied(o){console.log("Card copied to clipboard")}goToStep(o){this.currentStep=o}onCancel(){this.router.navigate(["/invoices"])}onPatientInput(o){let e=o.target;if(this.patientInput=e.value,this.showPatientDropdown=!0,this.patientInput.trim()){let r=this.patientInput.toLowerCase();this.filteredPatients=this.patients.filter(a=>a.fullName.toLowerCase().includes(r))}else this.filteredPatients=[...this.patients]}selectPatient(o){this.patientInput=o.fullName,this.selectedPatient=o,this.invoiceForm.patchValue({patientId:o.id}),this.showPatientDropdown=!1}onDoctorInput(o){let e=o.target;if(this.doctorInput=e.value,this.showDoctorDropdown=!0,this.doctorInput.trim()){let r=this.doctorInput.toLowerCase();this.filteredDoctors=this.doctors.filter(a=>a.name.toLowerCase().includes(r))}else this.filteredDoctors=[...this.doctors]}selectDoctor(o){this.doctorInput=o.name,this.selectedDoctor={doctorName:o.name,doctorId:o.id,isNewDoctor:!1},this.showDoctorDropdown=!1,this.invoiceForm.patchValue({doctor:this.selectedDoctor})}addNewDoctor(){let o=this.doctorInput.trim();o&&(this.selectedDoctor={doctorName:o,isNewDoctor:!0},this.showDoctorDropdown=!1,this.invoiceForm.patchValue({doctor:this.selectedDoctor}))}onClickOutside(o){let e=o.target;e.closest(".doctor-dropdown-container")||(this.showDoctorDropdown=!1),e.closest(".patient-dropdown-container")||(this.showPatientDropdown=!1),e.closest(".drug-dropdown-container")||(this.showDrugDropdown=!1)}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=A({type:l,selectors:[["app-invoice-form"]],hostBindings:function(e,r){e&1&&f("click",function(s){return r.onClickOutside(s)},!1,Se)},decls:60,vars:99,consts:[["qrCanvas",""],[1,"min-h-screen"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"mb-8","animate-fade-in"],[1,"text-3xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"mb-6","animate-slide-down"],[1,"mb-12","animate-fade-in-up",2,"animation-delay","0.1s"],[1,"relative"],[1,"absolute","top-5","left-0","right-0","h-1","bg-gray-200","rounded-full"],[1,"absolute","top-5","left-0","h-1","rounded-full","transition-all","duration-700","ease-out"],[1,"relative","flex","justify-between"],[1,"flex","flex-col","items-center","group","cursor-pointer",3,"click"],[1,"w-12","h-12","rounded-full","flex","items-center","justify-center","transition-all","duration-300","shadow-lg","border-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-white"],[1,"text-lg","font-bold",3,"text-white","text-gray-500"],[1,"mt-3","text-center"],[1,"text-sm","font-semibold","transition-colors"],[1,"text-xs","text-gray-500","mt-1","max-w-[120px]"],[1,"flex","flex-col","items-center","group"],[1,"text-lg","font-bold"],[1,"rounded-2xl","shadow-xl","border","border-gray-100","overflow-hidden","animate-fade-in-up",2,"animation-delay","0.2s","background","var(--card-bg)"],[3,"invoiceForm","itemsArray","patients","pharmacyDrugs","doctors","filteredDoctors","filteredPatients","filteredDrugs","patientInput","doctorInput","drugInput","barcodeInput","showPatientDropdown","showDoctorDropdown","showDrugDropdown","showDrugSelector","loading","formattedSubtotal","formattedTotal","getDrugName"],[1,"p-8",3,"formGroup"],[3,"voucher","voucherProductGroups","subtotal","averageDiscountPercentage","voucherDiscountAmount","loading","getDiscountedPrice"],[1,"p-8","space-y-8"],[3,"voucher","averageDiscountPercentage","sendingVoucher"],["type","error",3,"title"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","3","d","M5 13l4 4L19 7"],[3,"onPatientInput","onPatientFocus","onPatientSelect","onDoctorInput","onDoctorFocus","onDoctorSelect","onAddNewDoctor","onDrugInput","onDrugFocus","onDrugSelect","onToggleDrugSelector","onAddSelectedDrug","onBarcodeEnter","onBarcodeScanned","onRemoveItem","onCreateVoucher","onCreateInvoice","onCancel","invoiceForm","itemsArray","patients","pharmacyDrugs","doctors","filteredDoctors","filteredPatients","filteredDrugs","patientInput","doctorInput","drugInput","barcodeInput","showPatientDropdown","showDoctorDropdown","showDrugDropdown","showDrugSelector","loading","formattedSubtotal","formattedTotal","getDrugName"],[1,"mb-10"],[1,"flex","items-center","mb-6"],[1,"w-1","h-8","rounded-full","mr-3"],[1,"text-xl","font-bold","text-gray-900"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"group"],[1,"block","text-sm","font-semibold","text-gray-700","mb-2"],[1,"text-red-500","ml-1"],[1,"relative","patient-dropdown-container"],["type","text","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-full","px-4","py-3.5","pl-12","border-2","border-gray-200","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all","duration-200","hover:border-gray-300",3,"ngModelChange","input","focus","ngModel","ngModelOptions","placeholder"],[1,"absolute","left-4","top-1/2","-translate-y-1/2","text-gray-400","pointer-events-none"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"absolute","z-20","mt-2","w-full","bg-white","shadow-2xl","max-h-64","rounded-xl","border","border-gray-100","overflow-hidden","animate-slide-down"],[1,"relative","doctor-dropdown-container"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center"],[1,"flex","gap-3"],[1,"relative","group"],["type","text","appBarcodeScanner","","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-64","pl-11","pr-4","py-2.5","border-2","border-gray-200","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all","duration-200","hover:border-gray-300",3,"ngModelChange","keyup.enter","barcodeScanned","placeholder","ngModel","ngModelOptions"],[1,"absolute","left-3.5","top-1/2","-translate-y-1/2","text-gray-400","pointer-events-none"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"],["type","button",1,"px-5","py-2.5","rounded-xl","font-semibold","text-sm","hover:shadow-lg","hover:scale-105","active:scale-95","transition-all","duration-200","flex","items-center","gap-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"mb-6","p-6","rounded-xl","border-2","animate-slide-down",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],["formArrayName","items",1,"space-y-4"],[1,"text-center","py-16","px-4"],["onmouseenter","this.style.borderColor='rgba(0, 48, 50, 0.5)';","onmouseleave","this.style.borderColor='#f3f4f6';",1,"group","relative","grid","grid-cols-1","md:grid-cols-5","gap-4","p-5","bg-gradient-to-br","from-gray-50","to-white","rounded-xl","border-2","border-gray-100","hover:shadow-md","transition-all","duration-200","animate-slide-in-left",3,"formGroupName","animation-delay"],[1,"mt-6","p-6","rounded-xl","border-2",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],[1,"mb-8"],["formControlName","paymentStatus","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-full","px-4","py-3.5","pl-12","border-2","border-gray-200","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all","appearance-none","cursor-pointer","hover:border-gray-300"],["value","pending"],["value","partial"],["value","paid"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"absolute","right-4","top-1/2","-translate-y-1/2","text-gray-400","pointer-events-none"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],["formControlName","paymentMethod","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-full","px-4","py-3.5","pl-12","border-2","border-gray-200","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all","appearance-none","cursor-pointer","hover:border-gray-300"],["value",""],["value","cash"],["value","card"],["value","bank_transfer"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"],[1,"flex","items-center","justify-end","gap-4","pt-8","border-t-2","border-gray-100"],["type","button",1,"px-6","py-3","border-2","border-gray-300","text-gray-700","rounded-xl","font-semibold","hover:bg-gray-50","hover:border-gray-400","transition-all","duration-200",3,"click"],["type","button","onmouseenter","if (!this.disabled) this.style.backgroundColor='rgba(217, 242, 117, 0.1)';","onmouseleave","if (!this.disabled) this.style.backgroundColor='';",1,"px-6","py-3","border-2","rounded-xl","font-semibold","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:bg-transparent","transition-all","duration-200","flex","items-center","gap-2",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"],["type","button",1,"px-6","py-3","rounded-xl","font-semibold","hover:shadow-xl","hover:scale-105","active:scale-95","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","disabled:hover:shadow-none","transition-all","duration-200","flex","items-center","gap-2",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],[1,"py-2","max-h-64","overflow-auto"],[1,"px-4","py-3","text-sm","text-gray-500"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","border-l-4","border-transparent",2,"color","rgb(55 65 81)"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","border-l-4","border-transparent",2,"color","rgb(55 65 81)",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2","text-gray-400"],["type","button",1,"block","w-full","text-left","px-4","py-3","text-sm","hover:bg-green-50","transition-colors","cursor-pointer","text-green-600","font-semibold","border-l-4","border-transparent","hover:border-green-500"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)'; this.style.color='rgb(55 65 81)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent'; this.style.color='rgb(55 65 81)';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","text-gray-900","border-l-4","border-transparent",2,"color","rgb(55 65 81)"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)'; this.style.color='rgb(55 65 81)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent'; this.style.color='rgb(55 65 81)';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","text-gray-900","border-l-4","border-transparent",2,"color","rgb(55 65 81)",3,"click"],["type","button",1,"block","w-full","text-left","px-4","py-3","text-sm","hover:bg-green-50","transition-colors","cursor-pointer","text-green-600","font-semibold","border-l-4","border-transparent","hover:border-green-500",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],[1,"relative","flex-1","drug-dropdown-container"],["type","text","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='rgba(0, 48, 50, 0.4)'; this.style.boxShadow='none';",1,"w-full","px-4","py-3","pl-12","border-2","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all",2,"border-color","rgba(0, 48, 50, 0.4)",3,"ngModelChange","input","focus","ngModel","ngModelOptions","placeholder"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"],["type","button",1,"px-6","py-3","rounded-xl","font-semibold","text-sm","hover:shadow-lg","hover:scale-105","active:scale-95","transition-all","duration-200",3,"click"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)'; this.style.color='rgb(55 65 81)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent'; this.style.color='rgb(55 65 81)';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","border-l-4","border-transparent",2,"color","rgb(55 65 81)"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)'; this.style.color='rgb(55 65 81)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent'; this.style.color='rgb(55 65 81)';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","border-l-4","border-transparent",2,"color","rgb(55 65 81)",3,"click"],[1,"flex","items-center","justify-between"],[1,"text-xs","text-gray-500","ml-2"],[1,"w-20","h-20","mx-auto","mb-4","bg-gray-100","rounded-full","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-10","h-10","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600","mb-6"],["onmouseenter","this.style.borderColor='rgba(0, 48, 50, 0.5)';","onmouseleave","this.style.borderColor='#f3f4f6';",1,"group","relative","grid","grid-cols-1","md:grid-cols-5","gap-4","p-5","bg-gradient-to-br","from-gray-50","to-white","rounded-xl","border-2","border-gray-100","hover:shadow-md","transition-all","duration-200","animate-slide-in-left",3,"formGroupName"],[1,"md:col-span-2"],[1,"block","text-xs","font-semibold","text-gray-600","mb-2","uppercase","tracking-wide"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center","mr-3"],["type","text","readonly","",1,"flex-1","px-4","py-3","border","border-gray-200","rounded-lg","text-sm","bg-gray-50","text-gray-700","font-medium",3,"value"],["type","number","formControlName","quantity","min","1","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-full","px-4","py-3","border-2","border-gray-200","rounded-lg","text-sm","bg-white","focus:outline-none","transition-all","text-center","font-semibold","text-gray-900"],["type","number","formControlName","unitPrice","step","0.01","readonly","",1,"w-full","px-4","py-3","pr-8","border","border-gray-200","rounded-lg","text-sm","bg-gray-50","text-gray-700","font-semibold"],[1,"absolute","right-3","top-1/2","-translate-y-1/2","text-xs","text-gray-500","font-medium"],[1,"flex","items-end","justify-end","md:justify-start"],["type","button","title","Remove item",1,"group/btn","p-3","text-red-500","hover:text-white","hover:bg-red-500","rounded-lg","transition-all","duration-200","hover:scale-110","active:scale-95",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"absolute","-left-1","top-1/2","-translate-y-1/2","w-1","h-0","rounded-full","group-hover:h-3/4","transition-all","duration-300"],[1,"space-y-3"],[1,"flex","justify-between","items-center","pb-3",2,"border-bottom","1px solid rgba(0, 48, 50, 0.3)"],[1,"text-sm","font-semibold","text-gray-700"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-sm","font-normal","text-gray-600"],[1,"flex","justify-between","items-center","pt-2"],[1,"text-2xl","font-bold"],[1,"text-base","font-semibold","text-gray-600"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[3,"onCalculateDiscount","onBack","onCreateVoucherInvoice","voucher","voucherProductGroups","subtotal","averageDiscountPercentage","voucherDiscountAmount","loading","getDiscountedPrice"],[1,"rounded-xl","p-6","border-2",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],[1,"w-12","h-12","rounded-lg","flex","items-center","justify-center","mr-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["type","text","readonly","",1,"flex-1","px-4","py-3","border","rounded-lg","text-sm","bg-white/50","font-mono","text-gray-900","font-semibold",2,"border-color","rgba(0, 48, 50, 0.4)",3,"value"],[1,"space-y-6"],["onmouseenter","this.style.borderColor='rgba(0, 48, 50, 0.5)';","onmouseleave","this.style.borderColor='#e5e7eb';",1,"border-2","border-gray-200","rounded-xl","overflow-hidden","transition-all","duration-300"],[1,"border-t-2","border-gray-200","pt-8"],[1,"border-2","rounded-xl","p-5","mb-6","flex","items-start",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","mr-3","flex-shrink-0","mt-0.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-sm","font-semibold","mb-1"],[1,"text-sm"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"bg-gradient-to-br","from-gray-50","to-white","p-5","rounded-xl","border-2","border-gray-200"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"p-5","rounded-xl","border-2",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],[1,"block","text-xs","font-semibold","mb-2","uppercase","tracking-wide"],[1,"bg-gradient-to-br","from-green-50","to-emerald-50/30","p-5","rounded-xl","border-2","border-green-200"],[1,"block","text-xs","font-semibold","text-green-700","mb-2","uppercase","tracking-wide"],[1,"text-2xl","font-bold","text-green-600"],[1,"text-sm","text-green-600"],[1,"rounded-xl","p-6"],[1,"flex","justify-between","items-center"],[1,"text-sm","font-semibold","opacity-90","mb-1"],[1,"text-4xl","font-bold"],[1,"text-xl"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","opacity-20"],["type","button",1,"px-6","py-3","border-2","border-gray-300","text-gray-700","rounded-xl","font-semibold","hover:bg-gray-50","hover:border-gray-400","transition-all","duration-200","flex","items-center","gap-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"px-6","py-4"],[1,"text-lg","font-bold","text-white","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"],[1,"p-6","space-y-4","bg-gradient-to-br","from-gray-50","to-white"],["onmouseenter","this.style.borderColor='rgba(0, 48, 50, 0.5)';","onmouseleave","this.style.borderColor='#f3f4f6';",1,"grid","grid-cols-1","md:grid-cols-5","gap-4","p-5","bg-white","rounded-xl","border-2","border-gray-100","hover:shadow-md","transition-all","duration-200"],[1,"flex","items-start","space-x-3"],["type","checkbox",1,"w-5","h-5","mt-1","border-gray-300","rounded","cursor-pointer","transition-all",3,"ngModelChange","change","ngModel","ngModelOptions"],[1,"flex-1"],[1,"text-sm","font-bold","text-gray-900","block","mb-1"],[1,"text-xs","text-gray-600","bg-gray-100","rounded-lg","px-3","py-1.5","inline-block"],[1,"font-semibold"],[1,"font-bold"],["type","number","min","0","max","100","step","0.01","onfocus","if (!this.disabled) { this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)'; }","onblur","if (!this.disabled) { this.style.borderColor='rgba(0, 48, 50, 0.4)'; this.style.boxShadow='none'; }",1,"w-full","px-4","py-3","pr-8","border-2","rounded-lg","text-sm","transition-all","disabled:bg-gray-100","disabled:cursor-not-allowed","disabled:border-gray-200","focus:outline-none",3,"ngModelChange","input","ngModel","ngModelOptions","disabled"],[1,"absolute","right-3","top-1/2","-translate-y-1/2","text-sm","font-bold","text-gray-600"],[1,"flex","items-center","justify-end"],[1,"text-right"],[1,"text-xs","font-semibold","text-gray-600","mb-1"],[1,"text-xs","text-gray-500"],[3,"onSendVoucher","onBack","onClose","onCardReady","onCardCopied","voucher","averageDiscountPercentage","sendingVoucher"],[1,"flex","items-center","mb-4"],[1,"w-12","h-12","rounded-full","flex","items-center","justify-center","mr-3"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"bg-white","rounded-lg","p-4"],[1,"block","text-xs","font-semibold","text-gray-600","mb-1","uppercase","tracking-wide"],[1,"flex","justify-center"],[1,"relative","bg-white","p-8","rounded-2xl","border-4","shadow-2xl",2,"border-color","rgba(0, 48, 50, 0.4)"],[1,"absolute","-top-2","-left-2","w-8","h-8","border-t-4","border-l-4","rounded-tl-lg"],[1,"absolute","-top-2","-right-2","w-8","h-8","border-t-4","border-r-4","rounded-tr-lg"],[1,"absolute","-bottom-2","-left-2","w-8","h-8","border-b-4","border-l-4","rounded-bl-lg"],[1,"absolute","-bottom-2","-right-2","w-8","h-8","border-b-4","border-r-4","rounded-br-lg"],[1,"w-64","h-64"],[1,"mt-4","text-center"],[1,"text-xs","font-semibold","text-gray-600","uppercase","tracking-wide"],[1,"text-lg","font-bold","font-mono"],[1,"text-center","space-y-4"],[1,"bg-gradient-to-br","from-green-50","to-emerald-50/30","rounded-xl","p-6","border-2","border-green-200"],[1,"flex","items-start","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-green-600","mr-3","flex-shrink-0","mt-0.5"],[1,"text-sm","text-green-900","text-left"],["type","button",1,"px-8","py-4","rounded-xl","font-bold","text-lg","hover:shadow-2xl","hover:scale-105","active:scale-95","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","disabled:hover:shadow-none","transition-all","duration-200","flex","items-center","gap-3","mx-auto",3,"click","disabled"],["type","button",1,"px-6","py-3","bg-gray-700","text-white","rounded-xl","font-semibold","hover:bg-gray-800","hover:shadow-lg","transition-all","duration-200",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-6","w-6"],["fill","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["d","M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"]],template:function(e,r){e&1&&(t(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1",4),d(4),c(5,"translate"),c(6,"translate"),c(7,"translate"),c(8,"translate"),n(),t(9,"p",5),d(10),c(11,"translate"),c(12,"translate"),c(13,"translate"),n()(),S(14,Tt,2,1,"div",6),t(15,"div",7)(16,"div",8),u(17,"div",9)(18,"div",10),t(19,"div",11)(20,"div",12),f("click",function(){return r.currentStep>1&&r.goToStep(1)}),t(21,"div",13),S(22,Mt,2,0,":svg:svg",14)(23,Bt,2,4,"span",15),n(),t(24,"div",16)(25,"p",17),d(26),c(27,"translate"),n(),t(28,"p",18),d(29),c(30,"translate"),n()()(),t(31,"div",12),f("click",function(){return r.currentStep>2&&r.goToStep(2)}),t(32,"div",13),S(33,Ft,2,0,":svg:svg",14)(34,Gt,2,4,"span",15),n(),t(35,"div",16)(36,"p",17),d(37),c(38,"translate"),n(),t(39,"p",18),d(40),c(41,"translate"),n()()(),t(42,"div",19)(43,"div",13)(44,"span",20),d(45,"3"),n()(),t(46,"div",16)(47,"p",17),d(48),c(49,"translate"),n(),t(50,"p",18),d(51),c(52,"translate"),n()()()()()(),t(53,"div",21),S(54,Lt,1,20,"app-invoice-step",22)(55,li,123,99,"form",23)(56,di,1,7,"app-voucher-step",24)(57,ui,77,73,"div",25)(58,vi,1,3,"app-share-voucher-step",26)(59,bi,56,44,"div",25),n()()()),e&2&&(b("background","var(--page-bg)"),i(4),x(" ",r.currentStep===1?r.isEdit?p(5,73,"form.editInvoice"):p(6,75,"invoice.wizard.step1Title"):r.currentStep===2?p(7,77,"invoice.wizard.step2Title"):p(8,79,"invoice.wizard.step3Title")," "),i(6),x(" ",r.currentStep===1?p(11,81,"invoice.wizard.step1Description"):r.currentStep===2?p(12,83,"invoice.wizard.step2Description"):p(13,85,"invoice.wizard.step3Description")," "),i(4),y(r.errorMessage?14:-1),i(4),b("width",r.currentStep===1?"0%":r.currentStep===2?"50%":"100%")("background","var(--sidebar-bg)"),i(3),b("background",r.currentStep>=1?"var(--sidebar-bg)":"white")("border-color",r.currentStep>=1?"var(--sidebar-bg)":"#d1d5db"),G("bg-white",r.currentStep<1)("border-gray-300",r.currentStep<1)("scale-110",r.currentStep===1),i(),y(r.currentStep>1?22:23),i(3),b("color",r.currentStep===1?"var(--sidebar-active-text)":""),G("text-gray-900",r.currentStep>1)("text-gray-500",r.currentStep<1),i(),x(" ",p(27,87,"invoice.wizard.step1")," "),i(3),v(p(30,89,"invoice.wizard.step1Subtitle")),i(3),b("background",r.currentStep>=2?"var(--sidebar-bg)":"white")("border-color",r.currentStep>=2?"var(--sidebar-bg)":"#d1d5db"),G("bg-white",r.currentStep<2)("border-gray-300",r.currentStep<2)("scale-110",r.currentStep===2),i(),y(r.currentStep>2?33:34),i(3),b("color",r.currentStep===2?"var(--sidebar-active-text)":""),G("text-gray-900",r.currentStep>2)("text-gray-500",r.currentStep<2),i(),x(" ",p(38,91,"invoice.wizard.step2")," "),i(3),v(p(41,93,"invoice.wizard.step2Subtitle")),i(3),b("background",r.currentStep>=3?"var(--sidebar-bg)":"white")("border-color",r.currentStep>=3?"var(--sidebar-bg)":"#d1d5db"),G("bg-white",r.currentStep<3)("border-gray-300",r.currentStep<3)("scale-110",r.currentStep===3),i(),G("text-white",r.currentStep>=3)("text-gray-500",r.currentStep<3),i(3),b("color",r.currentStep===3?"var(--sidebar-active-text)":""),G("text-gray-500",r.currentStep<3),i(),x(" ",p(49,95,"invoice.wizard.step3")," "),i(3),v(p(52,97,"invoice.wizard.step3Subtitle")),i(3),y(r.currentStep===1?54:-1),i(),y(-1),i(),y(r.currentStep===2?56:-1),i(),y(-1),i(),y(r.currentStep===3?58:-1),i(),y(-1))},dependencies:[H,te,ue,oe,se,pe,z,W,ie,ce,O,ne,q,me,re,de,ae,le,$,R,Me,U,j,_e,be,he],styles:["@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_fade-in-up{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slide-down{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slide-in-left{0%{opacity:0;transform:translate(-20px)}to{opacity:1;transform:translate(0)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .5s ease-out}.animate-fade-in-up[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in-up .6s ease-out}.animate-slide-down[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-down .3s ease-out}.animate-slide-in-left[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-in-left .4s ease-out}[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--scrollbar-bg);border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb);border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{opacity:.8}"]})};export{ze as InvoiceFormComponent};
