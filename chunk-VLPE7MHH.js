import{a as X}from"./chunk-ITKD655B.js";import{a as U}from"./chunk-GR6BKOHX.js";import{a as K}from"./chunk-QDLVDHOW.js";import{a as Q}from"./chunk-JYPY3KCN.js";import{c as N,e as z,g as W,o as O,p as R,q as j,w as H}from"./chunk-TK76J465.js";import{a as G}from"./chunk-6CFKC637.js";import{a as q}from"./chunk-EIOKHCL2.js";import{a as J}from"./chunk-5PFWNSG3.js";import{b as A}from"./chunk-3UJCRMW3.js";import{d as F}from"./chunk-C3O3TVFX.js";import{$a as n,Ab as s,Bb as r,Fa as v,Ka as V,Q as _,Qa as d,Va as D,W as S,X as y,Y as P,Z as T,_a as a,_b as C,ab as h,cb as L,db as g,eb as b,mb as l,nb as c,ob as f,pb as w,tb as M,ub as B,vb as E,wa as t}from"./chunk-E4S7NVXB.js";import{a as I,b as k}from"./chunk-C6Q5SG76.js";var x=class m{status="active";get label(){return{active:"platform.account.statusActive",suspended:"platform.account.statusSuspended",trial:"platform.account.statusTrial",closed:"platform.account.statusClosed",restricted:"platform.account.statusRestricted"}[this.status]}get badgeVariant(){return{active:"success",suspended:"danger",trial:"info",closed:"default",restricted:"warning"}[this.status]}static \u0275fac=function(e){return new(e||m)};static \u0275cmp=v({type:m,selectors:[["app-account-status-badge"]],inputs:{status:"status"},decls:3,vars:4,consts:[[3,"variant"]],template:function(e,o){e&1&&(a(0,"app-badge",0),l(1),s(2,"translate"),n()),e&2&&(d("variant",o.badgeVariant),t(),f(" ",r(2,2,o.label)," "))},dependencies:[C,J,A],encapsulation:2})};function ee(m,i){if(m&1){let e=L();a(0,"app-modal",23,0),s(2,"translate"),g("confirmed",function(){S(e);let u=b();return y(u.selectedAccount=null)}),a(3,"div",1)(4,"div")(5,"h3",24),l(6),s(7,"translate"),n(),a(8,"div",25)(9,"div")(10,"label",11),l(11),s(12,"translate"),n(),a(13,"p",26),l(14),n()(),a(15,"div")(16,"label",11),l(17),s(18,"translate"),n(),h(19,"app-account-status-badge",27),n(),a(20,"div")(21,"label",11),l(22),s(23,"translate"),n(),a(24,"p",26),l(25),n()(),a(26,"div")(27,"label",11),l(28),s(29,"translate"),n(),a(30,"p",26),l(31),n()()()(),a(32,"app-module-toggle-matrix",28),g("modulesChange",function(u){S(e);let p=b();return y(p.updateModules(u))}),n()()()}if(m&2){let e=b();d("title",e.selectedAccount.name)("showFooter",!0)("confirmText",r(2,15,"common.close")),t(6),c(r(7,17,"platform.accounts.overview")),t(5),c(r(12,19,"platform.accounts.email")),t(3),c(e.selectedAccount.email),t(3),c(r(18,21,"platform.accounts.status")),t(2),d("status",e.selectedAccount.status),t(3),c(r(23,23,"platform.accounts.pharmacies")),t(3),w("",e.selectedAccount.pharmaciesCreated," / ",e.selectedAccount.maxPharmacies===-1?"\u221E":e.selectedAccount.maxPharmacies,""),t(3),c(r(29,25,"platform.accounts.staff")),t(3),w("",e.selectedAccount.staffCreated," / ",e.selectedAccount.maxStaff===-1?"\u221E":e.selectedAccount.maxStaff,""),t(),d("enabledModules",e.selectedAccount.enabledModules)}}var Y=class m{accountsService=_(U);router=_(F);loading=!1;accounts=[];selectedAccount=null;filters={status:"",search:""};totalAccounts=0;activeAccounts=0;trialAccounts=0;suspendedAccounts=0;pagination={page:1,pageSize:10,total:0,totalPages:0};columns=[{key:"name",label:"platform.accounts.name",sortable:!0},{key:"email",label:"platform.accounts.email",sortable:!0},{key:"status",label:"platform.accounts.status",sortable:!0},{key:"pharmaciesCreated",label:"platform.accounts.pharmacies",sortable:!0},{key:"lastLoginAt",label:"platform.accounts.lastLogin",sortable:!0}];showCreateModal=!1;ngOnInit(){this.loadAccounts()}loadAccounts(){this.loading=!0,this.accountsService.getAll({page:this.pagination.page,pageSize:this.pagination.pageSize,status:this.filters.status||void 0,search:this.filters.search||void 0}).subscribe({next:i=>{this.accounts=i.data.map(e=>k(I({},e),{status:e.status,pharmaciesCreated:`${e.pharmaciesCreated} / ${e.maxPharmacies===-1?"\u221E":e.maxPharmacies}`,lastLoginAt:e.lastLoginAt?new Date(e.lastLoginAt).toLocaleDateString():"-"})),this.pagination={page:i.page,pageSize:i.pageSize,total:i.total,totalPages:i.totalPages},this.calculateStats(i.data),this.loading=!1},error:()=>{this.loading=!1}})}calculateStats(i){this.totalAccounts=i.length,this.activeAccounts=i.filter(e=>e.status==="active").length,this.trialAccounts=i.filter(e=>e.status==="trial").length,this.suspendedAccounts=i.filter(e=>e.status==="suspended").length}applyFilters(){this.pagination.page=1,this.loadAccounts()}onPageChange(i){this.pagination.page=i,this.loadAccounts()}viewAccount(i){this.accountsService.getById(i.id).subscribe({next:e=>{this.selectedAccount=e}})}updateModules(i){this.selectedAccount&&this.accountsService.updateModules(this.selectedAccount.id,i).subscribe({next:e=>{this.selectedAccount=e,this.loadAccounts()}})}static \u0275fac=function(e){return new(e||m)};static \u0275cmp=v({type:m,selectors:[["app-accounts"]],decls:48,vars:52,consts:[["accountModal",""],[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-[var(--text-primary)]"],["variant","primary",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[3,"label","value","icon"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"block","text-sm","font-medium","text-[var(--card-text)]","mb-1"],[1,"w-full","px-4","py-2","border","border-[var(--border-color)]","rounded-[var(--radius-md)]","text-sm","bg-[var(--card-bg)]","text-[var(--text-primary)]",3,"ngModelChange","ngModel"],["value",""],["value","active"],["value","trial"],["value","suspended"],["type","text",1,"w-full","px-4","py-2","border","border-[var(--border-color)]","rounded-[var(--radius-md)]","text-sm","bg-[var(--card-bg)]","text-[var(--text-primary)]",3,"ngModelChange","ngModel","placeholder"],[1,"flex","items-end"],["variant","primary","size","sm",3,"onClick"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-6"],[3,"onPageChange","onRowClick","columns","data","pagination","loading","emptyMessage"],[3,"title","showFooter","confirmText"],[3,"confirmed","title","showFooter","confirmText"],[1,"text-lg","font-semibold","text-[var(--text-primary)]","mb-4"],[1,"grid","grid-cols-2","gap-4"],[1,"text-[var(--text-primary)]"],[3,"status"],[3,"modulesChange","enabledModules"]],template:function(e,o){e&1&&(a(0,"div",1)(1,"div",2)(2,"h1",3),l(3),s(4,"translate"),n(),a(5,"app-button",4),g("onClick",function(){return o.showCreateModal=!0}),P(),a(6,"svg",5),h(7,"path",6),n(),l(8),s(9,"translate"),n()(),T(),a(10,"div",7),h(11,"app-stat-card",8)(12,"app-stat-card",8)(13,"app-stat-card",8)(14,"app-stat-card",8),n(),a(15,"div",9)(16,"div",10)(17,"div")(18,"label",11),l(19),s(20,"translate"),n(),a(21,"select",12),E("ngModelChange",function(p){return B(o.filters.status,p)||(o.filters.status=p),p}),a(22,"option",13),l(23),s(24,"translate"),n(),a(25,"option",14),l(26),s(27,"translate"),n(),a(28,"option",15),l(29),s(30,"translate"),n(),a(31,"option",16),l(32),s(33,"translate"),n()()(),a(34,"div")(35,"label",11),l(36),s(37,"translate"),n(),a(38,"input",17),s(39,"translate"),E("ngModelChange",function(p){return B(o.filters.search,p)||(o.filters.search=p),p}),n()(),a(40,"div",18)(41,"app-button",19),g("onClick",function(){return o.applyFilters()}),l(42),s(43,"translate"),n()()()(),a(44,"div",20)(45,"app-table",21),s(46,"translate"),g("onPageChange",function(p){return o.onPageChange(p)})("onRowClick",function(p){return o.viewAccount(p)}),n()()(),V(47,ee,33,27,"app-modal",22)),e&2&&(t(3),c(r(4,30,"platform.accounts.title")),t(5),f(" ",r(9,32,"platform.accounts.create")," "),t(3),d("label","platform.accounts.total")("value",o.totalAccounts)("icon","users"),t(),d("label","platform.accounts.active")("value",o.activeAccounts)("icon","check-circle"),t(),d("label","platform.accounts.trial")("value",o.trialAccounts)("icon","clock"),t(),d("label","platform.accounts.suspended")("value",o.suspendedAccounts)("icon","alert"),t(5),c(r(20,34,"platform.accounts.status")),t(2),M("ngModel",o.filters.status),t(2),c(r(24,36,"common.all")),t(3),c(r(27,38,"platform.account.statusActive")),t(3),c(r(30,40,"platform.account.statusTrial")),t(3),c(r(33,42,"platform.account.statusSuspended")),t(4),c(r(37,44,"common.search")),t(2),M("ngModel",o.filters.search),d("placeholder",r(39,46,"platform.accounts.searchPlaceholder")),t(4),f(" ",r(43,48,"common.search")," "),t(3),d("columns",o.columns)("data",o.accounts)("pagination",o.pagination)("loading",o.loading)("emptyMessage",r(46,50,"platform.accounts.noAccounts")),t(2),D(o.selectedAccount?47:-1))},dependencies:[C,H,R,j,N,O,z,W,K,G,A,x,X,Q,q],encapsulation:2})};export{Y as AccountsComponent};
