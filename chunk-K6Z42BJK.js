import{a as je,b as Me}from"./chunk-DYYETH2D.js";import{a as Be}from"./chunk-RI4HLURJ.js";import{a as Ee}from"./chunk-J55IG6XL.js";import{a as Ae}from"./chunk-MU4FCAEK.js";import{a as Te}from"./chunk-EKSGP2SL.js";import{a as Fe}from"./chunk-QSZBM4NB.js";import"./chunk-P5TE6FOK.js";import"./chunk-Y5QUESDN.js";import{b as be,c as W,d as T,e as $,f as fe,g as U,h as xe,i as K,k as Ce,l as ye,m as Se,n as we,r as De,s as Q,v as Ie,w as j,x as Y}from"./chunk-VW37JDOU.js";import{a as Ve}from"./chunk-YJWIIGXE.js";import{a as Pe}from"./chunk-YUKQXM5O.js";import"./chunk-M3W4QUEG.js";import"./chunk-BYXBJQAS.js";import{b as he,d as _e}from"./chunk-QHH3SHC3.js";import{a as ke}from"./chunk-KPWAPXFF.js";import{b as O}from"./chunk-7DC7YEPQ.js";import{$ as D,$a as n,$b as L,Bb as d,Ca as ne,Cb as p,Db as H,Ga as M,Ia as se,La as I,M as ae,Ra as S,S as B,Sa as _,Ta as E,Wa as y,Xa as de,Y as m,Z as v,Za as V,Zb as ge,_ as x,_a as P,ab as a,bb as g,db as k,eb as f,f as re,fa as C,fb as u,jb as pe,ka as le,kb as ue,lb as me,nb as s,ob as b,pb as h,qb as ve,ub as F,vb as A,wa as ce,wb as N,xa as o,yb as G}from"./chunk-OKFD3A6M.js";import{d as He}from"./chunk-KAT7YFEL.js";var Le=He(je());var J=class l{barcodeSubject=new re;barcode$=this.barcodeSubject.asObservable();barcodeBuffer="";bufferTimeout;constructor(){this.initializeBarcodeReader()}initializeBarcodeReader(){document.addEventListener("keypress",i=>{i.key&&i.key.length===1&&this.handleBarcodeInput(i.key)})}handleBarcodeInput(i){this.bufferTimeout&&clearTimeout(this.bufferTimeout),this.barcodeBuffer+=i,i===`
`||i==="\r"?(this.processBarcode(this.barcodeBuffer.trim()),this.barcodeBuffer=""):this.bufferTimeout=setTimeout(()=>{this.barcodeBuffer.length>=6&&this.processBarcode(this.barcodeBuffer.trim()),this.barcodeBuffer=""},100)}processBarcode(i){i.length>=6&&this.barcodeSubject.next(i)}scanBarcode(i){i&&i.length>=6&&this.barcodeSubject.next(i)}static \u0275fac=function(e){return new(e||l)};static \u0275prov=ae({token:l,factory:l.\u0275fac,providedIn:"root"})};var X=class l{constructor(i,e){this.el=i;this.barcodeService=e;this.barcodeService.barcode$.subscribe(t=>{this.isElementFocused()&&this.barcodeScanned.emit(t)})}barcodeScanned=new C;barcodeBuffer="";bufferTimeout;onKeyDown(i){i.key&&i.key.length===1&&!i.ctrlKey&&!i.metaKey&&(this.bufferTimeout&&clearTimeout(this.bufferTimeout),this.barcodeBuffer+=i.key,this.bufferTimeout=setTimeout(()=>{this.barcodeBuffer=""},200))}onPaste(i){let e=i.clipboardData?.getData("text")||"";e.length>=6&&/^\d+$/.test(e)&&(i.preventDefault(),this.barcodeScanned.emit(e.trim()))}isElementFocused(){return document.activeElement===this.el.nativeElement||this.el.nativeElement.contains(document.activeElement)}static \u0275fac=function(e){return new(e||l)(ne(le),ne(J))};static \u0275dir=se({type:l,selectors:[["","appBarcodeScanner",""]],hostBindings:function(e,t){e&1&&f("keydown",function(c){return t.onKeyDown(c)})("paste",function(c){return t.onPaste(c)})},outputs:{barcodeScanned:"barcodeScanned"}})};var Z=()=>({standalone:!0}),q=(l,i)=>i.id,qe=(l,i)=>i.id||i.name;function We(l,i){if(l&1){let e=k();n(0,"button",44),f("click",function(){let r=m(e).$implicit,c=u(3);return v(c.onPatientSelect.emit(r))}),n(1,"div",18),x(),n(2,"svg",45),g(3,"path",13),a(),s(4),a()()}if(l&2){let e=i.$implicit;o(4),h(" ",e.fullName," ")}}function $e(l,i){if(l&1&&V(0,We,5,1,"button",43,q),l&2){let e=u(2);P(e.filteredPatients)}}function Ue(l,i){l&1&&(n(0,"div",42),s(1),d(2,"translate"),a()),l&2&&(o(),h(" ",p(2,1,"common.noData")," "))}function Ke(l,i){if(l&1){let e=k();n(0,"button",44),f("click",function(){let r=m(e).$implicit,c=u(3);return v(c.onPatientSelect.emit(r))}),n(1,"div",18),x(),n(2,"svg",45),g(3,"path",13),a(),s(4),a()()}if(l&2){let e=i.$implicit;o(4),h(" ",e.fullName," ")}}function Qe(l,i){if(l&1&&V(0,Ke,5,1,"button",43,q),l&2){let e=u(2);P(e.patients)}}function Ye(l,i){if(l&1&&(n(0,"div",14)(1,"div",41),I(2,$e,2,0)(3,Ue,3,3,"div",42)(4,Qe,2,0),a()()),l&2){let e=u();o(2),y(e.patientInput.trim()&&e.filteredPatients.length>0?2:-1),o(),y(e.patientInput.trim()&&e.filteredPatients.length===0?3:-1),o(),y(e.patientInput.trim()?-1:4)}}function Je(l,i){if(l&1){let e=k();n(0,"button",48),f("click",function(){let r=m(e).$implicit,c=u(3);return v(c.onDoctorSelect.emit(r))}),n(1,"div",18),x(),n(2,"svg",45),g(3,"path",13),a(),s(4),a()()}if(l&2){let e=i.$implicit;o(4),h(" ",e.name," ")}}function Xe(l,i){if(l&1&&V(0,Je,5,1,"button",47,qe),l&2){let e=u(2);P(e.filteredDoctors)}}function Ze(l,i){if(l&1){let e=k();n(0,"button",49),f("click",function(){m(e);let r=u(2);return v(r.onAddNewDoctor.emit())}),n(1,"div",18),x(),n(2,"svg",50),g(3,"path",25),a(),s(4),d(5,"translate"),a()()}if(l&2){let e=u(2);o(4),ve(" ",p(5,2,"invoice.addNewDoctor"),": ",e.doctorInput," ")}}function et(l,i){if(l&1){let e=k();n(0,"button",48),f("click",function(){let r=m(e).$implicit,c=u(3);return v(c.onDoctorSelect.emit(r))}),n(1,"div",18),x(),n(2,"svg",45),g(3,"path",13),a(),s(4),a()()}if(l&2){let e=i.$implicit;o(4),h(" ",e.name," ")}}function tt(l,i){if(l&1&&V(0,et,5,1,"button",47,q),l&2){let e=u(2);P(e.doctors)}}function it(l,i){if(l&1&&(n(0,"div",14)(1,"div",41),I(2,Xe,2,0)(3,Ze,6,4,"button",46)(4,tt,2,0),a()()),l&2){let e=u();o(2),y(e.doctorInput.trim()&&e.filteredDoctors.length>0?2:-1),o(),y(e.doctorInput.trim()&&e.filteredDoctors.length===0?3:-1),o(),y(e.doctorInput.trim()?-1:4)}}function nt(l,i){if(l&1){let e=k();n(0,"button",56),f("click",function(){let r=m(e).$implicit,c=u(4);return v(c.onDrugSelect.emit(r))}),n(1,"div",57)(2,"div",18),x(),n(3,"svg",45),g(4,"path",53),a(),D(),n(5,"span"),s(6),a()(),n(7,"span",58),s(8),a()()()}if(l&2){let e=i.$implicit;o(6),b((e.generalDrug==null?null:e.generalDrug.name)||"Drug "+e.id),o(2),h("",e.price," EGP")}}function ot(l,i){if(l&1&&V(0,nt,9,2,"button",55,q),l&2){let e=u(3);P(e.filteredDrugs)}}function rt(l,i){l&1&&(n(0,"div",42),s(1),d(2,"translate"),a()),l&2&&(o(),h(" ",p(2,1,"common.noData")," "))}function at(l,i){if(l&1){let e=k();n(0,"button",56),f("click",function(){let r=m(e).$implicit,c=u(4);return v(c.onDrugSelect.emit(r))}),n(1,"div",57)(2,"div",18),x(),n(3,"svg",45),g(4,"path",53),a(),D(),n(5,"span"),s(6),a()(),n(7,"span",58),s(8),a()()()}if(l&2){let e=i.$implicit;o(6),b((e.generalDrug==null?null:e.generalDrug.name)||"Drug "+e.id),o(2),h("",e.price," EGP")}}function lt(l,i){if(l&1&&V(0,at,9,2,"button",55,q),l&2){let e=u(3);P(e.pharmacyDrugs)}}function ct(l,i){if(l&1&&(n(0,"div",14)(1,"div",41),I(2,ot,2,0)(3,rt,3,3,"div",42)(4,lt,2,0),a()()),l&2){let e=u(2);o(2),y(e.drugInput.trim()&&e.filteredDrugs.length>0?2:-1),o(),y(e.drugInput.trim()&&e.filteredDrugs.length===0?3:-1),o(),y(e.drugInput.trim()?-1:4)}}function st(l,i){if(l&1){let e=k();n(0,"div",26)(1,"div",19)(2,"div",51)(3,"input",52),d(4,"translate"),N("ngModelChange",function(r){m(e);let c=u();return A(c.drugInput,r)||(c.drugInput=r),v(r)}),f("input",function(r){m(e);let c=u();return v(c.onDrugInput.emit(r))})("focus",function(){m(e);let r=u();return v(r.onDrugFocus.emit())}),a(),n(5,"div",11),x(),n(6,"svg",12),g(7,"path",53),a()(),I(8,ct,5,3,"div",14),a(),D(),n(9,"button",54),f("click",function(){m(e);let r=u();return v(r.onAddSelectedDrug.emit())}),s(10),d(11,"translate"),a()()()}if(l&2){let e=u();o(3),F("ngModel",e.drugInput),S("ngModelOptions",G(13,Z))("placeholder",p(4,9,"form.selectDrug")),o(5),y(e.showDrugDropdown?8:-1),o(),_("background","var(--sidebar-active-bg)")("color","var(--sidebar-active-text)"),o(),h(" ",p(11,11,"common.add")," ")}}function dt(l,i){l&1&&(n(0,"div",28)(1,"div",59),x(),n(2,"svg",60),g(3,"path",61),a()(),D(),n(4,"h4",62),s(5),d(6,"translate"),a(),n(7,"p",63),s(8),d(9,"translate"),a()()),l&2&&(o(5),b(p(6,2,"invoice.wizard.noItemsYet")),o(3),b(p(9,4,"invoice.wizard.addDrugsHint")))}function pt(l,i){if(l&1){let e=k();n(0,"div",64)(1,"div",65)(2,"label",66),s(3),d(4,"translate"),a(),n(5,"div",18)(6,"div",67),x(),n(7,"svg",12),g(8,"path",53),a()(),D(),g(9,"input",68),a()(),n(10,"div")(11,"label",66),s(12),d(13,"translate"),a(),g(14,"input",69),a(),n(15,"div")(16,"label",66),s(17),d(18,"translate"),a(),n(19,"div",70),g(20,"input",71),n(21,"span",72),s(22,"EGP"),a()()(),n(23,"div",73)(24,"button",74),f("click",function(){let r=m(e).$index,c=u();return v(c.onRemoveItem.emit(r))}),x(),n(25,"svg",12),g(26,"path",75),a()()(),D(),g(27,"div",76),a()}if(l&2){let e,t=i.$implicit,r=i.$index,c=u();_("animation-delay",r*.05+"s"),S("formGroupName",r),o(3),b(p(4,13,"drug.name")),o(3),_("background","rgba(0, 48, 50, 0.2)"),o(),_("color","var(--sidebar-active-text)"),o(2),S("value",c.getDrugName((e=t.get("drugId"))==null?null:e.value)),o(3),b(p(13,15,"invoice.quantity")),o(5),b(p(18,17,"form.invoice.unitPrice")),o(10),_("background","var(--sidebar-bg)")}}function ut(l,i){if(l&1&&(n(0,"div",30)(1,"div",77)(2,"div",78)(3,"span",79),s(4),d(5,"translate"),a(),n(6,"span",80),s(7),n(8,"span",81),s(9,"EGP"),a()()(),n(10,"div",82)(11,"span",80),s(12),d(13,"translate"),a(),n(14,"span",83),s(15),n(16,"span",84),s(17,"EGP"),a()()()()()),l&2){let e=u();o(4),b(p(5,6,"invoice.subtotal")),o(3),h("",e.formattedSubtotal," "),o(5),b(p(13,8,"invoice.total")),o(2),_("color","var(--sidebar-active-text)"),o(),h(" ",e.formattedTotal," ")}}var ee=class l{invoiceForm;itemsArray;patients=[];pharmacyDrugs=[];doctors=[];filteredDoctors=[];filteredPatients=[];filteredDrugs=[];patientInput="";doctorInput="";drugInput="";barcodeInput="";showPatientDropdown=!1;showDoctorDropdown=!1;showDrugDropdown=!1;showDrugSelector=!1;loading=!1;formattedSubtotal="0.00";formattedTotal="0.00";getDrugName;onPatientInput=new C;onPatientFocus=new C;onPatientSelect=new C;onDoctorInput=new C;onDoctorFocus=new C;onDoctorSelect=new C;onAddNewDoctor=new C;onDrugInput=new C;onDrugFocus=new C;onDrugSelect=new C;onToggleDrugSelector=new C;onAddSelectedDrug=new C;onBarcodeEnter=new C;onBarcodeScanned=new C;onRemoveItem=new C;onCreateVoucher=new C;onCreateInvoice=new C;onCancel=new C;paymentStatusOptions=[{value:"pending",label:"invoice.status.pending"},{value:"partial",label:"invoice.status.partial"},{value:"paid",label:"invoice.status.paid"}];paymentMethodOptions=[{value:"cash",label:"form.invoice.cash"},{value:"card",label:"form.invoice.card"},{value:"bank_transfer",label:"form.invoice.bankTransfer"}];static \u0275fac=function(e){return new(e||l)};static \u0275cmp=M({type:l,selectors:[["app-invoice-step"]],inputs:{invoiceForm:"invoiceForm",itemsArray:"itemsArray",patients:"patients",pharmacyDrugs:"pharmacyDrugs",doctors:"doctors",filteredDoctors:"filteredDoctors",filteredPatients:"filteredPatients",filteredDrugs:"filteredDrugs",patientInput:"patientInput",doctorInput:"doctorInput",drugInput:"drugInput",barcodeInput:"barcodeInput",showPatientDropdown:"showPatientDropdown",showDoctorDropdown:"showDoctorDropdown",showDrugDropdown:"showDrugDropdown",showDrugSelector:"showDrugSelector",loading:"loading",formattedSubtotal:"formattedSubtotal",formattedTotal:"formattedTotal",getDrugName:"getDrugName"},outputs:{onPatientInput:"onPatientInput",onPatientFocus:"onPatientFocus",onPatientSelect:"onPatientSelect",onDoctorInput:"onDoctorInput",onDoctorFocus:"onDoctorFocus",onDoctorSelect:"onDoctorSelect",onAddNewDoctor:"onAddNewDoctor",onDrugInput:"onDrugInput",onDrugFocus:"onDrugFocus",onDrugSelect:"onDrugSelect",onToggleDrugSelector:"onToggleDrugSelector",onAddSelectedDrug:"onAddSelectedDrug",onBarcodeEnter:"onBarcodeEnter",onBarcodeScanned:"onBarcodeScanned",onRemoveItem:"onRemoveItem",onCreateVoucher:"onCreateVoucher",onCreateInvoice:"onCreateInvoice",onCancel:"onCancel"},decls:82,vars:68,consts:[[1,"p-8",3,"formGroup"],[1,"mb-10"],[1,"flex","items-center","mb-6"],[1,"w-1","h-8","rounded-full","mr-3"],[1,"text-xl","font-bold","text-gray-900"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"group"],[1,"block","text-sm","font-semibold","text-gray-700","mb-2"],[1,"text-red-500","ml-1"],[1,"relative","patient-dropdown-container"],["type","text","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-full","px-4","py-3.5","pl-12","border-2","border-gray-200","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all","duration-200","hover:border-gray-300",3,"ngModelChange","input","focus","ngModel","ngModelOptions","placeholder"],[1,"absolute","left-4","top-1/2","-translate-y-1/2","text-gray-400","pointer-events-none"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"absolute","z-20","mt-2","w-full","bg-white","shadow-2xl","max-h-64","rounded-xl","border","border-gray-100","overflow-hidden","animate-slide-down"],[1,"relative","doctor-dropdown-container"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center"],[1,"flex","gap-3"],[1,"relative","group"],["type","text","appBarcodeScanner","","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-64","pl-11","pr-4","py-2.5","border-2","border-gray-200","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all","duration-200","hover:border-gray-300",3,"ngModelChange","keyup.enter","barcodeScanned","placeholder","ngModel","ngModelOptions"],[1,"absolute","left-3.5","top-1/2","-translate-y-1/2","text-gray-400","pointer-events-none"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"],["type","button",1,"px-5","py-2.5","rounded-xl","font-semibold","text-sm","hover:shadow-lg","hover:scale-105","active:scale-95","transition-all","duration-200","flex","items-center","gap-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"mb-6","p-6","rounded-xl","border-2","animate-slide-down",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],["formArrayName","items",1,"space-y-4"],[1,"text-center","py-16","px-4"],["onmouseenter","this.style.borderColor='rgba(0, 48, 50, 0.5)';","onmouseleave","this.style.borderColor='#f3f4f6';",1,"group","relative","grid","grid-cols-1","md:grid-cols-5","gap-4","p-5","bg-gradient-to-br","from-gray-50","to-white","rounded-xl","border-2","border-gray-100","hover:shadow-md","transition-all","duration-200","animate-slide-in-left",3,"formGroupName","animation-delay"],[1,"mt-6","p-6","rounded-xl","border-2",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],[1,"mb-8"],["formControlName","paymentStatus",3,"label","radioOptions"],["formControlName","paymentMethod",3,"label","radioOptions"],[1,"flex","items-center","justify-end","gap-4","pt-8","border-t-2","border-gray-100"],["type","button","variant","outline",3,"onClick"],["type","button","variant","outline",3,"onClick","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"],["type","button","variant","primary",3,"onClick","loading","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"py-2","max-h-64","overflow-auto"],[1,"px-4","py-3","text-sm","text-gray-500"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","border-l-4","border-transparent",2,"color","rgb(55 65 81)"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","border-l-4","border-transparent",2,"color","rgb(55 65 81)",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2","text-gray-400"],["type","button",1,"block","w-full","text-left","px-4","py-3","text-sm","hover:bg-green-50","transition-colors","cursor-pointer","text-green-600","font-semibold","border-l-4","border-transparent","hover:border-green-500"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)'; this.style.color='rgb(55 65 81)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent'; this.style.color='rgb(55 65 81)';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","text-gray-900","border-l-4","border-transparent",2,"color","rgb(55 65 81)"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)'; this.style.color='rgb(55 65 81)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent'; this.style.color='rgb(55 65 81)';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","text-gray-900","border-l-4","border-transparent",2,"color","rgb(55 65 81)",3,"click"],["type","button",1,"block","w-full","text-left","px-4","py-3","text-sm","hover:bg-green-50","transition-colors","cursor-pointer","text-green-600","font-semibold","border-l-4","border-transparent","hover:border-green-500",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],[1,"relative","flex-1","drug-dropdown-container"],["type","text","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='rgba(0, 48, 50, 0.4)'; this.style.boxShadow='none';",1,"w-full","px-4","py-3","pl-12","border-2","rounded-xl","text-sm","bg-white","focus:outline-none","transition-all",2,"border-color","rgba(0, 48, 50, 0.4)",3,"ngModelChange","input","focus","ngModel","ngModelOptions","placeholder"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"],["type","button",1,"px-6","py-3","rounded-xl","font-semibold","text-sm","hover:shadow-lg","hover:scale-105","active:scale-95","transition-all","duration-200",3,"click"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)'; this.style.color='rgb(55 65 81)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent'; this.style.color='rgb(55 65 81)';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","border-l-4","border-transparent",2,"color","rgb(55 65 81)"],["type","button","onmouseenter","this.style.backgroundColor='rgba(0, 48, 50, 0.1)'; this.style.borderLeftColor='var(--sidebar-bg)'; this.style.color='rgb(55 65 81)';","onmouseleave","this.style.backgroundColor=''; this.style.borderLeftColor='transparent'; this.style.color='rgb(55 65 81)';",1,"block","w-full","text-left","px-4","py-3","text-sm","transition-colors","cursor-pointer","border-l-4","border-transparent",2,"color","rgb(55 65 81)",3,"click"],[1,"flex","items-center","justify-between"],[1,"text-xs","text-gray-500","ml-2"],[1,"w-20","h-20","mx-auto","mb-4","bg-gray-100","rounded-full","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-10","h-10","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600","mb-6"],["onmouseenter","this.style.borderColor='rgba(0, 48, 50, 0.5)';","onmouseleave","this.style.borderColor='#f3f4f6';",1,"group","relative","grid","grid-cols-1","md:grid-cols-5","gap-4","p-5","bg-gradient-to-br","from-gray-50","to-white","rounded-xl","border-2","border-gray-100","hover:shadow-md","transition-all","duration-200","animate-slide-in-left",3,"formGroupName"],[1,"md:col-span-2"],[1,"block","text-xs","font-semibold","text-gray-600","mb-2","uppercase","tracking-wide"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center","mr-3"],["type","text","readonly","",1,"flex-1","px-4","py-3","border","border-gray-200","rounded-lg","text-sm","bg-gray-50","text-gray-700","font-medium",3,"value"],["type","number","formControlName","quantity","min","1","onfocus","this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)';","onblur","this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';",1,"w-full","px-4","py-3","border-2","border-gray-200","rounded-lg","text-sm","bg-white","focus:outline-none","transition-all","text-center","font-semibold","text-gray-900"],[1,"relative"],["type","number","formControlName","unitPrice","step","0.01","readonly","",1,"w-full","px-4","py-3","pr-8","border","border-gray-200","rounded-lg","text-sm","bg-gray-50","text-gray-700","font-semibold"],[1,"absolute","right-3","top-1/2","-translate-y-1/2","text-xs","text-gray-500","font-medium"],[1,"flex","items-end","justify-end","md:justify-start"],["type","button","title","Remove item",1,"group/btn","p-3","text-red-500","hover:text-white","hover:bg-red-500","rounded-lg","transition-all","duration-200","hover:scale-110","active:scale-95",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"absolute","-left-1","top-1/2","-translate-y-1/2","w-1","h-0","rounded-full","group-hover:h-3/4","transition-all","duration-300"],[1,"space-y-3"],[1,"flex","justify-between","items-center","pb-3",2,"border-bottom","1px solid rgba(0, 48, 50, 0.3)"],[1,"text-sm","font-semibold","text-gray-700"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-sm","font-normal","text-gray-600"],[1,"flex","justify-between","items-center","pt-2"],[1,"text-2xl","font-bold"],[1,"text-base","font-semibold","text-gray-600"]],template:function(e,t){e&1&&(n(0,"form",0)(1,"div",1)(2,"div",2),g(3,"div",3),n(4,"h3",4),s(5),d(6,"translate"),a()(),n(7,"div",5)(8,"div",6)(9,"label",7),s(10),d(11,"translate"),n(12,"span",8),s(13,"*"),a()(),n(14,"div",9)(15,"input",10),d(16,"translate"),N("ngModelChange",function(c){return A(t.patientInput,c)||(t.patientInput=c),c}),f("input",function(c){return t.onPatientInput.emit(c)})("focus",function(){return t.onPatientFocus.emit()}),a(),n(17,"div",11),x(),n(18,"svg",12),g(19,"path",13),a()(),I(20,Ye,5,3,"div",14),a()(),D(),n(21,"div",6)(22,"label",7),s(23),d(24,"translate"),a(),n(25,"div",15)(26,"input",10),d(27,"translate"),N("ngModelChange",function(c){return A(t.doctorInput,c)||(t.doctorInput=c),c}),f("input",function(c){return t.onDoctorInput.emit(c)})("focus",function(){return t.onDoctorFocus.emit()}),a(),n(28,"div",11),x(),n(29,"svg",12),g(30,"path",16),a()(),I(31,it,5,3,"div",14),a()()()(),D(),n(32,"div",1)(33,"div",17)(34,"div",18),g(35,"div",3),n(36,"h3",4),s(37),d(38,"translate"),a()(),n(39,"div",19)(40,"div",20)(41,"input",21),d(42,"translate"),N("ngModelChange",function(c){return A(t.barcodeInput,c)||(t.barcodeInput=c),c}),f("keyup.enter",function(){return t.onBarcodeEnter.emit()})("barcodeScanned",function(c){return t.onBarcodeScanned.emit(c)}),a(),n(43,"div",22),x(),n(44,"svg",12),g(45,"path",23),a()()(),D(),n(46,"button",24),f("click",function(){return t.onToggleDrugSelector.emit()}),x(),n(47,"svg",12),g(48,"path",25),a(),s(49),d(50,"translate"),a()()(),I(51,st,12,14,"div",26),D(),n(52,"div",27),I(53,dt,10,6,"div",28),V(54,pt,28,19,"div",29,de),a(),I(56,ut,18,10,"div",30),a(),n(57,"div",31)(58,"div",2),g(59,"div",3),n(60,"h3",4),s(61),d(62,"translate"),a()(),n(63,"div",5)(64,"div",6),g(65,"app-radio-input",32),a(),n(66,"div",6),g(67,"app-radio-input",33),a()()(),n(68,"div",34)(69,"app-button",35),f("onClick",function(){return t.onCancel.emit()}),s(70),d(71,"translate"),a(),n(72,"app-button",36),f("onClick",function(){return t.onCreateVoucher.emit()}),x(),n(73,"svg",37),g(74,"path",38),a(),s(75),d(76,"translate"),a(),D(),n(77,"app-button",39),f("onClick",function(){return t.onCreateInvoice.emit()}),x(),n(78,"svg",37),g(79,"path",40),a(),s(80),d(81,"translate"),a()()()),e&2&&(S("formGroup",t.invoiceForm),o(3),_("background","var(--sidebar-bg)"),o(2),b(p(6,41,"invoice.wizard.patientDoctorInfo")),o(5),h(" ",p(11,43,"invoice.patient")," "),o(5),F("ngModel",t.patientInput),S("ngModelOptions",G(65,Z))("placeholder",p(16,45,"form.selectPatient")),o(5),y(t.showPatientDropdown?20:-1),o(3),b(p(24,47,"invoice.doctor")),o(3),F("ngModel",t.doctorInput),S("ngModelOptions",G(66,Z))("placeholder",p(27,49,"form.selectOrType")),o(5),y(t.showDoctorDropdown?31:-1),o(4),_("background","var(--sidebar-bg)"),o(2),b(p(38,51,"invoice.items")),o(4),S("placeholder",p(42,53,"placeholder.scanBarcode")),F("ngModel",t.barcodeInput),S("ngModelOptions",G(67,Z)),o(5),_("background","var(--sidebar-active-bg)")("color","var(--sidebar-active-text)"),o(3),h(" ",p(50,55,"form.invoice.addDrug")," "),o(2),y(t.showDrugSelector?51:-1),o(2),y(t.itemsArray.length===0?53:-1),o(),P(t.itemsArray.controls),o(2),y(t.itemsArray.length>0?56:-1),o(3),_("background","var(--sidebar-bg)"),o(2),b(p(62,57,"form.invoice.paymentInfo")),o(4),S("label","invoice.paymentStatus")("radioOptions",t.paymentStatusOptions),o(2),S("label","invoice.paymentMethod")("radioOptions",t.paymentMethodOptions),o(3),h(" ",p(71,59,"common.cancel")," "),o(2),S("disabled",t.invoiceForm.invalid||t.itemsArray.length===0),o(3),h(" ",p(76,61,"invoice.wizard.createVoucher")," "),o(2),S("loading",t.loading)("disabled",t.invoiceForm.invalid||t.itemsArray.length===0),o(3),h(" ",p(81,63,"invoice.wizard.createInvoice")," "))},dependencies:[L,Y,xe,W,K,$,fe,Q,Ce,we,ye,Se,j,U,O,X,Te,Ve],encapsulation:2})};var Ne=()=>({standalone:!0}),mt=(l,i)=>i.origin,vt=(l,i)=>i.drugId;function gt(l,i){if(l&1){let e=k();n(0,"div",46)(1,"div",47)(2,"div",48)(3,"input",49),N("ngModelChange",function(r){let c=m(e).$implicit;return A(c.applyDiscount,r)||(c.applyDiscount=r),v(r)}),f("change",function(){m(e);let r=u(2);return v(r.onCalculateDiscount.emit())}),a(),n(4,"div",50)(5,"span",51),s(6),a(),n(7,"div",52),s(8),d(9,"translate"),n(10,"span",53),s(11),a(),s(12," \xD7 "),n(13,"span",53),s(14),d(15,"number"),a(),s(16," = "),n(17,"span",54),s(18),d(19,"number"),a()()()()(),n(20,"div",47)(21,"label",18),s(22),d(23,"translate"),a(),n(24,"div",55)(25,"input",56),N("ngModelChange",function(r){let c=m(e).$implicit;return A(c.discountPercentage,r)||(c.discountPercentage=r),v(r)}),f("input",function(){m(e);let r=u(2);return v(r.onCalculateDiscount.emit())}),a(),n(26,"span",57),s(27,"%"),a()()(),n(28,"div",58)(29,"div",59)(30,"div",60),s(31),d(32,"translate"),a(),n(33,"div",61),s(34),d(35,"number"),a(),n(36,"div",62),s(37,"EGP"),a()()()()}if(l&2){let e=i.$implicit,t=u(2);o(3),_("accent-color","var(--sidebar-bg)"),F("ngModel",e.applyDiscount),S("ngModelOptions",G(38,Ne)),o(3),b(e.drugName),o(2),h(" ",p(9,23,"invoice.quantity"),": "),o(3),b(e.quantity),o(3),b(H(15,25,e.price,"1.2-2")),o(3),_("color","var(--sidebar-active-text)"),o(),h("",H(19,28,e.quantity*e.price,"1.2-2")," EGP"),o(4),h(" ",p(23,31,"invoice.voucher.discountPercentage")," "),o(3),_("border-color",e.applyDiscount?"rgba(0, 48, 50, 0.4)":"#e5e7eb")("background-color",e.applyDiscount?"rgba(0, 48, 50, 0.1)":"#f9fafb")("color",e.applyDiscount?"rgb(55 65 81)":""),F("ngModel",e.discountPercentage),S("ngModelOptions",G(39,Ne))("disabled",!e.applyDiscount),o(6),b(p(32,33,"invoice.totalPrice")),o(3),b(H(35,35,t.getDiscountedPrice(e),"1.2-2"))}}function ht(l,i){if(l&1&&(n(0,"div",9)(1,"div",41)(2,"h4",42),x(),n(3,"svg",43),g(4,"path",44),a(),s(5),d(6,"translate"),d(7,"translate"),d(8,"translate"),a()(),D(),n(9,"div",45),V(10,gt,38,40,"div",46,vt),a()()),l&2){let e=i.$implicit;o(),_("background","var(--sidebar-bg)")("color","var(--sidebar-active-text)"),o(4),h(" ",e.origin==="local"?p(6,5,"drug.origin.local"):e.origin==="imported"?p(7,7,"drug.origin.imported"):p(8,9,"invoice.voucher.unknownOrigin")," "),o(5),P(e.products)}}function _t(l,i){l&1&&(x(),n(0,"svg",40),g(1,"circle",63)(2,"path",64),a())}function bt(l,i){l&1&&(x(),n(0,"svg",37),g(1,"path",65),a())}var te=class l{voucher;voucherProductGroups=[];subtotal=0;averageDiscountPercentage=0;voucherDiscountAmount=0;loading=!1;getDiscountedPrice;onCalculateDiscount=new C;onBack=new C;onCreateVoucherInvoice=new C;static \u0275fac=function(e){return new(e||l)};static \u0275cmp=M({type:l,selectors:[["app-voucher-step"]],inputs:{voucher:"voucher",voucherProductGroups:"voucherProductGroups",subtotal:"subtotal",averageDiscountPercentage:"averageDiscountPercentage",voucherDiscountAmount:"voucherDiscountAmount",loading:"loading",getDiscountedPrice:"getDiscountedPrice"},outputs:{onCalculateDiscount:"onCalculateDiscount",onBack:"onBack",onCreateVoucherInvoice:"onCreateVoucherInvoice"},decls:77,vars:73,consts:[[1,"p-8","space-y-8"],[1,"rounded-xl","p-6","border-2",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],[1,"block","text-sm","font-semibold","text-gray-700","mb-2"],[1,"flex","items-center"],[1,"w-12","h-12","rounded-lg","flex","items-center","justify-center","mr-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"],["type","text","readonly","",1,"flex-1","px-4","py-3","border","rounded-lg","text-sm","bg-white/50","font-mono","text-gray-900","font-semibold",2,"border-color","rgba(0, 48, 50, 0.4)",3,"value"],[1,"space-y-6"],["onmouseenter","this.style.borderColor='rgba(0, 48, 50, 0.5)';","onmouseleave","this.style.borderColor='#e5e7eb';",1,"border-2","border-gray-200","rounded-xl","overflow-hidden","transition-all","duration-300"],[1,"border-t-2","border-gray-200","pt-8"],[1,"border-2","rounded-xl","p-5","mb-6","flex","items-start",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","mr-3","flex-shrink-0","mt-0.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-sm","font-semibold","mb-1"],[1,"text-sm"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"bg-gradient-to-br","from-gray-50","to-white","p-5","rounded-xl","border-2","border-gray-200"],[1,"block","text-xs","font-semibold","text-gray-600","mb-2","uppercase","tracking-wide"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"p-5","rounded-xl","border-2",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],[1,"block","text-xs","font-semibold","mb-2","uppercase","tracking-wide"],[1,"text-2xl","font-bold"],[1,"bg-gradient-to-br","from-green-50","to-emerald-50/30","p-5","rounded-xl","border-2","border-green-200"],[1,"block","text-xs","font-semibold","text-green-700","mb-2","uppercase","tracking-wide"],[1,"text-2xl","font-bold","text-green-600"],[1,"text-sm","text-green-600"],[1,"rounded-xl","p-6"],[1,"flex","justify-between","items-center"],[1,"text-sm","font-semibold","opacity-90","mb-1"],[1,"text-4xl","font-bold"],[1,"text-xl"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","opacity-20"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"flex","items-center","justify-end","gap-4","pt-8","border-t-2","border-gray-100"],["type","button",1,"px-6","py-3","border-2","border-gray-300","text-gray-700","rounded-xl","font-semibold","hover:bg-gray-50","hover:border-gray-400","transition-all","duration-200","flex","items-center","gap-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],["type","button",1,"px-6","py-3","rounded-xl","font-semibold","hover:shadow-xl","hover:scale-105","active:scale-95","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","disabled:hover:shadow-none","transition-all","duration-200","flex","items-center","gap-2",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],[1,"px-6","py-4"],[1,"text-lg","font-bold","text-white","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"],[1,"p-6","space-y-4","bg-gradient-to-br","from-gray-50","to-white"],["onmouseenter","this.style.borderColor='rgba(0, 48, 50, 0.5)';","onmouseleave","this.style.borderColor='#f3f4f6';",1,"grid","grid-cols-1","md:grid-cols-5","gap-4","p-5","bg-white","rounded-xl","border-2","border-gray-100","hover:shadow-md","transition-all","duration-200"],[1,"md:col-span-2"],[1,"flex","items-start","space-x-3"],["type","checkbox",1,"w-5","h-5","mt-1","border-gray-300","rounded","cursor-pointer","transition-all",3,"ngModelChange","change","ngModel","ngModelOptions"],[1,"flex-1"],[1,"text-sm","font-bold","text-gray-900","block","mb-1"],[1,"text-xs","text-gray-600","bg-gray-100","rounded-lg","px-3","py-1.5","inline-block"],[1,"font-semibold"],[1,"font-bold"],[1,"relative"],["type","number","min","0","max","100","step","0.01","onfocus","if (!this.disabled) { this.style.borderColor='var(--sidebar-bg)'; this.style.boxShadow='0 0 0 4px rgba(0, 48, 50, 0.1)'; }","onblur","if (!this.disabled) { this.style.borderColor='rgba(0, 48, 50, 0.4)'; this.style.boxShadow='none'; }",1,"w-full","px-4","py-3","pr-8","border-2","rounded-lg","text-sm","transition-all","disabled:bg-gray-100","disabled:cursor-not-allowed","disabled:border-gray-200","focus:outline-none",3,"ngModelChange","input","ngModel","ngModelOptions","disabled"],[1,"absolute","right-3","top-1/2","-translate-y-1/2","text-sm","font-bold","text-gray-600"],[1,"flex","items-center","justify-end"],[1,"text-right"],[1,"text-xs","font-semibold","text-gray-600","mb-1"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-xs","text-gray-500"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div",1)(2,"label",2),s(3),d(4,"translate"),a(),n(5,"div",3)(6,"div",4),x(),n(7,"svg",5),g(8,"path",6),a()(),D(),g(9,"input",7),a()(),n(10,"div",8),V(11,ht,12,11,"div",9,mt),a(),n(13,"div",10)(14,"div",11),x(),n(15,"svg",12),g(16,"path",13),a(),D(),n(17,"div")(18,"p",14),s(19),d(20,"translate"),a(),n(21,"p",15),s(22),d(23,"translate"),a()()(),n(24,"div",16)(25,"div",17)(26,"label",18),s(27),d(28,"translate"),a(),n(29,"div",19),s(30),d(31,"number"),a(),n(32,"div",20),s(33,"EGP"),a()(),n(34,"div",21)(35,"label",22),s(36),d(37,"translate"),a(),n(38,"div",23),s(39),a(),n(40,"div",15),s(41),d(42,"translate"),a()(),n(43,"div",24)(44,"label",25),s(45),d(46,"translate"),a(),n(47,"div",26),s(48),d(49,"number"),a(),n(50,"div",27),s(51),d(52,"translate"),a()()(),n(53,"div",28)(54,"div",29)(55,"div")(56,"div",30),s(57),d(58,"translate"),a(),n(59,"div",31),s(60),d(61,"number"),n(62,"span",32),s(63,"EGP"),a()()(),x(),n(64,"svg",33),g(65,"path",34),a()()()(),D(),n(66,"div",35)(67,"button",36),f("click",function(){return t.onBack.emit()}),x(),n(68,"svg",37),g(69,"path",38),a(),s(70),d(71,"translate"),a(),D(),n(72,"button",39),f("click",function(){return t.onCreateVoucherInvoice.emit()}),I(73,_t,3,0,":svg:svg",40)(74,bt,2,0,":svg:svg",37),s(75),d(76,"translate"),a()()()),e&2&&(o(3),b(p(4,42,"invoice.voucher.voucherName")),o(3),_("background","rgba(0, 48, 50, 0.2)"),o(),_("color","var(--sidebar-active-text)"),o(2),S("value",t.voucher.voucherName),o(2),P(t.voucherProductGroups),o(4),_("color","var(--sidebar-active-text)"),o(3),_("color","var(--sidebar-active-text)"),o(),h(" ",p(20,44,"invoice.voucher.note")," "),o(2),_("color","var(--card-text)"),o(),h(" ",p(23,46,"invoice.voucher.averageDiscountNote")," "),o(5),b(p(28,48,"invoice.subtotal")),o(3),b(H(31,50,t.subtotal,"1.2-2")),o(5),_("color","var(--sidebar-active-text)"),o(),b(p(37,53,"invoice.voucher.averageDiscount")),o(2),_("color","var(--sidebar-active-text)"),o(),h("",t.averageDiscountPercentage.toFixed(2),"%"),o(),_("color","var(--sidebar-active-text)"),o(),b(p(42,55,"invoice.voucher.averageDiscountLabel")),o(4),b(p(46,57,"invoice.voucher.discountAmount")),o(3),b(H(49,59,t.voucherDiscountAmount,"1.2-2")),o(3),b(p(52,62,"invoice.voucher.egpSaved")),o(2),_("background","var(--sidebar-bg)")("color","var(--sidebar-text)"),o(4),b(p(58,64,"invoice.total")),o(3),h("",H(61,66,t.subtotal-t.voucherDiscountAmount,"1.2-2")," "),o(10),h(" ",p(71,69,"common.back")," "),o(2),_("background","var(--primary-bg)")("color","var(--primary-text)"),S("disabled",t.loading),o(),y(t.loading?73:74),o(2),h(" ",p(76,71,"invoice.wizard.createInvoice")," "))},dependencies:[L,ge,j,W,K,be,$,Q,De,U,O],encapsulation:2})};var ft=["voucherCard"];function xt(l,i){l&1&&(x(),n(0,"svg",25),g(1,"circle",26)(2,"path",27),a(),s(3),d(4,"translate")),l&2&&(o(3),h(" ",p(4,1,"invoice.voucher.sending")," "))}function Ct(l,i){l&1&&(x(),n(0,"svg",28),g(1,"path",29),a(),s(2),d(3,"translate")),l&2&&(o(2),h(" ",p(3,1,"invoice.voucher.sendToPatient")," "))}var ie=class l{voucherCard;voucher;averageDiscountPercentage=0;sendingVoucher=!1;onSendVoucher=new C;onBack=new C;onClose=new C;onCardReady=new C;onCardCopied=new C;ngAfterViewInit(){}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=M({type:l,selectors:[["app-share-voucher-step"]],viewQuery:function(e,t){if(e&1&&pe(ft,5),e&2){let r;ue(r=me())&&(t.voucherCard=r.first)}},inputs:{voucher:"voucher",averageDiscountPercentage:"averageDiscountPercentage",sendingVoucher:"sendingVoucher"},outputs:{onSendVoucher:"onSendVoucher",onBack:"onBack",onClose:"onClose",onCardReady:"onCardReady",onCardCopied:"onCardCopied"},decls:45,vars:32,consts:[["voucherCard",""],[1,"p-8","space-y-8"],[1,"rounded-xl","p-6","border-2",2,"background","rgba(0, 48, 50, 0.1)","border-color","rgba(0, 48, 50, 0.3)","color","rgb(55 65 81)"],[1,"flex","items-center","mb-4"],[1,"w-12","h-12","rounded-full","flex","items-center","justify-center","mr-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"text-lg","font-bold","text-gray-900"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"bg-white","rounded-lg","p-4"],[1,"block","text-xs","font-semibold","text-gray-600","mb-1","uppercase","tracking-wide"],[1,"flex","justify-center"],[3,"onCardReady","onCardCopied","voucher","averageDiscountPercentage"],[1,"text-center","space-y-4"],[1,"bg-gradient-to-br","from-green-50","to-emerald-50/30","rounded-xl","p-6","border-2","border-green-200"],[1,"flex","items-start","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-green-600","mr-3","flex-shrink-0","mt-0.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-sm","text-green-900","text-left"],["type","button",1,"px-8","py-4","rounded-xl","font-bold","text-lg","hover:shadow-2xl","hover:scale-105","active:scale-95","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","disabled:hover:shadow-none","transition-all","duration-200","flex","items-center","gap-3","mx-auto",3,"click","disabled"],[1,"flex","items-center","justify-end","gap-4","pt-8","border-t-2","border-gray-100"],["type","button",1,"px-6","py-3","border-2","border-gray-300","text-gray-700","rounded-xl","font-semibold","hover:bg-gray-50","hover:border-gray-400","transition-all","duration-200","flex","items-center","gap-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],["type","button",1,"px-6","py-3","bg-gray-700","text-white","rounded-xl","font-semibold","hover:bg-gray-800","hover:shadow-lg","transition-all","duration-200",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-6","w-6"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["fill","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["d","M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"]],template:function(e,t){if(e&1){let r=k();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),x(),n(4,"svg",5),g(5,"path",6),a()(),D(),n(6,"h3",7),s(7),d(8,"translate"),a()(),n(9,"div",8)(10,"div",9)(11,"label",10),s(12),d(13,"translate"),a(),n(14,"div",7),s(15),a()(),n(16,"div",9)(17,"label",10),s(18),d(19,"translate"),a(),n(20,"div",7),s(21),a()()()(),n(22,"div",11)(23,"app-voucher-card",12,0),f("onCardReady",function(w){return m(r),v(t.onCardReady.emit(w))})("onCardCopied",function(w){return m(r),v(t.onCardCopied.emit(w))}),a()(),n(25,"div",13)(26,"div",14)(27,"div",15),x(),n(28,"svg",16),g(29,"path",17),a(),D(),n(30,"p",18),s(31),d(32,"translate"),a()()(),n(33,"button",19),f("click",function(){return m(r),v(t.onSendVoucher.emit())}),I(34,xt,5,3)(35,Ct,4,3),a()(),n(36,"div",20)(37,"button",21),f("click",function(){return m(r),v(t.onBack.emit())}),x(),n(38,"svg",22),g(39,"path",23),a(),s(40),d(41,"translate"),a(),D(),n(42,"button",24),f("click",function(){return m(r),v(t.onClose.emit())}),s(43),d(44,"translate"),a()()()}e&2&&(o(3),_("background","rgba(0, 48, 50, 0.2)"),o(),_("color","var(--sidebar-active-text)"),o(3),b(p(8,20,"invoice.voucher.patientInfo")),o(5),b(p(13,22,"patient.fullName")),o(3),b(t.voucher.patient.fullName),o(3),b(p(19,24,"patient.phone")),o(3),b(t.voucher.patient.phone),o(2),S("voucher",t.voucher)("averageDiscountPercentage",t.averageDiscountPercentage),o(8),h(" ",p(32,26,"invoice.voucher.qrCodeDescription")," "),o(2),_("background","var(--primary-bg)")("color","var(--primary-text)"),S("disabled",t.sendingVoucher),o(),y(t.sendingVoucher?34:35),o(6),h(" ",p(41,28,"common.back")," "),o(3),h(" ",p(44,30,"common.close")," "))},dependencies:[L,O,Me],encapsulation:2})};function yt(l,i){if(l&1&&(n(0,"div",5),g(1,"app-alert",24),a()),l&2){let e=u();o(),S("title",e.errorMessage)}}function St(l,i){l&1&&(x(),n(0,"svg",13),g(1,"path",25),a())}function wt(l,i){if(l&1&&(n(0,"span",19),s(1,"1"),a()),l&2){let e=u();E("text-white",e.currentStep>=1)("text-gray-500",e.currentStep<1)}}function Dt(l,i){l&1&&(x(),n(0,"svg",13),g(1,"path",25),a())}function It(l,i){if(l&1&&(n(0,"span",19),s(1,"2"),a()),l&2){let e=u();E("text-white",e.currentStep>=2)("text-gray-500",e.currentStep<2)}}function kt(l,i){if(l&1){let e=k();n(0,"app-invoice-step",26),f("onPatientInput",function(r){m(e);let c=u();return v(c.onPatientInput(r))})("onPatientFocus",function(){m(e);let r=u();return v(r.showPatientDropdown=!0)})("onPatientSelect",function(r){m(e);let c=u();return v(c.selectPatient(r))})("onDoctorInput",function(r){m(e);let c=u();return v(c.onDoctorInput(r))})("onDoctorFocus",function(){m(e);let r=u();return v(r.showDoctorDropdown=!0)})("onDoctorSelect",function(r){m(e);let c=u();return v(c.selectDoctor(r))})("onAddNewDoctor",function(){m(e);let r=u();return v(r.addNewDoctor())})("onDrugInput",function(r){m(e);let c=u();return v(c.onDrugInput(r))})("onDrugFocus",function(){m(e);let r=u();return v(r.showDrugDropdown=!0)})("onDrugSelect",function(r){m(e);let c=u();return v(c.selectDrug(r))})("onToggleDrugSelector",function(){m(e);let r=u();return v(r.showDrugSelector=!r.showDrugSelector)})("onAddSelectedDrug",function(){m(e);let r=u();return v(r.addSelectedDrug())})("onBarcodeEnter",function(){m(e);let r=u();return v(r.addItemByBarcode())})("onBarcodeScanned",function(r){m(e);let c=u();return v(c.onBarcodeScanned(r))})("onRemoveItem",function(r){m(e);let c=u();return v(c.removeItem(r))})("onCreateVoucher",function(){m(e);let r=u();return v(r.onCreateVoucher())})("onCreateInvoice",function(){m(e);let r=u();return v(r.onCreateInvoice())})("onCancel",function(){m(e);let r=u();return v(r.onCancel())}),a()}if(l&2){let e=u();S("invoiceForm",e.invoiceForm)("itemsArray",e.itemsArray)("patients",e.patients)("pharmacyDrugs",e.pharmacyDrugs)("doctors",e.doctors)("filteredDoctors",e.filteredDoctors)("filteredPatients",e.filteredPatients)("filteredDrugs",e.filteredDrugs)("patientInput",e.patientInput)("doctorInput",e.doctorInput)("drugInput",e.drugInput)("barcodeInput",e.barcodeInput)("showPatientDropdown",e.showPatientDropdown)("showDoctorDropdown",e.showDoctorDropdown)("showDrugDropdown",e.showDrugDropdown)("showDrugSelector",e.showDrugSelector)("loading",e.loading)("formattedSubtotal",e.formattedSubtotal)("formattedTotal",e.formattedTotal)("getDrugName",e.getDrugName.bind(e))}}function Vt(l,i){if(l&1){let e=k();n(0,"app-voucher-step",27),f("onCalculateDiscount",function(){m(e);let r=u();return v(r.calculateVoucherDiscount())})("onBack",function(){m(e);let r=u();return v(r.goToStep(1))})("onCreateVoucherInvoice",function(){m(e);let r=u();return v(r.onCreateVoucherInvoice())}),a()}if(l&2){let e=u();S("voucher",e.voucher)("voucherProductGroups",e.voucherProductGroups)("subtotal",e.subtotal)("averageDiscountPercentage",e.averageDiscountPercentage)("voucherDiscountAmount",e.voucherDiscountAmount)("loading",e.loading)("getDiscountedPrice",e.getDiscountedPrice.bind(e))}}function Pt(l,i){if(l&1){let e=k();n(0,"app-share-voucher-step",28),f("onSendVoucher",function(){m(e);let r=u();return v(r.sendVoucherToPatient())})("onBack",function(){m(e);let r=u();return v(r.goToStep(2))})("onClose",function(){m(e);let r=u();return v(r.onCancel())})("onCardReady",function(r){m(e);let c=u();return v(c.onCardReadyHandler(r))})("onCardCopied",function(r){m(e);let c=u();return v(c.onCardCopied(r))}),a()}if(l&2){let e=u();S("voucher",e.voucher)("averageDiscountPercentage",e.averageDiscountPercentage)("sendingVoucher",e.sendingVoucher)}}var Ge=class l{fb=B(Ie);router=B(_e);route=B(he);invoicesService=B(Be);patientsService=B(Ee);drugsService=B(Fe);invoiceCartService=B(Ae);pharmacyContextService=B(Pe);cardElementRef;invoiceForm;loading=!1;sendingVoucher=!1;errorMessage="";isEdit=!1;invoiceId=null;currentStep=1;patients=[];pharmacyDrugs=[];selectedPatient=null;barcodeInput="";showDrugSelector=!1;selectedDrugId="";drugInput="";showDrugDropdown=!1;filteredDrugs=[];patientInput="";showPatientDropdown=!1;filteredPatients=[];doctorInput="";showDoctorDropdown=!1;doctors=[{id:"DOC001",name:"Dr. John Smith"},{id:"DOC002",name:"Dr. Jane Doe"},{id:"DOC003",name:"Dr. Michael Johnson"},{id:"DOC004",name:"Dr. Sarah Williams"}];filteredDoctors=[];selectedDoctor=null;voucher=null;voucherProductGroups=[];averageDiscountPercentage=0;voucherDiscountAmount=0;get itemsArray(){return this.invoiceForm.get("items")}get subtotal(){return this.itemsArray.value.reduce((e,t)=>e+(t.quantity*t.unitPrice||0),0)}get total(){return this.subtotal}get formattedSubtotal(){return this.subtotal.toFixed(2)}get formattedTotal(){return this.total.toFixed(2)}ngOnInit(){this.invoiceId=this.route.snapshot.paramMap.get("id"),this.isEdit=!!this.invoiceId,this.invoiceForm=this.fb.group({patientId:["",[T.required]],items:this.fb.array([]),paymentStatus:["pending"],paymentMethod:[""],doctor:[null]}),this.loadPatients(),this.loadDrugs(),this.isEdit&&this.invoiceId&&this.loadInvoice()}getWizardTitle(){return""}loadPatients(){this.patientsService.getAll({page:1,pageSize:100}).subscribe({next:i=>{this.patients=i.data}})}loadDrugs(){this.drugsService.getPharmacyDrugs({page:1,pageSize:100}).subscribe({next:i=>{this.pharmacyDrugs=i.data,!this.isEdit&&this.itemsArray.length===0&&this.loadDrugsFromCart()}})}loadInvoice(){this.invoicesService.getById(this.invoiceId).subscribe({next:i=>{if(i){if(this.invoiceForm.patchValue({patientId:i.patientId,paymentStatus:i.paymentStatus,paymentMethod:i.paymentMethod||""}),i.patientId){let e=this.patients.find(t=>t.id===i.patientId);e&&(this.patientInput=e.fullName,this.selectedPatient=e)}i.items.forEach(e=>{this.addItemWithData(e)})}},error:()=>{this.errorMessage="Failed to load invoice"}})}onBarcodeScanned(i){this.addItemByBarcode(i)}addItemByBarcode(i){let e=i||this.barcodeInput.trim();e&&this.drugsService.getPharmacyDrugByBarcode(e).subscribe({next:t=>{t?(this.addItemWithDrug(t),this.barcodeInput=""):this.errorMessage="Drug not found for barcode: "+e},error:()=>{this.errorMessage="Failed to search drug"}})}onDrugInput(i){let e=i.target;if(this.drugInput=e.value,this.showDrugDropdown=!0,this.drugInput.trim()){let t=this.drugInput.toLowerCase();this.filteredDrugs=this.pharmacyDrugs.filter(r=>(r.generalDrug?.name||"Drug "+r.id).toLowerCase().includes(t))}else this.filteredDrugs=[...this.pharmacyDrugs]}selectDrug(i){this.drugInput=i.generalDrug?.name||"Drug "+i.id,this.selectedDrugId=i.id,this.showDrugDropdown=!1}addSelectedDrug(){if(!this.selectedDrugId)if(this.drugInput.trim()){let e=this.pharmacyDrugs.find(t=>(t.generalDrug?.name||"Drug "+t.id).toLowerCase()===this.drugInput.toLowerCase());if(e)this.selectedDrugId=e.id;else return}else return;let i=this.pharmacyDrugs.find(e=>e.id===this.selectedDrugId);i&&(this.addItemWithDrug(i),this.selectedDrugId="",this.drugInput="",this.showDrugSelector=!1)}addItemWithDrug(i){let e=this.itemsArray.controls.findIndex(r=>r.get("drugId")?.value===i.id);if(e>=0){let r=this.itemsArray.at(e),c=r.get("quantity")?.value||1;r.patchValue({quantity:c+1});return}let t=this.fb.group({drugId:[i.id,[T.required]],quantity:[1,[T.required,T.min(1)]],unitPrice:[i.priceAfterDiscount||i.price,[T.required]]});this.itemsArray.push(t)}loadDrugsFromCart(){if(this.isEdit)return;let i=this.invoiceCartService.getDrugs();i.length>0&&i.forEach(e=>{let t=this.pharmacyDrugs.find(r=>r.id===e.id)||e;this.addItemWithDrug(t)})}addItemWithData(i){let e=this.fb.group({drugId:[i.drugId,[T.required]],quantity:[i.quantity,[T.required,T.min(1)]],unitPrice:[i.unitPrice,[T.required]]});this.itemsArray.push(e)}removeItem(i){this.itemsArray.removeAt(i)}getDrugName(i){return this.pharmacyDrugs.find(t=>t.id===i)?.generalDrug?.name||"Unknown Drug"}onCreateInvoice(){if(this.invoiceForm.valid&&this.itemsArray.length>0){this.loading=!0,this.errorMessage="";let i=this.invoiceForm.value,e=i.items.map(c=>({drugId:c.drugId,quantity:c.quantity,unitPrice:c.unitPrice,totalPrice:c.quantity*c.unitPrice})),t={patientId:i.patientId,items:e,subtotal:this.subtotal,discount:0,total:this.total,paymentStatus:i.paymentStatus,paymentMethod:i.paymentMethod||void 0,pharmacyId:this.pharmacyContextService.getCurrentPharmacy()?.id||"ph1"};(this.isEdit?this.invoicesService.update(this.invoiceId,t):this.invoicesService.create(t)).subscribe({next:()=>{this.invoiceCartService.clear(),this.router.navigate(["/invoices"])},error:c=>{this.errorMessage=c.message||"An error occurred while saving",this.loading=!1}})}else Object.keys(this.invoiceForm.controls).forEach(i=>{this.invoiceForm.get(i)?.markAsTouched()})}onCreateVoucher(){if(this.invoiceForm.valid&&this.itemsArray.length>0){let i=this.invoiceForm.get("patientId")?.value;if(!i){this.errorMessage="Please select a patient first";return}if(this.selectedPatient=this.patients.find(z=>z.id===i)||null,!this.selectedPatient){this.errorMessage="Patient not found";return}let e=this.pharmacyContextService.getCurrentPharmacy();if(!e){this.errorMessage="Pharmacy not found";return}let t=Date.now().toString(36).toUpperCase(),r=`${i}-${e.name}-${t}`,c=new Date,w=new Date;w.setMonth(w.getMonth()+3),this.voucher={voucherName:r,voucherCode:t,createdAt:c,validUntil:w,amount:this.subtotal,patient:this.selectedPatient,pharmacy:e},this.groupProductsByOrigin(),this.currentStep=2}}groupProductsByOrigin(){let i=this.itemsArray.value,e={};i.forEach(t=>{let c=this.pharmacyDrugs.find(w=>w.id===t.drugId)?.origin||"unknown";e[c]||(e[c]={origin:c,products:[]}),e[c].products.push({drugId:t.drugId,drugName:this.getDrugName(t.drugId),price:t.unitPrice,quantity:t.quantity,applyDiscount:!1,discountPercentage:0})}),this.voucherProductGroups=Object.values(e),this.calculateVoucherDiscount()}getDiscountedPrice(i){return i.quantity*i.price}calculateVoucherDiscount(){let i=0,e=0,t=this.subtotal;this.voucherProductGroups.forEach(r=>{r.products.forEach(c=>{c.applyDiscount&&c.discountPercentage>0&&(i+=c.discountPercentage,e++)})}),e>0?this.averageDiscountPercentage=i/e:this.averageDiscountPercentage=0,this.voucherDiscountAmount=t*this.averageDiscountPercentage/100,this.voucher&&(this.voucher.amount=this.subtotal-this.voucherDiscountAmount)}onCreateVoucherInvoice(){this.loading=!0,this.errorMessage="";let i=this.invoiceForm.value,e=i.items.map(w=>({drugId:w.drugId,quantity:w.quantity,unitPrice:w.unitPrice,totalPrice:w.quantity*w.unitPrice})),t=this.voucherDiscountAmount,r=this.subtotal-t,c={patientId:i.patientId,items:e,subtotal:this.subtotal,discount:t,total:r,paymentStatus:i.paymentStatus,paymentMethod:i.paymentMethod||void 0,pharmacyId:this.pharmacyContextService.getCurrentPharmacy()?.id||"ph1",voucherCode:this.voucher?.voucherCode||"",voucherName:this.voucher?.voucherName||""};this.invoicesService.create(c).subscribe({next:()=>{this.loading=!1,this.currentStep=3},error:w=>{this.errorMessage=w.message||"An error occurred while saving",this.loading=!1}})}sendVoucherToPatient(){if(!this.voucher||!this.cardElementRef){this.errorMessage="Voucher or card not available";return}this.sendingVoucher=!0;let i=this.cardElementRef.nativeElement;(0,Le.default)(i,{backgroundColor:"#ffffff",scale:2,logging:!1,useCORS:!0,allowTaint:!1}).then(e=>{e.toBlob(t=>{if(this.sendingVoucher=!1,!t){this.errorMessage="Failed to generate card image";return}let r=new ClipboardItem({"image/png":t});navigator.clipboard.write([r]).then(()=>{let w=`https://wa.me/${this.voucher.patient.phone.replace(/[^0-9]/g,"")}`;window.open(w,"_blank"),setTimeout(()=>{this.router.navigate(["/invoices"])},2e3)}).catch(c=>{console.error("Failed to copy to clipboard:",c);let w=URL.createObjectURL(t),z=document.createElement("a");z.href=w,z.download=`voucher-${this.voucher.voucherCode}.png`,z.click(),URL.revokeObjectURL(w);let Oe=`https://wa.me/${this.voucher.patient.phone.replace(/[^0-9]/g,"")}`;window.open(Oe,"_blank")})},"image/png")}).catch(e=>{console.error("Failed to capture card:",e),this.errorMessage="Failed to capture card image",this.sendingVoucher=!1})}onCardReadyHandler(i){this.cardElementRef=i}onCardCopied(i){console.log("Card copied to clipboard")}goToStep(i){this.currentStep=i}onCancel(){this.router.navigate(["/invoices"])}onPatientInput(i){let e=i.target;if(this.patientInput=e.value,this.showPatientDropdown=!0,this.patientInput.trim()){let t=this.patientInput.toLowerCase();this.filteredPatients=this.patients.filter(r=>r.fullName.toLowerCase().includes(t))}else this.filteredPatients=[...this.patients]}selectPatient(i){this.patientInput=i.fullName,this.selectedPatient=i,this.invoiceForm.patchValue({patientId:i.id}),this.showPatientDropdown=!1}onDoctorInput(i){let e=i.target;if(this.doctorInput=e.value,this.showDoctorDropdown=!0,this.doctorInput.trim()){let t=this.doctorInput.toLowerCase();this.filteredDoctors=this.doctors.filter(r=>r.name.toLowerCase().includes(t))}else this.filteredDoctors=[...this.doctors]}selectDoctor(i){this.doctorInput=i.name,this.selectedDoctor={doctorName:i.name,doctorId:i.id,isNewDoctor:!1},this.showDoctorDropdown=!1,this.invoiceForm.patchValue({doctor:this.selectedDoctor})}addNewDoctor(){let i=this.doctorInput.trim();i&&(this.selectedDoctor={doctorName:i,isNewDoctor:!0},this.showDoctorDropdown=!1,this.invoiceForm.patchValue({doctor:this.selectedDoctor}))}onClickOutside(i){let e=i.target;e.closest(".doctor-dropdown-container")||(this.showDoctorDropdown=!1),e.closest(".patient-dropdown-container")||(this.showPatientDropdown=!1),e.closest(".drug-dropdown-container")||(this.showDrugDropdown=!1)}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=M({type:l,selectors:[["app-invoice-form"]],hostBindings:function(e,t){e&1&&f("click",function(c){return t.onClickOutside(c)},!1,ce)},decls:57,vars:96,consts:[[1,"min-h-screen"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"mb-8","animate-fade-in"],[1,"text-3xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"mb-6","animate-slide-down"],[1,"mb-12","animate-fade-in-up",2,"animation-delay","0.1s"],[1,"relative"],[1,"absolute","top-5","left-0","right-0","h-1","bg-gray-200","rounded-full"],[1,"absolute","top-5","left-0","h-1","rounded-full","transition-all","duration-700","ease-out"],[1,"relative","flex","justify-between"],[1,"flex","flex-col","items-center","group","cursor-pointer",3,"click"],[1,"w-12","h-12","rounded-full","flex","items-center","justify-center","transition-all","duration-300","shadow-lg","border-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-white"],[1,"text-lg","font-bold",3,"text-white","text-gray-500"],[1,"mt-3","text-center"],[1,"text-sm","font-semibold","transition-colors"],[1,"text-xs","text-gray-500","mt-1","max-w-[120px]"],[1,"flex","flex-col","items-center","group"],[1,"text-lg","font-bold"],[1,"rounded-2xl","shadow-xl","border","border-gray-100","overflow-hidden","animate-fade-in-up",2,"animation-delay","0.2s","background","var(--card-bg)"],[3,"invoiceForm","itemsArray","patients","pharmacyDrugs","doctors","filteredDoctors","filteredPatients","filteredDrugs","patientInput","doctorInput","drugInput","barcodeInput","showPatientDropdown","showDoctorDropdown","showDrugDropdown","showDrugSelector","loading","formattedSubtotal","formattedTotal","getDrugName"],[3,"voucher","voucherProductGroups","subtotal","averageDiscountPercentage","voucherDiscountAmount","loading","getDiscountedPrice"],[3,"voucher","averageDiscountPercentage","sendingVoucher"],["type","error",3,"title"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","3","d","M5 13l4 4L19 7"],[3,"onPatientInput","onPatientFocus","onPatientSelect","onDoctorInput","onDoctorFocus","onDoctorSelect","onAddNewDoctor","onDrugInput","onDrugFocus","onDrugSelect","onToggleDrugSelector","onAddSelectedDrug","onBarcodeEnter","onBarcodeScanned","onRemoveItem","onCreateVoucher","onCreateInvoice","onCancel","invoiceForm","itemsArray","patients","pharmacyDrugs","doctors","filteredDoctors","filteredPatients","filteredDrugs","patientInput","doctorInput","drugInput","barcodeInput","showPatientDropdown","showDoctorDropdown","showDrugDropdown","showDrugSelector","loading","formattedSubtotal","formattedTotal","getDrugName"],[3,"onCalculateDiscount","onBack","onCreateVoucherInvoice","voucher","voucherProductGroups","subtotal","averageDiscountPercentage","voucherDiscountAmount","loading","getDiscountedPrice"],[3,"onSendVoucher","onBack","onClose","onCardReady","onCardCopied","voucher","averageDiscountPercentage","sendingVoucher"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),s(4),d(5,"translate"),d(6,"translate"),d(7,"translate"),d(8,"translate"),a(),n(9,"p",4),s(10),d(11,"translate"),d(12,"translate"),d(13,"translate"),a()(),I(14,yt,2,1,"div",5),n(15,"div",6)(16,"div",7),g(17,"div",8)(18,"div",9),n(19,"div",10)(20,"div",11),f("click",function(){return t.currentStep>1&&t.goToStep(1)}),n(21,"div",12),I(22,St,2,0,":svg:svg",13)(23,wt,2,4,"span",14),a(),n(24,"div",15)(25,"p",16),s(26),d(27,"translate"),a(),n(28,"p",17),s(29),d(30,"translate"),a()()(),n(31,"div",11),f("click",function(){return t.currentStep>2&&t.goToStep(2)}),n(32,"div",12),I(33,Dt,2,0,":svg:svg",13)(34,It,2,4,"span",14),a(),n(35,"div",15)(36,"p",16),s(37),d(38,"translate"),a(),n(39,"p",17),s(40),d(41,"translate"),a()()(),n(42,"div",18)(43,"div",12)(44,"span",19),s(45,"3"),a()(),n(46,"div",15)(47,"p",16),s(48),d(49,"translate"),a(),n(50,"p",17),s(51),d(52,"translate"),a()()()()()(),n(53,"div",20),I(54,kt,1,20,"app-invoice-step",21)(55,Vt,1,7,"app-voucher-step",22)(56,Pt,1,3,"app-share-voucher-step",23),a()()()),e&2&&(_("background","var(--page-bg)"),o(4),h(" ",t.currentStep===1?t.isEdit?p(5,70,"form.editInvoice"):p(6,72,"invoice.wizard.step1Title"):t.currentStep===2?p(7,74,"invoice.wizard.step2Title"):p(8,76,"invoice.wizard.step3Title")," "),o(6),h(" ",t.currentStep===1?p(11,78,"invoice.wizard.step1Description"):t.currentStep===2?p(12,80,"invoice.wizard.step2Description"):p(13,82,"invoice.wizard.step3Description")," "),o(4),y(t.errorMessage?14:-1),o(4),_("width",t.currentStep===1?"0%":t.currentStep===2?"50%":"100%")("background","var(--sidebar-bg)"),o(3),_("background",t.currentStep>=1?"var(--sidebar-bg)":"white")("border-color",t.currentStep>=1?"var(--sidebar-bg)":"#d1d5db"),E("bg-white",t.currentStep<1)("border-gray-300",t.currentStep<1)("scale-110",t.currentStep===1),o(),y(t.currentStep>1?22:23),o(3),_("color",t.currentStep===1?"var(--sidebar-active-text)":""),E("text-gray-900",t.currentStep>1)("text-gray-500",t.currentStep<1),o(),h(" ",p(27,84,"invoice.wizard.step1")," "),o(3),b(p(30,86,"invoice.wizard.step1Subtitle")),o(3),_("background",t.currentStep>=2?"var(--sidebar-bg)":"white")("border-color",t.currentStep>=2?"var(--sidebar-bg)":"#d1d5db"),E("bg-white",t.currentStep<2)("border-gray-300",t.currentStep<2)("scale-110",t.currentStep===2),o(),y(t.currentStep>2?33:34),o(3),_("color",t.currentStep===2?"var(--sidebar-active-text)":""),E("text-gray-900",t.currentStep>2)("text-gray-500",t.currentStep<2),o(),h(" ",p(38,88,"invoice.wizard.step2")," "),o(3),b(p(41,90,"invoice.wizard.step2Subtitle")),o(3),_("background",t.currentStep>=3?"var(--sidebar-bg)":"white")("border-color",t.currentStep>=3?"var(--sidebar-bg)":"#d1d5db"),E("bg-white",t.currentStep<3)("border-gray-300",t.currentStep<3)("scale-110",t.currentStep===3),o(),E("text-white",t.currentStep>=3)("text-gray-500",t.currentStep<3),o(3),_("color",t.currentStep===3?"var(--sidebar-active-text)":""),E("text-gray-500",t.currentStep<3),o(),h(" ",p(49,92,"invoice.wizard.step3")," "),o(3),b(p(52,94,"invoice.wizard.step3Subtitle")),o(3),y(t.currentStep===1?54:-1),o(),y(t.currentStep===2?55:-1),o(),y(t.currentStep===3?56:-1))},dependencies:[L,Y,j,ke,O,ee,te,ie],styles:["@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_fade-in-up{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slide-down{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slide-in-left{0%{opacity:0;transform:translate(-20px)}to{opacity:1;transform:translate(0)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .5s ease-out}.animate-fade-in-up[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in-up .6s ease-out}.animate-slide-down[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-down .3s ease-out}.animate-slide-in-left[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-in-left .4s ease-out}[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--scrollbar-bg);border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb);border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{opacity:.8}"]})};export{Ge as InvoiceFormComponent};
