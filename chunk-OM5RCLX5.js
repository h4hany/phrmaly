import{a as j}from"./chunk-XFUAL6PF.js";import{a as P}from"./chunk-THCZEFPZ.js";import"./chunk-P5TE6FOK.js";import{a as M}from"./chunk-N3GUYB4W.js";import"./chunk-YJWIIGXE.js";import{a as B}from"./chunk-YUKQXM5O.js";import{a as x}from"./chunk-M3W4QUEG.js";import"./chunk-BYXBJQAS.js";import"./chunk-QHH3SHC3.js";import{a as D,b as O}from"./chunk-7DC7YEPQ.js";import{$a as d,$b as E,A as l,Bb as g,Cb as h,Fb as A,Ga as C,La as I,M as b,Ra as m,S as s,Y as v,Z as S,ab as u,db as _,eb as w,j as o,nb as k,pb as T,xa as c}from"./chunk-OKFD3A6M.js";import{a as y,b as F}from"./chunk-KAT7YFEL.js";var f=class r{pharmacyContextService=s(B);authService=s(x);flags=[{id:"FF001",pharmacyId:void 0,key:"automation_engine",name:"Automation Engine",description:"Enable automation rules engine",enabled:!0,createdAt:new Date,updatedAt:new Date,createdBy:"system"},{id:"FF002",pharmacyId:"ph1",key:"advanced_analytics",name:"Advanced Analytics",description:"Enable advanced analytics dashboard",enabled:!1,createdAt:new Date,updatedAt:new Date,createdBy:"admin"}];isEnabled(a){let e=this.pharmacyContextService.getCurrentPharmacy()?.id,t=this.authService.getCurrentUser();if(e){let n=this.flags.find(p=>p.key===a&&p.pharmacyId===e);if(n)return o(n.enabled).pipe(l(100))}let i=this.flags.find(n=>n.key===a&&n.pharmacyId===null);if(i){if(i.targetRoles&&t?.role){let n=i.targetRoles.includes(t.role);return o(n&&i.enabled).pipe(l(100))}return o(i.enabled).pipe(l(100))}return o(!1).pipe(l(100))}getFlags(){let a=this.pharmacyContextService.getCurrentPharmacy()?.id,e=this.flags.filter(t=>!t.pharmacyId||t.pharmacyId===a);return o(e).pipe(l(300))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=b({token:r,factory:r.\u0275fac,providedIn:"root"})};function N(r,a){if(r&1&&(d(0,"app-badge",4),k(1),g(2,"translate"),g(3,"translate"),u()),r&2){let e=a.$implicit;m("variant",e.enabled?"success":"default"),c(),T(" ",e.enabled?h(2,2,"featureFlags.enabled"):h(3,4,"featureFlags.disabled")," ")}}var R=class r{featureFlagService=s(f);translationService=s(D);flags=[];loading=!1;columns=[{key:"key",label:"featureFlags.key"},{key:"name",label:"featureFlags.name"},{key:"description",label:"featureFlags.description"},{key:"scope",label:"featureFlags.scope"}];ngOnInit(){this.loadFlags()}loadFlags(){this.loading=!0,this.featureFlagService.getFlags().subscribe({next:a=>{this.flags=a.map(e=>F(y({},e),{scope:e.pharmacyId?this.translationService.translate("featureFlags.pharmacy"):this.translationService.translate("featureFlags.global")})),this.loading=!1},error:()=>{this.loading=!1}})}handleSearch(a){this.loadFlags()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=C({type:r,selectors:[["app-feature-flags"]],decls:5,vars:5,consts:[["actionTemplate",""],[1,"space-y-6"],["title","featureFlags.title",3,"onSearch","showSearch"],[3,"columns","data","loading","emptyMessage"],[3,"variant"]],template:function(e,t){if(e&1){let i=_();d(0,"div",1)(1,"app-action-toolbar",2),w("onSearch",function(p){return v(i),S(t.handleSearch(p))}),u(),d(2,"app-table",3),I(3,N,4,6,"ng-template",null,0,A),u()()}e&2&&(c(),m("showSearch",!0),c(),m("columns",t.columns)("data",t.flags)("loading",t.loading)("emptyMessage","featureFlags.empty"))},dependencies:[E,P,j,M,O],encapsulation:2})};export{R as FeatureFlagsComponent};
