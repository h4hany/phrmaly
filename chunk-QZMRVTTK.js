import{a as ie}from"./chunk-QDLVDHOW.js";import{a as ne}from"./chunk-JYPY3KCN.js";import{a as ee}from"./chunk-XG6FMBJJ.js";import{c as z,d as F,e as H,f as q,h as $,i as K,k as U,n as J,r as W,s as X,v as Y,x as Z}from"./chunk-TK76J465.js";import{a as te}from"./chunk-6CFKC637.js";import"./chunk-5PFWNSG3.js";import{b as j}from"./chunk-3UJCRMW3.js";import{$a as d,Ab as l,Bb as s,Eb as Q,Fa as O,K as N,Ka as x,Q as D,Qa as h,Sa as L,Va as R,W as M,X as f,Y as C,Z as k,_a as o,_b as G,ab as g,cb as E,db as P,eb as I,i as u,ib as T,jb as A,kb as B,mb as p,nb as b,ob as S,wa as a,y}from"./chunk-E4S7NVXB.js";import{a as v,b as w}from"./chunk-C6Q5SG76.js";var V=class r{paymentMethods=[{id:"PM001",name:"Cash",deductionRate:0,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")},{id:"PM002",name:"Credit Card",deductionRate:2.5,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")},{id:"PM003",name:"Bank Transfer",deductionRate:1,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")}];getAll(e){let i=e?.page||1,t=e?.pageSize||10,n=(i-1)*t,m=n+t,c=[...this.paymentMethods],_=c.slice(n,m);return u({data:_,total:c.length,page:i,pageSize:t,totalPages:Math.ceil(c.length/t)}).pipe(y(500))}getById(e){let i=this.paymentMethods.find(t=>t.id===e);return u(i||null).pipe(y(300))}create(e){let i=w(v({},e),{id:`PM${String(this.paymentMethods.length+1).padStart(3,"0")}`,createdAt:new Date,updatedAt:new Date});return this.paymentMethods.push(i),u(i).pipe(y(500))}update(e,i){let t=this.paymentMethods.findIndex(n=>n.id===e);if(t===-1)throw new Error("Payment method not found");return this.paymentMethods[t]=w(v(v({},this.paymentMethods[t]),i),{id:e,updatedAt:new Date}),u(this.paymentMethods[t]).pipe(y(500))}delete(e){let i=this.paymentMethods.findIndex(t=>t.id===e);return i===-1?u(!1).pipe(y(300)):(this.paymentMethods.splice(i,1),u(!0).pipe(y(500)))}search(e){let i=e.toLowerCase();return u(this.paymentMethods.filter(t=>t.name.toLowerCase().includes(i))).pipe(y(300))}static \u0275fac=function(i){return new(i||r)};static \u0275prov=N({token:r,factory:r.\u0275fac,providedIn:"root"})};var re=["paymentMethodModal"],de=["deleteModal"];function le(r,e){if(r&1&&g(0,"app-alert",4),r&2){let i=I();h("title",i.errorMessage)}}function se(r,e){if(r&1){let i=E();o(0,"div",26)(1,"button",27),l(2,"translate"),P("click",function(){let n=M(i).$implicit,m=I();return f(m.editPaymentMethod(n))}),C(),o(3,"svg",28),g(4,"path",29),d()(),k(),o(5,"button",30),l(6,"translate"),P("click",function(){let n=M(i).$implicit,m=I();return f(m.confirmDelete(n))}),C(),o(7,"svg",28),g(8,"path",31),d()()()}r&2&&(a(),h("title",s(2,2,"common.edit")),a(4),h("title",s(6,4,"common.delete")))}function me(r,e){r&1&&(o(0,"p",22),p(1),l(2,"translate"),d()),r&2&&(a(),b(s(2,1,"form.paymentMethod.nameRequired")))}function pe(r,e){r&1&&(o(0,"p",22),p(1),l(2,"translate"),d()),r&2&&(a(),b(s(2,1,"form.paymentMethod.deductionRateRequired")))}var ae=class r{paymentMethodsService=D(V);fb=D(Y);paymentMethods=[];searchQuery="";errorMessage="";loading=!1;saving=!1;deleting=!1;isEdit=!1;selectedPaymentMethodId=null;selectedPaymentMethodName="";paymentMethodForm;paymentMethodModal;deleteModal;columns=[{key:"id",label:"table.id",sortable:!0},{key:"name",label:"table.name",sortable:!0},{key:"deductionRateDisplay",label:"table.deductionRate",sortable:!0},{key:"createdAtDisplay",label:"table.createdAt",sortable:!0},{key:"actions",label:"table.action"}];pagination={page:1,pageSize:10,total:0,totalPages:0};ngOnInit(){this.initForm(),this.loadPaymentMethods()}initForm(){this.paymentMethodForm=this.fb.group({name:["",[F.required]],deductionRate:[0,[F.required,F.min(0),F.max(100)]]})}loadPaymentMethods(){this.loading=!0,this.errorMessage="",this.paymentMethodsService.getAll({page:this.pagination.page,pageSize:this.pagination.pageSize}).subscribe({next:e=>{this.paymentMethods=e.data.map(i=>w(v({},i),{deductionRateDisplay:`${i.deductionRate}%`,createdAtDisplay:new Date(i.createdAt).toLocaleDateString()})),this.pagination={page:e.page,pageSize:e.pageSize,total:e.total,totalPages:e.totalPages},this.loading=!1},error:e=>{this.errorMessage=e.message||"Failed to load payment methods",this.loading=!1}})}onSearch(){this.searchQuery.trim()?this.paymentMethodsService.search(this.searchQuery).subscribe({next:e=>{this.paymentMethods=e.map(i=>w(v({},i),{deductionRateDisplay:`${i.deductionRate}%`,createdAtDisplay:new Date(i.createdAt).toLocaleDateString()}))},error:e=>{this.errorMessage=e.message||"Search failed"}}):this.loadPaymentMethods()}openCreateModal(){this.isEdit=!1,this.selectedPaymentMethodId=null,this.paymentMethodForm.reset({name:"",deductionRate:0}),this.paymentMethodModal.open()}editPaymentMethod(e){this.isEdit=!0,this.selectedPaymentMethodId=e.id,this.paymentMethodForm.patchValue({name:e.name,deductionRate:e.deductionRate}),this.paymentMethodModal.open()}closeModal(){this.paymentMethodForm.reset({name:"",deductionRate:0}),this.isEdit=!1,this.selectedPaymentMethodId=null}onSubmit(){if(this.paymentMethodForm.valid){this.saving=!0,this.errorMessage="";let e=this.paymentMethodForm.value,i={name:e.name,deductionRate:e.deductionRate};(this.isEdit&&this.selectedPaymentMethodId?this.paymentMethodsService.update(this.selectedPaymentMethodId,i):this.paymentMethodsService.create(i)).subscribe({next:()=>{this.saving=!1,this.paymentMethodModal.close(),this.loadPaymentMethods()},error:n=>{this.errorMessage=n.message||"An error occurred while saving the payment method",this.saving=!1}})}else Object.keys(this.paymentMethodForm.controls).forEach(e=>{this.paymentMethodForm.get(e)?.markAsTouched()})}confirmDelete(e){this.selectedPaymentMethodId=e.id,this.selectedPaymentMethodName=e.name,this.deleteModal.open()}deletePaymentMethod(){this.selectedPaymentMethodId&&(this.deleting=!0,this.paymentMethodsService.delete(this.selectedPaymentMethodId).subscribe({next:e=>{e?(this.deleteModal.close(),this.loadPaymentMethods()):this.errorMessage="Failed to delete payment method",this.deleting=!1},error:e=>{this.errorMessage=e.message||"Failed to delete payment method",this.deleting=!1}}))}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=O({type:r,selectors:[["app-payment-methods-list"]],viewQuery:function(i,t){if(i&1&&(T(re,5),T(de,5)),i&2){let n;A(n=B())&&(t.paymentMethodModal=n.first),A(n=B())&&(t.deleteModal=n.first)}},decls:56,vars:55,consts:[["actionTemplate",""],["paymentMethodModal",""],["deleteModal",""],[1,"space-y-6"],["type","error",3,"title"],[1,"flex","items-center","justify-between","gap-4"],[1,"flex-1","max-w-lg"],[1,"relative"],["type","text",1,"w-full","px-4","py-2","pl-10","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-[#166534]","focus:border-[#166534]",3,"input","placeholder","value"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","absolute","left-3","top-2.5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"flex","gap-3"],["variant","outline"],["variant","primary",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["rowIdKey","id",3,"columns","data","pagination","emptyMessage","loading"],[3,"confirmed","closed","title","showFooter","confirmText","confirmLoading"],[1,"space-y-4",3,"formGroup"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["type","text","formControlName","name",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-[#166534]"],[1,"mt-1","text-sm","text-red-600"],["type","number","formControlName","deductionRate","step","0.01","min","0","max","100",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-[#166534]"],[1,"mt-1","text-xs","text-gray-500"],[3,"confirmed","title","showFooter","confirmText","confirmLoading"],[1,"flex","items-center","gap-2"],[1,"p-1","text-gray-600","hover:text-gray-900",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"p-1","text-gray-600","hover:text-red-600",3,"click","title"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"]],template:function(i,t){if(i&1){let n=E();o(0,"div",3),x(1,le,1,1,"app-alert",4),o(2,"div",5)(3,"div",6)(4,"div",7)(5,"input",8),l(6,"translate"),P("input",function(c){return M(n),t.searchQuery=c.target.value,f(t.onSearch())}),d(),C(),o(7,"svg",9),g(8,"path",10),d()()(),k(),o(9,"div",11)(10,"app-button",12),p(11),l(12,"translate"),d(),o(13,"app-button",13),P("onClick",function(){return M(n),f(t.openCreateModal())}),C(),o(14,"svg",14),g(15,"path",15),d(),p(16),l(17,"translate"),d()()(),k(),o(18,"app-table",16),x(19,se,9,6,"ng-template",null,0,Q),d(),o(21,"app-modal",17,1),l(23,"translate"),l(24,"translate"),P("confirmed",function(){return M(n),f(t.onSubmit())})("closed",function(){return M(n),f(t.closeModal())}),o(25,"form",18)(26,"div")(27,"label",19),p(28),l(29,"translate"),o(30,"span",20),p(31,"*"),d()(),g(32,"input",21),x(33,me,3,3,"p",22),d(),o(34,"div")(35,"label",19),p(36),l(37,"translate"),o(38,"span",20),p(39,"*"),d()(),g(40,"input",23),x(41,pe,3,3,"p",22),o(42,"p",24),p(43),l(44,"translate"),d()()()(),o(45,"app-modal",25,2),l(47,"translate"),l(48,"translate"),P("confirmed",function(){return M(n),f(t.deletePaymentMethod())}),o(49,"p"),p(50),l(51,"translate"),o(52,"strong"),p(53),d(),p(54),l(55,"translate"),d()()()}if(i&2){let n,m,c,_;a(),R(t.errorMessage?1:-1),a(4),h("placeholder",s(6,31,"common.search"))("value",t.searchQuery),a(6),b(s(12,33,"common.export")),a(5),S(" ",s(17,35,"button.createPaymentMethod")," "),a(2),h("columns",t.columns)("data",t.paymentMethods)("pagination",t.pagination)("emptyMessage","empty.noPaymentMethods")("loading",t.loading),a(3),h("title",s(23,37,t.isEdit?"form.editPaymentMethod":"form.addPaymentMethod"))("showFooter",!0)("confirmText",s(24,39,t.isEdit?"common.update":"common.create"))("confirmLoading",t.saving),a(4),h("formGroup",t.paymentMethodForm),a(3),S(" ",s(29,41,"form.paymentMethod.name")," "),a(4),L("border-red-500",((n=t.paymentMethodForm.get("name"))==null?null:n.invalid)&&((n=t.paymentMethodForm.get("name"))==null?null:n.touched)),a(),R((m=t.paymentMethodForm.get("name"))!=null&&m.invalid&&((m=t.paymentMethodForm.get("name"))!=null&&m.touched)?33:-1),a(3),S(" ",s(37,43,"form.paymentMethod.deductionRate")," "),a(4),L("border-red-500",((c=t.paymentMethodForm.get("deductionRate"))==null?null:c.invalid)&&((c=t.paymentMethodForm.get("deductionRate"))==null?null:c.touched)),a(),R((_=t.paymentMethodForm.get("deductionRate"))!=null&&_.invalid&&((_=t.paymentMethodForm.get("deductionRate"))!=null&&_.touched)?41:-1),a(2),b(s(44,45,"form.paymentMethod.deductionRateHint")),a(2),h("title",s(47,47,"button.deletePaymentMethod"))("showFooter",!0)("confirmText",s(48,49,"common.delete"))("confirmLoading",t.deleting),a(5),S("",s(51,51,"modal.deletePaymentMethodConfirm")," "),a(3),b(t.selectedPaymentMethodName),a(),b(s(55,53,"modal.cannotUndo"))}},dependencies:[G,te,ie,ne,ee,j,Z,$,z,K,H,q,X,W,U,J],encapsulation:2})};export{ae as PaymentMethodsListComponent};
