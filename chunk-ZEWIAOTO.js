import{a as Z}from"./chunk-GDW5FJH2.js";import{a as X}from"./chunk-EKSGP2SL.js";import{a as Y}from"./chunk-QSZBM4NB.js";import{a as Q,b as U}from"./chunk-4PK2EB7K.js";import{a as J}from"./chunk-CPH2TRFL.js";import{a as K}from"./chunk-PUVF5ECJ.js";import"./chunk-Y5QUESDN.js";import{d as m,e as G,f as O,h as T,k as P,l as j,m as R,n as H,t as $,v as z,w as L,x as W}from"./chunk-VW37JDOU.js";import{b as q,d as N}from"./chunk-QHH3SHC3.js";import"./chunk-KPWAPXFF.js";import"./chunk-ACQN7LQS.js";import{b as V}from"./chunk-7DC7YEPQ.js";import{$ as _,$a as i,$b as D,Bb as g,Cb as v,Ga as C,La as I,Ra as a,S as u,Sa as S,Wa as B,Xa as k,Y as x,Z as F,Za as E,_ as c,_a as M,ab as o,bb as d,db as A,eb as b,fb as y,nb as f,ob as w,pb as h,xa as n}from"./chunk-OKFD3A6M.js";import"./chunk-KAT7YFEL.js";function te(s,e){if(s&1){let r=A();i(0,"div",14)(1,"div",6),d(2,"app-autocomplete-input",19),o(),i(3,"div"),d(4,"app-text-input",20),o(),i(5,"div",21)(6,"button",22),b("click",function(){let l=x(r).$index,p=y();return F(p.removeItem(l))}),c(),i(7,"svg",23),d(8,"path",24),o()()()()}if(s&2){let r=e.$index,t=y();a("formGroupName",r),n(2),a("label","form.bundle.drug")("options",t.drugOptions)("placeholder","form.selectDrug"),n(2),a("label","form.bundle.quantity")("min",1)}}function re(s,e){s&1&&(c(),i(0,"svg",18),d(1,"circle",25)(2,"path",26),o())}function ie(s,e){s&1&&(c(),i(0,"svg",11),d(1,"path",27),o())}var ee=class s{fb=u(z);router=u(N);route=u(q);bundlesService=u(Z);drugsService=u(Y);bundleForm;loading=!1;errorMessage="";isEdit=!1;bundleId=null;pharmacyDrugs=[];statusOptions=[{value:"active",label:"common.active"},{value:"inactive",label:"common.inactive"}];drugOptions=[];get itemsArray(){return this.bundleForm.get("items")}ngOnInit(){this.bundleId=this.route.snapshot.paramMap.get("id"),this.isEdit=!!this.bundleId,this.bundleForm=this.fb.group({name:["",[m.required]],fixedPrice:[0,[m.required,m.min(0)]],status:["active"],items:this.fb.array([])}),this.loadDrugs(),this.isEdit&&this.bundleId&&this.loadBundle()}loadDrugs(){this.drugsService.getPharmacyDrugs({page:1,pageSize:100}).subscribe({next:e=>{this.pharmacyDrugs=e.data,this.drugOptions=this.pharmacyDrugs.map(r=>({value:r.id,label:r.generalDrug?.name||"Drug "+r.id}))}})}loadBundle(){this.bundlesService.getById(this.bundleId).subscribe({next:e=>{e&&(this.bundleForm.patchValue({name:e.name,fixedPrice:e.fixedPrice,status:e.status}),e.items.forEach(r=>{this.addItemWithData(r)}))},error:()=>{this.errorMessage="error.loadBundle"}})}addItem(){let e=this.fb.group({drugId:["",[m.required]],quantity:[1,[m.required,m.min(1)]]});this.itemsArray.push(e)}addItemWithData(e){let r=this.fb.group({drugId:[e.drugId,[m.required]],quantity:[e.quantity,[m.required,m.min(1)]]});this.itemsArray.push(r)}removeItem(e){this.itemsArray.removeAt(e)}onSubmit(){if(this.bundleForm.valid&&this.itemsArray.length>0){this.loading=!0,this.errorMessage="";let e=this.bundleForm.value,r={name:e.name,fixedPrice:e.fixedPrice,status:e.status,items:e.items,pharmacyId:"ph1"};(this.isEdit?this.bundlesService.update(this.bundleId,r):this.bundlesService.create(r)).subscribe({next:()=>{this.router.navigate(["/bundles"])},error:l=>{this.errorMessage=l.message||"error.saveBundle",this.loading=!1}})}else Object.keys(this.bundleForm.controls).forEach(e=>{this.bundleForm.get(e)?.markAsTouched()})}onCancel(){this.router.navigate(["/bundles"])}static \u0275fac=function(r){return new(r||s)};static \u0275cmp=C({type:s,selectors:[["app-bundle-form"]],decls:32,vars:34,consts:[[3,"title","description","errorMessage"],[1,"p-8",3,"ngSubmit","formGroup"],[3,"title"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["type","text","formControlName","name","prefixIcon","tag",3,"label","required","hasError","errorMessage"],["type","number","formControlName","fixedPrice","prefixIcon","currency-dollar",3,"label","step","min","required"],[1,"md:col-span-2"],["formControlName","status",3,"label","radioOptions"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-lg","font-semibold","text-gray-700"],["type","button",1,"px-4","py-2","border-2","border-gray-300","text-gray-700","rounded-lg","font-medium","hover:bg-gray-50","hover:border-gray-400","transition-all","duration-200","flex","items-center","gap-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["formArrayName","items",1,"space-y-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","p-4","bg-gray-50","rounded-xl","border","border-gray-200",3,"formGroupName"],[1,"flex","items-center","justify-end","gap-4","pt-8","border-t-2","border-gray-100"],["type","button",1,"px-6","py-3","border-2","border-gray-300","text-gray-700","rounded-xl","font-semibold","hover:bg-gray-50","hover:border-gray-400","transition-all","duration-200",3,"click"],["type","submit",1,"px-6","py-3","rounded-xl","font-semibold","hover:shadow-xl","hover:scale-105","active:scale-95","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","disabled:hover:shadow-none","transition-all","duration-200","flex","items-center","gap-2",3,"disabled"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],["formControlName","drugId","prefixIcon","medicine",3,"label","options","placeholder"],["type","number","formControlName","quantity","prefixIcon","package",3,"label","min"],[1,"flex","items-end"],["type","button",1,"w-full","px-4","py-2","text-red-600","hover:bg-red-50","rounded-lg","transition-all","duration-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mx-auto"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"]],template:function(r,t){if(r&1&&(i(0,"app-modern-form-wrapper",0)(1,"form",1),b("ngSubmit",function(){return t.onSubmit()}),i(2,"app-form-section",2)(3,"div",3)(4,"div"),d(5,"app-text-input",4),o(),i(6,"div"),d(7,"app-text-input",5),o(),i(8,"div",6),d(9,"app-radio-input",7),o()()(),i(10,"app-form-section",2)(11,"div",8)(12,"h4",9),f(13),g(14,"translate"),o(),i(15,"button",10),b("click",function(){return t.addItem()}),c(),i(16,"svg",11),d(17,"path",12),o(),f(18),g(19,"translate"),o()(),_(),i(20,"div",13),E(21,te,9,6,"div",14,k),o()(),i(23,"div",15)(24,"button",16),b("click",function(){return t.onCancel()}),f(25),g(26,"translate"),o(),i(27,"button",17),I(28,re,3,0,":svg:svg",18)(29,ie,2,0,":svg:svg",11),f(30),g(31,"translate"),o()()()()),r&2){let l,p;a("title",t.isEdit?"form.editBundle":"form.addBundle")("description",t.isEdit?"form.editBundleDescription":"form.addBundleDescription")("errorMessage",t.errorMessage),n(),a("formGroup",t.bundleForm),n(),a("title","bundle.basicInfo"),n(3),a("label","form.bundle.name")("required",!0)("hasError",!!((l=t.bundleForm.get("name"))!=null&&l.invalid&&((l=t.bundleForm.get("name"))!=null&&l.touched)))("errorMessage",(p=t.bundleForm.get("name"))!=null&&p.invalid&&((p=t.bundleForm.get("name"))!=null&&p.touched)?"validation.nameRequired":void 0),n(2),a("label","form.bundle.fixedPrice")("step",.01)("min",0)("required",!0),n(2),a("label","bundle.status")("radioOptions",t.statusOptions),n(),a("title","bundle.items"),n(3),w(v(14,26,"form.bundle.addItems")),n(5),h(" ",v(19,28,"form.bundle.addItem")," "),n(3),M(t.itemsArray.controls),n(4),h(" ",v(26,30,"common.cancel")," "),n(2),S("background","var(--primary-bg)")("color","var(--primary-text)"),a("disabled",t.bundleForm.invalid||t.itemsArray.length===0||t.loading),n(),B(t.loading?28:29),n(2),h(" ",v(31,32,t.isEdit?"form.updateBundle":"form.createBundle")," ")}},dependencies:[D,W,T,G,O,$,P,H,j,R,L,Q,U,K,X,J,V],encapsulation:2})};export{ee as BundleFormComponent};
