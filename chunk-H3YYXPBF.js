import{a as q}from"./chunk-OENR7YPY.js";import{a as N}from"./chunk-VIUQYQMJ.js";import{a as J,b as Q}from"./chunk-DDVIQT7K.js";import"./chunk-RFLCZAFW.js";import"./chunk-V3KZ3RJV.js";import"./chunk-YUKQXM5O.js";import{a as j}from"./chunk-M3W4QUEG.js";import"./chunk-BYXBJQAS.js";import{c as V,d as _,e as $,f as z}from"./chunk-QHH3SHC3.js";import{a as X}from"./chunk-ACQN7LQS.js";import{a as U,b as H}from"./chunk-7DC7YEPQ.js";import{$a as r,$b as x,Bb as s,Cb as p,Ga as f,Ib as A,La as g,Nb as R,Qa as b,Ra as c,S as u,Sa as y,Ta as L,Wa as h,Y as O,Z as P,Za as k,_a as w,a as M,ab as o,bb as l,db as F,eb as I,fb as d,la as C,nb as m,ob as v,pb as G,xa as a,zb as T}from"./chunk-OKFD3A6M.js";import{a as B,b as E}from"./chunk-KAT7YFEL.js";var W=[{key:"overview",label:"nav.overview",icon:"layout-grid",items:[{path:"/dashboard",label:"nav.dashboard",icon:"layout-grid",exact:!0}],collapsedByDefault:!1,order:1},{key:"operations",label:"nav.operations",icon:"briefcase",items:[{path:"/invoices",label:"nav.sales",icon:"receipt"},{path:"/patients",label:"nav.customers",icon:"user-heart"},{path:"/vouchers",label:"nav.vouchers",icon:"ticket"}],collapsedByDefault:!0,order:2},{key:"people",label:"nav.people",icon:"users",items:[{path:"/pharmacy-staff",label:"nav.staffProfiles",icon:"id-badge"},{path:"/people/attendance",label:"nav.attendance",icon:"clock"},{path:"/people/payroll",label:"nav.payroll",icon:"credit-card"},{path:"/people/performance",label:"nav.performance",icon:"chart"},{path:"/people/training",label:"nav.training",icon:"graduation-cap"}],collapsedByDefault:!0,order:3},{key:"inventory",label:"nav.inventory",icon:"package",items:[{path:"/drugs",label:"nav.products",icon:"pill-bottle"},{path:"/bundles",label:"nav.bundles",icon:"package"},{path:"/inventory/alerts",label:"nav.inventoryAlerts",icon:"bell-warning"},{path:"/inventory/requested-products",label:"nav.requestedProducts",icon:"file-question"},{path:"/inventory/transfers",label:"nav.transfers",icon:"arrows-left-right"},{path:"/inventory/map",label:"nav.pharmacyMap",icon:"map-grid"}],collapsedByDefault:!0,order:4},{key:"procurement",label:"nav.procurement",icon:"factory",items:[{path:"/suppliers",label:"nav.suppliers",icon:"factory"},{path:"/purchases",label:"nav.orders",icon:"clipboard-list"}],collapsedByDefault:!0,order:5},{key:"finance",label:"nav.finance",icon:"credit-card",items:[{path:"/payments",label:"nav.payments",icon:"credit-card"},{path:"/audit-logs",label:"nav.auditLogs",icon:"shield-check"},{path:"/inventory/movements",label:"nav.drugMovements",icon:"activity-pulse"}],collapsedByDefault:!0,order:6},{key:"growth",label:"nav.growth",icon:"trending-up",items:[{path:"/growth/referrals",label:"nav.referrals",icon:"handshake"}],collapsedByDefault:!0,order:7},{key:"system",label:"nav.system",icon:"settings",items:[{path:"/system/automation",label:"nav.automation",icon:"magic-wand"},{path:"/system/migration",label:"nav.dataImport",icon:"database-arrow-down"},{path:"/system/permissions",label:"nav.accessControl",icon:"lock-key"},{path:"/system/features",label:"nav.featureFlags",icon:"toggle-sliders"},{path:"/payments/methods",label:"nav.paymentMethods",icon:"credit-card"},{path:"/settings",label:"nav.settings",icon:"gear"}],collapsedByDefault:!0,order:8},{key:"support",label:"nav.support",icon:"help-circle",items:[{path:"/reports",label:"nav.helpSupport",icon:"help-circle"}],collapsedByDefault:!1,order:9}];var Y=i=>({exact:i}),ie=(i,t)=>t.key,ne=(i,t)=>t.path;function ae(i,t){if(i&1&&(r(0,"li")(1,"a",21),s(2,"translate"),l(3,"app-icon",22),r(4,"span"),m(5),s(6,"translate"),o()()()),i&2){let e,n=d(2).$implicit;a(),c("routerLink",n.items[0].path)("routerLinkActive","nav-item-active")("routerLinkActiveOptions",T(11,Y,(e=n.items[0].exact)!==null&&e!==void 0?e:!1)),b("aria-label",p(2,7,n.items[0].label)),a(2),c("name",n.items[0].icon)("color","currentColor"),a(2),v(p(6,9,n.items[0].label))}}function re(i,t){if(i&1&&(r(0,"li")(1,"a",21),s(2,"translate"),l(3,"app-icon",22),r(4,"span"),m(5),s(6,"translate"),o()()()),i&2){let e,n=t.$implicit;a(),c("routerLink",n.path)("routerLinkActive","nav-item-active")("routerLinkActiveOptions",T(11,Y,(e=n.exact)!==null&&e!==void 0?e:!1)),b("aria-label",p(2,7,n.label)),a(2),c("name",n.icon)("color","currentColor"),a(2),v(p(6,9,n.label))}}function oe(i,t){if(i&1&&(r(0,"ul",25),k(1,re,7,13,"li",null,ne),o()),i&2){let e=d(3).$implicit,n=d();a(),w(n.getVisibleItems(e))}}function le(i,t){if(i&1){let e=F();r(0,"li")(1,"button",23),s(2,"translate"),I("click",function(){O(e);let D=d(2).$implicit,K=d();return P(K.toggleGroup(D.key))}),r(3,"div",2),l(4,"app-icon",22),r(5,"span"),m(6),s(7,"translate"),o()(),l(8,"app-icon",24),o(),g(9,oe,3,0,"ul",25),o()}if(i&2){let e=d(2).$implicit,n=d();a(),b("aria-expanded",!n.isGroupCollapsed(e.key))("aria-label",p(2,9,e.label)),a(3),c("name",e.icon)("color","currentColor"),a(2),v(p(7,11,e.label)),a(2),L("rotate-180",!n.isGroupCollapsed(e.key)),c("color","currentColor"),a(),h(n.isGroupCollapsed(e.key)?-1:9)}}function se(i,t){if(i&1&&g(0,ae,7,13,"li")(1,le,10,13,"li"),i&2){let e=d().$implicit;h(e.items.length===1?0:1)}}function pe(i,t){if(i&1&&g(0,se,2,1),i&2){let e=t.$implicit,n=d();h(n.shouldShowGroup(e)?0:-1)}}var S=class i{router=u(_);authService=u(j);platformContext=u(q);translationService=u(U);rbacService=u(N);subscriptions=new M;groups=W;collapsedGroups=C({});permissionTrigger=C(0);visibleGroups=R(()=>(this.permissionTrigger(),this.groups.filter(t=>this.isGroupVisible(t))));ngOnInit(){let t={};this.groups.forEach(e=>{t[e.key]=e.collapsedByDefault??!0}),this.collapsedGroups.set(t),this.subscriptions.add(this.rbacService.getPermissionContext$().subscribe(()=>{this.permissionTrigger.update(e=>e+1)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}toggleGroup(t){this.collapsedGroups.update(e=>E(B({},e),{[t]:!e[t]}))}isGroupCollapsed(t){return this.collapsedGroups()[t]??!1}isGroupVisible(t){return t.key==="system-console"?!1:this.rbacService.canAccessGroup(t.key)}isItemVisible(t){return this.rbacService.canAccessItem(t.path)}getVisibleItems(t){return t.items.filter(e=>this.isItemVisible(e))}shouldShowGroup(t){return this.getVisibleItems(t).length>0}logout(){this.authService.logout(),this.router.navigate(["/login"])}get isRTL(){return this.translationService.getCurrentLanguage()==="ar"}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=f({type:i,selectors:[["app-sidebar"]],decls:39,vars:29,consts:[[1,"w-64","h-full","rounded-[var(--radius-lg)]","flex","flex-col","relative","overflow-hidden","overflow-x-hidden",2,"background-color","var(--sidebar-bg)"],[1,"p-6","border-b","relative","z-10",2,"border-color","rgba(227, 244, 245, 0.1)"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center",2,"background-color","var(--primary-bg)"],[1,"text-xl","font-bold",2,"color","var(--primary-text)"],[1,"text-xl","font-bold",2,"color","var(--sidebar-text)"],[1,"flex-1","overflow-y-auto","overflow-x-hidden","p-4","relative","z-10"],[1,"absolute","inset-0","pointer-events-none",2,"opacity","0.15"],[1,"absolute"],["src","icons/medicine.svg","alt","",1,"w-24","h-24",2,"filter","brightness(0) invert(1)","opacity","0.4"],[1,"absolute",2,"transform","translateX(-50%)"],[1,"space-y-2","relative","z-10"],[1,"p-4","border-t","relative","z-10",2,"border-color","rgba(227, 244, 245, 0.1)"],[1,"rounded-[var(--radius-md)]","p-4",2,"background-color","rgba(227, 244, 245, 0.1)"],[1,"flex","items-center","gap-2","mb-2"],["name","lock","size","20",3,"color"],[1,"font-semibold","text-sm",2,"color","var(--sidebar-text)"],[1,"text-xs","mb-3",2,"color","var(--sidebar-text)","opacity","0.8"],[1,"w-full","rounded-[var(--radius-md)]","px-4","py-2","text-sm","font-medium","transition-opacity","hover:opacity-90",2,"background-color","var(--primary-bg)","color","var(--primary-text)"],[1,"w-full","flex","items-center","gap-3","px-4","py-3","rounded-[var(--radius-md)]","transition-colors","hover:opacity-80",2,"color","var(--sidebar-text)",3,"click"],["name","logout","size","20",3,"color"],["tabindex","0",1,"flex","items-center","gap-3","px-4","py-3","rounded-[var(--radius-md)]","transition-colors",2,"color","var(--sidebar-text)",3,"routerLink","routerLinkActive","routerLinkActiveOptions"],["size","20",3,"name","color"],["type","button",1,"w-full","flex","items-center","justify-between","gap-3","px-4","py-3","rounded-[var(--radius-md)]","transition-colors","hover:opacity-80",2,"color","var(--sidebar-text)",3,"click"],["name","chevron-down","size","16",1,"transition-transform","duration-200",3,"color"],[1,"mt-2","ml-4","space-y-1","group-transition"]],template:function(e,n){e&1&&(r(0,"aside",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),m(5,"P"),o()(),r(6,"span",5),m(7,"Pharmly"),o()()(),r(8,"nav",6)(9,"div",7)(10,"div",8),l(11,"img",9),o(),r(12,"div",8),l(13,"img",9),o(),r(14,"div",10),l(15,"img",9),o()(),r(16,"ul",11),k(17,pe,1,1,null,null,ie),o()(),r(19,"div",12)(20,"div",13)(21,"div",14),l(22,"app-icon",15),r(23,"span",16),m(24),s(25,"translate"),o()(),r(26,"p",17),m(27),s(28,"translate"),o(),r(29,"button",18),m(30),s(31,"translate"),o()()(),r(32,"div",12)(33,"button",19),s(34,"translate"),I("click",function(){return n.logout()}),l(35,"app-icon",20),r(36,"span"),m(37),s(38,"translate"),o()()()()),e&2&&(a(10),y("top",15,"%")("left",-5,"%"),a(2),y("top",50,"%")("right",-5,"%"),a(2),y("bottom",15,"%")("left",50,"%"),a(3),w(n.visibleGroups()),a(5),c("color","var(--sidebar-text)"),a(2),v(p(25,19,"upgrade.title")),a(3),G(" ",p(28,21,"upgrade.description")," "),a(3),G(" ",p(31,23,"upgrade.button")," "),a(3),b("aria-label",p(34,25,"nav.logout")),a(2),c("color","currentColor"),a(2),v(p(38,27,"nav.logout")))},dependencies:[x,$,z,H,X],styles:[".nav-item-active[_ngcontent-%COMP%]{background-color:var(--sidebar-active-bg)!important;color:var(--sidebar-active-text)!important}.nav-item-active[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{color:var(--sidebar-active-text)!important}.group-transition[_ngcontent-%COMP%]{transition:all .3s ease-in-out}"]})};var Z=class i{router=u(_);currentTitle="nav.dashboard";subtitle;isDevMode=A();ngOnInit(){this.updateTitle(),this.router.events.subscribe(()=>{this.updateTitle()})}updateTitle(){let t=this.router.url.split("/")[1]||"dashboard",e={dashboard:"nav.dashboard",patients:"patient.list",drugs:"drug.list",purchases:"nav.orders",invoices:"nav.sales",payments:"nav.payments",suppliers:"nav.suppliers",reports:"nav.helpSupport",settings:"nav.settings",inventory:"inventory.alerts",bundles:"nav.bundles","pharmacy-staff":"nav.pharmacyStaff","audit-logs":"audit.title","inventory-movements":"movements.title","inventory-transfers":"transfers.title","inventory-map":"map.title","growth-referrals":"referrals.title","system-migration":"migration.title","system-automation":"automation.title","system-permissions":"permissions.title","system-features":"featureFlags.title"};this.currentTitle=e[t]||"nav.dashboard",this.subtitle=t==="dashboard"?"dashboard.subtitle":void 0}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=f({type:i,selectors:[["app-main-layout"]],decls:9,vars:2,consts:[[1,"flex","h-screen",2,"background-color","var(--page-bg)"],[1,"py-4","pl-4","flex-shrink-0"],[1,"flex-1","flex","flex-col","overflow-hidden"],[1,"pt-4",2,"padding-left","var(--spacing-page)","padding-right","var(--spacing-page)"],[3,"title","subtitle"],[1,"flex-1","overflow-y-auto",2,"padding","var(--spacing-page)","background-color","var(--page-bg)"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1),l(2,"app-sidebar"),o(),r(3,"div",2)(4,"div",3),l(5,"app-header",4),o(),r(6,"main",5),l(7,"router-outlet"),o()(),l(8,"app-toast"),o()),e&2&&(a(5),c("title",n.currentTitle)("subtitle",n.subtitle))},dependencies:[x,V,S,J,Q],encapsulation:2})};export{Z as MainLayoutComponent};
