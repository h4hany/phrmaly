import{a as K}from"./chunk-4TZJMUES.js";import{a as J}from"./chunk-HVLAQ2GG.js";import{a as Y}from"./chunk-BHTDODCV.js";import{a as q}from"./chunk-6XQQMEJ6.js";import{a as U,b as O}from"./chunk-P3MRTKB5.js";import{d as G}from"./chunk-B4EO6REF.js";import{Da as B,Ia as f,Oa as C,Pa as u,Q as M,Qa as P,Sa as L,Ta as m,Ua as $,W as h,Wa as E,X as _,Xa as F,Xb as I,Y as y,Ya as a,Z as D,Za as o,_a as x,ab as S,bb as b,cb as c,ga as T,gb as j,hb as Q,ib as H,ja as A,kb as d,lb as k,mb as v,nb as w,ob as R,pb as N,va as r,yb as l,zb as s}from"./chunk-Z4T7VGFQ.js";import"./chunk-7CGTOI24.js";function ee(n,t){if(n&1&&(a(0,"p",36),d(1),o()),n&2){let e=c();u("color","var(--sidebar-text, #E3F4F5)"),r(),v(" ",e.getManufacturer()," ")}}function te(n,t){if(n&1&&(a(0,"p",17)(1,"span",18),d(2),l(3,"translate"),o(),d(4),o()),n&2){let e=c();u("color","var(--sidebar-text, #E3F4F5)"),r(2),v("",s(3,4,"drugCard.barcode"),":"),r(2),v(" ",e.drug.internalBarcode," ")}}function ie(n,t){if(n&1&&(a(0,"p",17)(1,"span",18),d(2),l(3,"translate"),o(),d(4),o()),n&2){let e=c();u("color","var(--sidebar-text, #E3F4F5)"),r(2),v("",s(3,4,"drugCard.plu"),":"),r(2),v(" ",e.drug.generalDrug==null?null:e.drug.generalDrug.internationalBarcode," ")}}function ne(n,t){if(n&1&&(a(0,"span",37),d(1),o()),n&2){let e=c();u("color","var(--sidebar-text, #E3F4F5)"),r(),v(" ",e.formatPrice(e.drug.price)," ")}}function re(n,t){if(n&1&&(a(0,"span",38),d(1),l(2,"translate"),l(3,"translate"),o()),n&2){let e=c();u("background","rgba(34, 197, 94, 0.2)")("color","#86efac"),r(),N(" ",s(2,8,"drugCard.save")," ",e.getDiscountPercentage(),"% \u2022 ",e.formatPrice(e.getDiscountAmount())," ",s(3,10,"drugCard.off")," ")}}function ae(n,t){if(n&1&&(a(0,"div",39),y(),a(1,"svg",40),x(2,"path",41),o(),D(),a(3,"span",26),d(4),l(5,"translate"),l(6,"translate"),o()()),n&2){let e=c();u("background","rgba(234, 179, 8, 0.15)")("border-left","3px solid #fbbf24"),r(3),u("color","var(--sidebar-text, #E3F4F5)"),r(),N(" ",s(5,10,"drugCard.expires"),": ",e.formatDate(e.drug.expiryDate)," (",e.getMonthsUntilExpiry()," ",s(6,12,"drugCard.months"),") ")}}function oe(n,t){if(n&1&&(a(0,"span"),d(1),l(2,"translate"),o()),n&2){let e=c().$implicit,i=c(3);r(),w(" \u2022 ",s(2,2,"drugCard.exp"),": ",i.formatDate(e.expiryDate),"")}}function le(n,t){if(n&1&&(a(0,"div",48)(1,"div",49)(2,"span"),d(3),l(4,"translate"),o(),a(5,"span"),d(6),l(7,"translate"),o()(),a(8,"div",50),d(9),l(10,"translate"),f(11,oe,3,4,"span"),o()()),n&2){let e=t.$implicit,i=c(3);u("background","rgba(255, 255, 255, 0.05)")("color","var(--sidebar-text, #E3F4F5)"),r(3),w("",s(4,11,"drugCard.quantity"),": ",e.quantity,""),r(3),w("",s(7,13,"drugCard.cost"),": ",i.formatPrice(e.unitCost),""),r(3),w(" ",s(10,15,"drugCard.purchased"),": ",i.formatDate(e.purchaseDate)," "),r(2),m(e.expiryDate?11:-1)}}function se(n,t){if(n&1&&(a(0,"div",46),E(1,le,12,17,"div",47,$),o()),n&2){let e=c(2);r(),F(e.drug.costLayers)}}function de(n,t){if(n&1){let e=S();a(0,"div",19)(1,"button",42),b("click",function(){h(e);let p=c();return _(p.toggleCostLayers())}),a(2,"span",43),d(3),l(4,"translate"),o(),y(),a(5,"svg",44),x(6,"path",45),o()(),f(7,se,3,0,"div",46),o()}if(n&2){let e=c();r(2),u("color","var(--sidebar-text, #E3F4F5)"),r(),w(" ",s(4,9,"drugCard.costLayers")," (",e.drug.costLayers.length,") "),r(2),u("color","var(--sidebar-text, #E3F4F5)"),P("rotate-180",e.showCostLayers()),r(2),m(e.showCostLayers()?7:-1)}}function pe(n,t){if(n&1&&(a(0,"span"),d(1),o()),n&2){let e=t.$implicit,i=c(2);L(i.getBadgeClasses(e)),r(),v(" ",e.label," ")}}function ce(n,t){if(n&1&&E(0,pe,2,3,"span",32,$),n&2){let e=c();F(e.badges)}}function ue(n,t){if(n&1&&(a(0,"span"),x(1,"span"),d(2),o()),n&2){let e=c();L(e.getStatusBadgeClasses()),r(),L(e.getStatusDotClasses()),r(),v(" ",e.getStatusLabel()," ")}}function ge(n,t){if(n&1){let e=S();a(0,"button",51),l(1,"translate"),b("click",function(p){h(e);let g=c();return _(g.onEditClick(p))}),y(),a(2,"svg",52),x(3,"path",53),o()()}n&2&&(u("background","rgba(255, 255, 255, 0.1)")("color","var(--sidebar-text, #E3F4F5)"),C("title",s(1,5,"common.edit")))}function me(n,t){if(n&1){let e=S();a(0,"button",54),l(1,"translate"),b("click",function(p){h(e);let g=c();return _(g.onDeleteClick(p))}),y(),a(2,"svg",52),x(3,"path",55),o()()}n&2&&(u("background","rgba(255, 255, 255, 0.1)")("color","var(--sidebar-text, #E3F4F5)"),C("title",s(1,5,"common.delete")))}var V=class n{translationService=M(U);drug;badges;showEdit=!0;showDelete=!0;costingMethod="FIFO";view=T();edit=T();delete=T();showCostLayers=A(!1);get isRTL(){return this.translationService.getCurrentLanguage()==="ar"}getDrugInitials(){let t=this.getDrugName();if(t){let e=t.trim().split(/\s+/);return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():t.substring(0,2).toUpperCase()}return"DR"}getDrugName(){return this.drug?.generalDrug?.name||"N/A"}getManufacturer(){return this.drug?.generalDrug?.manufacturer||""}formatPrice(t){return t.toFixed(2)}hasDiscount(){return this.drug.priceAfterDiscount<this.drug.price}getCurrentPrice(){return this.drug.priceAfterDiscount}getDiscountAmount(){return this.drug.price-this.drug.priceAfterDiscount}getDiscountPercentage(){return this.hasDiscount()?Math.round((this.drug.price-this.drug.priceAfterDiscount)/this.drug.price*100):0}getMaxStock(){if(this.drug.costLayers&&this.drug.costLayers.length>0){let t=this.drug.costLayers.reduce((e,i)=>e+i.quantity,0);return Math.max(t,this.drug.stockQuantity,this.drug.minimumStock*2)}return Math.max(this.drug.stockQuantity,this.drug.minimumStock*2)}getStockPercentage(){let t=this.getMaxStock();return t===0?0:Math.min(this.drug.stockQuantity/t*100,100)}getCostingMethod(){return this.costingMethod}getMonthsUntilExpiry(){if(!this.drug.expiryDate)return 0;let t=new Date(this.drug.expiryDate),e=new Date,i=(t.getFullYear()-e.getFullYear())*12+(t.getMonth()-e.getMonth());return Math.max(0,i)}getBadgeClasses(t){let e="px-2.5 py-1 rounded-full text-xs font-medium",i=t.variant||"default";return`${e} ${{success:"bg-green-500/20 text-green-400",warning:"bg-amber-500/20 text-amber-400",danger:"bg-red-500/20 text-red-400",info:"bg-blue-500/20 text-blue-400",default:"bg-white/10 text-white/80"}[i]}`}getStatusBadgeClasses(){let t="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium",e=this.drug?.status;return e==="active"?`${t} bg-green-500/20 text-green-400`:e==="out_of_stock"?`${t} bg-red-500/20 text-red-400`:`${t} bg-white/10 text-white/60`}getStatusDotClasses(){let t="w-1.5 h-1.5 rounded-full mr-2",e=this.drug?.status;return e==="active"?`${t} bg-green-400`:e==="out_of_stock"?`${t} bg-red-400`:`${t} bg-gray-400`}getStatusLabel(){let t=this.drug?.status;return t==="active"?this.translationService.translate("drugCard.active")||"Active":t==="out_of_stock"?this.translationService.translate("drugCard.outOfStock")||"Out of Stock":this.translationService.translate("drugCard.inactive")||"Inactive"}toggleCostLayers(){this.showCostLayers.update(t=>!t)}onViewClick(t){t.stopPropagation(),this.view.emit()}onEditClick(t){t.stopPropagation(),this.edit.emit()}onDeleteClick(t){t.stopPropagation(),this.delete.emit()}formatDate(t){if(!t)return"";let e=typeof t=="string"?new Date(t):t;if(isNaN(e.getTime()))return"";let i=String(e.getDate()).padStart(2,"0"),p=String(e.getMonth()+1).padStart(2,"0"),g=e.getFullYear();return`${i}-${p}-${g}`}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=B({type:n,selectors:[["app-drug-card"]],inputs:{drug:"drug",badges:"badges",showEdit:"showEdit",showDelete:"showDelete",costingMethod:"costingMethod"},outputs:{view:"view",edit:"edit",delete:"delete"},decls:57,vars:89,consts:[[1,"drug-card","group","relative","rounded-xl","p-6","transition-all","duration-200","cursor-pointer","hover:-translate-y-0.5","flex","flex-col"],[1,"medicine-pattern","absolute","inset-0","pointer-events-none","overflow-visible","rounded-xl"],[1,"absolute","medicine-icon"],["src","icons/medicine.svg","alt","",1,"w-40","h-40",2,"filter","brightness(0) invert(1)","opacity","0.15"],[1,"absolute","inset-0","rounded-xl","opacity-0","group-hover:opacity-100","transition-opacity","duration-200","pointer-events-none"],["type","button",1,"view-button",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","stroke-width","2.5",1,"w-5","h-5","arrow-icon-ltr"],["stroke-linecap","round","stroke-linejoin","round","d","M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"],[1,"relative","z-10","flex-1","flex","flex-col"],[1,"flex","items-start","mb-5"],[1,"relative","flex-shrink-0"],[1,"w-16","h-16","rounded-full","flex","items-center","justify-center","text-xl","font-bold","ring-2","transition-all","duration-200","shadow-lg"],[1,"mb-4","flex-1"],[1,"text-lg","font-bold","mb-1.5","group-hover:opacity-90","transition-opacity","duration-200","leading-tight"],[1,"text-sm","mb-2","font-medium","opacity-80",3,"color"],[1,"space-y-1","mb-2"],[1,"text-xs","opacity-60",3,"color"],[1,"text-xs","opacity-60"],[1,"font-medium"],[1,"mb-2"],[1,"flex","items-baseline","gap-2","mb-1"],[1,"text-2xl","font-bold"],[1,"text-lg","line-through","opacity-60",3,"color"],[1,"inline-block","px-2","py-0.5","rounded","text-xs","font-medium",3,"background","color"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-xs","font-semibold","uppercase","tracking-wide","opacity-70"],[1,"text-xs","font-medium"],[1,"w-full","bg-white/10","rounded-full","h-1.5","mb-1"],[1,"h-1.5","rounded-full","transition-all","duration-300"],[1,"flex","items-center","justify-between","text-xs","opacity-60"],[1,"mb-2","p-2","rounded","flex","items-center","gap-2",3,"background","border-left"],[1,"flex","items-center","gap-2","flex-wrap","mb-4"],[3,"class"],[1,"action-buttons","absolute","bottom-4","flex","items-center","gap-2","opacity-0","group-hover:opacity-100","transition-all","duration-200","transform","translate-y-2","group-hover:translate-y-0"],["type","button",1,"p-2","rounded-lg","backdrop-blur-sm","transition-all","duration-200","shadow-md","opacity-80","hover:opacity-100",3,"background","color","title"],["type","button",1,"p-2","rounded-lg","backdrop-blur-sm","transition-all","duration-200","shadow-md","opacity-80","hover:opacity-100","hover:bg-red-500/20","hover:text-red-400",3,"background","color","title"],[1,"text-sm","mb-2","font-medium","opacity-80"],[1,"text-lg","line-through","opacity-60"],[1,"inline-block","px-2","py-0.5","rounded","text-xs","font-medium"],[1,"mb-2","p-2","rounded","flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","flex-shrink-0",2,"color","#fbbf24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],["type","button",1,"w-full","flex","items-center","justify-between","p-1.5","rounded","transition-colors","hover:bg-white/5",3,"click"],[1,"text-xs","font-semibold","uppercase","tracking-wide"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"mt-1","space-y-1"],[1,"p-1.5","rounded","text-xs","opacity-70",3,"background","color"],[1,"p-1.5","rounded","text-xs","opacity-70"],[1,"flex","justify-between"],[1,"text-xs","opacity-60","mt-0.5"],["type","button",1,"p-2","rounded-lg","backdrop-blur-sm","transition-all","duration-200","shadow-md","opacity-80","hover:opacity-100",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["type","button",1,"p-2","rounded-lg","backdrop-blur-sm","transition-all","duration-200","shadow-md","opacity-80","hover:opacity-100","hover:bg-red-500/20","hover:text-red-400",3,"click","title"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),x(3,"img",3),o()(),x(4,"div",4),a(5,"button",5),l(6,"translate"),b("click",function(g){return i.onViewClick(g)}),y(),a(7,"svg",6),x(8,"path",7),o()(),D(),a(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11),d(13),o()()(),a(14,"div",12)(15,"h3",13),d(16),o(),f(17,ee,2,3,"p",14),a(18,"div",15),f(19,te,5,6,"p",16)(20,ie,5,6,"p",16),a(21,"p",17)(22,"span",18),d(23),l(24,"translate"),o(),d(25),o()(),a(26,"div",19)(27,"div",20)(28,"span",21),d(29),o(),f(30,ne,2,3,"span",22),o(),f(31,re,4,12,"span",23),o(),a(32,"div",19)(33,"div",24)(34,"span",25),d(35),l(36,"translate"),o(),a(37,"span",26),d(38),o()(),a(39,"div",27),x(40,"div",28),o(),a(41,"div",29)(42,"span"),d(43),l(44,"translate"),l(45,"translate"),o(),a(46,"span"),d(47),l(48,"translate"),o()()(),f(49,ae,7,14,"div",30)(50,de,8,11,"div",19),o(),a(51,"div",31),f(52,ce,2,0)(53,ue,3,5,"span",32),o(),a(54,"div",33),f(55,ge,4,7,"button",34)(56,me,4,7,"button",35),o()()()),e&2&&(u("color","var(--sidebar-text, #E3F4F5)")("min-height","420px"),r(2),u("right",i.isRTL?"auto":"1rem")("left",i.isRTL?"1rem":"auto")("top","50%")("transform","translateY(-50%)"),r(2),u("background","radial-gradient(circle at center, var(--sidebar-active-bg, #D9F275)15, transparent 70%)")("box-shadow","0 0 40px rgba(217, 242, 117, 0.3)"),r(),P("rtl-position",i.isRTL),C("title",s(6,77,"common.view")),r(2),u("color","var(--primary-text, #003032)"),P("rotate-180",i.isRTL),r(5),u("background","var(--sidebar-active-bg, #D9F275)")("color","var(--sidebar-active-text, #003032)")("border-color","rgba(255, 255, 255, 0.2)"),r(),v(" ",i.getDrugInitials()," "),r(2),u("color","var(--sidebar-text, #E3F4F5)"),r(),v(" ",i.getDrugName()," "),r(),m(i.getManufacturer()?17:-1),r(2),m(i.drug.internalBarcode?19:-1),r(),m(i.drug.generalDrug!=null&&i.drug.generalDrug.internationalBarcode?20:-1),r(),u("color","var(--sidebar-text, #E3F4F5)"),r(2),v("",s(24,79,"drugCard.id"),":"),r(2),v(" #",i.drug.id," "),r(3),u("color","var(--sidebar-text, #E3F4F5)"),r(),v(" ",i.formatPrice(i.getCurrentPrice())," "),r(),m(i.hasDiscount()?30:-1),r(),m(i.hasDiscount()?31:-1),r(3),u("color","var(--sidebar-text, #E3F4F5)"),r(),v(" ",s(36,81,"drugCard.stockLevel")," "),r(2),u("color","var(--sidebar-text, #E3F4F5)"),r(),w(" ",i.drug.stockQuantity," / ",i.getMaxStock()," "),r(2),u("width",i.getStockPercentage(),"%"),P("bg-yellow-400",i.getStockPercentage()>=50)("bg-amber-500",i.getStockPercentage()>=25&&i.getStockPercentage()<50)("bg-red-400",i.getStockPercentage()<25),r(),u("color","var(--sidebar-text, #E3F4F5)"),r(2),R("",s(44,83,"drugCard.min"),": ",i.drug.minimumStock," ",s(45,85,"drugCard.units"),""),r(4),w("",s(48,87,"drugCard.method"),": ",i.getCostingMethod(),""),r(2),m(i.drug.expiryDate?49:-1),r(),m(i.drug.costLayers&&i.drug.costLayers.length>0?50:-1),r(2),m(i.badges&&i.badges.length>0?52:-1),r(),m(i.drug.status?53:-1),r(),u("right",i.isRTL?"auto":"1rem")("left",i.isRTL?"1rem":"auto"),r(),m(i.showEdit?55:-1),r(),m(i.showDelete?56:-1))},dependencies:[I,O],styles:['.drug-card[_ngcontent-%COMP%]{position:relative;overflow:visible;contain:layout;--w: 50px;--h: 50px;--outline: 20px;--radius: 20px;--offset: calc(-1 * var(--outline));--size: calc(var(--radius) + var(--outline));background:calc(100% - var(--offset)) var(--h) radial-gradient(circle at left bottom,transparent var(--radius),#F7F7F7 var(--radius)),calc(100% - var(--w)) var(--offset) radial-gradient(circle at left bottom,transparent var(--radius),#F7F7F7 var(--radius)),var(--sidebar-bg, #003032);background-repeat:no-repeat;background-size:var(--size) var(--size),var(--size) var(--size),cover}[dir=rtl][_ngcontent-%COMP%]   .drug-card[_ngcontent-%COMP%], [dir="rtl"][_nghost-%COMP%]   .drug-card[_ngcontent-%COMP%], [dir="rtl"]   [_nghost-%COMP%]   .drug-card[_ngcontent-%COMP%], html[dir="rtl"][_nghost-%COMP%]   .drug-card[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .drug-card[_ngcontent-%COMP%]{background:var(--offset) var(--h) radial-gradient(circle at right bottom,transparent var(--radius),#F7F7F7 var(--radius)),var(--w) var(--offset) radial-gradient(circle at right bottom,transparent var(--radius),#F7F7F7 var(--radius)),var(--sidebar-bg, #003032);background-repeat:no-repeat;background-size:var(--size) var(--size),var(--size) var(--size),cover}.view-button[_ngcontent-%COMP%]{position:absolute;top:2px;right:0;width:var(--w);height:var(--h);outline:var(--outline) solid #F7F7F7;border-radius:50%;background:var(--primary-bg, #D9F275);border-color:var(--primary-bg);display:grid;place-items:center;cursor:pointer;transition:background .15s ease,transform .15s ease;z-index:20;padding:0;border:none;box-shadow:0 4px 12px #0003}.view-button[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.view-button.rtl-position[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   .view-button[_ngcontent-%COMP%], [dir="rtl"][_nghost-%COMP%]   .view-button[_ngcontent-%COMP%], [dir="rtl"]   [_nghost-%COMP%]   .view-button[_ngcontent-%COMP%], html[dir="rtl"][_nghost-%COMP%]   .view-button[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .view-button[_ngcontent-%COMP%]{right:auto;left:0}.drug-card[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent);opacity:0;transition:opacity .2s;z-index:2}.drug-card[_ngcontent-%COMP%]:hover:before{opacity:1}[dir=rtl][_ngcontent-%COMP%]   .drug-card[_ngcontent-%COMP%]{direction:rtl}[dir="rtl"][_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%], [dir="rtl"]   [_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%], [dir="rtl"][_nghost-%COMP%]   .action-buttons.right-4[_ngcontent-%COMP%], [dir="rtl"]   [_nghost-%COMP%]   .action-buttons.right-4[_ngcontent-%COMP%], [dir="rtl"][_nghost-%COMP%]   .drug-card[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%], [dir="rtl"]   [_nghost-%COMP%]   .drug-card[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{right:auto!important;left:1rem!important}html[dir="rtl"][_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]{right:auto!important;left:1rem!important}[dir=rtl][_ngcontent-%COMP%]   .drug-card[_ngcontent-%COMP%]   .absolute.bottom-0.right-0[_ngcontent-%COMP%]{right:auto;left:0}.arrow-icon-ltr[_ngcontent-%COMP%]{display:block}']})};var ve=["deleteModal"],xe=["importModal"],fe=(n,t)=>t.id;function he(n,t){if(n&1&&x(0,"app-alert",4),n&2){let e=c();C("title",e.errorMessage)}}function _e(n,t){if(n&1&&(a(0,"app-alert",18),l(1,"translate"),d(2),l(3,"translate"),o()),n&2){let e=c();C("title",s(1,3,"alert.lowStockTitle")),r(2),w(" ",e.lowStockCount," ",s(3,5,"alert.lowStockMessage")," ")}}function Ce(n,t){if(n&1&&(a(0,"app-alert",18),l(1,"translate"),d(2),l(3,"translate"),o()),n&2){let e=c();C("title",s(1,3,"alert.expiryTitle")),r(2),w(" ",e.expiringCount," ",s(3,5,"alert.expiryMessage")," ")}}function be(n,t){n&1&&(a(0,"div",19)(1,"div",29),d(2),l(3,"translate"),o()()),n&2&&(r(2),k(s(3,1,"common.loading")))}function ye(n,t){n&1&&(a(0,"div",20),y(),a(1,"svg",30),x(2,"path",31),o(),D(),a(3,"p",32),d(4),l(5,"translate"),o()()),n&2&&(r(4),k(s(5,1,"empty.noDrugs")))}function we(n,t){if(n&1){let e=S();a(0,"app-drug-card",34),b("view",function(){let p=h(e).$implicit,g=c(2);return _(g.viewDrug(p.id))})("edit",function(){let p=h(e).$implicit,g=c(2);return _(g.editDrug(p.id))})("delete",function(){let p=h(e).$implicit,g=c(2);return _(g.confirmDelete(p))}),o()}if(n&2){let e=t.$implicit,i=c(2);C("drug",e)("badges",i.getBadges(e))}}function De(n,t){if(n&1&&(a(0,"div",21),E(1,we,1,2,"app-drug-card",33,fe),o()),n&2){let e=c();r(),F(e.drugs)}}function Se(n,t){if(n&1&&(a(0,"p",27)(1,"span",35),d(2),l(3,"translate"),o(),d(4),o()),n&2){let e=c();r(2),v("",s(3,2,"button.selectedFile"),":"),r(2),v(" ",e.selectedFile.name," ")}}function ke(n,t){if(n&1&&x(0,"app-alert",4),n&2){let e=c();C("title",e.importError)}}function Me(n,t){if(n&1&&x(0,"app-alert",28),n&2){let e=c();C("title",e.importSuccess)}}var W=class n{router=M(G);drugsService=M(K);drugs=[];searchQuery="";errorMessage="";loading=!1;deleting=!1;selectedDrugId=null;lowStockCount=0;expiringCount=0;importing=!1;selectedFile=null;importError="";importSuccess="";deleteModal;importModal;pagination={page:1,pageSize:10,total:0,totalPages:0};ngOnInit(){this.loadDrugs(),this.checkAlerts()}loadDrugs(){this.loading=!0,this.drugsService.getPharmacyDrugs({page:this.pagination.page,pageSize:this.pagination.pageSize}).subscribe({next:t=>{this.drugs=t.data,this.pagination={page:t.page,pageSize:t.pageSize,total:t.total,totalPages:t.totalPages},this.loading=!1},error:()=>{this.errorMessage="Failed to load drugs",this.loading=!1}})}checkAlerts(){this.drugsService.getLowStockDrugs().subscribe({next:t=>{this.lowStockCount=t.length}}),this.drugsService.getExpiringDrugs(30).subscribe({next:t=>{this.expiringCount=t.length}})}onSearch(){this.searchQuery.trim()?(this.loading=!0,this.drugsService.searchPharmacyDrugs(this.searchQuery).subscribe({next:t=>{this.drugs=t,this.pagination={page:1,pageSize:10,total:t.length,totalPages:Math.ceil(t.length/10)},this.loading=!1},error:()=>{this.errorMessage="Search failed",this.loading=!1}})):this.loadDrugs()}navigateToNew(){this.router.navigate(["/drugs/new"])}viewDrug(t){this.router.navigate(["/drugs",t])}editDrug(t){this.router.navigate(["/drugs",t,"edit"])}confirmDelete(t){this.selectedDrugId=t.id,this.deleteModal.open()}deleteDrug(){this.selectedDrugId&&(this.deleting=!0,this.drugsService.deletePharmacyDrug(this.selectedDrugId).subscribe({next:t=>{t&&(this.loadDrugs(),this.checkAlerts(),this.deleteModal.close(),this.selectedDrugId=null),this.deleting=!1},error:()=>{this.errorMessage="Failed to delete drug",this.deleting=!1}}))}openImportModal(){this.selectedFile=null,this.importError="",this.importSuccess="",this.importModal.open()}onFileSelected(t){let e=t.target;if(e.files&&e.files.length>0){let i=e.files[0],p=i.name.split(".").pop()?.toLowerCase();p&&["csv","xlsx","xls"].includes(p)?(this.selectedFile=i,this.importError=""):(this.importError="Please select a valid CSV or Excel file",this.selectedFile=null)}}handleImport(){if(!this.selectedFile){this.importError="Please select a file to import";return}this.importing=!0,this.importError="",this.importSuccess="",setTimeout(()=>{this.importing=!1,this.importSuccess=`File "${this.selectedFile.name}" uploaded successfully. Import functionality will process the file.`,setTimeout(()=>{this.selectedFile=null,this.importModal.close(),this.loadDrugs()},2e3)},1500)}getBadges(t){let e=[];if(t.stockQuantity<=t.minimumStock&&e.push({label:"Low Stock",variant:"warning"}),t.expiryDate){let i=new Date(t.expiryDate),p=new Date,g=Math.ceil((i.getTime()-p.getTime())/(1e3*60*60*24));g>0&&g<=30&&e.push({label:"Expiring Soon",variant:"danger"})}return e}formatDate(t){let e=new Date(t),i=String(e.getDate()).padStart(2,"0"),p=String(e.getMonth()+1).padStart(2,"0"),g=e.getFullYear();return`${i}-${p}-${g}`}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=B({type:n,selectors:[["app-drugs-list"]],viewQuery:function(e,i){if(e&1&&(j(ve,5),j(xe,5)),e&2){let p;Q(p=H())&&(i.deleteModal=p.first),Q(p=H())&&(i.importModal=p.first)}},decls:55,vars:48,consts:[["deleteModal",""],["importModal",""],["fileInput",""],[1,"space-y-6"],["type","error",3,"title"],[1,"flex","items-center","justify-between","gap-4"],[1,"flex-1","max-w-lg"],[1,"relative"],["type","text",1,"w-full","px-4","py-2","pl-10","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-[#166534]","focus:border-[#166534]",3,"input","placeholder","value"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","absolute","left-3","top-2.5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"flex","gap-3"],["variant","outline"],["variant","outline",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"],["variant","primary",3,"onClick"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["type","warning",3,"title"],[1,"flex","items-center","justify-center","py-12"],[1,"flex","flex-col","items-center","justify-center","py-12","text-gray-500"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[3,"confirmed","title","showFooter","confirmText","confirmLoading"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","file","accept",".csv,.xlsx,.xls",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-[#166534]","focus:border-[#166534]","text-sm",3,"change"],[1,"mt-2","text-xs","text-gray-500"],[1,"mt-2","text-sm","text-gray-700"],["type","success",3,"title"],[1,"text-gray-500"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","mb-4","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"],[1,"text-lg","font-medium"],[3,"drug","badges"],[3,"view","edit","delete","drug","badges"],[1,"font-medium"]],template:function(e,i){if(e&1){let p=S();a(0,"div",3),f(1,he,1,1,"app-alert",4),a(2,"div",5)(3,"div",6)(4,"div",7)(5,"input",8),l(6,"translate"),b("input",function(z){return h(p),i.searchQuery=z.target.value,_(i.onSearch())}),o(),y(),a(7,"svg",9),x(8,"path",10),o()()(),D(),a(9,"div",11)(10,"app-button",12),d(11),l(12,"translate"),o(),a(13,"app-button",13),b("onClick",function(){return h(p),_(i.openImportModal())}),y(),a(14,"svg",14),x(15,"path",15),o(),d(16),l(17,"translate"),o(),D(),a(18,"app-button",12),d(19),l(20,"translate"),o(),a(21,"app-button",16),b("onClick",function(){return h(p),_(i.navigateToNew())}),y(),a(22,"svg",14),x(23,"path",17),o(),d(24),l(25,"translate"),o()()(),f(26,_e,4,7,"app-alert",18)(27,Ce,4,7,"app-alert",18)(28,be,4,3,"div",19)(29,ye,6,3,"div",20)(30,De,3,0,"div",21),D(),a(31,"app-modal",22,0),l(33,"translate"),l(34,"translate"),b("confirmed",function(){return h(p),_(i.deleteDrug())}),a(35,"p"),d(36),l(37,"translate"),o()(),a(38,"app-modal",22,1),l(40,"translate"),l(41,"translate"),b("confirmed",function(){return h(p),_(i.handleImport())}),a(42,"div",23)(43,"div")(44,"label",24),d(45),l(46,"translate"),o(),a(47,"input",25,2),b("change",function(z){return h(p),_(i.onFileSelected(z))}),o(),a(49,"p",26),d(50),l(51,"translate"),o(),f(52,Se,5,4,"p",27),o(),f(53,ke,1,1,"app-alert",4)(54,Me,1,1,"app-alert",28),o()()()}e&2&&(r(),m(i.errorMessage?1:-1),r(4),C("placeholder",s(6,24,"button.searchByNameBarcode"))("value",i.searchQuery),r(6),k(s(12,26,"common.filters")),r(5),v(" ",s(17,28,"button.import")," "),r(3),k(s(20,30,"common.export")),r(5),v(" ",s(25,32,"button.addNewDrug")," "),r(2),m(i.lowStockCount>0?26:-1),r(),m(i.expiringCount>0?27:-1),r(),m(i.loading?28:i.drugs.length===0?29:30),r(3),C("title",s(33,34,"button.deleteDrug"))("showFooter",!0)("confirmText",s(34,36,"common.delete"))("confirmLoading",i.deleting),r(5),k(s(37,38,"modal.deleteDrugConfirm")),r(2),C("title",s(40,40,"button.importDrugs"))("showFooter",!0)("confirmText",s(41,42,"button.upload"))("confirmLoading",i.importing),r(7),v(" ",s(46,44,"button.selectFile")," "),r(5),v(" ",s(51,46,"button.importFileFormat")," "),r(2),m(i.selectedFile?52:-1),r(),m(i.importError?53:-1),r(),m(i.importSuccess?54:-1))},dependencies:[I,Y,J,q,O,V],encapsulation:2})};export{W as DrugsListComponent};
