import{M as d,Nb as n,Ob as u,la as c}from"./chunk-OKFD3A6M.js";import{a as o,b as i}from"./chunk-KAT7YFEL.js";var g="pharmly_invoice_cart",p=class s{_drugs=c(this.loadFromStorage());drugs=this._drugs.asReadonly();hasDrugs=n(()=>this._drugs().length>0);count=n(()=>this._drugs().length);constructor(){u(()=>{let e=this._drugs();this.saveToStorage(e)})}addDrug(e){this._drugs().find(t=>t.id===e.id)||this._drugs.update(t=>[...t,e])}removeDrug(e){this._drugs.update(r=>r.filter(t=>t.id!==e))}clear(){this._drugs.set([])}getDrugs(){return this._drugs()}hasDrug(e){return this._drugs().some(r=>r.id===e)}loadFromStorage(){try{let e=sessionStorage.getItem(g);if(e)return JSON.parse(e).map(t=>i(o({},t),{expiryDate:t.expiryDate?new Date(t.expiryDate):void 0,createdAt:t.createdAt?new Date(t.createdAt):new Date,updatedAt:t.updatedAt?new Date(t.updatedAt):new Date,costLayers:t.costLayers?.map(a=>i(o({},a),{purchaseDate:a.purchaseDate?new Date(a.purchaseDate):new Date,expiryDate:a.expiryDate?new Date(a.expiryDate):void 0}))||[]}))}catch(e){console.error("Failed to load cart from sessionStorage:",e)}return[]}saveToStorage(e){try{sessionStorage.setItem(g,JSON.stringify(e))}catch(r){console.error("Failed to save cart to sessionStorage:",r)}}static \u0275fac=function(r){return new(r||s)};static \u0275prov=d({token:s,factory:s.\u0275fac,providedIn:"root"})};export{p as a};
