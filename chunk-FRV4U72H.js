import{a as I}from"./chunk-WX7MLWZI.js";import{a as V}from"./chunk-47X5MO5M.js";import"./chunk-3NBSZF5I.js";import{a as D}from"./chunk-QDLVDHOW.js";import"./chunk-6CFKC637.js";import"./chunk-5PFWNSG3.js";import"./chunk-T542ZMY7.js";import"./chunk-URFUYTQU.js";import"./chunk-BYXBJQAS.js";import{b as L}from"./chunk-3UJCRMW3.js";import{d as E}from"./chunk-C3O3TVFX.js";import{$a as a,Ab as m,Bb as p,Eb as T,Fa as b,Ka as w,Q as x,Qa as h,Va as M,W as v,X as c,_a as i,_b as k,cb as y,db as g,eb as _,mb as s,nb as d,ob as S,wa as t}from"./chunk-E4S7NVXB.js";import{a as f}from"./chunk-C6Q5SG76.js";function B(u,r){if(u&1){let e=y();i(0,"div",3)(1,"div",5)(2,"select",6),g("change",function(o){v(e);let l=_();return c(l.handleFilterChange("movementType",o))}),i(3,"option",7),s(4),m(5,"translate"),a(),i(6,"option",8),s(7),m(8,"translate"),a(),i(9,"option",9),s(10),m(11,"translate"),a(),i(12,"option",10),s(13),m(14,"translate"),a(),i(15,"option",11),s(16),m(17,"translate"),a()(),i(18,"select",6),g("change",function(o){v(e);let l=_();return c(l.handleFilterChange("riskLevel",o))}),i(19,"option",7),s(20),m(21,"translate"),a(),i(22,"option",12),s(23),m(24,"translate"),a(),i(25,"option",13),s(26),m(27,"translate"),a(),i(28,"option",14),s(29),m(30,"translate"),a(),i(31,"option",15),s(32),m(33,"translate"),a()(),i(34,"input",16),g("change",function(o){v(e);let l=_();return c(l.handleFilterChange("startDate",o))}),a(),i(35,"input",16),g("change",function(o){v(e);let l=_();return c(l.handleFilterChange("endDate",o))}),a()()()}if(u&2){let e=_();t(2),h("value",e.filters.movementType),t(2),d(p(5,14,"movements.allTypes")),t(3),d(p(8,16,"movements.type.sale")),t(3),d(p(11,18,"movements.type.purchase")),t(3),d(p(14,20,"movements.type.adjustment")),t(3),d(p(17,22,"movements.type.theft")),t(2),h("value",e.filters.riskLevel),t(2),d(p(21,24,"movements.allRisks")),t(3),d(p(24,26,"risk.low")),t(3),d(p(27,28,"risk.medium")),t(3),d(p(30,30,"risk.high")),t(3),d(p(33,32,"risk.critical")),t(2),h("value",e.filters.startDate),t(),h("value",e.filters.endDate)}}function P(u,r){if(u&1){let e=y();i(0,"div",17)(1,"button",18),g("click",function(){let o=v(e).$implicit,l=_();return c(l.viewDetail(o.id))}),s(2),m(3,"translate"),a()()}u&2&&(t(2),S(" ",p(3,1,"common.view")," "))}var F=class u{movementEngine=x(I);router=x(E);movements=[];loading=!1;showFilters=!1;pagination=null;filters={movementType:"",riskLevel:"",startDate:"",endDate:""};columns=[{key:"timestamp",label:"movements.date",sortable:!0},{key:"drugName",label:"movements.drug"},{key:"movementType",label:"movements.type"},{key:"quantity",label:"movements.quantity",sortable:!0},{key:"staffName",label:"movements.staff"},{key:"riskLevel",label:"movements.risk"}];primaryAction={label:"movements.new",onClick:()=>this.router.navigate(["/inventory/movements/new"]),variant:"primary"};ngOnInit(){this.loadMovements()}loadMovements(){this.loading=!0;let r=f(f(f(f({page:this.pagination?.page||1,pageSize:10},this.filters.movementType&&{movementType:this.filters.movementType}),this.filters.riskLevel&&{riskLevel:this.filters.riskLevel}),this.filters.startDate&&{startDate:new Date(this.filters.startDate)}),this.filters.endDate&&{endDate:new Date(this.filters.endDate)});this.movementEngine.getMovements(r).subscribe({next:e=>{this.movements=e.data,this.pagination={page:e.page,pageSize:e.pageSize,total:e.total,totalPages:e.totalPages},this.loading=!1},error:()=>{this.loading=!1}})}handlePageChange(r){this.pagination&&(this.pagination.page=r,this.loadMovements())}handleSearch(r){this.loadMovements()}handleFilterChange(r,e){let n=e.target;this.filters[r]=n.value,this.loadMovements()}viewDetail(r){this.router.navigate(["/inventory/movements",r])}static \u0275fac=function(e){return new(e||u)};static \u0275cmp=b({type:u,selectors:[["app-movements-list"]],decls:6,vars:9,consts:[["actionTemplate",""],[1,"space-y-6"],["title","movements.title",3,"onSearch","onFilter","showSearch","showFilter","primaryAction"],[1,"p-4","rounded-lg",2,"background-color","var(--card-bg)"],[3,"onPageChange","columns","data","pagination","loading","emptyMessage"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"px-3","py-2","border","rounded-md","text-sm",3,"change","value"],["value",""],["value","sale"],["value","purchase"],["value","adjustment"],["value","theft"],["value","low"],["value","medium"],["value","high"],["value","critical"],["type","date",1,"px-3","py-2","border","rounded-md","text-sm",3,"change","value"],[1,"flex","gap-2"],[1,"text-sm","px-3","py-1","rounded","text-blue-600","hover:bg-blue-50",3,"click"]],template:function(e,n){if(e&1){let o=y();i(0,"div",1)(1,"app-action-toolbar",2),g("onSearch",function(C){return v(o),c(n.handleSearch(C))})("onFilter",function(){return v(o),c(n.showFilters=!n.showFilters)}),a(),w(2,B,36,34,"div",3),i(3,"app-table",4),g("onPageChange",function(C){return v(o),c(n.handlePageChange(C))}),w(4,P,4,3,"ng-template",null,0,T),a()()}e&2&&(t(),h("showSearch",!0)("showFilter",!0)("primaryAction",n.primaryAction),t(),M(n.showFilters?2:-1),t(),h("columns",n.columns)("data",n.movements)("pagination",n.pagination)("loading",n.loading)("emptyMessage","movements.empty"))},dependencies:[k,D,V,L],encapsulation:2})};export{F as MovementsListComponent};
