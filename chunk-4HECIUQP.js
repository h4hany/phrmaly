import{a as B}from"./chunk-WEX6ITFF.js";import"./chunk-TZMBWUW7.js";import"./chunk-4QDB3A4I.js";import"./chunk-M66DABPW.js";import{c as w,e as _,g as M,u as k}from"./chunk-YODUIR4B.js";import{a as O}from"./chunk-MMBAO3XL.js";import{a as I}from"./chunk-N5CA5YND.js";import{a as A}from"./chunk-CYU2XYT2.js";import{a as U}from"./chunk-BHTDODCV.js";import"./chunk-VSEEBRBA.js";import{a as x,b as E}from"./chunk-P3MRTKB5.js";import{Da as C,Oa as m,Q as g,Xb as T,Ya as l,Za as n,_a as u,bb as S,kb as p,lb as d,mb as P,rb as y,sb as b,tb as f,va as t,yb as o,zb as s}from"./chunk-Z4T7VGFQ.js";import{a as h,b as D}from"./chunk-7CGTOI24.js";var L=class v{analyticsService=g(B);translationService=g(x);loading=!1;metrics=null;startDate=new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0];endDate=new Date().toISOString().split("T")[0];signupsData={};activePharmaciesData={};subscriptionDistributionData={};featureUsageData={};chartOptions={};featureUsageTable=[];usageColumns=[{key:"module",label:"platform.analytics.module",sortable:!0},{key:"accountCount",label:"platform.analytics.accounts",sortable:!0},{key:"pharmacyCount",label:"platform.analytics.pharmacies",sortable:!0},{key:"usagePercentage",label:"platform.analytics.usage",sortable:!0},{key:"trend",label:"platform.analytics.trend",sortable:!0}];ngOnInit(){this.loadData()}loadData(){this.loading=!0;let i=new Date(this.startDate),a=new Date(this.endDate);this.analyticsService.getMetrics(i,a).subscribe({next:e=>{this.metrics=e,this.loadCharts(i,a),this.loadFeatureUsage(),this.loading=!1},error:()=>{this.loading=!1}})}loadCharts(i,a){this.analyticsService.getSignupsOverTime(i,a).subscribe({next:e=>{this.signupsData={labels:e.map(r=>r.date.toLocaleDateString()),datasets:[{label:"Signups",data:e.map(r=>r.count),borderColor:"rgba(22, 101, 52, 1)",backgroundColor:"rgba(22, 101, 52, 0.1)",fill:!0}]}}}),this.analyticsService.getActivePharmaciesOverTime(i,a).subscribe({next:e=>{this.activePharmaciesData={labels:e.map(r=>r.date.toLocaleDateString()),datasets:[{label:"Active Pharmacies",data:e.map(r=>r.count),borderColor:"rgba(59, 130, 246, 1)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0}]}}}),this.analyticsService.getSubscriptionDistribution().subscribe({next:e=>{this.subscriptionDistributionData={labels:e.map(r=>r.plan),datasets:[{data:e.map(r=>r.count),backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(22, 101, 52, 0.8)","rgba(245, 158, 11, 0.8)"]}]}}}),this.chartOptions={responsive:!0,maintainAspectRatio:!1}}loadFeatureUsage(){this.analyticsService.getFeatureUsage().subscribe({next:i=>{this.featureUsageTable=i.map(a=>D(h({},a),{module:this.translationService.translate(this.getModuleLabel(a.module)),usagePercentage:a.usagePercentage+"%",trend:this.translationService.translate(this.getTrendLabel(a.trend))})),this.featureUsageData={labels:i.map(a=>this.translationService.translate(this.getModuleLabel(a.module))),datasets:[{label:"Usage %",data:i.map(a=>a.usagePercentage),backgroundColor:"rgba(22, 101, 52, 0.8)"}]}}})}getModuleLabel(i){return{inventory:"platform.modules.inventory",hr:"platform.modules.hr",finance:"platform.modules.finance",automation:"platform.modules.automation",loyalty:"platform.modules.loyalty",api_access:"platform.modules.api_access",ai_features:"platform.modules.ai_features",analytics:"platform.modules.analytics"}[i]||i}getTrendLabel(i){return{up:"platform.analytics.trendUp",down:"platform.analytics.trendDown",stable:"platform.analytics.trendStable"}[i]||i}formatCurrency(i){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(i)}static \u0275fac=function(a){return new(a||v)};static \u0275cmp=C({type:v,selectors:[["app-platform-analytics"]],decls:57,vars:62,consts:[[1,"space-y-6"],[1,"text-2xl","font-bold","text-[var(--text-primary)]"],[1,"text-sm","text-[var(--card-text)]","mt-1"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"block","text-sm","font-medium","text-[var(--card-text)]","mb-1"],["type","date",1,"w-full","px-4","py-2","border","border-[var(--border-color)]","rounded-[var(--radius-md)]","text-sm","bg-[var(--card-bg)]","text-[var(--text-primary)]",3,"ngModelChange","ngModel"],[1,"flex","items-end"],["variant","primary","size","sm",3,"onClick"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[3,"label","value","icon"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-6"],[1,"text-lg","font-semibold","text-[var(--text-primary)]","mb-4"],[3,"type","data","options"],[3,"columns","data","loading","emptyMessage"]],template:function(a,e){a&1&&(l(0,"div",0)(1,"div")(2,"h1",1),p(3),o(4,"translate"),n(),l(5,"p",2),p(6),o(7,"translate"),n()(),l(8,"div",3)(9,"div",4)(10,"div")(11,"label",5),p(12),o(13,"translate"),n(),l(14,"input",6),f("ngModelChange",function(c){return b(e.startDate,c)||(e.startDate=c),c}),n()(),l(15,"div")(16,"label",5),p(17),o(18,"translate"),n(),l(19,"input",6),f("ngModelChange",function(c){return b(e.endDate,c)||(e.endDate=c),c}),n()(),l(20,"div",7)(21,"app-button",8),S("onClick",function(){return e.loadData()}),p(22),o(23,"translate"),n()()()(),l(24,"div",9),u(25,"app-stat-card",10)(26,"app-stat-card",10)(27,"app-stat-card",10)(28,"app-stat-card",10),n(),l(29,"div",11)(30,"div",12)(31,"h3",13),p(32),o(33,"translate"),n(),u(34,"app-chart",14),n(),l(35,"div",12)(36,"h3",13),p(37),o(38,"translate"),n(),u(39,"app-chart",14),n()(),l(40,"div",11)(41,"div",12)(42,"h3",13),p(43),o(44,"translate"),n(),u(45,"app-chart",14),n(),l(46,"div",12)(47,"h3",13),p(48),o(49,"translate"),n(),u(50,"app-chart",14),n()(),l(51,"div",12)(52,"h3",13),p(53),o(54,"translate"),n(),u(55,"app-table",15),o(56,"translate"),n()()),a&2&&(t(3),d(s(4,40,"platform.analytics.title")),t(3),d(s(7,42,"platform.analytics.subtitle")),t(6),d(s(13,44,"platform.analytics.startDate")),t(2),y("ngModel",e.startDate),t(3),d(s(18,46,"platform.analytics.endDate")),t(2),y("ngModel",e.endDate),t(3),P(" ",s(23,48,"common.search")," "),t(3),m("label","platform.analytics.totalAccounts")("value",(e.metrics==null?null:e.metrics.totalAccounts)||0)("icon","users"),t(),m("label","platform.analytics.activePharmacies")("value",(e.metrics==null?null:e.metrics.activePharmacies)||0)("icon","package"),t(),m("label","platform.analytics.monthlyRevenue")("value",e.formatCurrency((e.metrics==null?null:e.metrics.monthlyRevenue)||0))("icon","chart"),t(),m("label","platform.analytics.openTickets")("value",(e.metrics==null?null:e.metrics.openTickets)||0)("icon","alert"),t(4),d(s(33,50,"platform.analytics.signupsOverTime")),t(2),m("type","line")("data",e.signupsData)("options",e.chartOptions),t(3),d(s(38,52,"platform.analytics.activePharmaciesOverTime")),t(2),m("type","line")("data",e.activePharmaciesData)("options",e.chartOptions),t(4),d(s(44,54,"platform.analytics.subscriptionDistribution")),t(2),m("type","pie")("data",e.subscriptionDistributionData)("options",e.chartOptions),t(3),d(s(49,56,"platform.analytics.featureUsage")),t(2),m("type","bar")("data",e.featureUsageData)("options",e.chartOptions),t(3),d(s(54,58,"platform.analytics.featureAdoption")),t(2),m("columns",e.usageColumns)("data",e.featureUsageTable)("loading",e.loading)("emptyMessage",s(56,60,"platform.analytics.noData")))},dependencies:[T,k,w,_,M,I,O,E,A,U],encapsulation:2})};export{L as PlatformAnalyticsComponent};
