import{a as Y}from"./chunk-4L6R42C3.js";import{a as X}from"./chunk-EHIXNH23.js";import{a as K}from"./chunk-HZMAO6XJ.js";import{c as M,d,e as V,f as T,h as q,i as G,j as P,k as j,l as O,m as $,n as H,o as R,p as W,q as z,t as L,v as Q}from"./chunk-NWB6AJFO.js";import{a as J}from"./chunk-7YIMD4Q6.js";import{a as U}from"./chunk-WY32ECM4.js";import{b as D,d as w}from"./chunk-VPFLKGZN.js";import"./chunk-CYRIZKVF.js";import{$a as u,Ea as S,Ja as b,Pa as s,R as c,Ra as E,Ua as h,Va as I,Wb as k,X as _,Xa as y,Y as C,Ya as x,Z as v,Za as t,_ as F,_a as i,bb as A,cb as f,db as g,lb as o,mb as B,nb as N,wa as m}from"./chunk-W6WRXJJ4.js";import"./chunk-7CGTOI24.js";var ee=(a,e)=>e.id;function te(a,e){if(a&1&&u(0,"app-alert",1),a&2){let r=g();s("title",r.errorMessage)}}function re(a,e){a&1&&(t(0,"p",7),o(1,"Name is required"),i())}function ie(a,e){if(a&1&&(t(0,"option",26),o(1),i()),a&2){let r=e.$implicit;s("value",r.id),m(),B((r.generalDrug==null?null:r.generalDrug.name)||"Drug "+r.id)}}function ne(a,e){if(a&1){let r=A();t(0,"div",20)(1,"div",9)(2,"label",4),o(3,"Drug"),i(),t(4,"select",24)(5,"option",25),o(6,"Select Drug"),i(),y(7,ie,2,2,"option",26,ee),i()(),t(9,"div")(10,"label",4),o(11,"Quantity"),i(),t(12,"div",27),u(13,"input",28),t(14,"button",29),f("click",function(){let l=_(r).$index,p=g();return C(p.removeItem(l))}),v(),t(15,"svg",30),u(16,"path",31),i()()()()()}if(a&2){let r=e.$index,n=g();s("formGroupName",r),m(7),x(n.pharmacyDrugs)}}var Z=class a{fb=c(L);router=c(w);route=c(D);bundlesService=c(Y);drugsService=c(X);bundleForm;loading=!1;errorMessage="";isEdit=!1;bundleId=null;pharmacyDrugs=[];get itemsArray(){return this.bundleForm.get("items")}ngOnInit(){this.bundleId=this.route.snapshot.paramMap.get("id"),this.isEdit=!!this.bundleId,this.bundleForm=this.fb.group({name:["",[d.required]],fixedPrice:[0,[d.required,d.min(0)]],status:["active"],items:this.fb.array([])}),this.loadDrugs(),this.isEdit&&this.bundleId&&this.loadBundle()}loadDrugs(){this.drugsService.getPharmacyDrugs({page:1,pageSize:100}).subscribe({next:e=>{this.pharmacyDrugs=e.data}})}loadBundle(){this.bundlesService.getById(this.bundleId).subscribe({next:e=>{e&&(this.bundleForm.patchValue({name:e.name,fixedPrice:e.fixedPrice,status:e.status}),e.items.forEach(r=>{this.addItemWithData(r)}))},error:()=>{this.errorMessage="Failed to load bundle data"}})}addItem(){let e=this.fb.group({drugId:["",[d.required]],quantity:[1,[d.required,d.min(1)]]});this.itemsArray.push(e)}addItemWithData(e){let r=this.fb.group({drugId:[e.drugId,[d.required]],quantity:[e.quantity,[d.required,d.min(1)]]});this.itemsArray.push(r)}removeItem(e){this.itemsArray.removeAt(e)}onSubmit(){if(this.bundleForm.valid&&this.itemsArray.length>0){this.loading=!0,this.errorMessage="";let e=this.bundleForm.value,r={name:e.name,fixedPrice:e.fixedPrice,status:e.status,items:e.items,pharmacyId:"ph1"};(this.isEdit?this.bundlesService.update(this.bundleId,r):this.bundlesService.create(r)).subscribe({next:()=>{this.router.navigate(["/bundles"])},error:l=>{this.errorMessage=l.message||"An error occurred while saving",this.loading=!1}})}else Object.keys(this.bundleForm.controls).forEach(e=>{this.bundleForm.get(e)?.markAsTouched()})}onCancel(){this.router.navigate(["/bundles"])}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=S({type:a,selectors:[["app-bundle-form"]],decls:41,vars:9,consts:[[3,"title"],["type","error",3,"title"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["type","text","formControlName","name",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],[1,"mt-1","text-sm","text-red-600"],["type","number","formControlName","fixedPrice","step","0.01","min","0",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],[1,"md:col-span-2"],["formControlName","status",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["value","active"],["value","inactive"],[1,"border-t","pt-6"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-medium","text-gray-900"],["type","button","variant","outline","size","sm",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["formArrayName","items",1,"space-y-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","p-4","bg-gray-50","rounded-[var(--radius-md)]",3,"formGroupName"],[1,"flex","items-center","justify-end","gap-4","pt-6","border-t"],["type","button","variant","outline",3,"onClick"],["type","submit","variant","primary",3,"loading","disabled"],["formControlName","drugId",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["value",""],[3,"value"],[1,"flex","gap-2"],["type","number","formControlName","quantity","min","1",1,"flex-1","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","button",1,"p-2","text-red-600","hover:text-red-800",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"]],template:function(r,n){if(r&1&&(t(0,"app-form-wrapper",0),b(1,te,1,1,"app-alert",1),t(2,"form",2),f("ngSubmit",function(){return n.onSubmit()}),t(3,"div",3)(4,"div")(5,"label",4),o(6," Name "),t(7,"span",5),o(8,"*"),i()(),u(9,"input",6),b(10,re,2,0,"p",7),i(),t(11,"div")(12,"label",4),o(13," Fixed Price "),t(14,"span",5),o(15,"*"),i()(),u(16,"input",8),i(),t(17,"div",9)(18,"label",4),o(19,"Status"),i(),t(20,"select",10)(21,"option",11),o(22,"Active"),i(),t(23,"option",12),o(24,"Inactive"),i()()()(),t(25,"div",13)(26,"div",14)(27,"h3",15),o(28,"Bundle Items"),i(),t(29,"app-button",16),f("onClick",function(){return n.addItem()}),v(),t(30,"svg",17),u(31,"path",18),i(),o(32," Add Item "),i()(),F(),t(33,"div",19),y(34,ne,17,1,"div",20,I),i()(),t(36,"div",21)(37,"app-button",22),f("onClick",function(){return n.onCancel()}),o(38," Cancel "),i(),t(39,"app-button",23),o(40),i()()()()),r&2){let l,p;s("title",n.isEdit?"Edit Bundle":"Add New Bundle"),m(),h(n.errorMessage?1:-1),m(),s("formGroup",n.bundleForm),m(7),E("border-red-500",((l=n.bundleForm.get("name"))==null?null:l.invalid)&&((l=n.bundleForm.get("name"))==null?null:l.touched)),m(),h((p=n.bundleForm.get("name"))!=null&&p.invalid&&((p=n.bundleForm.get("name"))!=null&&p.touched)?10:-1),m(24),x(n.itemsArray.controls),m(5),s("loading",n.loading)("disabled",n.bundleForm.invalid||n.itemsArray.length===0),m(),N(" ",n.isEdit?"Update":"Create"," Bundle ")}},dependencies:[k,Q,q,R,W,M,G,H,V,T,z,P,$,j,O,K,J,U],encapsulation:2})};export{Z as BundleFormComponent};
