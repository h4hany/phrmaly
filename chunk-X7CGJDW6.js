import{a as p}from"./chunk-ASC66LS3.js";import{a as s}from"./chunk-T542ZMY7.js";import{K as d,Q as h,i,y as n}from"./chunk-E4S7NVXB.js";import{a as o,b as m}from"./chunk-C6Q5SG76.js";var u=class c{apiService=h(p);pharmacyContextService=h(s);mockVouchers=this.initializeMockVouchers();initializeMockVouchers(){let e={id:"ph1",name:"Main Pharmacy",address:"123 Main St",phone:"+1234567890",email:"main@pharmly.com",primaryColor:"#166534",secondaryColor:"#22c55e",sidebarColor:"#14532d",rtlEnabled:!1},t=[{id:"PAT001",fullName:"John Smith",dateOfBirth:new Date("1985-05-15"),gender:"male",phone:"+201116811410",email:"john.smith@example.com",address:{city:"New York",area:"Manhattan",street:"123 Main St",notes:"Apartment 4B"},occupation:"Engineer",medicalNotes:"Allergic to penicillin",cardId:"PC-2024-001234",validUntil:new Date("2025-12-31"),issuedDate:new Date("2024-01-15"),createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-11-27")},{id:"PAT002",fullName:"Jane Doe",dateOfBirth:new Date("1990-08-22"),gender:"female",phone:"+201116811410",email:"jane.doe@example.com",address:{city:"Los Angeles",area:"Beverly Hills",street:"456 Oak Ave",notes:""},occupation:"Teacher",medicalNotes:"",cardId:"PC-2024-001235",validUntil:new Date("2025-11-30"),issuedDate:new Date("2024-02-10"),createdAt:new Date("2024-02-10"),updatedAt:new Date("2024-11-26")},{id:"PAT003",fullName:"Michael Johnson",dateOfBirth:new Date("1978-12-03"),gender:"male",phone:"+201116811410",email:"michael.j@example.com",address:{city:"Chicago",area:"Downtown",street:"789 Pine Rd",notes:""},occupation:"Doctor",medicalNotes:"Diabetes Type 2",cardId:"PC-2024-001236",validUntil:new Date("2026-03-20"),issuedDate:new Date("2024-03-20"),createdAt:new Date("2024-03-20"),updatedAt:new Date("2024-11-25")}],a=new Date,r=new Date(a.getTime()+90*24*60*60*1e3),l=new Date(a.getTime()+180*24*60*60*1e3),v=new Date(a.getTime()-30*24*60*60*1e3),y=new Date(a.getTime()-60*24*60*60*1e3);return[{voucherName:"PAT001-Main Pharmacy-VCH001",voucherCode:"VCH001",createdAt:new Date("2024-11-01"),validUntil:r,amount:150,patient:t[0],pharmacy:e},{voucherName:"PAT001-Main Pharmacy-VCH002",voucherCode:"VCH002",createdAt:new Date("2024-11-15"),validUntil:l,amount:250.5,patient:t[0],pharmacy:e},{voucherName:"PAT002-Main Pharmacy-VCH003",voucherCode:"VCH003",createdAt:new Date("2024-10-20"),validUntil:r,amount:75.25,patient:t[1],pharmacy:e},{voucherName:"PAT002-Main Pharmacy-VCH004",voucherCode:"VCH004",createdAt:new Date("2024-11-20"),validUntil:r,amount:300,patient:t[1],pharmacy:e},{voucherName:"PAT003-Main Pharmacy-VCH005",voucherCode:"VCH005",createdAt:new Date("2024-09-10"),validUntil:v,amount:100,patient:t[2],pharmacy:e},{voucherName:"PAT003-Main Pharmacy-VCH006",voucherCode:"VCH006",createdAt:new Date("2024-11-25"),validUntil:r,amount:500.75,patient:t[2],pharmacy:e},{voucherName:"PAT001-Main Pharmacy-VCH007",voucherCode:"VCH007",createdAt:new Date("2024-08-15"),validUntil:y,amount:200,patient:t[0],pharmacy:e},{voucherName:"PAT002-Main Pharmacy-VCH008",voucherCode:"VCH008",createdAt:new Date("2024-11-28"),validUntil:r,amount:125.5,patient:t[1],pharmacy:e}]}getAll(e){let t=this.pharmacyContextService.getCurrentPharmacy(),a=this.mockVouchers.filter(r=>!t||r.pharmacy.id===t.id).map(r=>this.mapToListItem(r));return e?.patientId&&(a=a.filter(r=>r.patientId===e.patientId)),i({data:a,message:"Vouchers retrieved successfully"}).pipe(n(300))}getById(e){let t=this.mockVouchers.find(a=>a.voucherCode===e||a.voucherName===e);return i(t||null).pipe(n(200))}getByPatientId(e){let t=this.pharmacyContextService.getCurrentPharmacy(),a=this.mockVouchers.filter(r=>r.patient.id===e&&(!t||r.pharmacy.id===t.id));return i(a).pipe(n(200))}create(e){let t=m(o({},e),{createdAt:new Date,validUntil:new Date(Date.now()+7776e6)});return this.mockVouchers.push(t),i(t).pipe(n(300))}update(e,t){let a=this.mockVouchers.findIndex(r=>r.voucherCode===e||r.voucherName===e);if(a===-1)throw new Error("Voucher not found");return this.mockVouchers[a]=m(o(o({},this.mockVouchers[a]),t),{voucherCode:this.mockVouchers[a].voucherCode,voucherName:this.mockVouchers[a].voucherName}),i(this.mockVouchers[a]).pipe(n(300))}delete(e){let t=this.mockVouchers.findIndex(a=>a.voucherCode===e||a.voucherName===e);return t===-1?i(!1).pipe(n(200)):(this.mockVouchers.splice(t,1),i(!0).pipe(n(300)))}mapToListItem(e){let t=new Date,a="active";return e.validUntil<t&&(a="expired"),{id:e.voucherCode,voucherCode:e.voucherCode,voucherName:e.voucherName,patientId:e.patient.id,patientName:e.patient.fullName,pharmacyId:e.pharmacy.id,pharmacyName:e.pharmacy.name,amount:e.amount,createdAt:e.createdAt,validUntil:e.validUntil,status:a}}static \u0275fac=function(t){return new(t||c)};static \u0275prov=d({token:c,factory:c.\u0275fac,providedIn:"root"})};export{u as a};
