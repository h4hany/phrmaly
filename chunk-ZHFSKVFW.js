import{a as $}from"./chunk-HBN3G5OJ.js";import{a as Z}from"./chunk-QDLVDHOW.js";import{e as G,g as H,o as j,p as J,q,w as K}from"./chunk-TK76J465.js";import{a as B}from"./chunk-6CFKC637.js";import{a as X}from"./chunk-B5SRLSM4.js";import{a as Q}from"./chunk-EIOKHCL2.js";import{a as Y}from"./chunk-5PFWNSG3.js";import{a as W,b as T}from"./chunk-3UJCRMW3.js";import{$a as a,Ab as o,Bb as s,Fa as E,Ka as P,Q as V,Qa as v,Sa as N,Ua as w,Va as S,W as g,X as f,Y as _,Ya as L,Z as C,Za as R,_a as n,_b as I,ab as x,cb as y,da as F,db as b,eb as m,mb as l,nb as d,ob as h,pb as U,tb as A,ub as O,vb as z,wa as e}from"./chunk-E4S7NVXB.js";import{a as M,b as D}from"./chunk-C6Q5SG76.js";function nt(p,i){p&1&&(n(0,"app-badge",3),l(1),o(2,"translate"),a()),p&2&&(e(),d(s(2,1,"platform.plan.enterprise")))}function at(p,i){if(p&1){let t=y();n(0,"div",13)(1,"app-button",14),b("onClick",function(){g(t);let c=m();return f(c.onSelect.emit(c.plan))}),l(2),o(3,"translate"),a(),n(4,"app-button",15),b("onClick",function(){g(t);let c=m();return f(c.onEdit.emit(c.plan))}),l(5),o(6,"translate"),a()()}p&2&&(e(2),h(" ",s(3,2,"platform.plan.select")," "),e(3),h(" ",s(6,4,"common.edit")," "))}var k=class p{plan;highlighted=!1;showActions=!0;onSelect=new F;onEdit=new F;formatPrice(i){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(i)}static \u0275fac=function(t){return new(t||p)};static \u0275cmp=E({type:p,selectors:[["app-plan-card"]],inputs:{plan:"plan",highlighted:"highlighted",showActions:"showActions"},outputs:{onSelect:"onSelect",onEdit:"onEdit"},decls:36,vars:28,consts:[[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-6","border-2"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-xl","font-bold","text-[var(--text-primary)]"],["variant","warning"],[1,"text-sm","text-[var(--card-text)]","mb-4"],[1,"mb-6"],[1,"text-3xl","font-bold","text-[var(--text-primary)]"],[1,"text-sm","text-[var(--card-text)]"],[1,"space-y-3","mb-6"],[1,"flex","items-center","gap-2","text-sm"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-green-600"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"text-[var(--text-primary)]"],[1,"flex","gap-2"],["variant","primary","size","sm",1,"flex-1",3,"onClick"],["variant","outline","size","sm",3,"onClick"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"div",1)(2,"h3",2),l(3),a(),P(4,nt,3,3,"app-badge",3),a(),n(5,"p",4),l(6),a(),n(7,"div",5)(8,"span",6),l(9),a(),n(10,"span",7),l(11),o(12,"translate"),o(13,"translate"),a()(),n(14,"div",8)(15,"div",9),_(),n(16,"svg",10),x(17,"path",11),a(),C(),n(18,"span",12),l(19),o(20,"translate"),o(21,"translate"),a()(),n(22,"div",9),_(),n(23,"svg",10),x(24,"path",11),a(),C(),n(25,"span",12),l(26),o(27,"translate"),o(28,"translate"),a()(),n(29,"div",9),_(),n(30,"svg",10),x(31,"path",11),a(),C(),n(32,"span",12),l(33),o(34,"translate"),a()()(),P(35,at,7,6,"div",13),a()),t&2&&(N("border-[var(--primary-color)]",r.highlighted)("border-transparent",!r.highlighted),e(3),d(r.plan.name),e(),S(r.plan.tier==="enterprise"?4:-1),e(2),d(r.plan.description),e(3),d(r.formatPrice(r.plan.price)),e(2),h("/",r.plan.billingCycle==="monthly"?s(12,14,"platform.plan.month"):s(13,16,"platform.plan.year"),""),e(8),d(r.plan.maxPharmacies===-1?s(20,18,"platform.plan.unlimitedPharmacies"):r.plan.maxPharmacies+" "+s(21,20,"platform.plan.pharmacies")),e(7),d(r.plan.maxStaff===-1?s(27,22,"platform.plan.unlimitedStaff"):r.plan.maxStaff+" "+s(28,24,"platform.plan.staff")),e(7),U("",r.plan.enabledModules.length," ",s(34,26,"platform.plan.modules"),""),e(2),S(r.showActions?35:-1))},dependencies:[I,T,B,Y],encapsulation:2})};var rt=(p,i)=>i.id;function ot(p,i){if(p&1){let t=y();n(0,"app-plan-card",17),b("onSelect",function(){let c=g(t).$implicit,u=m(2);return f(u.assignPlan(c))})("onEdit",function(){let c=g(t).$implicit,u=m(2);return f(u.editPlan(c))}),a()}if(p&2){let t=i.$implicit;v("plan",t)("highlighted",t.tier==="enterprise")("showActions",!0)}}function st(p,i){if(p&1&&(n(0,"div",14),L(1,ot,1,3,"app-plan-card",16,rt),a()),p&2){let t=m();e(),R(t.plans)}}function lt(p,i){if(p&1){let t=y();n(0,"div",15)(1,"div",1)(2,"div",18)(3,"select",19),z("ngModelChange",function(c){g(t);let u=m();return O(u.subscriptionFilters.status,c)||(u.subscriptionFilters.status=c),f(c)}),n(4,"option",20),l(5),o(6,"translate"),a(),n(7,"option",21),l(8),o(9,"translate"),a(),n(10,"option",22),l(11),o(12,"translate"),a(),n(13,"option",23),l(14),o(15,"translate"),a()()()(),n(16,"app-table",24),o(17,"translate"),b("onPageChange",function(c){g(t);let u=m();return f(u.onSubscriptionPageChange(c))}),a()()}if(p&2){let t=m();e(3),A("ngModel",t.subscriptionFilters.status),e(2),d(s(6,10,"common.all")),e(3),d(s(9,12,"platform.subscriptions.statusActive")),e(3),d(s(12,14,"platform.subscriptions.statusTrial")),e(3),d(s(15,16,"platform.subscriptions.statusCancelled")),e(2),v("columns",t.subscriptionColumns)("data",t.subscriptions)("pagination",t.subscriptionPagination)("loading",t.loading)("emptyMessage",s(17,18,"platform.subscriptions.noSubscriptions"))}}function pt(p,i){if(p&1){let t=y();n(0,"div",15)(1,"div",1)(2,"div",18)(3,"select",19),z("ngModelChange",function(c){g(t);let u=m();return O(u.invoiceFilters.status,c)||(u.invoiceFilters.status=c),f(c)}),n(4,"option",20),l(5),o(6,"translate"),a(),n(7,"option",25),l(8),o(9,"translate"),a(),n(10,"option",26),l(11),o(12,"translate"),a(),n(13,"option",27),l(14),o(15,"translate"),a()()()(),n(16,"app-table",24),o(17,"translate"),b("onPageChange",function(c){g(t);let u=m();return f(u.onInvoicePageChange(c))}),a()()}if(p&2){let t=m();e(3),A("ngModel",t.invoiceFilters.status),e(2),d(s(6,10,"common.all")),e(3),d(s(9,12,"platform.subscriptions.invoicePaid")),e(3),d(s(12,14,"platform.subscriptions.invoiceOpen")),e(3),d(s(15,16,"platform.subscriptions.invoiceUncollectible")),e(2),v("columns",t.invoiceColumns)("data",t.invoices)("pagination",t.invoicePagination)("loading",t.loading)("emptyMessage",s(17,18,"platform.subscriptions.noInvoices"))}}function ct(p,i){if(p&1&&(n(0,"div",0)(1,"div",28)(2,"div",29)(3,"h3",30),l(4),o(5,"translate"),a(),x(6,"app-chart",31),a(),n(7,"div",29)(8,"h3",30),l(9),o(10,"translate"),a(),x(11,"app-chart",31),a(),n(12,"div",29)(13,"h3",30),l(14),o(15,"translate"),a(),x(16,"app-chart",31),a()()()),p&2){let t=m();e(4),d(s(5,12,"platform.subscriptions.mrrGrowth")),e(2),v("type","line")("data",t.mrrData)("options",t.chartOptions),e(3),d(s(10,14,"platform.subscriptions.churnRate")),e(2),v("type","bar")("data",t.churnData)("options",t.chartOptions),e(3),d(s(15,16,"platform.subscriptions.revenueByPlan")),e(2),v("type","pie")("data",t.revenueByPlanData)("options",t.chartOptions)}}var tt=class p{subscriptionsService=V($);translationService=V(W);loading=!1;activeTab="plans";plans=[];subscriptions=[];invoices=[];mrr=32860;totalSubscriptions=0;activeSubscriptions=0;churnRate=2.5;subscriptionFilters={status:""};invoiceFilters={status:""};subscriptionPagination={page:1,pageSize:10,total:0,totalPages:0};invoicePagination={page:1,pageSize:10,total:0,totalPages:0};subscriptionColumns=[{key:"accountId",label:"platform.subscriptions.account",sortable:!0},{key:"planId",label:"platform.subscriptions.plan",sortable:!0},{key:"status",label:"platform.subscriptions.status",sortable:!0},{key:"currentPeriodEnd",label:"platform.subscriptions.nextBilling",sortable:!0}];invoiceColumns=[{key:"invoiceNumber",label:"platform.subscriptions.invoiceNumber",sortable:!0},{key:"accountId",label:"platform.subscriptions.account",sortable:!0},{key:"amount",label:"platform.subscriptions.amount",sortable:!0},{key:"status",label:"platform.subscriptions.status",sortable:!0},{key:"dueDate",label:"platform.subscriptions.dueDate",sortable:!0}];showCreatePlanModal=!1;mrrData={};churnData={};revenueByPlanData={};chartOptions={};ngOnInit(){this.loadPlans(),this.loadSubscriptions(),this.loadInvoices(),this.loadAnalytics()}loadPlans(){this.loading=!0,this.subscriptionsService.getPlans().subscribe({next:i=>{this.plans=i.data,this.loading=!1},error:()=>{this.loading=!1}})}loadSubscriptions(){this.loading=!0,this.subscriptionsService.getSubscriptions({page:this.subscriptionPagination.page,pageSize:this.subscriptionPagination.pageSize,status:this.subscriptionFilters.status||void 0}).subscribe({next:i=>{this.subscriptions=i.data.map(t=>D(M({},t),{status:this.translationService.translate(this.getStatusBadge(t.status)),currentPeriodEnd:new Date(t.currentPeriodEnd).toLocaleDateString()})),this.subscriptionPagination={page:i.page,pageSize:i.pageSize,total:i.total,totalPages:i.totalPages},this.totalSubscriptions=i.total,this.activeSubscriptions=i.data.filter(t=>t.status==="active").length,this.loading=!1},error:()=>{this.loading=!1}})}loadInvoices(){this.loading=!0,this.subscriptionsService.getInvoices({page:this.invoicePagination.page,pageSize:this.invoicePagination.pageSize,status:this.invoiceFilters.status||void 0}).subscribe({next:i=>{this.invoices=i.data.map(t=>D(M({},t),{amount:this.formatCurrency(t.amount),status:this.translationService.translate(this.getInvoiceStatusBadge(t.status)),dueDate:new Date(t.dueDate).toLocaleDateString()})),this.invoicePagination={page:i.page,pageSize:i.pageSize,total:i.total,totalPages:i.totalPages},this.loading=!1},error:()=>{this.loading=!1}})}loadAnalytics(){this.mrrData={labels:["Jan","Feb","Mar","Apr","May","Jun"],datasets:[{label:"MRR",data:[25e3,27e3,29e3,31e3,32e3,32860],borderColor:"rgba(22, 101, 52, 1)",backgroundColor:"rgba(22, 101, 52, 0.1)",fill:!0}]},this.churnData={labels:["Jan","Feb","Mar","Apr","May","Jun"],datasets:[{label:"Churn Rate %",data:[3.2,2.8,2.5,2.3,2.4,2.5],backgroundColor:"rgba(245, 158, 11, 0.8)"}]},this.revenueByPlanData={labels:["Starter","Professional","Enterprise"],datasets:[{data:[7920,14950,9990],backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(22, 101, 52, 0.8)","rgba(245, 158, 11, 0.8)"]}]},this.chartOptions={responsive:!0,maintainAspectRatio:!1}}onSubscriptionPageChange(i){this.subscriptionPagination.page=i,this.loadSubscriptions()}onInvoicePageChange(i){this.invoicePagination.page=i,this.loadInvoices()}assignPlan(i){console.log("Assign plan:",i)}editPlan(i){console.log("Edit plan:",i)}getStatusBadge(i){return{active:"platform.subscriptions.statusActive",trial:"platform.subscriptions.statusTrial",cancelled:"platform.subscriptions.statusCancelled",expired:"platform.subscriptions.statusCancelled",past_due:"platform.subscriptions.statusCancelled"}[i]||i}getInvoiceStatusBadge(i){return{paid:"platform.subscriptions.invoicePaid",open:"platform.subscriptions.invoiceOpen",uncollectible:"platform.subscriptions.invoiceUncollectible",draft:"platform.subscriptions.invoiceOpen",void:"platform.subscriptions.invoiceOpen"}[i]||i}formatCurrency(i){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(i)}static \u0275fac=function(t){return new(t||p)};static \u0275cmp=E({type:p,selectors:[["app-subscriptions"]],decls:39,vars:45,consts:[[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-[var(--text-primary)]"],[1,"text-sm","text-[var(--card-text)]","mt-1"],["variant","primary",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[3,"label","value","icon"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]"],[1,"border-b","border-[var(--border-color)]"],[1,"flex","-mb-px"],[1,"px-6","py-4","border-b-2","font-medium","text-sm","transition-colors",3,"click"],[1,"p-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"space-y-4"],[3,"plan","highlighted","showActions"],[3,"onSelect","onEdit","plan","highlighted","showActions"],[1,"flex","gap-2"],[1,"px-4","py-2","border","border-[var(--border-color)]","rounded-[var(--radius-md)]","text-sm","bg-[var(--card-bg)]","text-[var(--text-primary)]",3,"ngModelChange","ngModel"],["value",""],["value","active"],["value","trial"],["value","cancelled"],[3,"onPageChange","columns","data","pagination","loading","emptyMessage"],["value","paid"],["value","open"],["value","uncollectible"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-6"],[1,"text-lg","font-semibold","text-[var(--text-primary)]","mb-4"],[3,"type","data","options"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),l(4),o(5,"translate"),a(),n(6,"p",3),l(7),o(8,"translate"),a()(),n(9,"app-button",4),b("onClick",function(){return r.showCreatePlanModal=!0}),_(),n(10,"svg",5),x(11,"path",6),a(),l(12),o(13,"translate"),a()(),C(),n(14,"div",7),x(15,"app-stat-card",8)(16,"app-stat-card",8)(17,"app-stat-card",8)(18,"app-stat-card",8),a(),n(19,"div",9)(20,"div",10)(21,"nav",11)(22,"button",12),b("click",function(){return r.activeTab="plans"}),l(23),o(24,"translate"),a(),n(25,"button",12),b("click",function(){return r.activeTab="subscriptions"}),l(26),o(27,"translate"),a(),n(28,"button",12),b("click",function(){return r.activeTab="invoices"}),l(29),o(30,"translate"),a(),n(31,"button",12),b("click",function(){return r.activeTab="analytics"}),l(32),o(33,"translate"),a()()(),n(34,"div",13),P(35,st,3,0,"div",14)(36,lt,18,20,"div",15)(37,pt,18,20,"div",15)(38,ct,17,18,"div",0),a()()()),t&2&&(e(4),d(s(5,31,"platform.subscriptions.title")),e(3),d(s(8,33,"platform.subscriptions.subtitle")),e(5),h(" ",s(13,35,"platform.subscriptions.createPlan")," "),e(3),v("label","platform.subscriptions.mrr")("value",r.formatCurrency(r.mrr))("icon","chart"),e(),v("label","platform.subscriptions.totalSubscriptions")("value",r.totalSubscriptions)("icon","credit-card"),e(),v("label","platform.subscriptions.activeSubscriptions")("value",r.activeSubscriptions)("icon","check-circle"),e(),v("label","platform.subscriptions.churnRate")("value",r.churnRate+"%")("icon","alert"),e(4),w(r.activeTab==="plans"?"border-[var(--primary-color)] text-[var(--primary-color)]":"border-transparent text-[var(--card-text)] hover:text-[var(--text-primary)]"),e(),h(" ",s(24,37,"platform.subscriptions.plans")," "),e(2),w(r.activeTab==="subscriptions"?"border-[var(--primary-color)] text-[var(--primary-color)]":"border-transparent text-[var(--card-text)] hover:text-[var(--text-primary)]"),e(),h(" ",s(27,39,"platform.subscriptions.subscriptions")," "),e(2),w(r.activeTab==="invoices"?"border-[var(--primary-color)] text-[var(--primary-color)]":"border-transparent text-[var(--card-text)] hover:text-[var(--text-primary)]"),e(),h(" ",s(30,41,"platform.subscriptions.invoices")," "),e(2),w(r.activeTab==="analytics"?"border-[var(--primary-color)] text-[var(--primary-color)]":"border-transparent text-[var(--card-text)] hover:text-[var(--text-primary)]"),e(),h(" ",s(33,43,"platform.subscriptions.analytics")," "),e(3),S(r.activeTab==="plans"?35:-1),e(),S(r.activeTab==="subscriptions"?36:-1),e(),S(r.activeTab==="invoices"?37:-1),e(),S(r.activeTab==="analytics"?38:-1))},dependencies:[I,K,J,q,j,G,H,Z,B,T,k,Q,X],encapsulation:2})};export{tt as SubscriptionsComponent};
