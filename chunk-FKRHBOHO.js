import{a as O}from"./chunk-XL3XUQKI.js";import{a as z}from"./chunk-FXA7JHBB.js";import{a as D}from"./chunk-GHDX2O3N.js";import"./chunk-C4LLEIGY.js";import"./chunk-BYXBJQAS.js";import{a as L}from"./chunk-JBZ5JDSH.js";import"./chunk-ONVEZIWC.js";import{a as B}from"./chunk-K7KLI742.js";import{b as V}from"./chunk-7YN2F2UA.js";import{d as T}from"./chunk-J2A4D5WT.js";import{Cb as k,Da as P,Ia as I,K as x,Oa as _,Q as l,W as u,Wb as E,X as p,Ya as d,Za as g,ab as A,bb as h,cb as w,i as s,kb as R,mb as S,va as c,y as m,yb as b,zb as y}from"./chunk-ILVQMZIM.js";import{a as f,b as v}from"./chunk-7CGTOI24.js";var C=class o{pharmacyContextService=l(D);eventBus=l(z);rules=[{id:"AUT001",pharmacyId:"ph1",name:"Auto Reorder Low Stock",description:"Automatically create purchase order when stock falls below minimum",trigger:"stock_low",triggerConditions:{threshold:"minimum"},action:"reorder",actionConfig:{supplierId:"supplier1"},status:"active",priority:1,enabled:!0,executionCount:12,createdAt:new Date("2024-10-01"),updatedAt:new Date("2024-11-20"),createdBy:"admin"}];getRules(t){let e=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!e)return s({data:[],total:0,page:1,pageSize:10,totalPages:0}).pipe(m(300));let a=this.rules.filter($=>$.pharmacyId===e),i=t?.page||1,n=t?.pageSize||10,r=(i-1)*n,j=r+n,N=a.slice(r,j);return s({data:N,total:a.length,page:i,pageSize:n,totalPages:Math.ceil(a.length/n)}).pipe(m(500))}createRule(t){let e=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!e)throw new Error("No pharmacy context");let a=v(f({},t),{id:`AUT${String(this.rules.length+1).padStart(3,"0")}`,pharmacyId:e,executionCount:0,createdAt:new Date,updatedAt:new Date});return this.rules.push(a),this.eventBus.emit({type:"automation_rule_created",payload:a,source:"automation-engine"}),s(a).pipe(m(500))}updateRule(t,e){let a=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!a)throw new Error("No pharmacy context");let i=this.rules.findIndex(n=>n.id===t&&n.pharmacyId===a);if(i===-1)throw new Error("Rule not found");return this.rules[i]=v(f(f({},this.rules[i]),e),{updatedAt:new Date}),s(this.rules[i]).pipe(m(500))}toggleRule(t,e){return this.updateRule(t,{enabled:e})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=x({token:o,factory:o.\u0275fac,providedIn:"root"})};function U(o,t){if(o&1){let e=A();d(0,"div",4)(1,"app-button",5),h("onClick",function(){let i=u(e).$implicit,n=w();return p(n.toggleRule(i))}),R(2),b(3,"translate"),b(4,"translate"),g(),d(5,"app-button",5),h("onClick",function(){let i=u(e).$implicit,n=w();return p(n.viewDetail(i.id))}),R(6),b(7,"translate"),g()()}if(o&2){let e=t.$implicit;c(2),S(" ",e.enabled?y(3,2,"automation.disable"):y(4,4,"automation.enable")," "),c(4),S(" ",y(7,6,"common.view")," ")}}var M=class o{automationEngine=l(C);router=l(T);rules=[];loading=!1;pagination=null;columns=[{key:"name",label:"automation.name",sortable:!0},{key:"trigger",label:"automation.trigger"},{key:"action",label:"automation.action"},{key:"status",label:"automation.status"},{key:"enabled",label:"automation.enabled"},{key:"executionCount",label:"automation.executions"}];primaryAction={label:"automation.new",onClick:()=>this.router.navigate(["/system/automation/new"]),variant:"primary"};ngOnInit(){this.loadRules()}loadRules(){this.loading=!0,this.automationEngine.getRules({page:1,pageSize:10}).subscribe({next:t=>{this.rules=t.data,this.pagination={page:t.page,pageSize:t.pageSize,total:t.total,totalPages:t.totalPages},this.loading=!1},error:()=>{this.loading=!1}})}handlePageChange(t){this.pagination&&(this.pagination.page=t,this.loadRules())}handleSearch(t){this.loadRules()}toggleRule(t){this.automationEngine.toggleRule(t.id,!t.enabled).subscribe({next:()=>{this.loadRules()}})}viewDetail(t){console.log("View rule:",t)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=P({type:o,selectors:[["app-automation-list"]],decls:5,vars:7,consts:[["actionTemplate",""],[1,"space-y-6"],["title","automation.title",3,"onSearch","showSearch","primaryAction"],[3,"onPageChange","columns","data","pagination","loading","emptyMessage"],[1,"flex","gap-2"],["variant","outline","size","sm",3,"onClick"]],template:function(e,a){if(e&1){let i=A();d(0,"div",1)(1,"app-action-toolbar",2),h("onSearch",function(r){return u(i),p(a.handleSearch(r))}),g(),d(2,"app-table",3),h("onPageChange",function(r){return u(i),p(a.handlePageChange(r))}),I(3,U,8,8,"ng-template",null,0,k),g()()}e&2&&(c(),_("showSearch",!0)("primaryAction",a.primaryAction),c(),_("columns",a.columns)("data",a.rules)("pagination",a.pagination)("loading",a.loading)("emptyMessage","automation.empty"))},dependencies:[E,L,O,B,V],encapsulation:2})};export{M as AutomationListComponent};
