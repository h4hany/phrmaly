import{a as se}from"./chunk-NMDNQUB4.js";import{a as le}from"./chunk-O3HD32UM.js";import{a as re}from"./chunk-QDLVDHOW.js";import{a as oe}from"./chunk-JYPY3KCN.js";import{e as K,g as Q,o as X,p as Y,q as Z,w as ee}from"./chunk-TK76J465.js";import{a as te}from"./chunk-6CFKC637.js";import{a as ne}from"./chunk-B5SRLSM4.js";import{a as ie}from"./chunk-EIOKHCL2.js";import"./chunk-5PFWNSG3.js";import{a as ae}from"./chunk-T542ZMY7.js";import"./chunk-URFUYTQU.js";import"./chunk-BYXBJQAS.js";import{b as k}from"./chunk-3UJCRMW3.js";import"./chunk-C3O3TVFX.js";import{$a as n,Ab as p,Bb as d,Fa as B,K as V,Ka as w,Q as P,Qa as v,Ua as J,Va as C,W as j,X as U,Y as W,Ya as $,Z as G,Za as H,_a as r,_b as A,ab as I,cb as q,db as D,eb as b,i as y,mb as l,nb as m,ob as S,tb as N,ub as O,vb as F,wa as i,y as u}from"./chunk-E4S7NVXB.js";import{a as _,b as R}from"./chunk-C6Q5SG76.js";var M=class s{pharmacyContextService=P(ae);invoicesService=P(le);salaryRules=[{id:"SR001",pharmacyId:"ph1",staffId:"ST001",baseSalary:5e3,currency:"USD",effectiveFrom:new Date("2024-01-01"),isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),createdBy:"admin"},{id:"SR002",pharmacyId:"ph1",role:"pharmacy_staff",baseSalary:3e3,currency:"USD",effectiveFrom:new Date("2024-01-01"),isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),createdBy:"admin"}];commissionRules=[{id:"CR001",pharmacyId:"ph1",role:"pharmacy_staff",type:"percentage",value:2,appliesTo:"all_sales",effectiveFrom:new Date("2024-01-01"),isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),createdBy:"admin"}];payrollRecords=[{id:"PR001",pharmacyId:"ph1",staffId:"ST001",staffName:"Sarah Johnson",period:{startDate:new Date("2024-11-01"),endDate:new Date("2024-11-30")},baseSalary:5e3,commission:250,bonuses:100,deductions:0,totalEarnings:5350,netPay:5350,currency:"USD",status:"approved",paymentDate:new Date("2024-12-01"),paymentMethod:"bank_transfer",breakdown:{baseSalary:5e3,commission:{total:250,sales:12500,items:[{invoiceId:"INV001",invoiceNumber:"SALES-2024-001",amount:5e3,commission:100}]},bonuses:[{id:"B001",type:"performance",amount:100,reason:"Outstanding performance"}],deductions:[]},createdAt:new Date("2024-11-30"),updatedAt:new Date("2024-12-01"),createdBy:"system",approvedBy:"admin",approvedAt:new Date("2024-12-01")}];getPayrollRecords(a){let t=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!t)return y({data:[],total:0,page:1,pageSize:10,totalPages:0}).pipe(u(300));let e=this.payrollRecords.filter(g=>g.pharmacyId===t);a?.staffId&&(e=e.filter(g=>g.staffId===a.staffId)),a?.status&&(e=e.filter(g=>g.status===a.status));let o=a?.page||1,c=a?.pageSize||10,x=(o-1)*c,E=x+c,h=e.slice(x,E);return y({data:h,total:e.length,page:o,pageSize:c,totalPages:Math.ceil(e.length/c)}).pipe(u(500))}getSalaryRules(a){let t=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!t)return y([]).pipe(u(300));let e=this.salaryRules.filter(o=>o.pharmacyId===t&&o.isActive);return a&&(e=e.filter(o=>o.staffId===a||!o.staffId&&!o.role)),y(e).pipe(u(300))}getCommissionRules(a){let t=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!t)return y([]).pipe(u(300));let e=this.commissionRules.filter(o=>o.pharmacyId===t&&o.isActive);return a&&(e=e.filter(o=>o.staffId===a||!o.staffId&&!o.role)),y(e).pipe(u(300))}generatePayroll(a,t,e){let o=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!o)throw new Error("No pharmacy selected");let x=this.salaryRules.find(f=>f.pharmacyId===o&&(f.staffId===a||!f.staffId&&f.isActive))?.baseSalary||0,E=this.commissionRules.filter(f=>f.pharmacyId===o&&(f.staffId===a||!f.staffId&&f.isActive)),h=0,g=[];if(E.length>0){let f=E[0],z=12500;h=z*f.value/100,g.push({invoiceId:"INV001",invoiceNumber:"SALES-2024-001",amount:z,commission:h})}let L={id:`PR${Date.now()}`,pharmacyId:o,staffId:a,period:{startDate:t,endDate:e},baseSalary:x,commission:h,bonuses:0,deductions:0,totalEarnings:x+h,netPay:x+h,currency:"USD",status:"draft",breakdown:{baseSalary:x,commission:{total:h,sales:12500,items:g},bonuses:[],deductions:[]},createdAt:new Date,updatedAt:new Date,createdBy:"system"};return this.payrollRecords.push(L),y(L).pipe(u(500))}approvePayroll(a,t){let e=this.payrollRecords.find(o=>o.id===a);return e?(e.status="approved",e.approvedBy=t,e.approvedAt=new Date,e.updatedAt=new Date,y(!0).pipe(u(500))):y(!1).pipe(u(300))}createSalaryRule(a){let t=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!t)throw new Error("No pharmacy selected");let e=R(_({},a),{id:`SR${Date.now()}`,pharmacyId:t,createdAt:new Date,updatedAt:new Date,createdBy:"system"});return this.salaryRules.push(e),y(e).pipe(u(500))}createCommissionRule(a){let t=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!t)throw new Error("No pharmacy selected");let e=R(_({},a),{id:`CR${Date.now()}`,pharmacyId:t,createdAt:new Date,updatedAt:new Date,createdBy:"system"});return this.commissionRules.push(e),y(e).pipe(u(500))}static \u0275fac=function(t){return new(t||s)};static \u0275prov=V({token:s,factory:s.\u0275fac,providedIn:"root"})};function ce(s,a){if(s&1&&(r(0,"div",4)(1,"span",5),l(2),p(3,"translate"),n(),r(4,"span",14),l(5),n()()),s&2){let t=b();i(2),m(d(3,2,"hr.payroll.commission")),i(3),S("+",t.formatCurrency(t.payroll.commission),"")}}function ye(s,a){if(s&1&&(r(0,"div",4)(1,"span",5),l(2),p(3,"translate"),n(),r(4,"span",14),l(5),n()()),s&2){let t=b();i(2),m(d(3,2,"hr.payroll.bonuses")),i(3),S("+",t.formatCurrency(t.payroll.bonuses),"")}}function ue(s,a){if(s&1&&(r(0,"div",4)(1,"span",5),l(2),p(3,"translate"),n(),r(4,"span",15),l(5),n()()),s&2){let t=b();i(2),m(d(3,2,"hr.payroll.deductions")),i(3),S("-",t.formatCurrency(t.payroll.deductions),"")}}function fe(s,a){if(s&1&&(r(0,"div",13)(1,"div",16)(2,"span",17),l(3),p(4,"translate"),n(),r(5,"span"),l(6),p(7,"translate"),n()()()),s&2){let t=b();i(3),m(d(4,4,"hr.payroll.status")),i(2),J(t.statusClass),i(),m(d(7,6,t.statusLabel))}}var T=class s{payroll;formatCurrency(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:this.payroll.currency||"USD"}).format(a)}get statusLabel(){return{draft:"hr.payroll.statusDraft",pending_approval:"hr.payroll.statusPending",approved:"hr.payroll.statusApproved",paid:"hr.payroll.statusPaid",cancelled:"hr.payroll.statusCancelled"}[this.payroll.status]||"hr.payroll.statusDraft"}get statusClass(){let a={draft:"px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-800",pending_approval:"px-2 py-1 rounded text-xs font-medium bg-yellow-100 text-yellow-800",approved:"px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800",paid:"px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800",cancelled:"px-2 py-1 rounded text-xs font-medium bg-red-100 text-red-800"};return a[this.payroll.status]||a.draft}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=B({type:s,selectors:[["app-payroll-summary-panel"]],inputs:{payroll:"payroll"},decls:30,vars:19,consts:[[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-6"],[1,"text-lg","font-semibold","text-[var(--text-primary)]","mb-4"],[1,"space-y-4"],[1,"space-y-2"],[1,"flex","justify-between","text-sm"],[1,"text-[var(--card-text)]"],[1,"font-medium","text-[var(--text-primary)]"],[1,"border-t","border-[var(--border-color)]","pt-4"],[1,"flex","justify-between","text-sm","font-medium","mb-2"],[1,"text-[var(--text-primary)]"],[1,"flex","justify-between","items-center"],[1,"text-base","font-semibold","text-[var(--text-primary)]"],[1,"text-2xl","font-bold","text-[var(--primary-color)]"],[1,"mt-4","pt-4","border-t","border-[var(--border-color)]"],[1,"font-medium","text-green-600"],[1,"font-medium","text-red-600"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-[var(--card-text)]"]],template:function(t,e){t&1&&(r(0,"div",0)(1,"h3",1),l(2),p(3,"translate"),n(),r(4,"div",2)(5,"div",3)(6,"div",4)(7,"span",5),l(8),p(9,"translate"),n(),r(10,"span",6),l(11),n()(),w(12,ce,6,4,"div",4)(13,ye,6,4,"div",4),n(),r(14,"div",7)(15,"div",8)(16,"span",5),l(17),p(18,"translate"),n(),r(19,"span",9),l(20),n()(),w(21,ue,6,4,"div",4),n(),r(22,"div",7)(23,"div",10)(24,"span",11),l(25),p(26,"translate"),n(),r(27,"span",12),l(28),n()()(),w(29,fe,8,8,"div",13),n()()),t&2&&(i(2),m(d(3,11,"hr.payroll.summary")),i(6),m(d(9,13,"hr.payroll.baseSalary")),i(3),m(e.formatCurrency(e.payroll.baseSalary)),i(),C(e.payroll.commission>0?12:-1),i(),C(e.payroll.bonuses>0?13:-1),i(4),m(d(18,15,"hr.payroll.totalEarnings")),i(3),m(e.formatCurrency(e.payroll.totalEarnings)),i(),C(e.payroll.deductions>0?21:-1),i(4),m(d(26,17,"hr.payroll.netPay")),i(3),m(e.formatCurrency(e.payroll.netPay)),i(),C(e.payroll.status?29:-1))},dependencies:[A,k],encapsulation:2})};var ve=(s,a)=>a.id;function he(s,a){if(s&1&&(r(0,"option",15),l(1),n()),s&2){let t=a.$implicit;v("value",t.id),i(),m(t.fullName)}}function ge(s,a){if(s&1){let t=q();r(0,"app-modal",28,0),p(2,"translate"),p(3,"translate"),D("confirmed",function(){j(t);let o=b();return U(o.selectedPayroll=null)}),I(4,"app-payroll-summary-panel",29),n()}if(s&2){let t=b();v("title",d(2,4,"hr.payroll.details"))("showFooter",!0)("confirmText",d(3,6,"common.close")),i(4),v("payroll",t.selectedPayroll)}}var de=class s{payrollService=P(M);staffService=P(se);loading=!1;showGenerateModal=!1;payrollRecords=[];staffList=[];selectedPayroll=null;filters={staffId:"",status:""};totalPayroll=0;totalCommission=0;pendingCount=0;paidCount=0;pagination={page:1,pageSize:10,total:0,totalPages:0};columns=[{key:"period",label:"hr.payroll.period",sortable:!0},{key:"staffName",label:"hr.payroll.staff",sortable:!0},{key:"baseSalary",label:"hr.payroll.baseSalary",sortable:!0},{key:"commission",label:"hr.payroll.commission",sortable:!0},{key:"netPay",label:"hr.payroll.netPay",sortable:!0},{key:"status",label:"hr.payroll.status",sortable:!0}];costVsRevenueData={};distributionData={};chartOptions={};ngOnInit(){this.loadStaff(),this.loadPayroll()}loadStaff(){this.staffService.getAll({page:1,pageSize:100}).subscribe({next:a=>{this.staffList=a.data}})}loadPayroll(){this.loading=!0;let a={page:this.pagination.page,pageSize:this.pagination.pageSize};this.filters.staffId&&(a.staffId=this.filters.staffId),this.filters.status&&(a.status=this.filters.status),this.payrollService.getPayrollRecords(a).subscribe({next:t=>{this.payrollRecords=t.data.map(e=>R(_({},e),{period:`${new Date(e.period.startDate).toLocaleDateString()} - ${new Date(e.period.endDate).toLocaleDateString()}`,baseSalary:this.formatCurrency(e.baseSalary),commission:this.formatCurrency(e.commission),netPay:this.formatCurrency(e.netPay),status:e.status})),this.pagination={page:t.page,pageSize:t.pageSize,total:t.total,totalPages:t.totalPages},this.calculateStats(t.data),this.loading=!1,this.loadCharts()},error:()=>{this.loading=!1}})}calculateStats(a){this.totalPayroll=a.reduce((t,e)=>t+e.netPay,0),this.totalCommission=a.reduce((t,e)=>t+e.commission,0),this.pendingCount=a.filter(t=>t.status==="pending_approval"||t.status==="draft").length,this.paidCount=a.filter(t=>t.status==="paid").length}loadCharts(){this.costVsRevenueData={labels:["Jan","Feb","Mar","Apr","May","Jun"],datasets:[{label:"Staff Cost",data:[15e3,16e3,15500,17e3,16500,18e3],borderColor:"rgba(239, 68, 68, 1)",backgroundColor:"rgba(239, 68, 68, 0.1)"},{label:"Revenue",data:[5e4,55e3,52e3,6e4,58e3,65e3],borderColor:"rgba(16, 185, 129, 1)",backgroundColor:"rgba(16, 185, 129, 0.1)"}]},this.distributionData={labels:["Base Salary","Commission","Bonuses"],datasets:[{data:[this.totalPayroll*.7,this.totalPayroll*.25,this.totalPayroll*.05],backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)"]}]},this.chartOptions={responsive:!0,maintainAspectRatio:!1}}formatCurrency(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a)}applyFilters(){this.pagination.page=1,this.loadPayroll()}onPageChange(a){this.pagination.page=a,this.loadPayroll()}viewPayroll(a){this.payrollService.getPayrollRecords({page:1,pageSize:1e3}).subscribe({next:t=>{this.selectedPayroll=t.data.find(e=>e.id===a.id)||null}})}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=B({type:s,selectors:[["app-payroll"]],decls:66,vars:69,consts:[["payrollModal",""],[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-[var(--text-primary)]"],["variant","primary",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[3,"label","value","unit","icon"],[3,"label","value","icon"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"block","text-sm","font-medium","text-[var(--card-text)]","mb-1"],[1,"w-full","px-4","py-2","border","border-[var(--border-color)]","rounded-[var(--radius-md)]","text-sm","bg-[var(--card-bg)]","text-[var(--text-primary)]",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["value","draft"],["value","pending_approval"],["value","approved"],["value","paid"],[1,"flex","items-end"],["variant","primary","size","sm",3,"onClick"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-6"],[3,"onPageChange","onRowClick","columns","data","pagination","loading","emptyMessage"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"text-lg","font-semibold","text-[var(--text-primary)]","mb-4"],[3,"type","data","options"],[3,"title","showFooter","confirmText"],[3,"confirmed","title","showFooter","confirmText"],[3,"payroll"]],template:function(t,e){t&1&&(r(0,"div",1)(1,"div",2)(2,"h1",3),l(3),p(4,"translate"),n(),r(5,"app-button",4),D("onClick",function(){return e.showGenerateModal=!0}),W(),r(6,"svg",5),I(7,"path",6),n(),l(8),p(9,"translate"),n()(),G(),r(10,"div",7),I(11,"app-stat-card",8)(12,"app-stat-card",8)(13,"app-stat-card",9)(14,"app-stat-card",9),n(),r(15,"div",10)(16,"div",11)(17,"div")(18,"label",12),l(19),p(20,"translate"),n(),r(21,"select",13),F("ngModelChange",function(c){return O(e.filters.staffId,c)||(e.filters.staffId=c),c}),r(22,"option",14),l(23),p(24,"translate"),n(),$(25,he,2,2,"option",15,ve),n()(),r(27,"div")(28,"label",12),l(29),p(30,"translate"),n(),r(31,"select",13),F("ngModelChange",function(c){return O(e.filters.status,c)||(e.filters.status=c),c}),r(32,"option",14),l(33),p(34,"translate"),n(),r(35,"option",16),l(36),p(37,"translate"),n(),r(38,"option",17),l(39),p(40,"translate"),n(),r(41,"option",18),l(42),p(43,"translate"),n(),r(44,"option",19),l(45),p(46,"translate"),n()()(),r(47,"div",20)(48,"app-button",21),D("onClick",function(){return e.applyFilters()}),l(49),p(50,"translate"),n()()()(),r(51,"div",22)(52,"app-table",23),p(53,"translate"),D("onPageChange",function(c){return e.onPageChange(c)})("onRowClick",function(c){return e.viewPayroll(c)}),n()(),r(54,"div",24)(55,"div",22)(56,"h3",25),l(57),p(58,"translate"),n(),I(59,"app-chart",26),n(),r(60,"div",22)(61,"h3",25),l(62),p(63,"translate"),n(),I(64,"app-chart",26),n()()(),w(65,ge,5,8,"app-modal",27)),t&2&&(i(3),m(d(4,41,"hr.payroll.title")),i(5),S(" ",d(9,43,"hr.payroll.generate")," "),i(3),v("label","hr.payroll.totalPayroll")("value",e.totalPayroll)("unit","USD")("icon","credit-card"),i(),v("label","hr.payroll.totalCommission")("value",e.totalCommission)("unit","USD")("icon","chart"),i(),v("label","hr.payroll.pending")("value",e.pendingCount)("icon","clock"),i(),v("label","hr.payroll.paid")("value",e.paidCount)("icon","check-circle"),i(5),m(d(20,45,"hr.payroll.staff")),i(2),N("ngModel",e.filters.staffId),i(2),m(d(24,47,"common.all")),i(2),H(e.staffList),i(4),m(d(30,49,"hr.payroll.status")),i(2),N("ngModel",e.filters.status),i(2),m(d(34,51,"common.all")),i(3),m(d(37,53,"hr.payroll.statusDraft")),i(3),m(d(40,55,"hr.payroll.statusPending")),i(3),m(d(43,57,"hr.payroll.statusApproved")),i(3),m(d(46,59,"hr.payroll.statusPaid")),i(4),S(" ",d(50,61,"common.search")," "),i(3),v("columns",e.columns)("data",e.payrollRecords)("pagination",e.pagination)("loading",e.loading)("emptyMessage",d(53,63,"hr.payroll.noRecords")),i(5),m(d(58,65,"hr.payroll.costVsRevenue")),i(2),v("type","line")("data",e.costVsRevenueData)("options",e.chartOptions),i(3),m(d(63,67,"hr.payroll.distribution")),i(2),v("type","pie")("data",e.distributionData)("options",e.chartOptions),i(),C(e.selectedPayroll?65:-1))},dependencies:[A,ee,Y,Z,X,K,Q,re,te,k,T,ie,ne,oe],encapsulation:2})};export{de as PayrollComponent};
