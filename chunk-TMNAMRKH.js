import{a as N}from"./chunk-X7CGJDW6.js";import{a as P}from"./chunk-YUSM72LK.js";import{b as G}from"./chunk-3AOUMDXJ.js";import{a as F}from"./chunk-QDLVDHOW.js";import"./chunk-ASC66LS3.js";import{a as H}from"./chunk-JYPY3KCN.js";import{a as D}from"./chunk-XG6FMBJJ.js";import{a as Q}from"./chunk-6CFKC637.js";import"./chunk-WWNH5MHG.js";import"./chunk-5PFWNSG3.js";import"./chunk-T542ZMY7.js";import"./chunk-URFUYTQU.js";import"./chunk-BYXBJQAS.js";import{b as j}from"./chunk-3UJCRMW3.js";import{d as A}from"./chunk-C3O3TVFX.js";import{$a as a,Ab as s,Bb as c,Eb as E,Fa as B,Ka as V,Q as y,Qa as p,Va as b,W as h,X as v,Y as f,Z as w,_a as t,_b as z,ab as u,cb as x,db as g,eb as d,ib as k,jb as M,kb as S,mb as _,nb as C,ob as L,wa as n}from"./chunk-E4S7NVXB.js";import{a as T,b as I}from"./chunk-C6Q5SG76.js";var U=["viewModal"],$=["deleteModal"];function q(r,o){if(r&1&&u(0,"app-alert",4),r&2){let e=d();p("title",e.errorMessage)}}function K(r,o){if(r&1){let e=x();t(0,"app-button",18),g("onClick",function(){h(e);let l=d();return v(l.navigateToNew())}),f(),t(1,"svg",19),u(2,"path",20),a(),_(3),s(4,"translate"),a()}r&2&&(n(3),L(" ",c(4,1,"button.createVoucher")," "))}function J(r,o){if(r&1){let e=x();t(0,"div",22)(1,"button",23),s(2,"translate"),g("click",function(){h(e);let l=d().$implicit,m=d();return v(m.viewVoucher(l))}),f(),t(3,"svg",24),u(4,"path",25)(5,"path",26),a()(),w(),t(6,"button",23),s(7,"translate"),g("click",function(){h(e);let l=d().$implicit,m=d();return v(m.editVoucher(l.id))}),f(),t(8,"svg",24),u(9,"path",27),a()(),w(),t(10,"button",28),s(11,"translate"),g("click",function(){h(e);let l=d().$implicit,m=d();return v(m.confirmDelete(l))}),f(),t(12,"svg",24),u(13,"path",29),a()()()}r&2&&(n(),p("title",c(2,3,"common.view")),n(5),p("title",c(7,5,"common.edit")),n(4),p("title",c(11,7,"common.delete")))}function W(r,o){r&1&&V(0,J,14,9,"div",21),r&2&&p("appCanAccess","voucher.actions")}function X(r,o){if(r&1&&(t(0,"div",16),u(1,"app-voucher-card",30),a()),r&2){let e=d();n(),p("voucher",e.selectedVoucher)("averageDiscountPercentage",0)}}var R=class r{router=y(A);vouchersService=y(N);vouchers=[];searchQuery="";errorMessage="";loading=!1;deleting=!1;selectedVoucherId=null;selectedVoucherCode="";selectedVoucher=null;viewModal;deleteModal;columns=[{key:"voucherCode",label:"voucher.code",sortable:!0},{key:"voucherName",label:"voucher.name",sortable:!0},{key:"patientName",label:"voucher.patient",sortable:!0},{key:"amount",label:"voucher.amount",sortable:!0},{key:"createdAt",label:"voucher.createdAt",sortable:!0},{key:"validUntil",label:"voucher.validUntil",sortable:!0},{key:"status",label:"voucher.status",sortable:!0},{key:"actions",label:"table.action"}];pagination={page:1,pageSize:10,total:0,totalPages:0};ngOnInit(){this.loadVouchers()}loadVouchers(){this.loading=!0,this.vouchersService.getAll({page:this.pagination.page,pageSize:this.pagination.pageSize}).subscribe({next:o=>{this.vouchers=o.data,this.pagination=I(T({},this.pagination),{total:o.data.length,totalPages:Math.ceil(o.data.length/this.pagination.pageSize)}),this.loading=!1},error:()=>{this.loading=!1,this.errorMessage="Failed to load vouchers"}})}onSearch(){this.loadVouchers()}viewVoucher(o){this.vouchersService.getById(o.id).subscribe({next:e=>{this.selectedVoucher=e,e&&this.viewModal.open()}})}editVoucher(o){this.router.navigate(["/vouchers",o,"edit"])}navigateToNew(){this.router.navigate(["/vouchers/new"])}confirmDelete(o){this.selectedVoucherId=o.id,this.selectedVoucherCode=o.voucherCode,this.deleteModal.open()}deleteVoucher(){this.selectedVoucherId&&(this.deleting=!0,this.vouchersService.delete(this.selectedVoucherId).subscribe({next:()=>{this.deleting=!1,this.deleteModal.close(),this.loadVouchers()},error:()=>{this.deleting=!1,this.errorMessage="Failed to delete voucher"}}))}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=B({type:r,selectors:[["app-vouchers-list"]],viewQuery:function(e,i){if(e&1&&(k(U,5),k($,5)),e&2){let l;M(l=S())&&(i.viewModal=l.first),M(l=S())&&(i.deleteModal=l.first)}},decls:35,vars:38,consts:[["actionTemplate",""],["viewModal",""],["deleteModal",""],[1,"space-y-6"],["type","error",3,"title"],[1,"flex","items-center","justify-between","gap-4"],[1,"flex-1","max-w-lg"],[1,"relative"],["type","text",1,"w-full","pl-10","pr-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]","focus:border-[var(--primary-color)]",3,"input","placeholder","value"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","absolute","left-3","top-2.5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"flex","gap-3"],["variant","outline"],["variant","primary",3,"onClick",4,"appCanAccess"],["rowIdKey","id",3,"columns","data","pagination","emptyMessage","loading"],[3,"title","showFooter","size"],[1,"flex","justify-center"],[3,"confirmed","title","showFooter","confirmText","confirmLoading"],["variant","primary",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["class","flex items-center gap-2",4,"appCanAccess"],[1,"flex","items-center","gap-2"],[1,"p-1","text-gray-600","hover:text-gray-900",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"p-1","text-gray-600","hover:text-red-600",3,"click","title"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[3,"voucher","averageDiscountPercentage"]],template:function(e,i){if(e&1){let l=x();t(0,"div",3),V(1,q,1,1,"app-alert",4),t(2,"div",5)(3,"div",6)(4,"div",7)(5,"input",8),s(6,"translate"),g("input",function(O){return h(l),i.searchQuery=O.target.value,v(i.onSearch())}),a(),f(),t(7,"svg",9),u(8,"path",10),a()()(),w(),t(9,"div",11)(10,"app-button",12),_(11),s(12,"translate"),a(),t(13,"app-button",12),_(14),s(15,"translate"),a(),V(16,K,5,3,"app-button",13),a()(),t(17,"app-table",14),V(18,W,1,1,"ng-template",null,0,E),a(),t(20,"app-modal",15,1),s(22,"translate"),V(23,X,2,2,"div",16),a(),t(24,"app-modal",17,2),s(26,"translate"),s(27,"translate"),g("confirmed",function(){return h(l),v(i.deleteVoucher())}),t(28,"p"),_(29),s(30,"translate"),t(31,"strong"),_(32),a(),_(33),s(34,"translate"),a()()()}e&2&&(n(),b(i.errorMessage?1:-1),n(4),p("placeholder",c(6,22,"common.search"))("value",i.searchQuery),n(6),C(c(12,24,"common.filters")),n(3),C(c(15,26,"common.export")),n(2),p("appCanAccess","voucher.create"),n(),p("columns",i.columns)("data",i.vouchers)("pagination",i.pagination)("emptyMessage","empty.noVouchers")("loading",i.loading),n(3),p("title",c(22,28,"voucher.view"))("showFooter",!1)("size","large"),n(3),b(i.selectedVoucher?23:-1),n(),p("title",c(26,30,"button.deleteVoucher"))("showFooter",!0)("confirmText",c(27,32,"common.delete"))("confirmLoading",i.deleting),n(5),L("",c(30,34,"modal.deleteVoucherConfirm")," "),n(3),C(i.selectedVoucherCode),n(),C(c(34,36,"modal.cannotUndo")))},dependencies:[z,Q,F,H,D,j,P,G],encapsulation:2})};export{R as VouchersListComponent};
