import{a as ne,b as se}from"./chunk-4PK2EB7K.js";import{a as oe}from"./chunk-PUVF5ECJ.js";import{a as G}from"./chunk-Y5QUESDN.js";import{a as H,d as R,e as W,f as U,h as J,j as K,k as Q,l as X,m as Y,n as Z,t as ee,v as te,w as I,x as ie}from"./chunk-VW37JDOU.js";import{a as re}from"./chunk-YJWIIGXE.js";import{a as z}from"./chunk-M3W4QUEG.js";import"./chunk-BYXBJQAS.js";import"./chunk-QHH3SHC3.js";import"./chunk-KPWAPXFF.js";import"./chunk-ACQN7LQS.js";import{b as A}from"./chunk-7DC7YEPQ.js";import{$ as N,$a as a,$b as P,Bb as u,Cb as m,Ga as k,Ka as D,L as T,La as $,Ra as s,S,Wa as q,X as V,Xa as L,Y as y,Z as w,Za as _,_ as x,_a as M,aa as B,ab as l,bb as h,db as F,eb as f,fb as p,nb as c,pb as v,xa as r,xb as j,yb as g,zb as b}from"./chunk-OKFD3A6M.js";import"./chunk-KAT7YFEL.js";var ue=(n,i)=>i.value;function me(n,i){if(n&1){let e=F();a(0,"div",2)(1,"input",3),f("change",function(o){let d=y(e).$implicit,O=p();return w(O.onCheckboxChange(o,d.value))})("blur",function(){y(e);let o=p();return w(o.onBlur())}),l(),a(2,"label",4),c(3),u(4,"translate"),l()()}if(n&2){let e=i.$implicit,t=p();r(),s("id",t.inputId+"-"+e.value)("name",t.name||t.inputId)("value",e.value)("checked",t.isCheckboxChecked(e.value))("disabled",t.disabled),r(),s("for",t.inputId+"-"+e.value),r(),v(" ",m(4,7,e.label)," ")}}var E=class n extends G{name;checkboxOptions=[];ngOnInit(){super.ngOnInit(),Array.isArray(this.value)||(this.value=[])}ngOnChanges(i){super.ngOnChanges(i),i.serverError&&(this.hasError=!!this.serverError||this.hasError)}isCheckboxChecked(i){return Array.isArray(this.value)?this.value.includes(i):this.value===i}onCheckboxChange(i,e){let t=i.target.checked;Array.isArray(this.value)||(this.value=[]),t?this.value.includes(e)||(this.value=[...this.value,e]):this.value=this.value.filter(o=>o!==e),this.onChangeCallback(this.value),this.onTouchedCallback()}writeValue(i){super.writeValue(i),this.value=Array.isArray(i)?i:i?[i]:[]}static \u0275fac=(()=>{let i;return function(t){return(i||(i=B(n)))(t||n)}})();static \u0275cmp=k({type:n,selectors:[["app-checkbox-input"]],inputs:{name:"name",checkboxOptions:"checkboxOptions"},features:[j([{provide:H,useExisting:T(()=>n),multi:!0}]),D,V],decls:4,vars:8,consts:[[3,"label","required","disabled","hasError","errorMessage","hint","inputId","serverError"],[1,"checkbox-group"],[1,"checkbox-item"],["type","checkbox",1,"checkbox-input",3,"change","blur","id","name","value","checked","disabled"],[1,"checkbox-label",3,"for"]],template:function(e,t){e&1&&(a(0,"app-base-input",0)(1,"div",1),_(2,me,5,9,"div",2,ue),l()()),e&2&&(s("label",t.label)("required",t.required)("disabled",t.disabled)("hasError",t.hasError||!!t.serverError)("errorMessage",t.serverError||t.errorMessage)("hint",t.hint)("inputId",t.inputId)("serverError",t.serverError),r(2),M(t.checkboxOptions))},dependencies:[P,I,A,G],styles:['.checkbox-group[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.checkbox-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.625rem}.checkbox-label[_ngcontent-%COMP%]{font-size:.875rem;color:#374151;cursor:pointer;-webkit-user-select:none;user-select:none}.checkbox-input[_ngcontent-%COMP%]{width:24px;height:24px;border:none;border-radius:.5rem;appearance:none;cursor:pointer;position:relative;transition:all .3s ease;background:#fff;box-shadow:0 2px 8px #0000001a;margin:0;padding:0}.checkbox-input[_ngcontent-%COMP%]:checked{background:var(--primary-bg, #D9F275);box-shadow:0 4px 15px #d9f27580;transform:scale(1.1)}.checkbox-input[_ngcontent-%COMP%]:checked:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-60%) rotate(45deg);width:6px;height:12px;border:solid var(--primary-text, #003032);border-width:0 3px 3px 0}.checkbox-input[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.checkbox-input[_ngcontent-%COMP%]:hover:not(:disabled){box-shadow:0 2px 12px #00000026}.checkbox-input[_ngcontent-%COMP%]:checked:hover:not(:disabled){box-shadow:0 4px 18px #d9f27599}']})};var pe=()=>({value:!0,label:"modulesPermissions.permissions.view"}),C=n=>[n],ce=()=>({value:!0,label:"modulesPermissions.permissions.create"}),ve=()=>({value:!0,label:"modulesPermissions.permissions.edit"}),fe=()=>({value:!0,label:"modulesPermissions.permissions.delete"}),he=()=>({value:!0,label:"modulesPermissions.permissions.actions"});function ge(n,i){if(n&1){let e=F();a(0,"div",18)(1,"div",19)(2,"h4",20),c(3),u(4,"translate"),l(),a(5,"button",21),u(6,"translate"),f("click",function(){let o=y(e).$index,d=p(2);return w(d.removeModule(o))}),x(),a(7,"svg",22),h(8,"path",23),l()()(),N(),a(9,"div",24),h(10,"app-checkbox-input",25)(11,"app-checkbox-input",25)(12,"app-checkbox-input",25)(13,"app-checkbox-input",25)(14,"app-checkbox-input",25),l()()}if(n&2){let e,t=i.$implicit,o=i.$index,d=p(2);s("formGroupName",o),r(3),v(" ",m(4,18,d.getModuleName((e=t.get("module"))==null?null:e.value))," "),r(2),s("title",m(6,20,"common.delete")),r(5),s("formControl",d.getPermissionControl(t,"view"))("checkboxOptions",b(23,C,g(22,pe)))("label",""),r(),s("formControl",d.getPermissionControl(t,"create"))("checkboxOptions",b(26,C,g(25,ce)))("label",""),r(),s("formControl",d.getPermissionControl(t,"edit"))("checkboxOptions",b(29,C,g(28,ve)))("label",""),r(),s("formControl",d.getPermissionControl(t,"delete"))("checkboxOptions",b(32,C,g(31,fe)))("label",""),r(),s("formControl",d.getPermissionControl(t,"actions"))("checkboxOptions",b(35,C,g(34,he)))("label","")}}function be(n,i){if(n&1&&_(0,ge,15,37,"div",18,L),n&2){let e=p();M(e.modulesArray.controls)}}var ae=class n{fb=S(te);authService=S(z);modulesForm;loading=!1;errorMessage="";get modulesArray(){return this.modulesForm.get("modules")}ngOnInit(){this.initializeForm(),this.loadModules()}initializeForm(){this.modulesForm=this.fb.group({modules:this.fb.array([]),newModuleName:["",[R.minLength(2)]]})}loadModules(){this.getMockModulesData().forEach(e=>{this.addModuleFormGroup(e.module,e.permissions)})}getMockModulesData(){return[{module:"dashboard",permissions:{view:!0,create:!1,edit:!1,delete:!1,actions:!1}},{module:"patients",permissions:{view:!0,create:!0,edit:!0,delete:!0,actions:!0}},{module:"staff",permissions:{view:!0,create:!0,edit:!0,delete:!1,actions:!0}},{module:"drugs",permissions:{view:!0,create:!0,edit:!0,delete:!0,actions:!1}},{module:"bundles",permissions:{view:!0,create:!0,edit:!0,delete:!0,actions:!1}},{module:"inventory",permissions:{view:!0,create:!1,edit:!0,delete:!1,actions:!0}},{module:"purchases",permissions:{view:!0,create:!0,edit:!0,delete:!1,actions:!0}},{module:"suppliers",permissions:{view:!0,create:!0,edit:!0,delete:!0,actions:!1}},{module:"invoices",permissions:{view:!0,create:!0,edit:!0,delete:!1,actions:!0}},{module:"vouchers",permissions:{view:!0,create:!0,edit:!0,delete:!1,actions:!0}},{module:"payments",permissions:{view:!0,create:!1,edit:!1,delete:!1,actions:!0}},{module:"audit",permissions:{view:!0,create:!1,edit:!1,delete:!1,actions:!1}},{module:"settings",permissions:{view:!0,create:!1,edit:!0,delete:!1,actions:!1}},{module:"system",permissions:{view:!0,create:!1,edit:!0,delete:!1,actions:!0}},{module:"reports",permissions:{view:!0,create:!1,edit:!1,delete:!1,actions:!1}},{module:"referrals",permissions:{view:!0,create:!0,edit:!1,delete:!1,actions:!1}},{module:"attendance",permissions:{view:!0,create:!0,edit:!0,delete:!1,actions:!1}},{module:"payroll",permissions:{view:!0,create:!1,edit:!0,delete:!1,actions:!1}},{module:"performance",permissions:{view:!0,create:!1,edit:!0,delete:!1,actions:!1}},{module:"training",permissions:{view:!0,create:!0,edit:!0,delete:!1,actions:!1}}]}getAllPermissions(){let i=[],e=["dashboard.view","patients.view","patients.kpi.view","patients.orders.view","patients.loyalty.view","patients.revenue.view","patients.vouchers.view","staff.view","staff.details.view","staff.performance.view","staff.risk.view","staff.activity.view","attendance.view","payroll.view","performance.view","training.view","drugs.view","drugs.create","bundles.view","inventory.alerts.view","inventory.map.view","inventory.transfers.view","inventory.movements.view","inventory.requested.view","purchases.view","purchases.create","suppliers.view","invoices.view","invoices.create","invoices.edit","invoices.actions","audit.view","payments.view","payments.methods.manage","referrals.view","settings.view","settings.account.view","system.permissions.manage","system.features.manage","system.automation.manage","system.migration.manage","reports.view","vouchers.view","vouchers.create","vouchers.edit","vouchers.actions"];return i.push(...e),["inventory.alerts.view","inventory.requested.view","inventory.map.view","inventory.transfers.view"].forEach(o=>{i.includes(o)||i.push(o)}),i}extractModules(i){let e=new Set;return i.forEach(o=>{let d=o.split(".");if(d.length>0){let O=d[0];e.add(O)}}),["dashboard","patients","staff","attendance","payroll","performance","training","drugs","bundles","inventory","purchases","suppliers","invoices","audit","payments","referrals","settings","system","reports","vouchers"].forEach(o=>e.add(o)),Array.from(e).sort()}getModulePermissions(i,e){let t=e.filter(o=>o.startsWith(i+"."));return{view:t.some(o=>o.includes(".view")),create:t.some(o=>o.includes(".create")),edit:t.some(o=>o.includes(".edit")),delete:t.some(o=>o.includes(".delete")),actions:t.some(o=>o.includes(".actions"))}}addModuleFormGroup(i,e){let t=this.fb.group({module:[i],permissions:this.fb.group({view:[e.view?[!0]:[]],create:[e.create?[!0]:[]],edit:[e.edit?[!0]:[]],delete:[e.delete?[!0]:[]],actions:[e.actions?[!0]:[]]})});this.modulesArray.push(t)}getPermissionControl(i,e){return i.get("permissions").get(e)}addNewModule(){let i=this.modulesForm.get("newModuleName")?.value?.trim().toLowerCase();if(!i||i.length<2)return;if(this.modulesArray.controls.map(t=>t.get("module")?.value).includes(i)){this.errorMessage="modulesPermissions.moduleExists";return}this.addModuleFormGroup(i,{view:!1,create:!1,edit:!1,delete:!1,actions:!1}),this.modulesForm.patchValue({newModuleName:""}),this.errorMessage=""}removeModule(i){this.modulesArray.removeAt(i)}getModuleName(i){return`modulesPermissions.modules.${i}`}onSubmit(){if(this.modulesForm.invalid)return;this.loading=!0,this.errorMessage="";let i=this.modulesForm.value.modules.map(e=>({module:e.module,permissions:{view:Array.isArray(e.permissions.view)&&e.permissions.view.includes(!0),create:Array.isArray(e.permissions.create)&&e.permissions.create.includes(!0),edit:Array.isArray(e.permissions.edit)&&e.permissions.edit.includes(!0),delete:Array.isArray(e.permissions.delete)&&e.permissions.delete.includes(!0),actions:Array.isArray(e.permissions.actions)&&e.permissions.actions.includes(!0)}}));console.log("Modules and Permissions:",i),setTimeout(()=>{this.loading=!1},1e3)}onCancel(){for(;this.modulesArray.length!==0;)this.modulesArray.removeAt(0);this.loadModules()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-modules-permissions"]],decls:28,vars:25,consts:[[3,"title","description","errorMessage"],[1,"p-8",3,"ngSubmit","formGroup"],[3,"title"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"p-6","bg-gradient-to-br","from-gray-50","to-gray-100","rounded-xl","border-2","border-dashed","border-gray-300","hover:border-primary","transition-all","duration-200","flex","flex-col"],[1,"text-lg","font-semibold","text-gray-800","mb-4"],[1,"flex-1","flex","flex-col"],[1,"mb-4"],["type","text","formControlName","newModuleName","prefixIcon","grid",3,"label","required","placeholder"],[1,"mt-auto"],["type","button","variant","primary","size","md",3,"onClick","fullWidth","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["formArrayName","modules",1,"contents"],[1,"flex","items-center","justify-end","gap-4","pt-8","border-t-2","border-gray-100"],["type","button","variant","outline","size","lg",3,"onClick"],["type","submit","variant","primary","size","lg",3,"disabled","loading"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"p-6","bg-white","rounded-xl","border","border-gray-200","shadow-sm","hover:shadow-md","transition-shadow","duration-200",3,"formGroupName"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-gray-800"],["type","button",1,"delete-icon-btn","p-2","rounded-lg","transition-all","duration-200","opacity-80","hover:opacity-100","text-gray-600",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"space-y-3"],[3,"formControl","checkboxOptions","label"]],template:function(e,t){if(e&1&&(a(0,"app-modern-form-wrapper",0)(1,"form",1),f("ngSubmit",function(){return t.onSubmit()}),a(2,"app-form-section",2)(3,"div",3)(4,"div",4)(5,"h4",5),c(6),u(7,"translate"),l(),a(8,"div",6)(9,"div",7),h(10,"app-text-input",8),l(),a(11,"div",9)(12,"app-button",10),f("onClick",function(){return t.addNewModule()}),x(),a(13,"svg",11),h(14,"path",12),l(),c(15),u(16,"translate"),l()()()(),N(),a(17,"div",13),$(18,be,2,0),l()()(),a(19,"div",14)(20,"app-button",15),f("onClick",function(){return t.onCancel()}),c(21),u(22,"translate"),l(),a(23,"app-button",16),x(),a(24,"svg",11),h(25,"path",17),l(),c(26),u(27,"translate"),l()()()()),e&2){let o;s("title","modulesPermissions.title")("description","modulesPermissions.description")("errorMessage",t.errorMessage),r(),s("formGroup",t.modulesForm),r(),s("title","modulesPermissions.existingModules"),r(4),v(" ",m(7,17,"modulesPermissions.addNewModule")," "),r(4),s("label","modulesPermissions.moduleName")("required",!1)("placeholder","modulesPermissions.moduleNamePlaceholder"),r(2),s("fullWidth",!0)("disabled",!((o=t.modulesForm.get("newModuleName"))!=null&&o.valid)||t.loading),r(3),v(" ",m(16,19,"modulesPermissions.addModule")," "),r(3),q(t.modulesArray&&t.modulesArray.controls.length>0?18:-1),r(3),v(" ",m(22,21,"common.cancel")," "),r(2),s("disabled",t.modulesForm.invalid||t.loading)("loading",t.loading),r(3),v(" ",m(27,23,"common.save")," ")}},dependencies:[P,ie,J,W,U,ee,K,Q,Z,X,Y,I,ne,se,oe,E,re,A],styles:[".delete-icon-btn[_ngcontent-%COMP%]{background:transparent;color:#6b7280}.delete-icon-btn[_ngcontent-%COMP%]:hover{background:var(--primary-bg);color:var(--primary-text)}"]})};export{ae as ModulesPermissionsComponent};
