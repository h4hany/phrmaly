import{a as I}from"./chunk-WEX6ITFF.js";import"./chunk-TZMBWUW7.js";import"./chunk-4QDB3A4I.js";import"./chunk-M66DABPW.js";import{a as E}from"./chunk-MMBAO3XL.js";import{a as x}from"./chunk-N5CA5YND.js";import{a as D}from"./chunk-6XQQMEJ6.js";import{a as C,b as P}from"./chunk-P3MRTKB5.js";import{Da as h,Ia as v,Oa as n,Q as b,Ta as g,Xb as S,Ya as o,Za as r,_a as d,cb as f,kb as l,lb as p,mb as y,va as a,yb as m,zb as c}from"./chunk-Z4T7VGFQ.js";import"./chunk-7CGTOI24.js";function T(u,s){if(u&1&&(o(0,"app-alert",5),l(1),r()),u&2){let e=f();n("type",(e.metrics==null?null:e.metrics.systemStatus)==="down"?"error":"warning")("title",e.getSystemStatusTitle()),a(),y(" ",e.getSystemStatusDescription()," ")}}var O=class u{analyticsService=b(I);translationService=b(C);metrics=null;loading=!1;signupsData={};activePharmaciesData={};subscriptionDistributionData={};featureUsageData={};chartOptions={};ngOnInit(){this.loadData()}loadData(){this.loading=!0;let s=new Date,e=new Date;e.setMonth(e.getMonth()-1),this.analyticsService.getMetrics(e,s).subscribe({next:t=>{this.metrics=t,this.loading=!1,this.loadCharts(e,s)},error:()=>{this.loading=!1}})}loadCharts(s,e){this.analyticsService.getSignupsOverTime(s,e).subscribe({next:t=>{this.signupsData={labels:t.map(i=>i.date.toLocaleDateString()),datasets:[{label:"Signups",data:t.map(i=>i.count),borderColor:"rgba(22, 101, 52, 1)",backgroundColor:"rgba(22, 101, 52, 0.1)",fill:!0}]}}}),this.analyticsService.getActivePharmaciesOverTime(s,e).subscribe({next:t=>{this.activePharmaciesData={labels:t.map(i=>i.date.toLocaleDateString()),datasets:[{label:"Active Pharmacies",data:t.map(i=>i.count),borderColor:"rgba(59, 130, 246, 1)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0}]}}}),this.analyticsService.getSubscriptionDistribution().subscribe({next:t=>{this.subscriptionDistributionData={labels:t.map(i=>i.plan),datasets:[{data:t.map(i=>i.count),backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(22, 101, 52, 0.8)","rgba(245, 158, 11, 0.8)"]}]}}}),this.analyticsService.getFeatureUsage().subscribe({next:t=>{this.featureUsageData={labels:t.map(i=>i.module),datasets:[{label:"Usage %",data:t.map(i=>i.usagePercentage),backgroundColor:"rgba(22, 101, 52, 0.8)"}]}}}),this.chartOptions={responsive:!0,maintainAspectRatio:!1}}formatCurrency(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(s)}getSystemStatusTitle(){if(!this.metrics?.systemStatus)return"";let e=`platform.dashboard.systemStatus${this.metrics.systemStatus}`;return this.translationService.translate(e)}getSystemStatusDescription(){if(!this.metrics?.systemStatus)return"";let e=`platform.dashboard.systemStatus${this.metrics.systemStatus}Desc`;return this.translationService.translate(e)}static \u0275fac=function(e){return new(e||u)};static \u0275cmp=h({type:u,selectors:[["app-platform-dashboard"]],decls:36,vars:43,consts:[[1,"space-y-6"],[1,"text-2xl","font-bold","text-[var(--text-primary)]"],[1,"text-sm","text-[var(--card-text)]","mt-1"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4"],[3,"label","value","icon"],[3,"type","title"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-6"],[1,"text-lg","font-semibold","text-[var(--text-primary)]","mb-4"],[3,"type","data","options"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div")(2,"h1",1),l(3),m(4,"translate"),r(),o(5,"p",2),l(6),m(7,"translate"),r()(),o(8,"div",3),d(9,"app-stat-card",4)(10,"app-stat-card",4)(11,"app-stat-card",4)(12,"app-stat-card",4),r(),v(13,T,2,3,"app-alert",5),o(14,"div",6)(15,"div",7)(16,"h3",8),l(17),m(18,"translate"),r(),d(19,"app-chart",9),r(),o(20,"div",7)(21,"h3",8),l(22),m(23,"translate"),r(),d(24,"app-chart",9),r()(),o(25,"div",6)(26,"div",7)(27,"h3",8),l(28),m(29,"translate"),r(),d(30,"app-chart",9),r(),o(31,"div",7)(32,"h3",8),l(33),m(34,"translate"),r(),d(35,"app-chart",9),r()()()),e&2&&(a(3),p(c(4,31,"platform.dashboard.title")),a(3),p(c(7,33,"platform.dashboard.subtitle")),a(3),n("label","platform.dashboard.totalAccounts")("value",(t.metrics==null?null:t.metrics.totalAccounts)||0)("icon","users"),a(),n("label","platform.dashboard.totalPharmacies")("value",(t.metrics==null?null:t.metrics.totalPharmacies)||0)("icon","package"),a(),n("label","platform.dashboard.activeSubscriptions")("value",(t.metrics==null?null:t.metrics.activeSubscriptions)||0)("icon","credit-card"),a(),n("label","platform.dashboard.monthlyRevenue")("value",t.formatCurrency((t.metrics==null?null:t.metrics.monthlyRevenue)||0))("icon","chart"),a(),g((t.metrics==null?null:t.metrics.systemStatus)!=="healthy"?13:-1),a(4),p(c(18,35,"platform.dashboard.signupsOverTime")),a(2),n("type","line")("data",t.signupsData)("options",t.chartOptions),a(3),p(c(23,37,"platform.dashboard.activePharmacies")),a(2),n("type","line")("data",t.activePharmaciesData)("options",t.chartOptions),a(4),p(c(29,39,"platform.dashboard.subscriptionDistribution")),a(2),n("type","pie")("data",t.subscriptionDistributionData)("options",t.chartOptions),a(3),p(c(34,41,"platform.dashboard.featureUsage")),a(2),n("type","bar")("data",t.featureUsageData)("options",t.chartOptions))},dependencies:[S,x,E,P,D],encapsulation:2})};export{O as PlatformDashboardComponent};
