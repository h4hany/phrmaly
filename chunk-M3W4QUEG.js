import{d as v}from"./chunk-QHH3SHC3.js";import{A as p,M as o,S as c,c as g,g as u,j as i,u as U}from"./chunk-OKFD3A6M.js";import{a as n,b as m}from"./chunk-KAT7YFEL.js";var l=class s{router=c(v);currentUserSubject=new u(null);currentUser$=this.currentUserSubject.asObservable();constructor(){this.initializeFromStorage()}initializeFromStorage(){let e=localStorage.getItem("currentUser");if(e)try{let r=JSON.parse(e);this.currentUserSubject.next(r)}catch(r){console.error("Error parsing saved user:",r),localStorage.removeItem("currentUser")}}logout(){localStorage.removeItem("currentUser"),this.currentUserSubject.next(null),this.router.navigate(["/login"])}getCurrentUser(){return this.currentUserSubject.value}isAuthenticated(){return this.currentUserSubject.value!==null}hasRole(e){return this.currentUserSubject.value?.role===e}hasAnyRole(e){let r=this.currentUserSubject.value;return r?e.includes(r.role):!1}storeUser(e){let r=m(n({},e),{password:""});localStorage.setItem("currentUser",JSON.stringify(r)),this.currentUserSubject.next(r)}static \u0275fac=function(r){return new(r||s)};static \u0275prov=o({token:s,factory:s.\u0275fac})};var h=class s extends l{mockUsers=[{id:"1",email:"owner@pharmly.com",username:"owner",phone:"+1234567890",password:"password",role:"account_owner",fullName:"James Bond",avatarUrl:"https://ui-avatars.com/api/?name=James+Bond",pharmacies:[{id:"ph1",name:"Main Pharmacy",address:"123 Main St",phone:"+1234567890",email:"main@pharmly.com",primaryColor:"#166534",secondaryColor:"#22c55e",sidebarColor:"#14532d",rtlEnabled:!1},{id:"ph2",name:"Branch Pharmacy",address:"456 Branch Ave",phone:"+1234567891",email:"branch@pharmly.com",primaryColor:"#166534",secondaryColor:"#22c55e",sidebarColor:"#14532d",rtlEnabled:!1}]},{id:"2",email:"manager@pharmly.com",username:"manager",password:"",role:"pharmacy_manager",fullName:"John Manager",pharmacyId:"ph1"},{id:"3",email:"staff@pharmly.com",username:"staff",password:"password",role:"pharmacy_staff",fullName:"Jane Staff",pharmacyId:"ph1"},{id:"5",email:"inventory@pharmly.com",username:"inventory",password:"password",role:"pharmacy_inventory_manager",fullName:"Inventory Manager",avatarUrl:"https://ui-avatars.com/api/?name=Inventory+Manager",pharmacies:[{id:"ph1",name:"Main Pharmacy",address:"123 Main St",phone:"+1234567890",email:"main@pharmly.com",primaryColor:"#166534",secondaryColor:"#22c55e",sidebarColor:"#14532d",rtlEnabled:!1},{id:"ph2",name:"Branch Pharmacy",address:"456 Branch Ave",phone:"+1234567891",email:"branch@pharmly.com",primaryColor:"#166534",secondaryColor:"#22c55e",sidebarColor:"#14532d",rtlEnabled:!1}]}];constructor(){super()}login(e,r){let t=this.mockUsers.find(a=>(a.email===e||a.username===e||a.phone===e)&&(a.password===""||a.password===r));if(!t)throw new Error("Invalid credentials");if(!["account_owner","pharmacy_manager","pharmacy_staff","pharmacy_inventory_manager","pharmacy_accounting_manager"].includes(t.role))throw new Error("Access denied. Pharmacy credentials required.");return this.storeUser(t),i(t).pipe(p(500))}getPermissionContext(){let e=this.getCurrentUser();if(!e)return i({permissions:[],modules:[],limits:{maxUsers:0,maxPharmacies:0}});let r=this.getPharmacyPermissionContext(e.role);return i(r)}getPermissionContextSync(){let e=this.getCurrentUser();return e?this.getPharmacyPermissionContext(e.role):{permissions:[],modules:[],limits:{maxUsers:0,maxPharmacies:0}}}getPharmacyPermissionContext(e){switch(e){case"account_owner":return{permissions:["dashboard.view","patients.view","patients.kpi.view","patients.orders.view","patients.loyalty.view","patients.revenue.view","patients.vouchers.view","staff.view","staff.details.view","staff.performance.view","staff.risk.view","staff.activity.view","attendance.view","payroll.view","performance.view","training.view","drugs.view","drugs.create","bundles.view","inventory.alerts.view","inventory.map.view","inventory.transfers.view","inventory.movements.view","inventory.requested.view","purchases.view","purchases.create","suppliers.view","invoices.view","invoices.create","invoices.edit","invoices.actions","audit.view","payments.view","payments.methods.manage","referrals.view","settings.view","settings.account.view","system.permissions.manage","system.features.manage","system.automation.manage","system.migration.manage","reports.view","vouchers.view","vouchers.create","vouchers.edit","vouchers.actions"],modules:["dashboard","patients","staff","inventory","procurement","finance","growth","system"],limits:{maxUsers:100,maxPharmacies:10}};case"pharmacy_manager":return{permissions:["patients.view","staff.view","staff.details.view","invoices.view","invoices.create","invoices.actions","drugs.view","drugs.create","inventory.alerts.view","inventory.requested.view","settings.view","vouchers.view","vouchers.create","vouchers.edit","vouchers.actions"],modules:["patients","staff","inventory","settings"],limits:{maxUsers:50,maxPharmacies:5}};case"pharmacy_staff":return{permissions:["invoices.view","invoices.create","invoices.actions","drugs.view","drugs.create","bundles.view","inventory.map.view","inventory.transfers.view","inventory.requested.view","vouchers.view","vouchers.create","vouchers.edit","vouchers.actions","patients.vouchers.view"],modules:["invoices","drugs","bundles","inventory"],limits:{maxUsers:20,maxPharmacies:1}};case"pharmacy_inventory_manager":return{permissions:["purchases.view","purchases.create","suppliers.view","inventory.alerts.view","inventory.requested.view","invoices.view","payments.methods.manage","settings.view"],modules:["procurement","inventory","finance","settings"],limits:{maxUsers:30,maxPharmacies:3}};default:return{permissions:[],modules:[],limits:{maxUsers:0,maxPharmacies:0}}}}logout(){localStorage.removeItem("currentUser"),this.currentUserSubject.next(null),this.router.navigate(["/login"])}setMockRole(e){let r=this.getCurrentUser();if(r){let t=m(n({},r),{role:e});localStorage.setItem("currentUser",JSON.stringify(t)),this.currentUserSubject.next(t)}}static \u0275fac=function(r){return new(r||s)};static \u0275prov=o({token:s,factory:s.\u0275fac,providedIn:"root"})};var f=class s extends l{mockUsers=[{id:"4",email:"admin@pharmly.com",username:"admin",password:"password",role:"super_admin",fullName:"Super Admin",avatarUrl:"https://ui-avatars.com/api/?name=Super+Admin"},{id:"6",email:"support@pharmly.com",username:"support",password:"password",role:"support_admin",fullName:"Support Admin",avatarUrl:"https://ui-avatars.com/api/?name=Support+Admin"},{id:"7",email:"sales@pharmly.com",username:"sales",password:"password",role:"sales_admin",fullName:"Sales Admin",avatarUrl:"https://ui-avatars.com/api/?name=Sales+Admin"},{id:"8",email:"finance@pharmly.com",username:"finance",password:"password",role:"finance_admin",fullName:"Finance Admin",avatarUrl:"https://ui-avatars.com/api/?name=Finance+Admin"}];constructor(){super()}login(e,r){let t=this.mockUsers.find(a=>(a.email===e||a.username===e||a.phone===e)&&(a.password===""||a.password===r));if(!t)throw new Error("Invalid credentials");if(!["super_admin","support_admin","sales_admin","finance_admin"].includes(t.role))throw new Error("Access denied. Platform admin credentials required.");return this.storeUser(t),i(t).pipe(p(500))}getPermissionContext(){let e=this.getCurrentUser();if(!e)return i({permissions:[],modules:[],limits:{maxUsers:0,maxPharmacies:0}});let r=this.getPlatformPermissionContext(e.role);return i(r)}getPermissionContextSync(){let e=this.getCurrentUser();return e?this.getPlatformPermissionContext(e.role):{permissions:[],modules:[],limits:{maxUsers:0,maxPharmacies:0}}}getPlatformPermissionContext(e){switch(e){case"super_admin":return{permissions:["platform.accounts.view","platform.accounts.create","platform.accounts.edit","platform.accounts.delete","platform.accounts.manage","platform.subscriptions.view","platform.subscriptions.manage","platform.catalog.view","platform.catalog.manage","platform.support.view","platform.support.manage","platform.features.manage","platform.analytics.view","platform.risk.view","platform.admins.manage","platform.modules.manage","platform.permissions.manage"],modules:["platform","accounts","subscriptions","catalog","support","analytics"],limits:{maxUsers:0,maxPharmacies:0}};case"support_admin":return{permissions:["platform.accounts.view","platform.support.view","platform.support.manage","platform.catalog.view"],modules:["platform","support","catalog"],limits:{maxUsers:0,maxPharmacies:0}};case"sales_admin":return{permissions:["platform.accounts.view","platform.accounts.create","platform.subscriptions.view","platform.subscriptions.manage","platform.analytics.view"],modules:["platform","accounts","subscriptions","analytics"],limits:{maxUsers:0,maxPharmacies:0}};case"finance_admin":return{permissions:["platform.accounts.view","platform.subscriptions.view","platform.subscriptions.manage","platform.analytics.view"],modules:["platform","accounts","subscriptions","analytics"],limits:{maxUsers:0,maxPharmacies:0}};default:return{permissions:[],modules:[],limits:{maxUsers:0,maxPharmacies:0}}}}logout(){localStorage.removeItem("currentUser"),this.currentUserSubject.next(null),this.router.navigate(["/admin-login"])}static \u0275fac=function(r){return new(r||s)};static \u0275prov=o({token:s,factory:s.\u0275fac,providedIn:"root"})};var y=class s{pharmacyAuthService=c(h);platformAuthService=c(f);router=c(v);currentUserSubject=new u(null);currentUser$;constructor(){let e=this.getCurrentUser();this.currentUserSubject.next(e),U(this.pharmacyAuthService.currentUser$,this.platformAuthService.currentUser$).subscribe(()=>{let r=this.getCurrentUser();this.currentUserSubject.next(r)}),this.currentUser$=this.currentUserSubject.asObservable()}login(e,r){return this.pharmacyAuthService.login(e,r).pipe()}loginPharmacy(e,r){return this.pharmacyAuthService.login(e,r)}loginPlatform(e,r){return this.platformAuthService.login(e,r)}logout(){let e=this.getCurrentUser();e&&this.isPlatformRole(e.role)?this.platformAuthService.logout():this.pharmacyAuthService.logout()}getCurrentUser(){return this.pharmacyAuthService.getCurrentUser()||this.platformAuthService.getCurrentUser()}isAuthenticated(){return this.getCurrentUser()!==null}hasRole(e){return this.getCurrentUser()?.role===e}hasAnyRole(e){let r=this.getCurrentUser();return r?e.includes(r.role):!1}getPermissionContext(){let e=this.getCurrentUser();return e?this.isPlatformRole(e.role)?this.platformAuthService.getPermissionContext():this.pharmacyAuthService.getPermissionContext():new g(r=>{r.next({permissions:[],modules:[],limits:{maxUsers:0,maxPharmacies:0}}),r.complete()})}getPermissionContextSync(){let e=this.getCurrentUser();return e?this.isPlatformRole(e.role)?this.platformAuthService.getPermissionContextSync():this.pharmacyAuthService.getPermissionContextSync():{permissions:[],modules:[],limits:{maxUsers:0,maxPharmacies:0}}}setMockRole(e){let r=this.getCurrentUser();if(!r)return;let t=m(n({},r),{role:e});localStorage.setItem("currentUser",JSON.stringify(t)),this.isPlatformRole(e)?this.platformAuthService.currentUserSubject?.next(t):this.pharmacyAuthService.setMockRole?this.pharmacyAuthService.setMockRole(e):this.pharmacyAuthService.currentUserSubject?.next(t),this.currentUserSubject.next(t)}isPlatformRole(e){return["super_admin","support_admin","sales_admin","finance_admin"].includes(e)}static \u0275fac=function(r){return new(r||s)};static \u0275prov=o({token:s,factory:s.\u0275fac,providedIn:"root"})};export{y as a};
