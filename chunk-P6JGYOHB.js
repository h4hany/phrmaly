import{a as u}from"./chunk-FXA7JHBB.js";import{a as m}from"./chunk-GHDX2O3N.js";import{K as h,Q as f,i as s,y as i}from"./chunk-ILVQMZIM.js";import{a as c,b as d}from"./chunk-7CGTOI24.js";var y=class p{pharmacyContextService=f(m);eventBus=f(u);transfers=[{id:"TRF001",pharmacyId:"ph1",fromBranchId:"branch1",fromBranchName:"Main Branch",toBranchId:"branch2",toBranchName:"North Branch",items:[{drugId:"PDRG001",drugName:"Paracetamol 500mg",requestedQuantity:50,approvedQuantity:50},{drugId:"PDRG002",drugName:"Ibuprofen 200mg",requestedQuantity:30,approvedQuantity:30}],status:"approved",requestedBy:"staff1",requestedByName:"John Doe",approvedBy:"manager1",approvedByName:"Manager",createdAt:new Date("2024-11-25"),updatedAt:new Date("2024-11-26"),createdBy:"staff1"}];getTransfers(a){let e=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!e)return s({data:[],total:0,page:1,pageSize:10,totalPages:0}).pipe(i(300));let r=this.transfers.filter(v=>v.pharmacyId===e),n=a?.page||1,t=a?.pageSize||10,o=(n-1)*t,g=o+t,l=r.slice(o,g);return s({data:l,total:r.length,page:n,pageSize:t,totalPages:Math.ceil(r.length/t)}).pipe(i(500))}getTransferById(a){let e=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!e)return s(null).pipe(i(300));let r=this.transfers.find(n=>n.id===a&&n.pharmacyId===e);return s(r||null).pipe(i(300))}createTransfer(a){let e=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!e)throw new Error("No pharmacy context");let r=d(c({},a),{id:`TRF${String(this.transfers.length+1).padStart(3,"0")}`,pharmacyId:e,status:"pending",createdAt:new Date,updatedAt:new Date});return this.transfers.push(r),this.eventBus.emit({type:"transfer_created",payload:r,source:"transfer-engine"}),s(r).pipe(i(500))}updateTransferStatus(a,e,r){let n=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!n)throw new Error("No pharmacy context");let t=this.transfers.findIndex(o=>o.id===a&&o.pharmacyId===n);if(t===-1)throw new Error("Transfer not found");return this.transfers[t]=d(c({},this.transfers[t]),{status:e,approvedBy:r||this.transfers[t].approvedBy,updatedAt:new Date}),s(this.transfers[t]).pipe(i(500))}static \u0275fac=function(e){return new(e||p)};static \u0275prov=h({token:p,factory:p.\u0275fac,providedIn:"root"})};export{y as a};
