import{a as j}from"./chunk-X6VRM7CQ.js";import{a as H}from"./chunk-NMDNQUB4.js";import{a as F}from"./chunk-QDLVDHOW.js";import{c as x,e as B,g as E,o as O,p as P,q as L,w as W}from"./chunk-TK76J465.js";import{a as N}from"./chunk-6CFKC637.js";import{a as z}from"./chunk-B5SRLSM4.js";import{a as R}from"./chunk-EIOKHCL2.js";import"./chunk-5PFWNSG3.js";import"./chunk-T542ZMY7.js";import"./chunk-URFUYTQU.js";import"./chunk-BYXBJQAS.js";import{b as A}from"./chunk-3UJCRMW3.js";import"./chunk-C3O3TVFX.js";import{$a as n,Ab as d,Bb as p,Fa as T,Q as y,Qa as c,Y as _,Ya as I,Z as k,Za as w,_a as r,_b as M,ab as g,db as h,mb as s,nb as m,ob as S,tb as u,ub as v,vb as b,wa as a}from"./chunk-E4S7NVXB.js";import{a as C,b as D}from"./chunk-C6Q5SG76.js";var G=(f,t)=>t.id;function Y(f,t){if(f&1&&(r(0,"option",12),s(1),n()),f&2){let i=t.$implicit;c("value",i.id),a(),m(i.fullName)}}var V=class f{attendanceService=y(j);staffService=y(H);loading=!1;showCheckInModal=!1;attendanceRecords=[];staffList=[];filters={staffId:"",startDate:"",endDate:""};todayStats={onShift:0,late:0,absent:0,present:0};pagination={page:1,pageSize:10,total:0,totalPages:0};columns=[{key:"date",label:"hr.attendance.date",sortable:!0},{key:"staffName",label:"hr.attendance.staff",sortable:!0},{key:"checkInTime",label:"hr.attendance.checkIn",sortable:!0},{key:"checkOutTime",label:"hr.attendance.checkOut",sortable:!0},{key:"totalHours",label:"hr.attendance.hours",sortable:!0},{key:"status",label:"hr.attendance.status",sortable:!0}];attendanceTrendData={};lateByStaffData={};chartOptions={};ngOnInit(){let t=new Date,i=new Date(t.getFullYear(),t.getMonth(),1);this.filters.startDate=i.toISOString().split("T")[0],this.filters.endDate=t.toISOString().split("T")[0],this.loadStaff(),this.loadAttendance(),this.loadTodayStats()}loadStaff(){this.staffService.getAll({page:1,pageSize:100}).subscribe({next:t=>{this.staffList=t.data}})}loadAttendance(){this.loading=!0;let t={page:this.pagination.page,pageSize:this.pagination.pageSize};this.filters.staffId&&(t.staffId=this.filters.staffId),this.filters.startDate&&(t.startDate=new Date(this.filters.startDate)),this.filters.endDate&&(t.endDate=new Date(this.filters.endDate)),this.attendanceService.getAttendanceRecords(t).subscribe({next:i=>{this.attendanceRecords=i.data.map(e=>D(C({},e),{date:new Date(e.date).toLocaleDateString(),checkInTime:e.checkInTime?new Date(e.checkInTime).toLocaleTimeString():"-",checkOutTime:e.checkOutTime?new Date(e.checkOutTime).toLocaleTimeString():"-",totalHours:e.totalHours?`${e.totalHours}h`:"-",status:e.status})),this.pagination={page:i.page,pageSize:i.pageSize,total:i.total,totalPages:i.totalPages},this.loading=!1,this.loadCharts()},error:()=>{this.loading=!1}})}loadTodayStats(){let t=new Date;t.setHours(0,0,0,0),this.attendanceService.getAttendanceRecords({startDate:t,endDate:t,page:1,pageSize:100}).subscribe({next:i=>{let e=i.data;this.todayStats={onShift:e.filter(o=>o.status==="present"&&!o.checkOutTime).length,late:e.filter(o=>o.status==="late").length,absent:e.filter(o=>o.status==="absent").length,present:e.filter(o=>o.status==="present").length}}})}loadCharts(){this.attendanceTrendData={labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"Attendance %",data:[95,98,97,96,99,85,90],borderColor:"var(--primary-color)",backgroundColor:"rgba(22, 101, 52, 0.1)"}]},this.lateByStaffData={labels:this.staffList.slice(0,5).map(t=>t.fullName),datasets:[{label:"Late Arrivals",data:[2,5,1,3,0],backgroundColor:"rgba(245, 158, 11, 0.8)"}]},this.chartOptions={responsive:!0,maintainAspectRatio:!1}}applyFilters(){this.pagination.page=1,this.loadAttendance()}onPageChange(t){this.pagination.page=t,this.loadAttendance()}static \u0275fac=function(i){return new(i||f)};static \u0275cmp=T({type:f,selectors:[["app-attendance"]],decls:55,vars:55,consts:[[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-[var(--text-primary)]"],["variant","primary",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[3,"label","value","icon"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-4"],[1,"block","text-sm","font-medium","text-[var(--card-text)]","mb-1"],[1,"w-full","px-4","py-2","border","border-[var(--border-color)]","rounded-[var(--radius-md)]","text-sm","bg-[var(--card-bg)]","text-[var(--text-primary)]",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["type","date",1,"w-full","px-4","py-2","border","border-[var(--border-color)]","rounded-[var(--radius-md)]","text-sm","bg-[var(--card-bg)]","text-[var(--text-primary)]",3,"ngModelChange","ngModel"],[1,"flex","items-end"],["variant","primary","size","sm",3,"onClick"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-6"],[3,"onPageChange","columns","data","pagination","loading","emptyMessage"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"text-lg","font-semibold","text-[var(--text-primary)]","mb-4"],[3,"type","data","options"]],template:function(i,e){i&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2),s(3),d(4,"translate"),n(),r(5,"app-button",3),h("onClick",function(){return e.showCheckInModal=!0}),_(),r(6,"svg",4),g(7,"path",5),n(),s(8),d(9,"translate"),n()(),k(),r(10,"div",6),g(11,"app-stat-card",7)(12,"app-stat-card",7)(13,"app-stat-card",7)(14,"app-stat-card",7),n(),r(15,"div",8)(16,"div",6)(17,"div")(18,"label",9),s(19),d(20,"translate"),n(),r(21,"select",10),b("ngModelChange",function(l){return v(e.filters.staffId,l)||(e.filters.staffId=l),l}),r(22,"option",11),s(23),d(24,"translate"),n(),I(25,Y,2,2,"option",12,G),n()(),r(27,"div")(28,"label",9),s(29),d(30,"translate"),n(),r(31,"input",13),b("ngModelChange",function(l){return v(e.filters.startDate,l)||(e.filters.startDate=l),l}),n()(),r(32,"div")(33,"label",9),s(34),d(35,"translate"),n(),r(36,"input",13),b("ngModelChange",function(l){return v(e.filters.endDate,l)||(e.filters.endDate=l),l}),n()(),r(37,"div",14)(38,"app-button",15),h("onClick",function(){return e.applyFilters()}),s(39),d(40,"translate"),n()()()(),r(41,"div",16)(42,"app-table",17),d(43,"translate"),h("onPageChange",function(l){return e.onPageChange(l)}),n()(),r(44,"div",18)(45,"div",16)(46,"h3",19),s(47),d(48,"translate"),n(),g(49,"app-chart",20),n(),r(50,"div",16)(51,"h3",19),s(52),d(53,"translate"),n(),g(54,"app-chart",20),n()()()),i&2&&(a(3),m(p(4,35,"hr.attendance.title")),a(5),S(" ",p(9,37,"hr.attendance.checkIn")," "),a(3),c("label","hr.attendance.onShift")("value",e.todayStats.onShift)("icon","users"),a(),c("label","hr.attendance.late")("value",e.todayStats.late)("icon","clock"),a(),c("label","hr.attendance.absent")("value",e.todayStats.absent)("icon","x-circle"),a(),c("label","hr.attendance.present")("value",e.todayStats.present)("icon","check-circle"),a(5),m(p(20,39,"hr.attendance.staff")),a(2),u("ngModel",e.filters.staffId),a(2),m(p(24,41,"common.all")),a(2),w(e.staffList),a(4),m(p(30,43,"hr.attendance.startDate")),a(2),u("ngModel",e.filters.startDate),a(3),m(p(35,45,"hr.attendance.endDate")),a(2),u("ngModel",e.filters.endDate),a(3),S(" ",p(40,47,"common.search")," "),a(3),c("columns",e.columns)("data",e.attendanceRecords)("pagination",e.pagination)("loading",e.loading)("emptyMessage",p(43,49,"hr.attendance.noRecords")),a(5),m(p(48,51,"hr.attendance.trend")),a(2),c("type","line")("data",e.attendanceTrendData)("options",e.chartOptions),a(3),m(p(53,53,"hr.attendance.lateByStaff")),a(2),c("type","bar")("data",e.lateByStaffData)("options",e.chartOptions))},dependencies:[M,W,P,L,x,O,B,E,F,N,A,R,z],encapsulation:2})};export{V as AttendanceComponent};
