import{a as l}from"./chunk-M3W4QUEG.js";import{M as m,S as p,g as u}from"./chunk-OKFD3A6M.js";var c={routes:{"/dashboard":["dashboard.view"],"/patients":["patients.view"],"/patients/:id":["patients.view"],"/pharmacy-staff":["staff.view"],"/pharmacy-staff/:id":["staff.view"],"/people/payroll":["payroll.view"],"/people/attendance":["attendance.view"],"/people/performance":["performance.view"],"/purchases":["purchases.view"],"/suppliers":["suppliers.view"],"/audit-logs":["audit.view"],"/inventory/movements":["inventory.movements.view"],"/growth/referrals":["referrals.view"],"/system/permissions":["system.permissions.manage"],"/system/features":["system.features.manage"],"/settings":["settings.view"],"/invoices":["invoices.view"],"/invoices/new":["invoices.create"],"/invoices/:id":["invoices.view"],"/invoices/:id/edit":["invoices.edit"],"/drugs":["drugs.view"],"/drugs/new":["drugs.create"],"/bundles":["bundles.view"],"/inventory/map":["inventory.map.view"],"/inventory/transfers":["inventory.transfers.view"],"/inventory/alerts":["inventory.alerts.view"],"/inventory/requested-products":["inventory.requested.view"],"/payments/methods":["payments.methods.manage"],"/vouchers":["vouchers.view"],"/vouchers/new":["vouchers.create"],"/purchases/new":["purchases.create"],"/vouchers/:id/edit":["vouchers.edit"]},groups:{overview:["dashboard.view"],operations:["patients.view","staff.view"],people:["attendance.view","payroll.view","performance.view"],inventory:["drugs.view","inventory.alerts.view","inventory.map.view"],procurement:["purchases.view","suppliers.view"],finance:["invoices.view","audit.view","inventory.movements.view"],growth:["referrals.view"],system:["settings.view","system.permissions.manage","payments.methods.manage"],support:["bundles.view","vouchers.view"]},items:{"/dashboard":["dashboard.view"],"/invoices":["invoices.view"],"/patients":["patients.view"],"/pharmacy-staff":["staff.view"],"/people/payroll":["payroll.view"],"/people/performance":["performance.view"],"/people/attendance":["attendance.view"],"/people/training":["training.view"],"/drugs":["drugs.view"],"/bundles":["bundles.view"],"/inventory/alerts":["inventory.alerts.view"],"/inventory/requested-products":["inventory.requested.view"],"/inventory/transfers":["inventory.transfers.view"],"/inventory/map":["inventory.map.view"],"/purchases":["purchases.view"],"/suppliers":["suppliers.view"],"/payments":["payments.view"],"/payments/methods":["payments.methods.manage"],"/audit-logs":["audit.view"],"/inventory/movements":["inventory.movements.view"],"/growth/referrals":["referrals.view"],"/system/automation":["system.automation.manage"],"/system/migration":["system.migration.manage"],"/system/permissions":["system.permissions.manage"],"/system/features":["system.features.manage"],"/settings":["settings.view"],"/reports":["reports.view"],"/vouchers":["vouchers.view"]},features:{"patient.overview.kpi-cards":["patients.kpi.view"],"patient.tabs.orders":["patients.orders.view"],"patient.tabs.loyalty":["patients.loyalty.view"],"patient.tabs.revenue":["patients.revenue.view"],"staff.tabs.details":["staff.details.view"],"staff.tabs.performance":["staff.performance.view"],"staff.tabs.risk":["staff.risk.view"],"staff.tabs.activity":["staff.activity.view"],"invoice.create":["invoices.create"],"invoice.actions":["invoices.actions"],"settings.tabs.account":["settings.account.view"],"voucher.view":["vouchers.view"],"voucher.create":["vouchers.create"],"voucher.edit":["vouchers.edit"],"voucher.actions":["vouchers.actions"],"patient.tabs.vouchers":["patients.vouchers.view"]}};function n(r,e){return c[r][e]||[]}function v(r,e){if(r===e)return!0;let s=r.replace(/:[^/]+/g,"[^/]+").replace(/\//g,"\\/");return new RegExp(`^${s}$`).test(e)}var h=class r{authService=p(l);permissionContextSubject=new u(null);permissionContext$=this.permissionContextSubject.asObservable();constructor(){if(this.authService.getCurrentUser()){let s=this.authService.getPermissionContextSync();s&&this.permissionContextSubject.next(s)}this.authService.currentUser$.subscribe(()=>{this.loadPermissionContext()})}loadPermissionContext(){this.authService.getPermissionContext().subscribe(e=>{this.permissionContextSubject.next(e)})}getPermissionContext(){return this.permissionContextSubject.value}hasPermission(e){let s=this.getPermissionContext();return s?s.permissions.includes(e):!1}hasAnyPermission(e){return e.length===0?!1:e.some(s=>this.hasPermission(s))}canAccessRoute(e){let s=this.getPermissionContext();if(!s){let i=this.authService.getPermissionContextSync();if(i)this.permissionContextSubject.next(i),s=i;else return!1}let t=e.split("?")[0].replace(/\/$/,"")||"/",o=n("routes",t);if(o.length>0)return this.hasAnyPermission(o);for(let i of Object.keys(c.routes))if(v(i,t)){let a=n("routes",i);if(a.length>0)return this.hasAnyPermission(a)}return!1}canAccessGroup(e){if(!this.getPermissionContext())return!1;let t=n("groups",e);return this.hasAnyPermission(t)}canAccessItem(e){if(!this.getPermissionContext())return!1;let t=e.split("?")[0].replace(/\/$/,"")||"/",o=n("items",t);if(o.length>0)return this.hasAnyPermission(o);for(let i of Object.keys(c.items))if(v(i,t)){let a=n("items",i);if(a.length>0)return this.hasAnyPermission(a)}return!1}canAccessFeature(e){if(!this.getPermissionContext())return!1;let t=n("features",e);return this.hasAnyPermission(t)}hasRole(e){return this.authService.getCurrentUser()?.role===e}hasAnyRole(e){let s=this.authService.getCurrentUser();return s?e.includes(s.role):!1}getHomeRoute(){let e=this.authService.getCurrentUser();if(!e)return"/login";let s=e.role;if(s==="super_admin"||s==="support_admin"||s==="sales_admin"||s==="finance_admin")return"/super-admin/dashboard";if(this.hasPermission("dashboard.view"))return"/dashboard";if(this.hasPermission("drugs.view"))return"/drugs";if(this.hasPermission("inventory.alerts.view"))return"/inventory/alerts";if(this.hasPermission("invoices.view"))return"/invoices";switch(s){case"pharmacy_manager":case"pharmacy_staff":return"/drugs";case"pharmacy_inventory_manager":return"/inventory/alerts";case"account_owner":default:return"/dashboard"}}getPermissionContext$(){return this.permissionContext$}static \u0275fac=function(s){return new(s||r)};static \u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})};export{h as a};
