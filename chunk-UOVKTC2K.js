import{a as ee}from"./chunk-CCTNJWMZ.js";import{a as Y,b as Z}from"./chunk-6KZOTGJV.js";import{e as W,g as L,n as V,o as U,p as H,u as Q}from"./chunk-YODUIR4B.js";import{a as G}from"./chunk-EMAOCJ4C.js";import"./chunk-FRIZRQKD.js";import"./chunk-BYXBJQAS.js";import{a as X}from"./chunk-CYU2XYT2.js";import{a as K}from"./chunk-BHTDODCV.js";import{a as J}from"./chunk-VSEEBRBA.js";import{b as $}from"./chunk-P3MRTKB5.js";import"./chunk-B4EO6REF.js";import{Da as B,Ia as R,K as A,Oa as y,Q as b,Ta as q,Wa as z,Xa as k,Xb as F,Y as E,Ya as r,Z as D,Za as o,_a as O,bb as w,cb as N,i as f,kb as l,lb as m,mb as S,nb as j,rb as I,sb as T,tb as M,va as n,y as h,yb as p,zb as d}from"./chunk-Z4T7VGFQ.js";import{a as P,b as _}from"./chunk-7CGTOI24.js";var C=class u{pharmacyContextService=b(G);modules=[{id:"TM001",pharmacyId:"ph1",title:"Pharmacy Safety Protocols",description:"Essential safety procedures for handling medications",category:"safety",difficulty:"beginner",estimatedDuration:30,videoUrl:"https://example.com/video1",content:"<p>Learn about proper medication handling, storage, and disposal procedures.</p>",quiz:{questions:[{id:"Q1",question:"What is the proper temperature for storing most medications?",type:"multiple_choice",options:["Room temperature (20-25\xB0C)","Refrigerated (2-8\xB0C)","Frozen (-20\xB0C)","Any temperature"],correctAnswer:0,points:10},{id:"Q2",question:"Expired medications should be disposed of immediately.",type:"true_false",correctAnswer:1,points:10}],passingScore:70},isRequired:!0,isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01"),createdBy:"admin"},{id:"TM002",pharmacyId:"ph1",title:"Customer Service Excellence",description:"Best practices for customer interactions",category:"customer_service",difficulty:"intermediate",estimatedDuration:45,content:"<p>Learn how to provide exceptional customer service in a pharmacy setting.</p>",isRequired:!1,isActive:!0,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15"),createdBy:"admin"}];certifications=[{id:"CERT001",pharmacyId:"ph1",staffId:"ST001",staffName:"Sarah Johnson",moduleId:"TM001",moduleTitle:"Pharmacy Safety Protocols",status:"completed",startedAt:new Date("2024-11-01"),completedAt:new Date("2024-11-01"),score:90,maxScore:100,passingScore:70,passed:!0,attempts:1,lastAttemptAt:new Date("2024-11-01"),certificateUrl:"https://example.com/cert1.pdf",createdAt:new Date("2024-11-01"),updatedAt:new Date("2024-11-01")},{id:"CERT002",pharmacyId:"ph1",staffId:"ST002",staffName:"Michael Chen",moduleId:"TM001",moduleTitle:"Pharmacy Safety Protocols",status:"in_progress",startedAt:new Date("2024-11-20"),attempts:1,lastAttemptAt:new Date("2024-11-20"),createdAt:new Date("2024-11-20"),updatedAt:new Date("2024-11-20")}];getModules(e){let t=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!t)return f({data:[],total:0,page:1,pageSize:10,totalPages:0}).pipe(h(300));let i=this.modules.filter(c=>c.pharmacyId===t&&c.isActive);e?.category&&(i=i.filter(c=>c.category===e.category)),e?.isRequired!==void 0&&(i=i.filter(c=>c.isRequired===e.isRequired));let a=e?.page||1,s=e?.pageSize||10,g=(a-1)*s,x=g+s,v=i.slice(g,x);return f({data:v,total:i.length,page:a,pageSize:s,totalPages:Math.ceil(i.length/s)}).pipe(h(500))}getModuleById(e){let t=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!t)return f(null).pipe(h(300));let i=this.modules.find(a=>a.id===e&&a.pharmacyId===t);return f(i||null).pipe(h(300))}getCertifications(e){let t=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!t)return f({data:[],total:0,page:1,pageSize:10,totalPages:0}).pipe(h(300));let i=this.certifications.filter(c=>c.pharmacyId===t);e?.staffId&&(i=i.filter(c=>c.staffId===e.staffId)),e?.status&&(i=i.filter(c=>c.status===e.status));let a=e?.page||1,s=e?.pageSize||10,g=(a-1)*s,x=g+s,v=i.slice(g,x);return f({data:v,total:i.length,page:a,pageSize:s,totalPages:Math.ceil(i.length/s)}).pipe(h(500))}startTraining(e,t){let i=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!i)throw new Error("No pharmacy selected");let a=this.certifications.find(g=>g.pharmacyId===i&&g.staffId===e&&g.moduleId===t);if(a)return a.status="in_progress",a.updatedAt=new Date,f(a).pipe(h(300));let s=this.modules.find(g=>g.id===t&&g.pharmacyId===i);if(!s)throw new Error("Training module not found");return a={id:`CERT${Date.now()}`,pharmacyId:i,staffId:e,moduleId:t,moduleTitle:s.title,status:"in_progress",startedAt:new Date,attempts:0,createdAt:new Date,updatedAt:new Date},this.certifications.push(a),f(a).pipe(h(500))}completeTraining(e,t,i){let a=this.certifications.find(c=>c.id===e);if(!a)throw new Error("Certification not found");let g=this.modules.find(c=>c.id===a.moduleId)?.quiz?.passingScore||70,v=t/i*100>=g;return a.status=v?"completed":"failed",a.completedAt=new Date,a.score=t,a.maxScore=i,a.passingScore=g,a.passed=v,a.attempts=(a.attempts||0)+1,a.lastAttemptAt=new Date,a.updatedAt=new Date,v&&(a.certificateUrl=`https://example.com/certificates/${e}.pdf`),f(a).pipe(h(500))}getStaffCertifications(e){let t=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!t)return f([]).pipe(h(300));let i=this.certifications.filter(a=>a.pharmacyId===t&&a.staffId===e);return f(i).pipe(h(300))}static \u0275fac=function(t){return new(t||u)};static \u0275prov=A({token:u,factory:u.\u0275fac,providedIn:"root"})};var ae=(u,e)=>e.id;function ne(u,e){u&1&&(r(0,"app-badge",27),l(1),p(2,"translate"),o()),u&2&&(n(),m(d(2,1,"hr.training.required")))}function re(u,e){if(u&1&&(r(0,"div",22)(1,"div",25)(2,"h3",26),l(3),o(),R(4,ne,3,3,"app-badge",27),o(),r(5,"p",28),l(6),o(),r(7,"div",29)(8,"span"),l(9),p(10,"translate"),o(),r(11,"app-badge",30),l(12),o()(),r(13,"app-button",31),l(14),p(15,"translate"),o()()),u&2){let t=e.$implicit,i=N();n(3),m(t.title),n(),q(t.isRequired?4:-1),n(2),m(t.description),n(3),j("",d(10,8,"hr.training.duration"),": ",t.estimatedDuration,"m"),n(2),y("variant",i.getDifficultyVariant(t.difficulty)),n(),S(" ",t.difficulty," "),n(2),S(" ",d(15,10,"hr.training.start")," ")}}var te=class u{trainingService=b(C);staffService=b(ee);loading=!1;modules=[];certifications=[];filters={category:"",isRequired:""};pagination={page:1,pageSize:10,total:0,totalPages:0};certificationColumns=[{key:"staffName",label:"hr.training.staff",sortable:!0},{key:"moduleTitle",label:"hr.training.module",sortable:!0},{key:"status",label:"hr.training.status",sortable:!0},{key:"score",label:"hr.training.score",sortable:!0},{key:"completedAt",label:"hr.training.completedAt",sortable:!0}];ngOnInit(){this.loadModules(),this.loadCertifications()}loadModules(){this.loading=!0;let e={page:1,pageSize:100};this.filters.category&&(e.category=this.filters.category),this.filters.isRequired!==""&&(e.isRequired=this.filters.isRequired==="true"),this.trainingService.getModules(e).subscribe({next:t=>{this.modules=t.data,this.loading=!1},error:()=>{this.loading=!1}})}loadCertifications(){this.trainingService.getCertifications({page:this.pagination.page,pageSize:this.pagination.pageSize}).subscribe({next:e=>{this.certifications=e.data.map(t=>_(P({},t),{status:t.status,score:t.score?`${t.score}/${t.maxScore}`:"-",completedAt:t.completedAt?new Date(t.completedAt).toLocaleDateString():"-"})),this.pagination={page:e.page,pageSize:e.pageSize,total:e.total,totalPages:e.totalPages}}})}getDifficultyVariant(e){return{beginner:"success",intermediate:"info",advanced:"warning"}[e]||"default"}applyFilters(){this.loadModules()}onPageChange(e){this.pagination.page=e,this.loadCertifications()}static \u0275fac=function(t){return new(t||u)};static \u0275cmp=B({type:u,selectors:[["app-training"]],decls:66,vars:61,consts:[[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-[var(--text-primary)]"],["variant","primary"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[3,"title","active"],[1,"space-y-6","p-6"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"block","text-sm","font-medium","text-[var(--card-text)]","mb-1"],[1,"w-full","px-4","py-2","border","border-[var(--border-color)]","rounded-[var(--radius-md)]","text-sm","bg-[var(--card-bg)]","text-[var(--text-primary)]",3,"ngModelChange","ngModel"],["value",""],["value","safety"],["value","compliance"],["value","sales"],["value","inventory"],["value","customer_service"],[3,"value"],[1,"flex","items-end"],["variant","primary","size","sm",3,"onClick"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-6","hover:shadow-md","transition-shadow"],[1,"bg-[var(--card-bg)]","rounded-[var(--radius-lg)]","shadow-[var(--shadow-sm)]","p-6"],[3,"onPageChange","columns","data","pagination","loading","emptyMessage"],[1,"flex","items-start","justify-between","mb-4"],[1,"text-lg","font-semibold","text-[var(--text-primary)]"],["variant","warning"],[1,"text-sm","text-[var(--card-text)]","mb-4"],[1,"flex","items-center","justify-between","text-xs","text-[var(--card-text)]","mb-4"],[3,"variant"],["variant","outline","size","sm",1,"w-full"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2),l(3),p(4,"translate"),o(),r(5,"app-button",3),E(),r(6,"svg",4),O(7,"path",5),o(),l(8),p(9,"translate"),o()(),D(),r(10,"app-tabs")(11,"app-tab",6),p(12,"translate"),r(13,"div",7)(14,"div",8)(15,"div",9)(16,"div")(17,"label",10),l(18),p(19,"translate"),o(),r(20,"select",11),M("ngModelChange",function(s){return T(i.filters.category,s)||(i.filters.category=s),s}),r(21,"option",12),l(22),p(23,"translate"),o(),r(24,"option",13),l(25),p(26,"translate"),o(),r(27,"option",14),l(28),p(29,"translate"),o(),r(30,"option",15),l(31),p(32,"translate"),o(),r(33,"option",16),l(34),p(35,"translate"),o(),r(36,"option",17),l(37),p(38,"translate"),o()()(),r(39,"div")(40,"label",10),l(41),p(42,"translate"),o(),r(43,"select",11),M("ngModelChange",function(s){return T(i.filters.isRequired,s)||(i.filters.isRequired=s),s}),r(44,"option",12),l(45),p(46,"translate"),o(),r(47,"option",18),l(48),p(49,"translate"),o(),r(50,"option",18),l(51),p(52,"translate"),o()()(),r(53,"div",19)(54,"app-button",20),w("onClick",function(){return i.applyFilters()}),l(55),p(56,"translate"),o()()()(),r(57,"div",21),z(58,re,16,12,"div",22,ae),o()()(),r(60,"app-tab",6),p(61,"translate"),r(62,"div",7)(63,"div",23)(64,"app-table",24),p(65,"translate"),w("onPageChange",function(s){return i.onPageChange(s)}),o()()()()()()),t&2&&(n(3),m(d(4,27,"hr.training.title")),n(5),S(" ",d(9,29,"hr.training.createModule")," "),n(3),y("title",d(12,31,"hr.training.modules"))("active",!0),n(7),m(d(19,33,"hr.training.category")),n(2),I("ngModel",i.filters.category),n(2),m(d(23,35,"common.all")),n(3),m(d(26,37,"hr.training.categorySafety")),n(3),m(d(29,39,"hr.training.categoryCompliance")),n(3),m(d(32,41,"hr.training.categorySales")),n(3),m(d(35,43,"hr.training.categoryInventory")),n(3),m(d(38,45,"hr.training.categoryCustomerService")),n(4),m(d(42,47,"hr.training.required")),n(2),I("ngModel",i.filters.isRequired),n(2),m(d(46,49,"common.all")),n(2),y("value",!0),n(),m(d(49,51,"common.yes")),n(2),y("value",!1),n(),m(d(52,53,"common.no")),n(4),S(" ",d(56,55,"common.search")," "),n(3),k(i.modules),n(2),y("title",d(61,57,"hr.training.certifications"))("active",!1),n(4),y("columns",i.certificationColumns)("data",i.certifications)("pagination",i.pagination)("loading",i.loading)("emptyMessage",d(65,59,"hr.training.noCertifications")))},dependencies:[F,Q,U,H,V,W,L,X,K,$,J,Z,Y],encapsulation:2})};export{te as TrainingComponent};
