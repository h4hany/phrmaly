import{a as J}from"./chunk-MLXERHHV.js";import{a as K}from"./chunk-TCUYX7IT.js";import{a as z}from"./chunk-XG6FMBJJ.js";import{c as M,d,e as G,f as P,h as T,i as V,j as q,k as O,n as Q,o as $,p as L,q as R,s as j,u as U,v as W,x as Y}from"./chunk-TK76J465.js";import{a as H}from"./chunk-6CFKC637.js";import{b as A}from"./chunk-3UJCRMW3.js";import{b as B,d as w}from"./chunk-C3O3TVFX.js";import{$a as r,Ab as s,Bb as p,Fa as E,Ka as b,Q as f,Qa as g,Sa as h,Va as S,Ya as F,Za as _,_a as t,_b as N,ab as m,db as C,eb as I,mb as i,nb as v,ob as D,pb as k,wa as a}from"./chunk-E4S7NVXB.js";import"./chunk-C6Q5SG76.js";var Z=(l,e)=>e.id;function ee(l,e){if(l&1&&m(0,"app-alert",1),l&2){let o=I();g("title",o.errorMessage)}}function te(l,e){if(l&1&&(t(0,"option",8),i(1),r()),l&2){let o=e.$implicit;g("value",o.id),a(),k("",o.name," - ",o.manufacturer,"")}}function re(l,e){l&1&&(t(0,"p",9),i(1,"General drug is required"),r())}function ie(l,e){l&1&&(t(0,"p",9),i(1,"Internal barcode is required (6-8 digits)"),r())}var X=class l{fb=f(W);router=f(w);route=f(B);drugsService=f(K);drugForm;loading=!1;errorMessage="";isEdit=!1;drugId=null;generalDrugs=[];ngOnInit(){this.drugId=this.route.snapshot.paramMap.get("id"),this.isEdit=!!this.drugId,this.drugForm=this.fb.group({generalDrugId:["",[d.required]],internalBarcode:["",[d.required,d.minLength(6),d.maxLength(8)]],price:[0,[d.required,d.min(0)]],priceAfterDiscount:[0,[d.min(0)]],stockQuantity:[0,[d.required,d.min(0)]],minimumStock:[0,[d.required,d.min(0)]],expiryDate:[""],status:["active"],classification:["medicinal"],origin:["local"]}),this.loadGeneralDrugs(),this.isEdit&&this.drugId&&this.loadDrug()}loadGeneralDrugs(){this.drugsService.getAllGeneralDrugs().subscribe({next:e=>{this.generalDrugs=e}})}loadDrug(){this.drugsService.getPharmacyDrugById(this.drugId).subscribe({next:e=>{e&&this.drugForm.patchValue({generalDrugId:e.generalDrugId,internalBarcode:e.internalBarcode,price:e.price,priceAfterDiscount:e.priceAfterDiscount,stockQuantity:e.stockQuantity,minimumStock:e.minimumStock,expiryDate:e.expiryDate?this.formatDateForInput(e.expiryDate):"",status:e.status,classification:e.classification||"medicinal",origin:e.origin||"local"})},error:()=>{this.errorMessage="Failed to load drug data"}})}onSubmit(){if(this.drugForm.valid){this.loading=!0,this.errorMessage="";let e=this.drugForm.value,o={generalDrugId:e.generalDrugId,pharmacyId:"ph1",internalBarcode:e.internalBarcode,price:e.price,priceAfterDiscount:e.priceAfterDiscount||e.price,stockQuantity:e.stockQuantity,minimumStock:e.minimumStock,expiryDate:e.expiryDate?new Date(e.expiryDate):void 0,status:e.status,classification:e.classification,origin:e.origin};(this.isEdit?this.drugsService.updatePharmacyDrug(this.drugId,o):this.drugsService.createPharmacyDrug(o)).subscribe({next:()=>{this.router.navigate(["/drugs"])},error:u=>{this.errorMessage=u.message||"An error occurred while saving the drug",this.loading=!1}})}else Object.keys(this.drugForm.controls).forEach(e=>{this.drugForm.get(e)?.markAsTouched()})}onCancel(){this.router.navigate(["/drugs"])}formatDateForInput(e){let o=new Date(e),n=o.getFullYear(),u=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0");return`${n}-${u}-${c}`}static \u0275fac=function(o){return new(o||l)};static \u0275cmp=E({type:l,selectors:[["app-drug-form"]],decls:93,vars:30,consts:[[3,"title"],["type","error",3,"title"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["formControlName","generalDrugId",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["value",""],[3,"value"],[1,"mt-1","text-sm","text-red-600"],["type","text","formControlName","internalBarcode","placeholder","6-8 digits","maxlength","8",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","number","formControlName","price","step","0.01","min","0",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","number","formControlName","priceAfterDiscount","step","0.01","min","0",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","number","formControlName","stockQuantity","min","0",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","number","formControlName","minimumStock","min","0",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","date","formControlName","expiryDate",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["formControlName","status",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["value","active"],["value","inactive"],["value","out_of_stock"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","gap-4"],[1,"flex","items-center","cursor-pointer"],["type","radio","formControlName","classification","value","medicinal",1,"w-4","h-4","text-[var(--primary-color)]","focus:ring-[var(--primary-color)]","border-gray-300"],[1,"ml-2","text-sm","text-gray-700"],["type","radio","formControlName","classification","value","cosmetic",1,"w-4","h-4","text-[var(--primary-color)]","focus:ring-[var(--primary-color)]","border-gray-300"],["type","radio","formControlName","origin","value","local",1,"w-4","h-4","text-[var(--primary-color)]","focus:ring-[var(--primary-color)]","border-gray-300"],["type","radio","formControlName","origin","value","imported",1,"w-4","h-4","text-[var(--primary-color)]","focus:ring-[var(--primary-color)]","border-gray-300"],[1,"flex","items-center","justify-end","gap-4","pt-6","border-t"],["type","button","variant","outline",3,"onClick"],["type","submit","variant","primary",3,"loading","disabled"]],template:function(o,n){if(o&1&&(t(0,"app-form-wrapper",0),b(1,ee,1,1,"app-alert",1),t(2,"form",2),C("ngSubmit",function(){return n.onSubmit()}),t(3,"div",3)(4,"div")(5,"label",4),i(6," General Drug "),t(7,"span",5),i(8,"*"),r()(),t(9,"select",6)(10,"option",7),i(11,"Select General Drug"),r(),F(12,te,2,3,"option",8,Z),r(),b(14,re,2,0,"p",9),r(),t(15,"div")(16,"label",4),i(17," Internal Barcode (PLU) "),t(18,"span",5),i(19,"*"),r()(),m(20,"input",10),b(21,ie,2,0,"p",9),r(),t(22,"div")(23,"label",4),i(24," Price "),t(25,"span",5),i(26,"*"),r()(),m(27,"input",11),r(),t(28,"div")(29,"label",4),i(30,"Price After Discount"),r(),m(31,"input",12),r(),t(32,"div")(33,"label",4),i(34," Stock Quantity "),t(35,"span",5),i(36,"*"),r()(),m(37,"input",13),r(),t(38,"div")(39,"label",4),i(40," Minimum Stock "),t(41,"span",5),i(42,"*"),r()(),m(43,"input",14),r(),t(44,"div")(45,"label",4),i(46,"Expiry Date"),r(),m(47,"input",15),r(),t(48,"div")(49,"label",4),i(50,"Status"),r(),t(51,"select",16)(52,"option",17),i(53,"Active"),r(),t(54,"option",18),i(55,"Inactive"),r(),t(56,"option",19),i(57,"Out of Stock"),r()()(),t(58,"div")(59,"label",20),i(60),s(61,"translate"),r(),t(62,"div",21)(63,"label",22),m(64,"input",23),t(65,"span",24),i(66),s(67,"translate"),r()(),t(68,"label",22),m(69,"input",25),t(70,"span",24),i(71),s(72,"translate"),r()()()(),t(73,"div")(74,"label",20),i(75),s(76,"translate"),r(),t(77,"div",21)(78,"label",22),m(79,"input",26),t(80,"span",24),i(81),s(82,"translate"),r()(),t(83,"label",22),m(84,"input",27),t(85,"span",24),i(86),s(87,"translate"),r()()()()(),t(88,"div",28)(89,"app-button",29),C("onClick",function(){return n.onCancel()}),i(90," Cancel "),r(),t(91,"app-button",30),i(92),r()()()()),o&2){let u,c,y,x;g("title",n.isEdit?"Edit Pharmacy Drug":"Add New Pharmacy Drug"),a(),S(n.errorMessage?1:-1),a(),g("formGroup",n.drugForm),a(7),h("border-red-500",((u=n.drugForm.get("generalDrugId"))==null?null:u.invalid)&&((u=n.drugForm.get("generalDrugId"))==null?null:u.touched)),a(3),_(n.generalDrugs),a(2),S((c=n.drugForm.get("generalDrugId"))!=null&&c.invalid&&((c=n.drugForm.get("generalDrugId"))!=null&&c.touched)?14:-1),a(6),h("border-red-500",((y=n.drugForm.get("internalBarcode"))==null?null:y.invalid)&&((y=n.drugForm.get("internalBarcode"))==null?null:y.touched)),a(),S((x=n.drugForm.get("internalBarcode"))!=null&&x.invalid&&((x=n.drugForm.get("internalBarcode"))!=null&&x.touched)?21:-1),a(39),D(" ",p(61,18,"drug.classification")," "),a(6),v(p(67,20,"drug.classification.medicinal")),a(5),v(p(72,22,"drug.classification.cosmetic")),a(4),D(" ",p(76,24,"drug.origin")," "),a(6),v(p(82,26,"drug.origin.local")),a(5),v(p(87,28,"drug.origin.imported")),a(5),g("loading",n.loading)("disabled",n.drugForm.invalid),a(),D(" ",n.isEdit?"Update":"Create"," Drug ")}},dependencies:[N,Y,T,L,R,M,V,$,q,G,P,U,j,O,Q,J,H,z,A],encapsulation:2})};export{X as DrugFormComponent};
