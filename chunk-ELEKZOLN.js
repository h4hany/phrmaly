import{a as W}from"./chunk-FF46ICM6.js";import{a as U}from"./chunk-LNJRAZKD.js";import{c as N,d as l,e as A,f as M,h as w,i as B,j as G,m as P,n as T,o as V,p as q,q as O,s as Q,t as $,v as L}from"./chunk-J4RW7IXS.js";import{a as R}from"./chunk-K7KLI742.js";import{a as j}from"./chunk-H653ED7N.js";import{b as I,d as k}from"./chunk-J2A4D5WT.js";import{Da as h,Ia as v,Oa as p,Q as c,Qa as D,Ta as y,Wa as S,Wb as E,Xa as x,Ya as r,Za as t,_a as d,bb as b,cb as C,kb as i,mb as F,nb as _,va as u}from"./chunk-ILVQMZIM.js";import"./chunk-7CGTOI24.js";var z=(a,e)=>e.id;function H(a,e){if(a&1&&d(0,"app-alert",1),a&2){let o=C();p("title",o.errorMessage)}}function J(a,e){if(a&1&&(r(0,"option",8),i(1),t()),a&2){let o=e.$implicit;p("value",o.id),u(),_("",o.name," - ",o.manufacturer,"")}}function K(a,e){a&1&&(r(0,"p",9),i(1,"General drug is required"),t())}function X(a,e){a&1&&(r(0,"p",9),i(1,"Internal barcode is required (6-8 digits)"),t())}var Y=class a{fb=c($);router=c(k);route=c(I);drugsService=c(W);drugForm;loading=!1;errorMessage="";isEdit=!1;drugId=null;generalDrugs=[];ngOnInit(){this.drugId=this.route.snapshot.paramMap.get("id"),this.isEdit=!!this.drugId,this.drugForm=this.fb.group({generalDrugId:["",[l.required]],internalBarcode:["",[l.required,l.minLength(6),l.maxLength(8)]],price:[0,[l.required,l.min(0)]],priceAfterDiscount:[0,[l.min(0)]],stockQuantity:[0,[l.required,l.min(0)]],minimumStock:[0,[l.required,l.min(0)]],expiryDate:[""],status:["active"]}),this.loadGeneralDrugs(),this.isEdit&&this.drugId&&this.loadDrug()}loadGeneralDrugs(){this.drugsService.getAllGeneralDrugs().subscribe({next:e=>{this.generalDrugs=e}})}loadDrug(){this.drugsService.getPharmacyDrugById(this.drugId).subscribe({next:e=>{e&&this.drugForm.patchValue({generalDrugId:e.generalDrugId,internalBarcode:e.internalBarcode,price:e.price,priceAfterDiscount:e.priceAfterDiscount,stockQuantity:e.stockQuantity,minimumStock:e.minimumStock,expiryDate:e.expiryDate?this.formatDateForInput(e.expiryDate):"",status:e.status})},error:()=>{this.errorMessage="Failed to load drug data"}})}onSubmit(){if(this.drugForm.valid){this.loading=!0,this.errorMessage="";let e=this.drugForm.value,o={generalDrugId:e.generalDrugId,pharmacyId:"ph1",internalBarcode:e.internalBarcode,price:e.price,priceAfterDiscount:e.priceAfterDiscount||e.price,stockQuantity:e.stockQuantity,minimumStock:e.minimumStock,expiryDate:e.expiryDate?new Date(e.expiryDate):void 0,status:e.status};(this.isEdit?this.drugsService.updatePharmacyDrug(this.drugId,o):this.drugsService.createPharmacyDrug(o)).subscribe({next:()=>{this.router.navigate(["/drugs"])},error:m=>{this.errorMessage=m.message||"An error occurred while saving the drug",this.loading=!1}})}else Object.keys(this.drugForm.controls).forEach(e=>{this.drugForm.get(e)?.markAsTouched()})}onCancel(){this.router.navigate(["/drugs"])}formatDateForInput(e){let o=new Date(e),n=o.getFullYear(),m=String(o.getMonth()+1).padStart(2,"0"),s=String(o.getDate()).padStart(2,"0");return`${n}-${m}-${s}`}static \u0275fac=function(o){return new(o||a)};static \u0275cmp=h({type:a,selectors:[["app-drug-form"]],decls:63,vars:12,consts:[[3,"title"],["type","error",3,"title"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["formControlName","generalDrugId",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["value",""],[3,"value"],[1,"mt-1","text-sm","text-red-600"],["type","text","formControlName","internalBarcode","placeholder","6-8 digits","maxlength","8",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","number","formControlName","price","step","0.01","min","0",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","number","formControlName","priceAfterDiscount","step","0.01","min","0",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","number","formControlName","stockQuantity","min","0",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","number","formControlName","minimumStock","min","0",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","date","formControlName","expiryDate",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["formControlName","status",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["value","active"],["value","inactive"],["value","out_of_stock"],[1,"flex","items-center","justify-end","gap-4","pt-6","border-t"],["type","button","variant","outline",3,"onClick"],["type","submit","variant","primary",3,"loading","disabled"]],template:function(o,n){if(o&1&&(r(0,"app-form-wrapper",0),v(1,H,1,1,"app-alert",1),r(2,"form",2),b("ngSubmit",function(){return n.onSubmit()}),r(3,"div",3)(4,"div")(5,"label",4),i(6," General Drug "),r(7,"span",5),i(8,"*"),t()(),r(9,"select",6)(10,"option",7),i(11,"Select General Drug"),t(),S(12,J,2,3,"option",8,z),t(),v(14,K,2,0,"p",9),t(),r(15,"div")(16,"label",4),i(17," Internal Barcode (PLU) "),r(18,"span",5),i(19,"*"),t()(),d(20,"input",10),v(21,X,2,0,"p",9),t(),r(22,"div")(23,"label",4),i(24," Price "),r(25,"span",5),i(26,"*"),t()(),d(27,"input",11),t(),r(28,"div")(29,"label",4),i(30,"Price After Discount"),t(),d(31,"input",12),t(),r(32,"div")(33,"label",4),i(34," Stock Quantity "),r(35,"span",5),i(36,"*"),t()(),d(37,"input",13),t(),r(38,"div")(39,"label",4),i(40," Minimum Stock "),r(41,"span",5),i(42,"*"),t()(),d(43,"input",14),t(),r(44,"div")(45,"label",4),i(46,"Expiry Date"),t(),d(47,"input",15),t(),r(48,"div")(49,"label",4),i(50,"Status"),t(),r(51,"select",16)(52,"option",17),i(53,"Active"),t(),r(54,"option",18),i(55,"Inactive"),t(),r(56,"option",19),i(57,"Out of Stock"),t()()()(),r(58,"div",20)(59,"app-button",21),b("onClick",function(){return n.onCancel()}),i(60," Cancel "),t(),r(61,"app-button",22),i(62),t()()()()),o&2){let m,s,g,f;p("title",n.isEdit?"Edit Pharmacy Drug":"Add New Pharmacy Drug"),u(),y(n.errorMessage?1:-1),u(),p("formGroup",n.drugForm),u(7),D("border-red-500",((m=n.drugForm.get("generalDrugId"))==null?null:m.invalid)&&((m=n.drugForm.get("generalDrugId"))==null?null:m.touched)),u(3),x(n.generalDrugs),u(2),y((s=n.drugForm.get("generalDrugId"))!=null&&s.invalid&&((s=n.drugForm.get("generalDrugId"))!=null&&s.touched)?14:-1),u(6),D("border-red-500",((g=n.drugForm.get("internalBarcode"))==null?null:g.invalid)&&((g=n.drugForm.get("internalBarcode"))==null?null:g.touched)),u(),y((f=n.drugForm.get("internalBarcode"))!=null&&f.invalid&&((f=n.drugForm.get("internalBarcode"))!=null&&f.touched)?21:-1),u(40),p("loading",n.loading)("disabled",n.drugForm.invalid),u(),F(" ",n.isEdit?"Update":"Create"," Drug ")}},dependencies:[E,L,w,V,q,N,B,T,A,M,Q,O,G,P,U,R,j],encapsulation:2})};export{Y as DrugFormComponent};
