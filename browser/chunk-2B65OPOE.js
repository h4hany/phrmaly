import{a as F}from"./chunk-2QDILHFW.js";import{a as H}from"./chunk-UW4RQ676.js";import{a as j}from"./chunk-SRZA4AYF.js";import"./chunk-PRIAQIJ7.js";import{a as A}from"./chunk-77NWAUUO.js";import{a as z}from"./chunk-L2QHXWDV.js";import{b as Q}from"./chunk-EO5VULWO.js";import{d as D}from"./chunk-5NQMXUDV.js";import"./chunk-TXY55LQM.js";import{$a as v,Cb as B,Ea as M,Ja as S,Pa as d,R as C,Ua as T,Vb as E,X as m,Y as u,Z as f,Za as n,_,_a as r,bb as k,cb as g,db as b,hb as V,ib as L,jb as N,lb as h,mb as y,nb as x,wa as a,yb as l,zb as s}from"./chunk-F5WAPTHD.js";import{a as I,b as w}from"./chunk-7CGTOI24.js";var G=["deleteModal"];function O(c,t){if(c&1&&v(0,"app-alert",3),c&2){let e=b();d("title",e.errorMessage)}}function R(c,t){if(c&1){let e=k();n(0,"div",17)(1,"button",18),l(2,"translate"),g("click",function(){let o=m(e).$implicit,p=b();return u(p.viewInvoice(o.id))}),f(),n(3,"svg",19),v(4,"path",20)(5,"path",21),r()(),_(),n(6,"button",18),l(7,"translate"),g("click",function(){let o=m(e).$implicit,p=b();return u(p.editInvoice(o.id))}),f(),n(8,"svg",19),v(9,"path",22),r()(),_(),n(10,"button",23),l(11,"translate"),g("click",function(){let o=m(e).$implicit,p=b();return u(p.confirmDelete(o))}),f(),n(12,"svg",19),v(13,"path",24),r()()()}c&2&&(a(),d("title",s(2,3,"common.view")),a(5),d("title",s(7,5,"common.edit")),a(4),d("title",s(11,7,"common.delete")))}var P=class c{router=C(D);invoicesService=C(H);invoices=[];searchQuery="";errorMessage="";loading=!1;deleting=!1;selectedInvoiceId=null;selectedInvoiceNumber="";deleteModal;columns=[{key:"invoiceNumber",label:"table.invoiceNumber",sortable:!0},{key:"patientName",label:"table.patient",sortable:!0},{key:"createdAt",label:"table.date",sortable:!0},{key:"itemsCount",label:"table.items",sortable:!0},{key:"total",label:"table.total",sortable:!0},{key:"paymentStatus",label:"table.paymentStatus",sortable:!0},{key:"paymentMethod",label:"table.paymentMethod",sortable:!0},{key:"actions",label:"table.action"}];pagination={page:1,pageSize:10,total:0,totalPages:0};ngOnInit(){this.loadInvoices()}loadInvoices(){this.loading=!0,this.invoicesService.getAll({page:this.pagination.page,pageSize:this.pagination.pageSize}).subscribe({next:t=>{this.invoices=t.data.map(e=>w(I({},e),{patientName:"Patient "+e.patientId,createdAt:this.formatDate(e.createdAt),itemsCount:e.items.length,total:e.total.toFixed(2),paymentMethod:e.paymentMethod||"N/A"})),this.pagination={page:t.page,pageSize:t.pageSize,total:t.total,totalPages:t.totalPages},this.loading=!1},error:()=>{this.errorMessage="Failed to load invoices",this.loading=!1}})}onSearch(){this.searchQuery.trim()?(this.loading=!0,this.invoicesService.search(this.searchQuery).subscribe({next:t=>{this.invoices=t.map(e=>w(I({},e),{patientName:"Patient "+e.patientId,createdAt:this.formatDate(e.createdAt),itemsCount:e.items.length,total:e.total.toFixed(2),paymentMethod:e.paymentMethod||"N/A"})),this.pagination={page:1,pageSize:10,total:t.length,totalPages:Math.ceil(t.length/10)},this.loading=!1},error:()=>{this.errorMessage="Search failed",this.loading=!1}})):this.loadInvoices()}navigateToNew(){this.router.navigate(["/invoices/new"])}viewInvoice(t){this.router.navigate(["/invoices",t])}editInvoice(t){this.router.navigate(["/invoices",t,"edit"])}confirmDelete(t){this.selectedInvoiceId=t.id,this.selectedInvoiceNumber=t.invoiceNumber,this.deleteModal.open()}deleteInvoice(){this.selectedInvoiceId&&(this.deleting=!0,this.invoicesService.delete(this.selectedInvoiceId).subscribe({next:t=>{t&&(this.loadInvoices(),this.deleteModal.close(),this.selectedInvoiceId=null,this.selectedInvoiceNumber=""),this.deleting=!1},error:()=>{this.errorMessage="Failed to delete invoice",this.deleting=!1}}))}formatDate(t){let e=new Date(t),i=String(e.getDate()).padStart(2,"0"),o=String(e.getMonth()+1).padStart(2,"0"),p=e.getFullYear();return`${i}-${o}-${p}`}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=M({type:c,selectors:[["app-invoices-list"]],viewQuery:function(e,i){if(e&1&&V(G,5),e&2){let o;L(o=N())&&(i.deleteModal=o.first)}},decls:35,vars:34,consts:[["actionTemplate",""],["deleteModal",""],[1,"space-y-6"],["type","error",3,"title"],[1,"flex","items-center","justify-between","gap-4"],[1,"flex-1","max-w-lg"],[1,"relative"],["type","text",1,"w-full","pl-10","pr-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]","focus:border-[var(--primary-color)]",3,"input","placeholder","value"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","absolute","left-3","top-2.5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"flex","gap-3"],["variant","outline"],["variant","primary",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["rowIdKey","id",3,"columns","data","pagination","emptyMessage","loading"],[3,"confirmed","title","showFooter","confirmText","confirmLoading"],[1,"flex","items-center","gap-2"],[1,"p-1","text-gray-600","hover:text-gray-900",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"p-1","text-gray-600","hover:text-red-600",3,"click","title"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"]],template:function(e,i){if(e&1){let o=k();n(0,"div",2),S(1,O,1,1,"app-alert",3),n(2,"div",4)(3,"div",5)(4,"div",6)(5,"input",7),l(6,"translate"),g("input",function($){return m(o),i.searchQuery=$.target.value,u(i.onSearch())}),r(),f(),n(7,"svg",8),v(8,"path",9),r()()(),_(),n(9,"div",10)(10,"app-button",11),h(11),l(12,"translate"),r(),n(13,"app-button",11),h(14),l(15,"translate"),r(),n(16,"app-button",12),g("onClick",function(){return m(o),u(i.navigateToNew())}),f(),n(17,"svg",13),v(18,"path",14),r(),h(19),l(20,"translate"),r()()(),_(),n(21,"app-table",15),S(22,R,14,9,"ng-template",null,0,B),r(),n(24,"app-modal",16,1),l(26,"translate"),l(27,"translate"),g("confirmed",function(){return m(o),u(i.deleteInvoice())}),n(28,"p"),h(29),l(30,"translate"),n(31,"strong"),h(32),r(),h(33),l(34,"translate"),r()()()}e&2&&(a(),T(i.errorMessage?1:-1),a(4),d("placeholder",s(6,18,"common.search"))("value",i.searchQuery),a(6),y(s(12,20,"common.filters")),a(3),y(s(15,22,"common.export")),a(5),x(" ",s(20,24,"button.createNewInvoice")," "),a(2),d("columns",i.columns)("data",i.invoices)("pagination",i.pagination)("emptyMessage","empty.noInvoices")("loading",i.loading),a(3),d("title",s(26,26,"button.deleteInvoice"))("showFooter",!0)("confirmText",s(27,28,"common.delete"))("confirmLoading",i.deleting),a(5),x("",s(30,30,"modal.deleteInvoiceConfirm")," "),a(3),y(i.selectedInvoiceNumber),a(),y(s(34,32,"modal.cannotUndo")))},dependencies:[E,z,j,F,A,Q],encapsulation:2})};export{P as InvoicesListComponent};
