import{a as g}from"./chunk-YUKQXM5O.js";import{A as o,M as l,S as D,j as d}from"./chunk-OKFD3A6M.js";import{a as m,b as u}from"./chunk-KAT7YFEL.js";var y=class p{pharmacyContextService=D(g);shifts=[{id:"SH001",pharmacyId:"ph1",staffId:"ST001",staffName:"Sarah Johnson",shiftDate:new Date("2024-11-27"),startTime:new Date("2024-11-27T08:00:00"),endTime:new Date("2024-11-27T17:00:00"),status:"completed",checkInTime:new Date("2024-11-27T07:55:00"),checkOutTime:new Date("2024-11-27T17:05:00"),checkInMethod:"qr",checkOutMethod:"qr",createdAt:new Date("2024-11-27"),updatedAt:new Date("2024-11-27"),createdBy:"system"},{id:"SH002",pharmacyId:"ph1",staffId:"ST002",staffName:"Michael Chen",shiftDate:new Date("2024-11-27"),startTime:new Date("2024-11-27T09:00:00"),endTime:new Date("2024-11-27T18:00:00"),status:"in_progress",checkInTime:new Date("2024-11-27T09:15:00"),checkInMethod:"pin",createdAt:new Date("2024-11-27"),updatedAt:new Date("2024-11-27"),createdBy:"system"}];attendanceRecords=[{id:"ATT001",pharmacyId:"ph1",staffId:"ST001",staffName:"Sarah Johnson",date:new Date("2024-11-27"),checkInTime:new Date("2024-11-27T07:55:00"),checkOutTime:new Date("2024-11-27T17:05:00"),totalHours:9.17,status:"present",shiftId:"SH001",createdAt:new Date("2024-11-27"),updatedAt:new Date("2024-11-27"),createdBy:"system"},{id:"ATT002",pharmacyId:"ph1",staffId:"ST002",staffName:"Michael Chen",date:new Date("2024-11-27"),checkInTime:new Date("2024-11-27T09:15:00"),totalHours:0,status:"late",lateMinutes:15,shiftId:"SH002",createdAt:new Date("2024-11-27"),updatedAt:new Date("2024-11-27"),createdBy:"system"}];getShifts(a){let n=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!n)return d({data:[],total:0,page:1,pageSize:10,totalPages:0}).pipe(o(300));let e=this.shifts.filter(r=>r.pharmacyId===n);a?.staffId&&(e=e.filter(r=>r.staffId===a.staffId)),a?.startDate&&(e=e.filter(r=>r.shiftDate>=a.startDate)),a?.endDate&&(e=e.filter(r=>r.shiftDate<=a.endDate));let i=a?.page||1,t=a?.pageSize||10,c=(i-1)*t,s=c+t,f=e.slice(c,s);return d({data:f,total:e.length,page:i,pageSize:t,totalPages:Math.ceil(e.length/t)}).pipe(o(500))}getAttendanceRecords(a){let n=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!n)return d({data:[],total:0,page:1,pageSize:10,totalPages:0}).pipe(o(300));let e=this.attendanceRecords.filter(r=>r.pharmacyId===n);a?.staffId&&(e=e.filter(r=>r.staffId===a.staffId)),a?.startDate&&(e=e.filter(r=>r.date>=a.startDate)),a?.endDate&&(e=e.filter(r=>r.date<=a.endDate));let i=a?.page||1,t=a?.pageSize||10,c=(i-1)*t,s=c+t,f=e.slice(c,s);return d({data:f,total:e.length,page:i,pageSize:t,totalPages:Math.ceil(e.length/t)}).pipe(o(500))}checkIn(a,n="qr"){let e=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!e)return d({success:!1,message:"No pharmacy selected"}).pipe(o(300));let i=new Date;i.setHours(0,0,0,0);let t=this.shifts.find(s=>s.pharmacyId===e&&s.staffId===a&&s.shiftDate.getTime()===i.getTime()&&s.status==="scheduled");t?(t.status="in_progress",t.checkInTime=new Date,t.checkInMethod=n,t.updatedAt=new Date):(t={id:`SH${Date.now()}`,pharmacyId:e,staffId:a,shiftDate:i,startTime:new Date,status:"in_progress",checkInTime:new Date,checkInMethod:n,createdAt:new Date,updatedAt:new Date,createdBy:"system"},this.shifts.push(t));let c={id:`ATT${Date.now()}`,pharmacyId:e,staffId:a,date:i,checkInTime:new Date,status:"present",shiftId:t.id,createdAt:new Date,updatedAt:new Date,createdBy:"system"};return this.attendanceRecords.push(c),d({success:!0,shift:t}).pipe(o(500))}checkOut(a,n="qr"){let e=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!e)return d({success:!1,message:"No pharmacy selected"}).pipe(o(300));let i=new Date;i.setHours(0,0,0,0);let t=this.shifts.find(s=>s.pharmacyId===e&&s.staffId===a&&s.shiftDate.getTime()===i.getTime()&&s.status==="in_progress");if(!t)return d({success:!1,message:"No active shift found"}).pipe(o(300));t.status="completed",t.checkOutTime=new Date,t.checkOutMethod=n,t.endTime=new Date,t.updatedAt=new Date;let c=this.attendanceRecords.find(s=>s.pharmacyId===e&&s.staffId===a&&s.date.getTime()===i.getTime());if(c){if(c.checkOutTime=new Date,c.checkInTime){let s=(c.checkOutTime.getTime()-c.checkInTime.getTime())/36e5;c.totalHours=Math.round(s*100)/100}c.updatedAt=new Date}return d({success:!0,shift:t}).pipe(o(500))}getAttendanceStats(a,n,e){let i=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!i)return d({staffId:a,staffName:"",totalDays:0,presentDays:0,absentDays:0,lateDays:0,attendancePercentage:0,averageHoursPerDay:0,period:{startDate:n,endDate:e}}).pipe(o(300));let t=this.attendanceRecords.filter(h=>h.pharmacyId===i&&h.staffId===a&&h.date>=n&&h.date<=e),c=Math.ceil((e.getTime()-n.getTime())/(1e3*60*60*24))+1,s=t.filter(h=>h.status==="present").length,f=t.filter(h=>h.status==="absent").length,r=t.filter(h=>h.status==="late").length,T=t.reduce((h,I)=>h+(I.totalHours||0),0),w={staffId:a,staffName:t[0]?.staffName||"",totalDays:c,presentDays:s,absentDays:f,lateDays:r,attendancePercentage:c>0?Math.round(s/c*100):0,averageHoursPerDay:s>0?Math.round(T/s*100)/100:0,period:{startDate:n,endDate:e}};return d(w).pipe(o(500))}createShift(a){let n=this.pharmacyContextService.getCurrentPharmacy()?.id;if(!n)throw new Error("No pharmacy selected");let e=u(m({},a),{id:`SH${Date.now()}`,pharmacyId:n,createdAt:new Date,updatedAt:new Date,createdBy:"system"});return this.shifts.push(e),d(e).pipe(o(500))}static \u0275fac=function(n){return new(n||p)};static \u0275prov=l({token:p,factory:p.\u0275fac,providedIn:"root"})};export{y as a};
