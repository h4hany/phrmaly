import{a as j}from"./chunk-CAPIU6NW.js";import{a as Q}from"./chunk-IONILDPT.js";import{a as z}from"./chunk-JBZ5JDSH.js";import"./chunk-ONVEZIWC.js";import{a as F}from"./chunk-K7KLI742.js";import{a as B}from"./chunk-H653ED7N.js";import{b as E}from"./chunk-7YN2F2UA.js";import{d as N}from"./chunk-J2A4D5WT.js";import{Cb as V,Da as M,Ia as k,Oa as u,Q as S,Ta as D,W as m,Wb as L,X as d,Y as f,Ya as a,Z as b,Za as o,_a as h,ab as P,bb as g,cb as _,gb as I,hb as A,ib as T,kb as v,lb as y,mb as C,va as r,yb as s,zb as l}from"./chunk-ILVQMZIM.js";import{a as w,b as x}from"./chunk-7CGTOI24.js";var G=["deleteModal"];function O(c,t){if(c&1&&h(0,"app-alert",3),c&2){let e=_();u("title",e.errorMessage)}}function R(c,t){if(c&1){let e=P();a(0,"div",17)(1,"button",18),s(2,"translate"),g("click",function(){let n=m(e).$implicit,p=_();return d(p.viewPurchase(n.id))}),f(),a(3,"svg",19),h(4,"path",20)(5,"path",21),o()(),b(),a(6,"button",18),s(7,"translate"),g("click",function(){let n=m(e).$implicit,p=_();return d(p.editPurchase(n.id))}),f(),a(8,"svg",19),h(9,"path",22),o()(),b(),a(10,"button",23),s(11,"translate"),g("click",function(){let n=m(e).$implicit,p=_();return d(p.confirmDelete(n))}),f(),a(12,"svg",19),h(13,"path",24),o()()()}c&2&&(r(),u("title",l(2,3,"common.view")),r(5),u("title",l(7,5,"common.edit")),r(4),u("title",l(11,7,"common.delete")))}var H=class c{router=S(N);purchasesService=S(j);purchases=[];searchQuery="";errorMessage="";loading=!1;deleting=!1;selectedPurchaseId=null;selectedInvoiceNumber="";deleteModal;columns=[{key:"invoiceNumber",label:"table.invoiceNumber",sortable:!0},{key:"supplierName",label:"table.supplier",sortable:!0},{key:"purchaseDate",label:"table.purchaseDate",sortable:!0},{key:"dueDate",label:"table.dueDate",sortable:!0},{key:"totalAmount",label:"table.totalAmount",sortable:!0},{key:"paidAmount",label:"table.paidAmount",sortable:!0},{key:"remainingAmount",label:"table.remainingAmount",sortable:!0},{key:"paymentStatus",label:"table.status",sortable:!0},{key:"actions",label:"table.action"}];pagination={page:1,pageSize:10,total:0,totalPages:0};ngOnInit(){this.loadPurchases()}loadPurchases(){this.loading=!0,this.purchasesService.getAll({page:this.pagination.page,pageSize:this.pagination.pageSize}).subscribe({next:t=>{this.purchases=t.data.map(e=>x(w({},e),{supplierName:"Supplier "+e.supplierId,purchaseDate:this.formatDate(e.purchaseDate),dueDate:e.dueDate?this.formatDate(e.dueDate):"N/A",totalAmount:e.totalAmount.toFixed(2),paidAmount:e.paidAmount.toFixed(2),remainingAmount:e.remainingAmount.toFixed(2)})),this.pagination={page:t.page,pageSize:t.pageSize,total:t.total,totalPages:t.totalPages},this.loading=!1},error:()=>{this.errorMessage="Failed to load purchase invoices",this.loading=!1}})}onSearch(){this.searchQuery.trim()?(this.loading=!0,this.purchasesService.search(this.searchQuery).subscribe({next:t=>{this.purchases=t.map(e=>x(w({},e),{supplierName:"Supplier "+e.supplierId,purchaseDate:this.formatDate(e.purchaseDate),dueDate:e.dueDate?this.formatDate(e.dueDate):"N/A",totalAmount:e.totalAmount.toFixed(2),paidAmount:e.paidAmount.toFixed(2),remainingAmount:e.remainingAmount.toFixed(2)})),this.pagination={page:1,pageSize:10,total:t.length,totalPages:Math.ceil(t.length/10)},this.loading=!1},error:()=>{this.errorMessage="Search failed",this.loading=!1}})):this.loadPurchases()}navigateToNew(){this.router.navigate(["/purchases/new"])}viewPurchase(t){this.router.navigate(["/purchases",t])}editPurchase(t){this.router.navigate(["/purchases",t,"edit"])}confirmDelete(t){this.selectedPurchaseId=t.id,this.selectedInvoiceNumber=t.invoiceNumber,this.deleteModal.open()}deletePurchase(){this.selectedPurchaseId&&(this.deleting=!0,this.purchasesService.delete(this.selectedPurchaseId).subscribe({next:t=>{t&&(this.loadPurchases(),this.deleteModal.close(),this.selectedPurchaseId=null,this.selectedInvoiceNumber=""),this.deleting=!1},error:()=>{this.errorMessage="Failed to delete purchase invoice",this.deleting=!1}}))}formatDate(t){let e=new Date(t),i=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),p=e.getFullYear();return`${i}-${n}-${p}`}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=M({type:c,selectors:[["app-purchases-list"]],viewQuery:function(e,i){if(e&1&&I(G,5),e&2){let n;A(n=T())&&(i.deleteModal=n.first)}},decls:35,vars:34,consts:[["actionTemplate",""],["deleteModal",""],[1,"space-y-6"],["type","error",3,"title"],[1,"flex","items-center","justify-between","gap-4"],[1,"flex-1","max-w-lg"],[1,"relative"],["type","text",1,"w-full","pl-10","pr-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]","focus:border-[var(--primary-color)]",3,"input","placeholder","value"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","absolute","left-3","top-2.5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"flex","gap-3"],["variant","outline"],["variant","primary",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["rowIdKey","id",3,"columns","data","pagination","emptyMessage","loading"],[3,"confirmed","title","showFooter","confirmText","confirmLoading"],[1,"flex","items-center","gap-2"],[1,"p-1","text-gray-600","hover:text-gray-900",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"p-1","text-gray-600","hover:text-red-600",3,"click","title"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"]],template:function(e,i){if(e&1){let n=P();a(0,"div",2),k(1,O,1,1,"app-alert",3),a(2,"div",4)(3,"div",5)(4,"div",6)(5,"input",7),s(6,"translate"),g("input",function($){return m(n),i.searchQuery=$.target.value,d(i.onSearch())}),o(),f(),a(7,"svg",8),h(8,"path",9),o()()(),b(),a(9,"div",10)(10,"app-button",11),v(11),s(12,"translate"),o(),a(13,"app-button",11),v(14),s(15,"translate"),o(),a(16,"app-button",12),g("onClick",function(){return m(n),d(i.navigateToNew())}),f(),a(17,"svg",13),h(18,"path",14),o(),v(19),s(20,"translate"),o()()(),b(),a(21,"app-table",15),k(22,R,14,9,"ng-template",null,0,V),o(),a(24,"app-modal",16,1),s(26,"translate"),s(27,"translate"),g("confirmed",function(){return m(n),d(i.deletePurchase())}),a(28,"p"),v(29),s(30,"translate"),a(31,"strong"),v(32),o(),v(33),s(34,"translate"),o()()()}e&2&&(r(),D(i.errorMessage?1:-1),r(4),u("placeholder",l(6,18,"common.search"))("value",i.searchQuery),r(6),y(l(12,20,"common.filters")),r(3),y(l(15,22,"common.export")),r(5),C(" ",l(20,24,"button.addNewPurchase")," "),r(2),u("columns",i.columns)("data",i.purchases)("pagination",i.pagination)("emptyMessage","empty.noPurchases")("loading",i.loading),r(3),u("title",l(26,26,"button.deletePurchase"))("showFooter",!0)("confirmText",l(27,28,"common.delete"))("confirmLoading",i.deleting),r(5),C("",l(30,30,"modal.deletePurchaseConfirm")," "),r(3),y(i.selectedInvoiceNumber),r(),y(l(34,32,"modal.cannotUndo")))},dependencies:[L,F,z,Q,B,E],encapsulation:2})};export{H as PurchasesListComponent};
