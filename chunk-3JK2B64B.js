import{a as Z}from"./chunk-2MD7G3AI.js";import{a as J}from"./chunk-OKWSYNGI.js";import{a as K}from"./chunk-4TZJMUES.js";import{a as X}from"./chunk-EYVGX2VS.js";import{c as M,d as m,e as q,f as T,h as V,i as G,j as $,k as j,l as B,m as O,n as R,o as H,p as W,q as z,t as L,v as U}from"./chunk-YODUIR4B.js";import{a as Y}from"./chunk-BHTDODCV.js";import{a as Q}from"./chunk-6XQQMEJ6.js";import{b as P,d as k}from"./chunk-B4EO6REF.js";import{Da as F,Ia as _,Oa as p,Q as c,Qa as A,Ta as D,Ua as E,W as x,Wa as h,X as S,Xa as f,Xb as w,Y as b,Ya as r,Z as C,Za as t,_a as d,ab as I,bb as g,cb as y,kb as n,lb as v,mb as N,va as s}from"./chunk-Z4T7VGFQ.js";import"./chunk-7CGTOI24.js";var te=(a,e)=>e.id;function re(a,e){if(a&1&&d(0,"app-alert",1),a&2){let i=y();p("title",i.errorMessage)}}function ie(a,e){if(a&1&&(r(0,"option",9),n(1),t()),a&2){let i=e.$implicit;p("value",i.id),s(),v(i.name)}}function ne(a,e){if(a&1&&(r(0,"option",9),n(1),t()),a&2){let i=e.$implicit;p("value",i.id),s(),v((i.generalDrug==null?null:i.generalDrug.name)||"Drug "+i.id)}}function oe(a,e){if(a&1){let i=I();r(0,"div",19)(1,"div",37)(2,"label",4),n(3,"Drug"),t(),r(4,"select",38)(5,"option",8),n(6,"Select Drug"),t(),h(7,ne,2,2,"option",9,te),t()(),r(9,"div")(10,"label",4),n(11,"Quantity"),t(),d(12,"input",39),t(),r(13,"div")(14,"label",4),n(15,"Unit Cost"),t(),d(16,"input",40),t(),r(17,"div",31)(18,"button",41),g("click",function(){let u=x(i).$index,l=y();return S(l.removeItem(u))}),b(),r(19,"svg",42),d(20,"path",43),t()()()()}if(a&2){let i=e.$index,o=y();p("formGroupName",i),s(7),f(o.pharmacyDrugs)}}var ee=class a{fb=c(L);router=c(k);route=c(P);purchasesService=c(X);suppliersService=c(Z);drugsService=c(K);purchaseForm;loading=!1;errorMessage="";isEdit=!1;purchaseId=null;suppliers=[];pharmacyDrugs=[];get itemsArray(){return this.purchaseForm.get("items")}get totalAmount(){return this.itemsArray.value.reduce((i,o)=>i+(o.quantity*o.unitCost||0),0)}get remainingAmount(){let e=this.purchaseForm.get("paidAmount")?.value||0;return Math.max(0,this.totalAmount-e)}get formattedTotalAmount(){return this.totalAmount.toFixed(2)}get formattedRemainingAmount(){return this.remainingAmount.toFixed(2)}ngOnInit(){this.purchaseId=this.route.snapshot.paramMap.get("id"),this.isEdit=!!this.purchaseId,this.purchaseForm=this.fb.group({invoiceNumber:["",[m.required]],supplierId:["",[m.required]],purchaseDate:["",[m.required]],dueDate:[""],items:this.fb.array([]),paidAmount:[0],paymentStatus:["pending"]}),this.loadSuppliers(),this.loadDrugs(),this.isEdit&&this.purchaseId&&this.loadPurchase()}loadSuppliers(){this.suppliersService.getAll({page:1,pageSize:100}).subscribe({next:e=>{this.suppliers=e.data}})}loadDrugs(){this.drugsService.getPharmacyDrugs().subscribe({next:e=>{this.pharmacyDrugs=e.data}})}loadPurchase(){this.purchasesService.getById(this.purchaseId).subscribe({next:e=>{e&&(this.purchaseForm.patchValue({invoiceNumber:e.invoiceNumber,supplierId:e.supplierId,purchaseDate:this.formatDateForInput(e.purchaseDate),dueDate:e.dueDate?this.formatDateForInput(e.dueDate):"",paidAmount:e.paidAmount,paymentStatus:e.paymentStatus}),e.items.forEach(i=>{this.addItemWithData(i)}))},error:()=>{this.errorMessage="Failed to load purchase invoice"}})}addItem(){let e=this.fb.group({drugId:["",[m.required]],quantity:[1,[m.required,m.min(1)]],unitCost:[0,[m.required,m.min(0)]]});this.itemsArray.push(e)}addItemWithData(e){let i=this.fb.group({drugId:[e.drugId,[m.required]],quantity:[e.quantity,[m.required,m.min(1)]],unitCost:[e.unitCost,[m.required,m.min(0)]]});this.itemsArray.push(i)}removeItem(e){this.itemsArray.removeAt(e)}onSubmit(){if(this.purchaseForm.valid&&this.itemsArray.length>0){this.loading=!0,this.errorMessage="";let e=this.purchaseForm.value,i=e.items.map(l=>({drugId:l.drugId,quantity:l.quantity,unitCost:l.unitCost,totalCost:l.quantity*l.unitCost})),o={invoiceNumber:e.invoiceNumber,supplierId:e.supplierId,purchaseDate:new Date(e.purchaseDate),dueDate:e.dueDate?new Date(e.dueDate):void 0,items:i,totalAmount:this.totalAmount,paidAmount:e.paidAmount||0,remainingAmount:this.remainingAmount,paymentStatus:e.paymentStatus,pharmacyId:"ph1"};(this.isEdit?this.purchasesService.update(this.purchaseId,o):this.purchasesService.create(o)).subscribe({next:()=>{this.router.navigate(["/purchases"])},error:l=>{this.errorMessage=l.message||"An error occurred while saving",this.loading=!1}})}else Object.keys(this.purchaseForm.controls).forEach(e=>{this.purchaseForm.get(e)?.markAsTouched()})}onCancel(){this.router.navigate(["/purchases"])}formatDateForInput(e){let i=new Date(e),o=i.getFullYear(),u=String(i.getMonth()+1).padStart(2,"0"),l=String(i.getDate()).padStart(2,"0");return`${o}-${u}-${l}`}static \u0275fac=function(i){return new(i||a)};static \u0275cmp=F({type:a,selectors:[["app-purchase-form"]],decls:76,vars:10,consts:[[3,"title"],["type","error",3,"title"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["type","text","formControlName","invoiceNumber",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]","focus:border-[var(--primary-color)]"],["formControlName","supplierId",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["value",""],[3,"value"],["type","date","formControlName","purchaseDate",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","date","formControlName","dueDate",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],[1,"border-t","pt-6"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-medium","text-gray-900"],["type","button","variant","outline","size","sm",3,"onClick"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["formArrayName","items",1,"space-y-4"],[1,"grid","grid-cols-1","md:grid-cols-5","gap-4","p-4","bg-gray-50","rounded-[var(--radius-md)]",3,"formGroupName"],[1,"mt-4","p-4","bg-gray-50","rounded-[var(--radius-md)]"],[1,"flex","justify-between","items-center"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-lg","font-medium","text-gray-900","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["type","number","formControlName","paidAmount","step","0.01","min","0",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["formControlName","paymentStatus",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["value","pending"],["value","partial"],["value","paid"],[1,"flex","items-end"],[1,"w-full","p-3","bg-gray-50","rounded-[var(--radius-md)]"],[1,"text-sm","text-gray-600"],[1,"flex","items-center","justify-end","gap-4","pt-6","border-t"],["type","button","variant","outline",3,"onClick"],["type","submit","variant","primary",3,"loading","disabled"],[1,"md:col-span-2"],["formControlName","drugId",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","number","formControlName","quantity","min","1",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","number","formControlName","unitCost","step","0.01","min","0",1,"w-full","px-4","py-2.5","border","border-gray-300","rounded-[var(--radius-md)]","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--primary-color)]"],["type","button",1,"p-2","text-red-600","hover:text-red-800",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"]],template:function(i,o){if(i&1&&(r(0,"app-form-wrapper",0),_(1,re,1,1,"app-alert",1),r(2,"form",2),g("ngSubmit",function(){return o.onSubmit()}),r(3,"div",3)(4,"div")(5,"label",4),n(6," Invoice Number "),r(7,"span",5),n(8,"*"),t()(),d(9,"input",6),t(),r(10,"div")(11,"label",4),n(12," Supplier "),r(13,"span",5),n(14,"*"),t()(),r(15,"select",7)(16,"option",8),n(17,"Select Supplier"),t(),h(18,ie,2,2,"option",9,te),t()(),r(20,"div")(21,"label",4),n(22," Purchase Date "),r(23,"span",5),n(24,"*"),t()(),d(25,"input",10),t(),r(26,"div")(27,"label",4),n(28,"Due Date"),t(),d(29,"input",11),t()(),r(30,"div",12)(31,"div",13)(32,"h3",14),n(33,"Items"),t(),r(34,"app-button",15),g("onClick",function(){return o.addItem()}),b(),r(35,"svg",16),d(36,"path",17),t(),n(37," Add Item "),t()(),C(),r(38,"div",18),h(39,oe,21,1,"div",19,E),t(),r(41,"div",20)(42,"div",21)(43,"span",22),n(44,"Total Amount:"),t(),r(45,"span",23),n(46),t()()()(),r(47,"div",12)(48,"h3",24),n(49,"Payment Information"),t(),r(50,"div",25)(51,"div")(52,"label",4),n(53,"Paid Amount"),t(),d(54,"input",26),t(),r(55,"div")(56,"label",4),n(57,"Payment Status"),t(),r(58,"select",27)(59,"option",28),n(60,"Pending"),t(),r(61,"option",29),n(62,"Partial"),t(),r(63,"option",30),n(64,"Paid"),t()()(),r(65,"div",31)(66,"div",32)(67,"div",33),n(68,"Remaining Amount"),t(),r(69,"div",22),n(70),t()()()()(),r(71,"div",34)(72,"app-button",35),g("onClick",function(){return o.onCancel()}),n(73," Cancel "),t(),r(74,"app-button",36),n(75),t()()()()),i&2){let u;p("title",o.isEdit?"Edit Purchase Invoice":"Add New Purchase Invoice"),s(),D(o.errorMessage?1:-1),s(),p("formGroup",o.purchaseForm),s(7),A("border-red-500",((u=o.purchaseForm.get("invoiceNumber"))==null?null:u.invalid)&&((u=o.purchaseForm.get("invoiceNumber"))==null?null:u.touched)),s(9),f(o.suppliers),s(21),f(o.itemsArray.controls),s(7),v(o.formattedTotalAmount),s(24),v(o.formattedRemainingAmount),s(4),p("loading",o.loading)("disabled",o.purchaseForm.invalid||o.itemsArray.length===0),s(),N(" ",o.isEdit?"Update":"Create"," Purchase ")}},dependencies:[w,U,V,H,W,M,G,R,q,T,z,$,O,j,B,J,Y,Q],encapsulation:2})};export{ee as PurchaseFormComponent};
